<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[DC/OS Deployment]]></title>
      <url>http://blog.wuliwala.net/2016/04/21/dcos_installation/</url>
      <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p><strong>Every system operator always dreaming an infrastructure management tool like <a href="https://dcos.io" target="_blank" rel="external">DCOS</a>, makes job easier and more spare time.</strong><br>As you know, mesosphere.com released it as <a href="https://mesosphere.com/blog/2016/04/19/open-source-dcos/" target="_blank" rel="external">Open Source project</a> on 2016/04/19.<br>So I tried it the first time.<br>This post reords my steps followed the official <a href="https://dcos.io/get-started" target="_blank" rel="external">guide</a>.<br>In this example, all my node is running CentOS7(with <code>yum -y update</code>), I used 6 nodes(1 deploy, 1 master, 4 compute), and if you want master node High-Availability, 8 nodes(1 deploy, 3 master, 4 compute) is recommended.<br>After deployment, the deploy node can be destroyed, so it can be a temporary vm.</p>
<h3 id="System-Requirements"><a href="#System-Requirements" class="headerlink" title="System Requirements"></a>System Requirements</h3><p>Please read <a href="https://dcos.io/docs/1.7/administration/installing/custom/system-requirements/" target="_blank" rel="external">system-requirements</a> carefully.<br>First time, I encountered an issue. It’s a shell script in the progress of deployment, to change the storage-driver to overlayfs.<br>I don’t know why if run with this <code>-H fd://</code>, docker daemon can not get started.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo mkdir -p /etc/systemd/system/docker.service.d &amp;&amp; sudo tee /etc/systemd/system/docker.service.d/override.conf &lt;&lt;- EOF</div><div class="line">[Service]</div><div class="line">ExecStart=</div><div class="line">ExecStart=/usr/bin/docker daemon --storage-driver=overlay -H fd://</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ul>
<li>CentOS Linux release 7.2.1511 (Core)   </li>
<li>Linux 3.10.0-327.13.1.el7.x86_64  </li>
<li>docker 1.9.xx</li>
</ul>
<p>So I upgraded docker to v1.11.0</p>
<h3 id="Deployment-Progress"><a href="#Deployment-Progress" class="headerlink" title="Deployment Progress"></a>Deployment Progress</h3><h4 id="change-storage-driver-from-devicemapper-to-overlayfs"><a href="#change-storage-driver-from-devicemapper-to-overlayfs" class="headerlink" title="change storage-driver from devicemapper to overlayfs"></a>change storage-driver from devicemapper to overlayfs</h4><p><a href="https://docs.docker.com/engine/userguide/storagedriver/overlayfs-driver/" target="_blank" rel="external">docker official docs of storage driver</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">service docker stop</div><div class="line"></div><div class="line"><span class="comment"># remove  '-H fd://'</span></div><div class="line">sed -ie <span class="string">"/DOCKER_STORAGE_OPTIONS/s/=.*/='--storage-driver=overlay'/"</span> /etc/sysconfig/docker-storage</div><div class="line"></div><div class="line">service docker start</div><div class="line"></div><div class="line"><span class="comment"># check if storage-driver is overlay</span></div><div class="line">docker info</div></pre></td></tr></table></figure>
<h4 id="Download-amp-Start-the-DC-OS-installer"><a href="#Download-amp-Start-the-DC-OS-installer" class="headerlink" title="Download &amp; Start the DC/OS installer"></a>Download &amp; Start the DC/OS installer</h4><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">curl -O https://downloads.dcos.io/dcos/EarlyAccess/dcos_generate_config.sh</div><div class="line">bash dcos_generate_config.sh --web -v</div></pre></td></tr></table></figure>
<p>Launch the DC/OS web installer in your browser at: <code>http://&lt;bootstrap-node-public-ip&gt;:9000</code>.</p>
<p><strong>Follow this <a href="https://dcos.io/docs/1.7/administration/installing/custom/gui/" target="_blank" rel="external">GUI DC/OS Installation Guide</a>.</strong></p>
<h4 id="Uninstall-DC-OS"><a href="#Uninstall-DC-OS" class="headerlink" title="Uninstall DC/OS"></a>Uninstall DC/OS</h4><figure class="highlight mipsasm"><table><tr><td class="code"><pre><div class="line"><span class="keyword">bash </span>dcos_generate_config.<span class="keyword">sh </span>--uninstall</div></pre></td></tr></table></figure>
<h4 id="Authentication-opt-out"><a href="#Authentication-opt-out" class="headerlink" title="Authentication opt-out"></a>Authentication opt-out</h4><p><a href="https://dcos.io/docs/1.7/overview/security/#authentication-opt-out" target="_blank" rel="external">authentication-opt-out</a><br>If you are performing a custom advanced installation, you may opt out of Auth0-based authentication by adding the following directive to <code>genconf/config.yaml</code> (note that the quotes are currently required):</p>
<p><code>oauth_enabled: &#39;false&#39;</code></p>
<p>On AWS, when creating a stack, at the Specify Details step, you may choose to set the OAuthEnabled option to false to disable authentication for the DC/OS installation.</p>
<p>The same option is not currently available when installing DC/OS through the Azure Marketplace, but will be added in a future release along with other options to customize authentication.</p>
<h3 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h3><p><a href="http://elrepo.org/tiki/tiki-index.php" target="_blank" rel="external">ELrepo</a><br><a href="https://github.com/dcos/dcos" target="_blank" rel="external">dcos on github</a><br><a href="https://dcos.io/docs/1.7/administration/installing/custom/advanced/#configure-your-cluster" target="_blank" rel="external">configure-your-cluster</a></p>
<h3 id="All-right-it’s-show-time"><a href="#All-right-it’s-show-time" class="headerlink" title="All right, it’s show time"></a>All right, it’s show time</h3><p><img src="/images/2016/04/21/1.png" alt=""><br><img src="/images/2016/04/21/2.png" alt=""><br><img src="/images/2016/04/21/3.png" alt=""><br><img src="/images/2016/04/21/4.png" alt=""><br><img src="/images/2016/04/21/5.png" alt=""><br><img src="/images/2016/04/21/6.png" alt=""><br><img src="/images/2016/04/21/7.png" alt=""><br><img src="/images/2016/04/21/8.png" alt=""><br><img src="/images/2016/04/21/9.png" alt=""><br><img src="/images/2016/04/21/10.png" alt=""><br><img src="/images/2016/04/21/11.png" alt=""><br><img src="/images/2016/04/21/12.png" alt=""><br><img src="/images/2016/04/21/13.png" alt=""><br><img src="/images/2016/04/21/14.png" alt=""><br><img src="/images/2016/04/21/15.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Using NxLog to send Windows Event Logs to Logstash]]></title>
      <url>http://blog.wuliwala.net/2016/04/21/using_nxlog_to_send_windows_event_logs_to_logstash/</url>
      <content type="html"><![CDATA[<h2 id="Using-NxLog-to-send-Windows-Event-Logs-to-Logstash"><a href="#Using-NxLog-to-send-Windows-Event-Logs-to-Logstash" class="headerlink" title="Using NxLog to send Windows Event Logs to Logstash"></a>Using NxLog to send Windows Event Logs to Logstash</h2><h3 id="configure-logstash"><a href="#configure-logstash" class="headerlink" title="configure logstash"></a>configure logstash</h3><figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">input &#123;</div><div class="line">  tcp &#123;</div><div class="line">    codec =&gt; json_lines &#123; charset =&gt; <span class="string">"UTF-8"</span> &#125;</div><div class="line">    <span class="comment"># codec =&gt; json_lines &#123; charset =&gt; CP1252 &#125;</span></div><div class="line">    port =&gt; <span class="number">5000</span></div><div class="line">    tags =&gt; [ <span class="string">"tcpjson"</span> ]</div><div class="line">    type =&gt; <span class="string">"nxlog"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">filter &#123;</div><div class="line">  <span class="keyword">if</span> [type] == <span class="string">"nxlog"</span> &#123;</div><div class="line">    json &#123;</div><div class="line">      source =&gt; <span class="string">"message"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> [SourceModuleName] == <span class="string">"eventlog"</span> &#123;</div><div class="line">      mutate &#123;</div><div class="line">        replace =&gt; [ <span class="string">"message"</span>, <span class="string">"%&#123;Message&#125;"</span> ]</div><div class="line">      &#125;</div><div class="line">      mutate &#123;</div><div class="line">        remove_field =&gt; [ <span class="string">"Message"</span> ]</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    date &#123;</div><div class="line">      locale =&gt; <span class="string">"en"</span></div><div class="line">      <span class="comment"># timezone =&gt; "Etc/GMT"</span></div><div class="line">      timezone =&gt; <span class="string">"Asia/Shanghai"</span></div><div class="line">      match =&gt; [ <span class="string">"EventTime"</span>, <span class="string">"YYYY-MM-dd HH:mm:ss"</span> ]</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">  elasticsearch &#123;</div><div class="line">    hosts =&gt; [<span class="string">"YOUR_ELASTICSEARCH_SERVER"</span>]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="install-nxlog-ce"><a href="#install-nxlog-ce" class="headerlink" title="install nxlog-ce"></a>install nxlog-ce</h3><p><a href="http://nxlog.org/products/nxlog-community-edition/download" target="_blank" rel="external">download here</a>  </p>
<h3 id="modify-nxlog-conf"><a href="#modify-nxlog-conf" class="headerlink" title="modify nxlog.conf"></a>modify nxlog.conf</h3><figure class="highlight"><table><tr><td class="code"><pre><div class="line">## This is a sample configuration file. See the nxlog reference manual about the</div><div class="line">## configuration options. It should be installed locally and is also available</div><div class="line">## online at http://nxlog.org/docs/</div><div class="line"></div><div class="line">## Please set the ROOT to the folder your nxlog was installed into,</div><div class="line">## otherwise it will not start.</div><div class="line"></div><div class="line">#define ROOT C:\Program Files\nxlog</div><div class="line">define ROOT C:\Program Files (x86)\nxlog</div><div class="line"></div><div class="line">Moduledir %ROOT%\modules</div><div class="line">CacheDir %ROOT%\data</div><div class="line">Pidfile %ROOT%\data\nxlog.pid</div><div class="line">SpoolDir %ROOT%\data</div><div class="line">LogFile %ROOT%\data\nxlog.log</div><div class="line"></div><div class="line">&lt;Extension json&gt;</div><div class="line">    Module	xm_json</div><div class="line">&lt;/Extension&gt;</div><div class="line"></div><div class="line">&lt;Input eventlog&gt;</div><div class="line">    Module      im_msvistalog</div><div class="line">#    SavePos	TRUE</div><div class="line">    Query       &lt;QueryList&gt;\</div><div class="line">                    &lt;Query Id="0"&gt;\</div><div class="line">                        &lt;Select Path="Application"&gt;*&lt;/Select&gt;\</div><div class="line">                        &lt;Select Path="System"&gt;*&lt;/Select&gt;\</div><div class="line">                        &lt;Select Path="Security"&gt;*&lt;/Select&gt;\</div><div class="line">                    &lt;/Query&gt;\</div><div class="line">                &lt;/QueryList&gt;</div><div class="line">    Exec	to_json();</div><div class="line">&lt;/Input&gt;</div><div class="line"></div><div class="line">&lt;Output out&gt;</div><div class="line">    Module      om_tcp</div><div class="line">    Host        YOUR_LOGSTASH_SERVER</div><div class="line">    Port        5000</div><div class="line">&lt;/Output&gt;</div><div class="line"></div><div class="line">&lt;Route 1&gt;</div><div class="line">    Path        eventlog =&gt; out</div><div class="line">&lt;/Route&gt;</div></pre></td></tr></table></figure>
<h3 id="verify-configuration-file-syntax-and-start-service"><a href="#verify-configuration-file-syntax-and-start-service" class="headerlink" title="verify configuration file syntax and start service"></a>verify configuration file syntax and start service</h3><p><code>&quot;C:\Program Files (x86)\nxlog\nxlog.exe&quot; -v &amp;&amp; net start nxlog</code></p>
<h3 id="make-some-noise-on-your-windows-node"><a href="#make-some-noise-on-your-windows-node" class="headerlink" title="make some noise on your windows node"></a>make some noise on your windows node</h3><h4 id="then-you-will-see-it-in-elasticsearch"><a href="#then-you-will-see-it-in-elasticsearch" class="headerlink" title="then you will see it in elasticsearch"></a>then you will see it in elasticsearch</h4><h3 id="docs"><a href="#docs" class="headerlink" title="docs"></a>docs</h3><p><a href="http://nxlog.org/docs/nxlog-ce/nxlog-reference-manual.html" target="_blank" rel="external">nxlog-reference-manual</a><br><a href="http://nxlog.org/docs/elasticsearch-kibana/using-nxlog-with-elasticsearch-and-kibana.html" target="_blank" rel="external">using-nxlog-with-elasticsearch-and-kibana</a><br><a href="http://nxlog.org/docs/sysmon/audit-logging-on-windows-with-sysmon-and-nxlog.html" target="_blank" rel="external">audit-logging-on-windows-with-sysmon-and-nxlog</a><br><a href="https://www.elastic.co/guide/en/logstash/2.2/event-dependent-configuration.html" target="_blank" rel="external">logstash-event-dependent-configuration</a><br><a href="https://sematext.com/blog/2016/02/01/sending-windows-event-logs-to-logsene-using-nxlog-and-logstash/" target="_blank" rel="external">sending-windows-event-logs-to-logsene-using-nxlog-and-logstash</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Upgrade influxdb from v0.9 to v0.12]]></title>
      <url>http://blog.wuliwala.net/2016/04/12/upgrade_influxdb_from_v0.9_to_v0.10/</url>
      <content type="html"><![CDATA[<h2 id="Upgrade-influxdb-from-v0-9-to-v0-10"><a href="#Upgrade-influxdb-from-v0-9-to-v0-10" class="headerlink" title="Upgrade influxdb from v0.9 to v0.10"></a>Upgrade influxdb from v0.9 to v0.10</h2><h4 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h4><table>
<thead>
<tr>
<th>Comparison</th>
<th>0.9</th>
<th>0.10</th>
</tr>
</thead>
<tbody>
<tr>
<td>engine</td>
<td>b1\</td>
<td>bz1</td>
<td>tsm1</td>
</tr>
</tbody>
</table>
<h3 id="upgrade-from-v0-9-to-v0-10"><a href="#upgrade-from-v0-9-to-v0-10" class="headerlink" title="upgrade from v0.9 to v0.10"></a>upgrade from v0.9 to v0.10</h3><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">$ influx_tsm -h</div><div class="line">:&lt;&lt;DOC</div><div class="line">Usage: influx_tsm [options] &lt;data-path&gt; </div><div class="line"></div><div class="line">Convert a database from b1 or bz1 format to tsm1 format.</div><div class="line"></div><div class="line">This tool will backup the directories before conversion (<span class="keyword">if</span> not disabled).</div><div class="line">The backed-up files must be removed manually, generally after starting up the</div><div class="line">node again to make sure all of data has been converted correctly.</div><div class="line"></div><div class="line">To restore a backup:</div><div class="line">  Shut down the node, remove the converted directory, and</div><div class="line">  copy the backed-up directory to the original location.</div><div class="line"></div><div class="line">Options:</div><div class="line">  -backup=<span class="string">""</span>: The location to backup up the current databases. Must not be within the data directory.</div><div class="line">  -dbs=<span class="string">""</span>: Comma-delimited list of databases to convert. Default is to convert all databases.</div><div class="line">  -debug=<span class="string">""</span>: If <span class="built_in">set</span>, http debugging endpoints will be enabled on the given address</div><div class="line">  -interval=5s: How often status updates are printed.</div><div class="line">  -nobackup=<span class="literal">false</span>: Disable database backups. Not recommended.</div><div class="line">  -parallel=<span class="literal">false</span>: Perform parallel conversion. (up to GOMAXPROCS shards at once)</div><div class="line">  -profile=<span class="string">""</span>: CPU Profile location</div><div class="line">  -sz=2147483648: Maximum size of individual TSM files.</div><div class="line">  -y=<span class="literal">false</span>: Don<span class="string">'t ask, just convert</span></div><div class="line">DOC</div><div class="line"></div><div class="line">$ ls /var/lib/influxdb</div><div class="line">data  hh  meta  wal</div><div class="line"></div><div class="line">$ mkdir /tmp/influxdb_backup</div><div class="line"></div><div class="line">$ influx_tsm -backup /tmp/influxdb_backup /var/lib/influxdb/data</div><div class="line"></div><div class="line"># If you wish to minimize the time conversion takes, enable parallel mode with -parallel:</div><div class="line">$ influx_tsm -parallel=true -backup /tmp/influxdb_backup /var/lib/influxdb/data</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">:&lt;&lt;OUTPUT</div><div class="line">2016/04/19 00:18:44.362167 Still Working: Completed Shards: 27/28 Points read/written: 4192583424/4192583424</div><div class="line">2016/04/19 00:18:49.362387 Still Working: Completed Shards: 27/28 Points read/written: 4192625739/4192625739</div><div class="line">2016/04/19 00:18:54.362674 Still Working: Completed Shards: 27/28 Points read/written: 4192700371/4192700371</div><div class="line">2016/04/19 00:18:59.362906 Still Working: Completed Shards: 27/28 Points read/written: 4192806162/4192806162</div><div class="line">2016/04/19 00:19:04.363121 Still Working: Completed Shards: 27/28 Points read/written: 4192911040/4192911040</div><div class="line">2016/04/19 00:19:09.363313 Still Working: Completed Shards: 27/28 Points read/written: 4192911040/4192911040</div><div class="line">2016/04/19 00:19:13.912142 Conversion of /data/data/icinga/default/136 successful (8h6m31.481348028s)</div><div class="line"></div><div class="line">Summary statistics</div><div class="line">========================================</div><div class="line">Databases converted:                 2</div><div class="line">Shards converted:                    28</div><div class="line">TSM files created:                   28</div><div class="line">Points read:                         4192911040</div><div class="line">Points written:                      4192911040</div><div class="line">NaN filtered:                        0</div><div class="line">Inf filtered:                        0</div><div class="line">Points without fields filtered:      0</div><div class="line">Disk usage pre-conversion (bytes):   118480699392</div><div class="line">Disk usage post-conversion (bytes):  17643390726</div><div class="line">Reduction factor:                    85%</div><div class="line">Bytes per TSM point:                 4.21</div><div class="line">Total conversion time:               13h56m43.515786407s</div><div class="line">OUTPUT</div></pre></td></tr></table></figure>
<h3 id="official-upgrading-guides"><a href="#official-upgrading-guides" class="headerlink" title="official upgrading guides"></a>official upgrading guides</h3><p><a href="https://docs.influxdata.com/influxdb/v0.10/administration/upgrading/" target="_blank" rel="external">v0.10/administration/upgrading/</a><br><a href="https://docs.influxdata.com/influxdb/v0.11/administration/upgrading/" target="_blank" rel="external">v0.11/administration/upgrading/</a><br><a href="https://docs.influxdata.com/influxdb/v0.12/administration/upgrading/" target="_blank" rel="external">v0.12/administration/upgrading/</a><br><a href="http://www.slideshare.net/SeanBeckett4/influxdb-upgrade-to-010-considerations" target="_blank" rel="external">SeanBeckett4 influxdb-upgrade-to-010-considerations</a></p>
<h4 id="Example-Migration-2"><a href="#Example-Migration-2" class="headerlink" title="Example Migration #2"></a>Example Migration #2</h4><p>Conditions: </p>
<ul>
<li>Downtime is unacceptable  </li>
<li>Converting from 0.9  </li>
<li>Not clustered  </li>
</ul>
<ol>
<li>Install 0.10.1 on top of 0.9 and restart</li>
<li>Copy “cold” B1/BZ1 shards to /tmp</li>
<li>Run <code>./influx_tsm to convert cold shards influx_tsm -backup /tmp/influxdb_backup /tmp/data</code></li>
<li>Remove cold B1/BZ1 shards and replace with converted TSM shards</li>
<li>Wait until current “hot” shards become “cold”, repeat steps 2-4 on newly cold shards</li>
</ol>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SuperMicro Auto Deploy]]></title>
      <url>http://blog.wuliwala.net/2016/04/07/supermicro_auto_deploy/</url>
      <content type="html"><![CDATA[<h2 id="SuperMicro-Auto-Deploy"><a href="#SuperMicro-Auto-Deploy" class="headerlink" title="SuperMicro Auto Deploy"></a>SuperMicro Auto Deploy</h2><h3 id="SMCIPMITool-Usage"><a href="#SMCIPMITool-Usage" class="headerlink" title="SMCIPMITool Usage"></a>SMCIPMITool Usage</h3><h4 id="Query-FRU-info"><a href="#Query-FRU-info" class="headerlink" title="Query FRU info"></a>Query FRU info</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi fru</div><div class="line">:&lt;&lt;EOF</div><div class="line">Getting FRU ...</div><div class="line">Chassis Type (CT)              = Other (01h)</div><div class="line">Chassis Part Number (CP)       = CSE-217HQ-XXXX</div><div class="line">Chassis Serial Number (CS)     = C2170FE0XXXX</div><div class="line">Board mfg. Date/Time (BDT)     = 1996/01/01 00:00:00 (00 00 00)</div><div class="line">Board Manufacturer Name (BM)   = Supermicro</div><div class="line">Board Product Name (BPN)       = </div><div class="line">Board Serial Number (BS)       = VM15CSXXXX</div><div class="line">Board Part Number (BP)         = X10DRT-H</div><div class="line">Board FRU File ID              = </div><div class="line">Product Manufacturer Name (PM) = Supermicro</div><div class="line">Product Name (PN)              = </div><div class="line">Product PartModel Number (PPM) = SYS-2028TR-H72R</div><div class="line">Product Version (PV)           = </div><div class="line">Product Serial Number (PS)     = S173440XXXXXXX</div><div class="line">Product Asset Tag (PAT)        = </div><div class="line">Product FRU File ID            = </div><div class="line">EOF</div></pre></td></tr></table></figure>
<h4 id="Set-Next-Boot-from-PXE"><a href="#Set-Next-Boot-from-PXE" class="headerlink" title="Set Next Boot from PXE"></a>Set Next Boot from PXE</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">:&lt;&lt;EOF</div><div class="line">For bootoption index :</div><div class="line">1: PXE              2:  Hard-drive</div><div class="line">3: CD/DVD           4:  Bios</div><div class="line">5: USB KEY          6:  USB HDD</div><div class="line">7: USB Floppy       8:  USB CD/DVD</div><div class="line">9: UEFI Hard-drive  10: UEFI CD/DVD</div><div class="line">11: UEFI USB KEY    12: UEFI USB HDD</div><div class="line">13: UEFI USB CD/DVD    </div><div class="line">EOF</div><div class="line"></div><div class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi power bootoption 1 </div><div class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi power reset</div><div class="line"></div><div class="line">:&lt;&lt;EOF</div><div class="line">3.39.2 wsiso mount</div><div class="line">Use this <span class="built_in">command</span> to mount an ISO file.</div><div class="line">Usage:wsiso mount &lt;IP&gt; &lt;path&gt; [username] [password]</div><div class="line">      IP: IP or domain name of share host</div><div class="line">      path: path to iso file</div><div class="line">      username: username of share host (optional)</div><div class="line">      password: password of share host (optional)</div><div class="line">      Ex 1: mount linux.iso</div><div class="line">       wsiso mount 192.168.1.100 /iso/linux.iso</div><div class="line">      Ex 2: mount linux.iso with username and password</div><div class="line">       wsiso mount 192.168.1.100 /iso/linux.iso admin admin</div><div class="line">      * Use one ISO file at a time. Make sure umount existing ISO before mount new ISO</div><div class="line">    file</div><div class="line">      * This <span class="built_in">command</span> is available <span class="keyword">for</span> X9 and X10 platform with SFT-OOB-LIC node</div><div class="line">    product key</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h3 id="RAID-Configuration"><a href="#RAID-Configuration" class="headerlink" title="RAID Configuration"></a>RAID Configuration</h3><p><code>&lt;Ctrl&gt; - &lt;Y&gt;</code><br><strong>LSI Preboot CLI</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment"># pager 20 lines per page</span></div><div class="line">PDList a0 page20</div><div class="line"><span class="comment"># create one raid0 ld with one disk</span></div><div class="line">C<span class="built_in">fg</span>LdAdd r0 [252:0] a0<span class="comment"># create one raid1 ld with two disks</span>C<span class="built_in">fg</span>LdAdd r1 [252:0,252:1] a0C<span class="built_in">fg</span>Foreign Clear a0</div></pre></td></tr></table></figure>
<p><strong>Full Screen Cast Below</strong></p>
<figure class="highlight vim"><table><tr><td class="code"><pre><div class="line">Battery Statu<span class="variable">s:</span> Not present                                                                         </div><div class="line">                                                                                                    </div><div class="line">PCI SLOT ID LUN VENDOR    PRODUCT                   REVISION       CAPACITY                         </div><div class="line">-------- -- --- ------    -------                   --------       --------                         </div><div class="line"><span class="number">3</span>               LSI       Supermicro SMC2208        <span class="number">3.240</span>.<span class="number">05</span>-<span class="number">2282</span>  <span class="number">1024</span>MB                           </div><div class="line"><span class="number">3</span>        <span class="number">7</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">3</span>        <span class="number">8</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">0</span> Virtual Drive(s) found <span class="keyword">on</span> the host adapter.                                                       </div><div class="line">                                                                                                    </div><div class="line"><span class="number">0</span> Virtual Drive(s) handled by BIOS                                                                  </div><div class="line">Press <span class="symbol">&lt;Ctrl&gt;</span><span class="symbol">&lt;H&gt;</span> <span class="keyword">for</span> WebBIOS <span class="built_in">or</span> press <span class="symbol">&lt;Ctrl&gt;</span><span class="symbol">&lt;Y&gt;</span> <span class="keyword">for</span> Preboot CLI                                      </div><div class="line">                                                                                                    </div><div class="line">MegaPCLI SAS RAID Management Tool.                                                                  </div><div class="line">Copyright(<span class="keyword">c</span>) LSI Corporation, <span class="number">2008</span>.                                                                 </div><div class="line">Use -h -<span class="keyword">a</span><span class="symbol">&lt;n&gt;</span> <span class="keyword">for</span> controller specific <span class="keyword">help</span>, where n <span class="keyword">is</span> the controller <span class="built_in">index</span>                          </div><div class="line">Use -v -<span class="keyword">a</span><span class="symbol">&lt;n&gt;</span> <span class="keyword">for</span> controller specific <span class="keyword">version</span>, where n <span class="keyword">is</span> the controller <span class="built_in">index</span>                       </div><div class="line">Use q <span class="keyword">to</span> <span class="keyword">exit</span> from $ prompt                                                                         </div><div class="line">                                                                                                    </div><div class="line">Controller(s) Found                                                                                 </div><div class="line">HA-<span class="number">0</span> (Bus <span class="number">3</span> DevFn <span class="number">0</span>)                                                                                </div><div class="line">$                                                                                                   </div><div class="line">                                                                                                    </div><div class="line">$cfgforeign clear a0                                                                                </div><div class="line">                                                                                                    </div><div class="line">                                                                                                    </div><div class="line">Foreign configuration <span class="number">0</span> <span class="keyword">is</span> cleared <span class="keyword">on</span> controller <span class="number">0</span>.                                                 </div><div class="line">Foreign configuration <span class="number">1</span> <span class="keyword">is</span> cleared <span class="keyword">on</span> controller <span class="number">0</span>.                                                 </div><div class="line">Exit Code = <span class="number">0</span>x0                                                                                     </div><div class="line">$cfgldadd r1 [<span class="number">252</span>:<span class="number">0</span>,<span class="number">252</span>:<span class="number">1</span>] a0                                                                       </div><div class="line">                                                                                                    </div><div class="line">                                                                                                    </div><div class="line">Adapter <span class="number">0</span>: Created VD <span class="number">0</span>                                                                             </div><div class="line">                                                                                                    </div><div class="line">Adapter <span class="number">0</span>: Configured the Adapter!!                                                                 </div><div class="line">Exit Code = <span class="number">0</span>x0                                                                                     </div><div class="line">$q                                                                                                  </div><div class="line">Press <span class="symbol">&lt;CTL&gt;</span><span class="symbol">&lt;ALT&gt;</span><span class="symbol">&lt;DEL&gt;</span> <span class="keyword">to</span> reboot.</div></pre></td></tr></table></figure>
<p><strong>After Rebooting POST message will show</strong></p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><div class="line"><span class="symbol">LSI</span> MegaRAID SAS-MFI <span class="keyword">BIOS </span>                                                                          </div><div class="line"><span class="symbol">Version</span> <span class="number">5</span>.<span class="number">38</span>.<span class="number">00</span> (<span class="keyword">Build </span>October <span class="number">11</span>, <span class="number">2012</span>)                                                            </div><div class="line"><span class="symbol">Copyright</span>(c) <span class="number">2012</span> LSI Corporation                                                                   </div><div class="line"><span class="symbol">HA</span> -<span class="number">0</span> (<span class="keyword">Bus </span><span class="number">3</span> Dev <span class="number">0</span>) Supermicro <span class="keyword">SMC2208 </span>                                                             </div><div class="line"><span class="symbol">FW</span> package: <span class="number">23</span>.<span class="number">12</span>.<span class="number">0</span>.<span class="number">0011</span>                                                                            </div><div class="line">                                                                                                    </div><div class="line"><span class="keyword">Battery </span>Status: Not present                                                                         </div><div class="line">                                                                                                    </div><div class="line"><span class="symbol">PCI</span> SLOT ID LUN VENDOR    PRODUCT                   <span class="keyword">REVISION </span>      CAPACITY                         </div><div class="line">-------- -- --- ------    -------                   --------       --------                         </div><div class="line"><span class="number">3</span>               LSI       Supermicro <span class="keyword">SMC2208 </span>       <span class="number">3</span>.<span class="number">240</span>.<span class="number">05</span>-<span class="number">2282</span>  <span class="number">1024</span>MB                           </div><div class="line"><span class="number">3</span>        <span class="number">7</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">3</span>        <span class="number">8</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">3</span>           <span class="number">0</span>   LSI       Virtual Drive             RAID1          <span class="number">139236</span>MB                         </div><div class="line"><span class="number">1</span> Virtual Drive(s) found on the host adapter.                                                       </div><div class="line">                                                                                                    </div><div class="line"><span class="number">1</span> Virtual Drive(s) handled <span class="keyword">by </span><span class="keyword">BIOS </span>                                                                 </div><div class="line"><span class="symbol">Press</span> &lt;Ctrl&gt;&lt;H&gt; for WebBIOS or press &lt;Ctrl&gt;&lt;Y&gt; for Preboot CLI</div></pre></td></tr></table></figure>
<h3 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h3><p>错误信息为:<br><code>PXE-E7B: Missing MTFTP server IP address</code>  </p>
<p>Cisco设备是PortFast<br>Huawei设备里是<br>临时关掉生成树<br><code>stp disable</code><br>或者标记为边界端口<br><code>stp edged-port enable</code></p>
<h3 id="other-resources"><a href="#other-resources" class="headerlink" title="other resources"></a>other resources</h3><h4 id="boot-ipxe"><a href="#boot-ipxe" class="headerlink" title="boot.ipxe"></a>boot.ipxe</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">http://10.0.0.9/cgi-bin/pxe.py?mac=<span class="variable">$&#123;netX/mac&#125;</span>&amp;manufacturer=<span class="variable">$&#123;manufacturer&#125;</span>&amp;product=<span class="variable">$&#123;product&#125;</span>&amp;serial=<span class="variable">$&#123;serial&#125;</span>&amp;bserial=<span class="variable">$&#123;smbios/board-serial:string&#125;</span></div></pre></td></tr></table></figure>
<h4 id="WS-Management"><a href="#WS-Management" class="headerlink" title="WS-Management"></a>WS-Management</h4><p><code>wsman identify -h 10.0.0.100 -P 5985 -u ADMIN -p ADMIN</code></p>
<h4 id="flashrom"><a href="#flashrom" class="headerlink" title="flashrom"></a>flashrom</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment"># flashrom-0.9.9 install</span></div><div class="line">yum install -y zlib-devel libpciaccess-devel pciutils-devel libusb1-devel             </div><div class="line">make DESTDIR=/usr install</div></pre></td></tr></table></figure>
<h4 id="Intel-BootUtil"><a href="#Intel-BootUtil" class="headerlink" title="Intel BootUtil"></a>Intel BootUtil</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">yum install -y make gcc perl kernel-devel</div><div class="line">./install </div><div class="line"></div><div class="line">./bootutil64e <span class="_">-e</span></div><div class="line"></div><div class="line">:&lt;&lt;EOF</div><div class="line">Intel(R) Ethernet Flash Firmware Utility</div><div class="line">BootUtil version 1.5.94.2</div><div class="line">Copyright (C) 2003-2015 Intel Corporation</div><div class="line"></div><div class="line">NIC= 1 MACAddress=0CC47AB4C12E</div><div class="line">NIC= 2 MACAddress=0CC47AB4C12F</div><div class="line"></div><div class="line">Port Network Address Location Series  WOL Flash Firmware                Version</div><div class="line">==== =============== ======== ======= === ============================= =======</div><div class="line">  1   0CC47AB4C12E     1:00.0 Gigabit YES FLASH Not Present</div><div class="line">  2   0CC47AB4C12F     1:00.1 Gigabit NO  FLASH Not Present</div><div class="line">EOF</div><div class="line"></div><div class="line">./bootutil64e -nic 1 -saveimage -file 0CC47AB4C12E.rom</div><div class="line"></div><div class="line">./bootutil64e -nic 1 -saveimage -file 80861521.rom</div></pre></td></tr></table></figure>
<h4 id="SerialNumber"><a href="#SerialNumber" class="headerlink" title="SerialNumber"></a>SerialNumber</h4><p><code>dmidecode -s baseboard-serial-number</code> instead of <code>dmidecode -s system-serial-number</code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[can not add lun device in vsphere client]]></title>
      <url>http://blog.wuliwala.net/2016/03/29/can_not_add_lun_device_in_vsphere_client/</url>
      <content type="html"><![CDATA[<h2 id="Can-not-add-lun-device-in-vsphere-client"><a href="#Can-not-add-lun-device-in-vsphere-client" class="headerlink" title="Can not add lun device in vsphere client"></a>Can not add lun device in vsphere client</h2><blockquote>
<p>Call “HostStorageSystem.ComputeDiskPartitionInfo” for object “storageSystem” on ESXi “10.19.40.8” failed.</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">~ <span class="comment"># esxcfg-scsidevs -l</span></div><div class="line">naa.600508b1001037383941424344450400</div><div class="line">   Device Type: Direct-Access </div><div class="line">   Size: 69973 MB</div><div class="line">   Display Name: HP Serial Attached SCSI Disk (naa.600508b1001037383941424344450400)</div><div class="line">   Multipath Plugin: NMP</div><div class="line">   Console Device: /vmfs/devices/disks/naa.600508b1001037383941424344450400</div><div class="line">   Devfs Path: /vmfs/devices/disks/naa.600508b1001037383941424344450400</div><div class="line">   Vendor: HP        Model: LOGICAL VOLUME    Revis: 1.62 </div><div class="line">   SCSI Level: 5  Is Pseudo: <span class="literal">false</span> Status: degraded  </div><div class="line">   Is RDM Capable: <span class="literal">true</span>  Is Removable: <span class="literal">false</span> </div><div class="line">   Is Local: <span class="literal">false</span> Is SSD: <span class="literal">false</span> </div><div class="line">   Other Names: </div><div class="line">      vml.0200000000600508b10010373839414243444504004c4f47494341</div><div class="line">   VAAI Status: unknown</div><div class="line">naa.600508b1001037383941424344450700</div><div class="line">   Device Type: Direct-Access </div><div class="line">   Size: 139979 MB</div><div class="line">   Display Name: HP Serial Attached SCSI Disk (naa.600508b1001037383941424344450700)</div><div class="line">   Multipath Plugin: NMP</div><div class="line">   Console Device: /vmfs/devices/disks/naa.600508b1001037383941424344450700</div><div class="line">   Devfs Path: /vmfs/devices/disks/naa.600508b1001037383941424344450700</div><div class="line">   Vendor: HP        Model: LOGICAL VOLUME    Revis: 1.62 </div><div class="line">   SCSI Level: 5  Is Pseudo: <span class="literal">false</span> Status: degraded  </div><div class="line">   Is RDM Capable: <span class="literal">true</span>  Is Removable: <span class="literal">false</span> </div><div class="line">   Is Local: <span class="literal">false</span> Is SSD: <span class="literal">false</span> </div><div class="line">   Other Names: </div><div class="line">      vml.0200010000600508b10010373839414243444507004c4f47494341</div><div class="line">   VAAI Status: unknown</div><div class="line"></div><div class="line"></div><div class="line">~ <span class="comment"># partedUtil getptbl /dev/disks/naa.600508b1001037383941424344450700</span></div><div class="line">msdos</div><div class="line">17844 255 63 286677120</div><div class="line">1 32 286677119 131 0</div><div class="line">~ <span class="comment"># partedUtil get /dev/disks/naa.600508b1001037383941424344450700</span></div><div class="line">17844 255 63 286677120</div><div class="line">1 32 286677119 131 0</div><div class="line"></div><div class="line">~ <span class="comment"># partedUtil delete /dev/disks/naa.600508b1001037383941424344450700 1</span></div><div class="line">~ <span class="comment"># partedUtil getptbl /dev/disks/naa.600508b1001037383941424344450700</span></div><div class="line">msdos</div><div class="line">17844 255 63 286677120</div></pre></td></tr></table></figure>
<p><a href="https://communities.vmware.com/message/2294919#2294919" target="_blank" rel="external">QA id 2294919 in vmware’s community</a><br><a href="http://www.cnblogs.com/kk1230/p/3363737.html" target="_blank" rel="external">post on kk.1230’s blog</a><br><a href="https://communities.vmware.com/thread/458670" target="_blank" rel="external">QA id 458670 in vmware’s community</a>  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Learning ElasticSearch]]></title>
      <url>http://blog.wuliwala.net/2016/03/29/learning-elasticsearch/</url>
      <content type="html"><![CDATA[<h2 id="Learning-ElasticSearch"><a href="#Learning-ElasticSearch" class="headerlink" title="Learning ElasticSearch"></a>Learning ElasticSearch</h2><p>最近在学习ElasticSearch，从底层的Lucene开始了解<br>特别推荐这两本书，非常非常感谢社区的贡献，有机会还是支持出版的纸质书籍<br>这篇文章等于是对这两本书阅读后做了摘要，方便零基础的用户快速上手ElasticSearch<br><a href="https://github.com/looly/elasticsearch-definitive-guide-cn" target="_blank" rel="external">Elasticsearch 权威指南（中文版）</a><br><a href="https://www.gitbook.com/book/chenryn/kibana-guide-cn/details" target="_blank" rel="external">ELKstack 中文指南（ElasticSearch章节）</a>  </p>
<h3 id="ES-vs-SQL"><a href="#ES-vs-SQL" class="headerlink" title="ES vs SQL"></a>ES vs SQL</h3><table>
<thead>
<tr>
<th>Relational DB</th>
<th>Elasticsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Databases</td>
<td>Indices</td>
</tr>
<tr>
<td>Tables</td>
<td>Types</td>
</tr>
<tr>
<td>Rows</td>
<td>Documents</td>
</tr>
<tr>
<td>Columns</td>
<td>Fields</td>
</tr>
</tbody>
</table>
<p>Elasticsearch集群可以包含多个索引(indices)（数据库），每一个索引可以包含多个类型(types)（表），每一个类型包含多个文档(documents)（行），然后每个文档包含多个字段(Fields)（列）。  </p>
<h3 id="“索引”含义的区分"><a href="#“索引”含义的区分" class="headerlink" title="“索引”含义的区分"></a>“索引”含义的区分</h3><p>你可能已经注意到索引(index)这个词在Elasticsearch中有着不同的含义，所以有必要在此做一下区分:  </p>
<ul>
<li>索引（名词） 如上文所述，一个索引(index)就像是传统关系数据库中的数据库，它是相关文档存储的地方，index的复数是indices 或indexes。  </li>
<li>索引（动词） 「索引一个文档」表示把一个文档存储到索引（名词）里，以便它可以被检索或者查询。这很像SQL中的INSERT关键字，差别是，如果文档已经存在，新的文档将覆盖旧的文档。  </li>
<li>倒排索引 传统数据库为特定列增加一个索引，例如B-Tree索引来加速检索。Elasticsearch和Lucene使用一种叫做倒排索引(inverted index)的数据结构来达到相同目的。   </li>
</ul>
<h3 id="Excerise"><a href="#Excerise" class="headerlink" title="Excerise"></a>Excerise</h3><ol>
<li><p>Ping &amp; Server info</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http http://127.0.0.1:9200/</div><div class="line">&#123;</div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "name": "Goliath", </div><div class="line">    "status": 200, </div><div class="line">    "tagline": "You Know, for Search", </div><div class="line">    "version": &#123;</div><div class="line">        "build_hash": "c88f77ffc81301dfa9dfd81ca2232f09588bd512", </div><div class="line">        "build_snapshot": false, </div><div class="line">        "build_timestamp": "2015-02-19T13:05:36Z", </div><div class="line">        "lucene_version": "4.10.3", </div><div class="line">        "number": "1.4.4"</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>All rows</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http 'http://localhost:9200/_count'                   </div><div class="line">&#123;</div><div class="line">    "_shards": &#123;</div><div class="line">        "failed": 0, </div><div class="line">        "successful": 436, </div><div class="line">        "total": 436</div><div class="line">    &#125;, </div><div class="line">    "count": 35672472</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>All indices</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><div class="line">http 'localhost:9200/_cat/indices?v'</div><div class="line">health status index                pri rep docs.count docs.deleted store.size pri.store.size </div><div class="line">yellow open   .kibana               <span class="number"> 1 </span> <span class="number"> 1 </span>       <span class="number"> 10 </span>          <span class="number"> 2 </span>    27.5kb         27.5kb </div><div class="line">yellow open   logstash-2016.01.18   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 289193 </span>          <span class="number"> 0 </span>   170.8mb        170.8mb </div><div class="line">yellow open   logstash-2016.03.22   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 597585 </span>          <span class="number"> 0 </span>   141.1mb        141.1mb </div><div class="line">yellow open   logstash-2016.03.17   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 582696 </span>          <span class="number"> 0 </span>   138.5mb        138.5mb </div><div class="line">yellow open   logstash-2016.02.25   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 304186 </span>          <span class="number"> 0 </span>   103.2mb        103.2mb </div><div class="line">yellow open   logstash-2016.02.24   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 298755 </span>          <span class="number"> 0 </span>   102.5mb        102.5mb</div></pre></td></tr></table></figure>
</li>
<li><p>Cluster health</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http '127.0.0.1:9200/_cluster/health?pretty'</div><div class="line">&#123;</div><div class="line">    "active_primary_shards": 436, </div><div class="line">    "active_shards": 436, </div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "initializing_shards": 0, </div><div class="line">    "number_of_data_nodes": 1, </div><div class="line">    "number_of_nodes": 1, </div><div class="line">    "relocating_shards": 0, </div><div class="line">    "status": "yellow", </div><div class="line">    "timed_out": false, </div><div class="line">    "unassigned_shards": 436</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Nodes list</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><div class="line">http '<span class="number">127.0.0.1</span>:<span class="number">9200</span>/_cat/nodes'</div><div class="line"><span class="number">366d</span>cee<span class="number">51992 172.17</span>.<span class="number">5.127 78 80</span> <span class="number">1</span>.<span class="number">21</span> d * Goliath</div></pre></td></tr></table></figure>
</li>
<li><p>Task list</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><div class="line">http 'http://<span class="number">127.0.0.1:9200</span>/_cluster/pending_tasks'</div><div class="line">&#123;</div><div class="line">    <span class="string">"tasks"</span>: <span class="string">[]</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Node health<br><strong>jvm</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http '127.0.0.1:9200/_nodes/stats/jvm'</div><div class="line">&#123;</div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "nodes": &#123;</div><div class="line">        "vwKzZrSrTDidFr-jtZdRjg": &#123;</div><div class="line">            "host": "366dcee51992", </div><div class="line">            "ip": [</div><div class="line">                "inet[/172.17.5.127:9300]", </div><div class="line">                "NONE"</div><div class="line">            ], </div><div class="line">            "jvm": &#123;</div><div class="line">                "buffer_pools": &#123;</div><div class="line">                    "direct": &#123;</div><div class="line">                        "count": 1610, </div><div class="line">                        "total_capacity_in_bytes": 39064123, </div><div class="line">                        "used_in_bytes": 39064123</div><div class="line">                    &#125;, </div><div class="line">                    "mapped": &#123;</div><div class="line">                        "count": 2656, </div><div class="line">                        "total_capacity_in_bytes": 6260870265, </div><div class="line">                        "used_in_bytes": 6260870265</div><div class="line">                    &#125;</div><div class="line">                &#125;, </div><div class="line">                "gc": &#123;</div><div class="line">                    "collectors": &#123;</div><div class="line">                        "old": &#123;</div><div class="line">                            "collection_count": 20469, </div><div class="line">                            "collection_time_in_millis": 1804674</div><div class="line">                        &#125;, </div><div class="line">                        "young": &#123;</div><div class="line">                            "collection_count": 396171, </div><div class="line">                            "collection_time_in_millis": 4463746</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;, </div><div class="line">                "mem": &#123;</div><div class="line">                    "heap_committed_in_bytes": 1037959168, </div><div class="line">                    "heap_max_in_bytes": 1037959168, </div><div class="line">                    "heap_used_in_bytes": 849427344, </div><div class="line">                    "heap_used_percent": 81, </div><div class="line">                    "non_heap_committed_in_bytes": 85303296, </div><div class="line">                    "non_heap_used_in_bytes": 56807912, </div><div class="line">                    "pools": &#123;</div><div class="line">                        "old": &#123;</div><div class="line">                            "max_in_bytes": 715849728, </div><div class="line">                            "peak_max_in_bytes": 715849728, </div><div class="line">                            "peak_used_in_bytes": 672561680, </div><div class="line">                            "used_in_bytes": 602039528</div><div class="line">                        &#125;, </div><div class="line">                        "survivor": &#123;</div><div class="line">                            "max_in_bytes": 35782656, </div><div class="line">                            "peak_max_in_bytes": 35782656, </div><div class="line">                            "peak_used_in_bytes": 35782656, </div><div class="line">                            "used_in_bytes": 6359176</div><div class="line">                        &#125;, </div><div class="line">                        "young": &#123;</div><div class="line">                            "max_in_bytes": 286326784, </div><div class="line">                            "peak_max_in_bytes": 286326784, </div><div class="line">                            "peak_used_in_bytes": 286326784, </div><div class="line">                            "used_in_bytes": 241028640</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;, </div><div class="line">                "threads": &#123;</div><div class="line">                    "count": 130, </div><div class="line">                    "peak_count": 135</div><div class="line">                &#125;, </div><div class="line">                "timestamp": 1459242935482, </div><div class="line">                "uptime_in_millis": 2528035636</div><div class="line">            &#125;, </div><div class="line">            "name": "Goliath", </div><div class="line">            "timestamp": 1459242935482, </div><div class="line">            "transport_address": "inet[/172.17.5.127:9300]"</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>os</strong></p>
 <figure class="highlight"><table><tr><td class="code"><pre><div class="line">http '127.0.0.1:9200/_nodes/stats/os'</div><div class="line">&#123;</div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "nodes": &#123;</div><div class="line">        "vwKzZrSrTDidFr-jtZdRjg": &#123;</div><div class="line">            "host": "366dcee51992", </div><div class="line">            "ip": [</div><div class="line">                "inet[/172.17.5.127:9300]", </div><div class="line">                "NONE"</div><div class="line">            ], </div><div class="line">            "name": "Goliath", </div><div class="line">            "os": &#123;</div><div class="line">                "cpu": &#123;</div><div class="line">                    "idle": 75, </div><div class="line">                    "stolen": 0, </div><div class="line">                    "sys": 2, </div><div class="line">                    "usage": 17, </div><div class="line">                    "user": 15</div><div class="line">                &#125;, </div><div class="line">                "load_average": [</div><div class="line">                    3.23, </div><div class="line">                    2.33, </div><div class="line">                    2.27</div><div class="line">                ], </div><div class="line">                "mem": &#123;</div><div class="line">                    "actual_free_in_bytes": 5407027200, </div><div class="line">                    "actual_used_in_bytes": 28110413824, </div><div class="line">                    "free_in_bytes": 2586775552, </div><div class="line">                    "free_percent": 16, </div><div class="line">                    "used_in_bytes": 30930665472, </div><div class="line">                    "used_percent": 83</div><div class="line">                &#125;, </div><div class="line">                "swap": &#123;</div><div class="line">                    "free_in_bytes": 7885094912, </div><div class="line">                    "used_in_bytes": 8892116992</div><div class="line">                &#125;, </div><div class="line">                "timestamp": 1459245065474, </div><div class="line">                "uptime_in_millis": 21615006</div><div class="line">            &#125;, </div><div class="line">            "timestamp": 1459245065474, </div><div class="line">            "transport_address": "inet[/172.17.5.127:9300]"</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p>Index info</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http http://127.0.0.1:9200/logstash-2016.03.29/</div><div class="line">&#123;</div><div class="line">    "logstash-2016.03.29": &#123;</div><div class="line">        "aliases": &#123;&#125;, </div><div class="line">        "mappings": &#123;</div><div class="line">            "_default_": &#123;</div><div class="line">                "_all": &#123;</div><div class="line">                    "enabled": true</div><div class="line">                &#125;, </div><div class="line">                "dynamic_templates": [</div><div class="line">                    &#123;</div><div class="line">                        "string_fields": &#123;</div><div class="line">                            "mapping": &#123;</div><div class="line">                                "fields": &#123;</div><div class="line">                                    "raw": &#123;</div><div class="line">                                        "ignore_above": 256, </div><div class="line">                                        "index": "not_analyzed", </div><div class="line">                                        "type": "string"</div><div class="line">                                    &#125;</div><div class="line">                                &#125;, </div><div class="line">                                "index": "analyzed", </div><div class="line">                                "omit_norms": true, </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;, </div><div class="line">                            "match": "*", </div><div class="line">                            "match_mapping_type": "string"</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                ], </div><div class="line">                "properties": &#123;</div><div class="line">                    "@version": &#123;</div><div class="line">                        "index": "not_analyzed", </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "geoip": &#123;</div><div class="line">                        "dynamic": "true", </div><div class="line">                        "properties": &#123;</div><div class="line">                            "location": &#123;</div><div class="line">                                "type": "geo_point"</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;, </div><div class="line">            "syslog": &#123;</div><div class="line">                "_all": &#123;</div><div class="line">                    "enabled": true</div><div class="line">                &#125;, </div><div class="line">                "dynamic_templates": [</div><div class="line">                    &#123;</div><div class="line">                        "string_fields": &#123;</div><div class="line">                            "mapping": &#123;</div><div class="line">                                "fields": &#123;</div><div class="line">                                    "raw": &#123;</div><div class="line">                                        "ignore_above": 256, </div><div class="line">                                        "index": "not_analyzed", </div><div class="line">                                        "type": "string"</div><div class="line">                                    &#125;</div><div class="line">                                &#125;, </div><div class="line">                                "index": "analyzed", </div><div class="line">                                "omit_norms": true, </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;, </div><div class="line">                            "match": "*", </div><div class="line">                            "match_mapping_type": "string"</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                ], </div><div class="line">                "properties": &#123;</div><div class="line">                    "@timestamp": &#123;</div><div class="line">                        "format": "dateOptionalTime", </div><div class="line">                        "type": "date"</div><div class="line">                    &#125;, </div><div class="line">                    "@version": &#123;</div><div class="line">                        "index": "not_analyzed", </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "brief": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "count": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "geoip": &#123;</div><div class="line">                        "dynamic": "true", </div><div class="line">                        "properties": &#123;</div><div class="line">                            "location": &#123;</div><div class="line">                                "type": "geo_point"</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;, </div><div class="line">                    "host": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "hostname": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "info": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "log_type": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "module": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "msg": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "oid": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "serverity": &#123;</div><div class="line">                        "type": "long"</div><div class="line">                    &#125;, </div><div class="line">                    "severity": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "status": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog5424_pri": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_facility": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_facility_code": &#123;</div><div class="line">                        "type": "long"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_message": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_program": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_severity": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_severity_code": &#123;</div><div class="line">                        "type": "long"</div><div class="line">                    &#125;, </div><div class="line">                    "tags": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "timestamp": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "type": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;, </div><div class="line">        "settings": &#123;</div><div class="line">            "index": &#123;</div><div class="line">                "creation_date": "1459189864276", </div><div class="line">                "number_of_replicas": "1", </div><div class="line">                "number_of_shards": "5", </div><div class="line">                "refresh_interval": "5s", </div><div class="line">                "uuid": "qUZ_ZY3_RPOdhrdJ5mi32A", </div><div class="line">                "version": &#123;</div><div class="line">                    "created": "1040499"</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;, </div><div class="line">        "warmers": &#123;&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="cat-接口的命令行使用"><a href="#cat-接口的命令行使用" class="headerlink" title="cat 接口的命令行使用"></a>cat 接口的命令行使用</h3><p>之前介绍的各种接口数据，其响应数据都是 JSON 格式，更适用于程序处理。对于我们日常运维，在 Linux 命令行终端环境来说，简单的分行和分列表格才是更方便的样式。为此，Elasticsearch 提供了 cat 接口。</p>
<p>cat 接口可以读取各种监控数据，可用接口列表如下：</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><div class="line">/<span class="variable">_cat</span>/allocation</div><div class="line">/<span class="variable">_cat</span>/shards</div><div class="line">/<span class="variable">_cat</span>/shards/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/master</div><div class="line">/<span class="variable">_cat</span>/nodes</div><div class="line">/<span class="variable">_cat</span>/indices</div><div class="line">/<span class="variable">_cat</span>/indices/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/segments</div><div class="line">/<span class="variable">_cat</span>/segments/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/<span class="built_in">count</span></div><div class="line">/<span class="variable">_cat</span>/<span class="built_in">count</span>/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/recovery</div><div class="line">/<span class="variable">_cat</span>/recovery/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/health</div><div class="line">/<span class="variable">_cat</span>/pending_tasks</div><div class="line">/<span class="variable">_cat</span>/aliases</div><div class="line">/<span class="variable">_cat</span>/aliases/&#123;alias&#125;</div><div class="line">/<span class="variable">_cat</span>/thread_pool</div><div class="line">/<span class="variable">_cat</span>/plugins</div><div class="line">/<span class="variable">_cat</span>/fielddata</div><div class="line">/<span class="variable">_cat</span>/fielddata/&#123;fields&#125;</div></pre></td></tr></table></figure>
<h3 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h3><p>增删改查是数据库的基础操作方法。ES 虽然不是数据库，但是很多场合下，都被人们当做一个文档型 NoSQL 数据库在使用，原因自然是因为在接口和分布式架构层面的相似性。虽然在 ELKstack 场景下，数据的写入和查询，分别由 Logstash 和 Kibana 代劳，作为测试、调研和排错时的基本功，还是需要了解一下 ES 的增删改查用法的。</p>
<h3 id="数据写入"><a href="#数据写入" class="headerlink" title="数据写入"></a>数据写入</h3><p>ES 的一大特点，就是全 RESTful 接口处理 JSON 请求。所以，数据写入非常简单：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST http://127.0.0.1:9200/logstash-2015.06.21/testlog -d '&#123;</div><div class="line">    "date" : "1434966686000",</div><div class="line">    "user" : "chenlin7",</div><div class="line">    "mesg" : "first message into Elasticsearch"</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>命令返回响应结果为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"created"</span>:<span class="literal">true</span>&#125;</div></pre></td></tr></table></figure>
<h3 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h3><p>“可以看到，在数据写入的时候，会返回该数据的 _id。这就是后续用来获取数据的关键：</p>
<p><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK</code><br>命令返回响应结果为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"found"</span>:<span class="literal">true</span>,<span class="attr">"_source"</span>:&#123;</div><div class="line">    <span class="attr">"date"</span> : <span class="string">"1434966686000"</span>,</div><div class="line">    <span class="attr">"user"</span> : <span class="string">"chenlin7"</span>,</div><div class="line">    <span class="attr">"mesg"</span> : <span class="string">"first message into Elasticsearch"</span></div><div class="line">&#125;&#125;</div></pre></td></tr></table></figure>
<p>这个 _source 里的内容，正是之前写入的数据。</p>
<p>如果觉得这个返回看起来有点太过麻烦，可以使用<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_source</code><br>来指明只获取源数据部分。</p>
<p>更进一步的，如果你只想看数据中的一部分字段内容，可以使用<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK?fields=user,mesg</code><br>来指明获取字段，结果如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"found"</span>:<span class="literal">true</span>,<span class="attr">"fields"</span>:&#123;<span class="attr">"user"</span>:[<span class="string">"chenlin7"</span>],<span class="attr">"mesg"</span>:[<span class="string">"first message into Elasticsearch"</span>]&#125;&#125;</div></pre></td></tr></table></figure>
<h3 id="数据删除"><a href="#数据删除" class="headerlink" title="数据删除"></a>数据删除</h3><p>要删除数据，修改发送的 HTTP 请求方法为 DELETE 即可：<br><code>curl -XDELETE http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK</code><br>删除不单针对单条数据，还可以删除整个 type，乃至整个索引。甚至可以用通配符。<br><code>curl -XDELETE http://127.0.0.1:9200/logstash-2015.06.0*</code></p>
<h3 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h3><p>已经写过的数据，同样还是可以修改的。有两种办法，一种是全量提交，即指明 _id 再发送一次写入请求。</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK -d '&#123;</div><div class="line">    "date" : "1434966686000",</div><div class="line">    "user" : "chenlin7",</div><div class="line">    "mesg" " "first message into Elasticsearch but version 2"</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>另一种是局部更新，使用 /_update 接口：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_update' -d '&#123;</div><div class="line">    "doc" : &#123;</div><div class="line">        "user" : "someone"</div><div class="line">    &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_update' -d '&#123;</div><div class="line">    "script" : "ctx._source.user = \"someone\""</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<h3 id="搜索请求"><a href="#搜索请求" class="headerlink" title="搜索请求"></a>搜索请求</h3><p>上节介绍的，都是针对单条数据的操作。在 ES 环境中，更多的是搜索和聚合请求。在之前章节中，我们也介绍过数据获取和数据搜索的一点区别：==刚写入的数据，可以通过 translog 立刻获取；但是却要等到 refresh 成为一个 segment 后，才能被搜索到。==本节就介绍一下 ES 的搜索语法。</p>
<h3 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h3><p>ES 对搜索请求，有简易语法和完整语法两种方式。简易语法作为以后在 Kibana 上最常用的方式，一定是需要学会的。而在命令行里，我们可以通过最简单的方式来做到。还是上节输入的数据：<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/_search?q=first</code><br>可以看到返回结果：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"took"</span>:<span class="number">240</span>,<span class="attr">"timed_out"</span>:<span class="literal">false</span>,<span class="attr">"_shards"</span>:&#123;<span class="attr">"total"</span>:<span class="number">27</span>,<span class="attr">"successful"</span>:<span class="number">27</span>,<span class="attr">"failed"</span>:<span class="number">0</span>&#125;,<span class="attr">"hits"</span>:&#123;<span class="attr">"total"</span>:<span class="number">1</span>,<span class="attr">"max_score"</span>:<span class="number">0.11506981</span>,<span class="attr">"hits"</span>:[&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_score"</span>:<span class="number">0.11506981</span>,<span class="attr">"_source"</span>:&#123;</div><div class="line">    <span class="attr">"date"</span> : <span class="string">"1434966686000"</span>,</div><div class="line">    <span class="attr">"user"</span> : <span class="string">"chenlin7"</span>,</div><div class="line">    <span class="attr">"mesg"</span> : <span class="string">"first message into Elasticsearch"</span></div><div class="line">&#125;&#125;]&#125;&#125;</div></pre></td></tr></table></figure>
<p>还可以用下面语句搜索，结果是一样的。<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/_search?q=user:&quot;chenlin7</code></p>
<p>Excerpt From: 饶琛琳. “ELKstack 中文指南.” iBooks. </p>
<h3 id="querystring-语法"><a href="#querystring-语法" class="headerlink" title="querystring 语法"></a>querystring 语法</h3><p><code>curl -XGET http://127.0.0.1:9200/logstash-2016.03.29/_search?q=first</code></p>
<p>上例中，<code>?q=</code>后面写的，就是 querystring 语法。鉴于这部分内容会在 Kibana 上经常使用，这里详细解析一下语法：  </p>
<ul>
<li><strong>全文检索</strong>：直接写搜索的单词，如上例中的 <code>first</code>；</li>
<li><strong>单字段的全文检索</strong>：在搜索单词之前加上字段名和冒号，比如如果知道单词 first 肯定出现在 mesg 字段，可以写作 <code>mesg:first</code>；</li>
<li><strong>单字段的精确检索</strong>：在搜索单词前后加双引号，比如 <code>user:&quot;chenlin7&quot;</code>；<br>多个检索条件的组合：可以使用 NOT, AND 和 OR 来组合检索，注意必须是大写。比如 <code>user:(&quot;chenlin7&quot; OR &quot;chenlin&quot;) AND NOT mesg:first</code>；</li>
<li><strong>字段是否存在</strong>：<code>_exists_:user</code> 表示要求 user 字段存在，<code>_missing_:user</code> 表示要求 user 字段不存在；</li>
<li><strong>通配符</strong>：用 ? 表示单字母，<em> 表示任意个字母。比如 `fir?t mess</em>`；</li>
<li><strong>正则</strong>：需要比通配符更复杂一点的表达式，可以使用正则。比如 <code>mesg:/mes{2}ages?/</code>。注意 ES 中正则性能很差，而且支持的功能也不是特别强大，尽量不要使用。ES 支持的正则语法见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="external">query-dsl-regexp-query.html</a></li>
<li><strong>近似搜索</strong>：用 ~ 表示搜索单词可能有一两个字母写的不对，请 ES 按照相似度返回结果。比如 <code>frist~</code>；</li>
<li><strong>范围搜索</strong>：对数值和时间，ES 都可以使用范围搜索，比如：<code>rtt:&gt;300</code>，<code>date:[&quot;now-6h&quot; TO &quot;now&quot;}</code> 等。其中，<code>[]</code> 表示端点数值包含在范围内，<code>{}</code> 表示端点数值不包含在范围内；</li>
</ul>
<h3 id="完整语法"><a href="#完整语法" class="headerlink" title="完整语法"></a>完整语法</h3><p>ES 支持各种类型的检索请求，除了可以用 querystring 语法表达的以外，还有很多其他类型，具体列表和示例可参见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-queries.html" target="_blank" rel="external">query-dsl-regexp-query.html</a>。</p>
<p>作为最简单和常用的示例，这里展示一下 term query 的写法，相当于 querystring 语法中的 <code>user:&quot;chenlin7&quot;</code>：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XGET http://127.0.0.1:9200/_search -d '</div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "term": &#123;</div><div class="line">      "user": "chenlin7" </div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<h3 id="聚合请求"><a href="#聚合请求" class="headerlink" title="聚合请求"></a>聚合请求</h3><p>在检索范围确定之后，ES 还支持对结果集做聚合查询，返回更直接的聚合统计结果。在 ES 1.0 版本之前，这个接口叫 Facet，1.0 版本之后，这个接口改为 Aggregation。</p>
<p>Kibana 分别在 v3 中使用 Facet，v4 中使用 Aggregation。不过总的来说，Aggregation 是 Facet 接口的强化升级版本，我们直接了解 Aggregation 即可。本书后续章节也会介绍如何在 Kibana 的 v3 版本中使用 aggregation 接口做二次开发。</p>
<p>Aggregation 分为 bucket 和 metric 两种，分别用作词元划分和数值计算。而其中的 bucket aggregation，还支持在自身结果集的基础上，叠加新的 aggregation。这就是 aggregation 比 facet 最领先的地方。比如实现一个时序百分比统计，在 facet 接口就无法直接完成，而在 aggregation 接口就很简单了：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line"># curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.22/_search?size=0&amp;pretty' -d'&#123;</div><div class="line">    "aggs" : &#123;</div><div class="line">        "percentile_over_time" : &#123;</div><div class="line">            "date_histogram" : &#123;</div><div class="line">                "field"    : "@timestamp",</div><div class="line">                "interval" : "1h"</div><div class="line">            &#125;,</div><div class="line">            "aggs" : &#123;</div><div class="line">                "percentile_one_time" : &#123;</div><div class="line">                    "percentiles" : &#123;</div><div class="line">                        "field" : "requesttime"</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>得到结果如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span> : <span class="number">151595</span>,</div><div class="line">  <span class="attr">"timed_out"</span> : <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span> : &#123;</div><div class="line">    <span class="attr">"total"</span> : <span class="number">81</span>,</div><div class="line">    <span class="attr">"successful"</span> : <span class="number">81</span>,</div><div class="line">    <span class="attr">"failed"</span> : <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span> : &#123;</div><div class="line">    <span class="attr">"total"</span> : <span class="number">3307142043</span>,</div><div class="line">    <span class="attr">"max_score"</span> : <span class="number">1.0</span>,</div><div class="line">    <span class="attr">"hits"</span> : [ ]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"aggregations"</span> : &#123;</div><div class="line">    <span class="attr">"percentile_over_time"</span> : &#123;</div><div class="line">      <span class="attr">"buckets"</span> : [ &#123;</div><div class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"22/Jun/2015:22:00:00 +0000"</span>,</div><div class="line">        <span class="attr">"key"</span> : <span class="number">1435010400000</span>,</div><div class="line">        <span class="attr">"doc_count"</span> : <span class="number">459273981</span>,</div><div class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</div><div class="line">          <span class="attr">"values"</span> : &#123;</div><div class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</div><div class="line">            <span class="attr">"5.0"</span> : <span class="number">0.006</span>,</div><div class="line">            <span class="attr">"25.0"</span> : <span class="number">0.023</span>,</div><div class="line">            <span class="attr">"50.0"</span> : <span class="number">0.035</span>,</div><div class="line">            <span class="attr">"75.0"</span> : <span class="number">0.08774675719725569</span>,</div><div class="line">            <span class="attr">"95.0"</span> : <span class="number">0.25732934416125663</span>,</div><div class="line">            <span class="attr">"99.0"</span> : <span class="number">0.7508899754871812</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"23/Jun/2015:00:00:00 +0000"</span>,</div><div class="line">        <span class="attr">"key"</span> : <span class="number">1435017600000</span>,</div><div class="line">        <span class="attr">"doc_count"</span> : <span class="number">768620219</span>,</div><div class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</div><div class="line">          <span class="attr">"values"</span> : &#123;</div><div class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</div><div class="line">            <span class="attr">"5.0"</span> : <span class="number">0.007000000000000001</span>,</div><div class="line">            <span class="attr">"25.0"</span> : <span class="number">0.025</span>,</div><div class="line">            <span class="attr">"50.0"</span> : <span class="number">0.03987809503972864</span>,</div><div class="line">            <span class="attr">"75.0"</span> : <span class="number">0.10297843567746187</span>,</div><div class="line">            <span class="attr">"95.0"</span> : <span class="number">0.30047269327062875</span>,</div><div class="line">            <span class="attr">"99.0"</span> : <span class="number">1.015495933753329</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"23/Jun/2015:02:00:00 +0000"</span>,</div><div class="line">        <span class="attr">"key"</span> : <span class="number">1435024800000</span>,</div><div class="line">        <span class="attr">"doc_count"</span> : <span class="number">849467060</span>,</div><div class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</div><div class="line">          <span class="attr">"values"</span> : &#123;</div><div class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</div><div class="line">            <span class="attr">"5.0"</span> : <span class="number">0.008</span>,</div><div class="line">            <span class="attr">"25.0"</span> : <span class="number">0.027000000000000003</span>,</div><div class="line">            <span class="attr">"50.0"</span> : <span class="number">0.0439999899006102</span>,</div><div class="line">            <span class="attr">"75.0"</span> : <span class="number">0.1160416197625958</span>,</div><div class="line">            <span class="attr">"95.0"</span> : <span class="number">0.3383140614483838</span>,</div><div class="line">            <span class="attr">"99.0"</span> : <span class="number">1.0275839684542212</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125; ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ES 目前能支持的聚合请求列表，参见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_blank" rel="external">search-aggregations.html</a></p>
<h3 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h3><p>对不了解 JVM 的 GC 的读者，这里先介绍一下 GC(垃圾收集)以及 GC 对 Elasticsearch 的影响。</p>
<p>Java is a garbage-collected language, which means that the programmer does not manually manage memory allocation and deallocation. The programmer simply writes code, and the Java Virtual Machine (JVM) manages the process of allocating memory as needed, and then later cleaning up that memory when no longer needed. Java 是一个自动垃圾收集的编程语言，启动 JVM 虚拟机的时候，会分配到固定大小的内存块，这个块叫做 heap(堆)。JVM 会把 heap 分成两个组：</p>
<ul>
<li>Young 新实例化的对象所分配的空间。这个空间一般来说只有 100MB 到 500MB 大小。Young 空间又分为两个 survivor(幸存)空间。当 Young 空间满，就会发生一次 young gc，还存活的对象，就被移入幸存空间里，已失效的对象则被移除。</li>
<li>Old 老对象存储的空间。这些对象应该是长期存活而且在较长一段时间内不会变化的内容。“这个空间会大很多，在 ES 来说，一节点上可能就有 30GB 内存是这个空间。前面提到的 young gc 中，如果某个对象连续多次幸存下来，就会被移进 Old 空间内。而等到 Old 空间满，就会发生一次 old gc，把失效对象移除。<br>听起来很美好的样子，但是这些都是有代价的！在 GC 发生的时候，JVM 需要暂停程序运行，以便自己追踪对象图收集全部失效对象。在这期间，其他一切都不会继续运行。请求没有响应，ping 没有应答，分片不会分配……</li>
</ul>
<p>当然，young gc 一般来说执行极快，没太大影响。但是 old 空间那么大，稍慢一点的 gc 就意味着程序几秒乃至十几秒的不可用，这太危险了。</p>
<p>JVM 本身对 gc 算法一直在努力优化，Elasticsearch 也尽量复用内部对象，复用网络缓冲，然后还提供像 Doc Values 这样的特性。但不管怎么说，gc 性能总是我们需要密切关注的数据，因为它是集群稳定性最大的影响因子。</p>
<p>如果你的 ES 集群监控里发现经常有很耗时的 GC，说明集群负载很重，内存不足。严重情况下，这些 GC 导致节点无法正确响应集群之间的 ping ，可能就直接从集群里退出了。然后数据分片也随之在集群中重新迁移，引发更大的网络和磁盘 IO，正常的写入和搜索也会受到影响。</p>
<h3 id="查询慢"><a href="#查询慢" class="headerlink" title="查询慢"></a>查询慢</h3><p>更常见的可能，是集群存储长期数据导致索引映射数据确实大到了 master 节点内存不足以快速处理的地步。</p>
<p>这时候，根据实际情况，可以有以下几种选择：</p>
<p>索引就是特别多：给 master 加内存。<br>索引里字段太多：改用 nested object 方式节省字段数量。<br>索引多到内存就是不够了：把一部分数据拆出来另一个集群。</p>
<h3 id="Web-Console"><a href="#Web-Console" class="headerlink" title="Web Console"></a>Web Console</h3><p><a href="https://github.com/lmenezes/elasticsearch-kopf" target="_blank" rel="external">elasticsearch-kopf</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[segmentfault「我是工具控」分享]]></title>
      <url>http://blog.wuliwala.net/2016/03/19/segmentfault-tools-sharing/</url>
      <content type="html"><![CDATA[<h2 id="segmentfault-我是工具控-分享"><a href="#segmentfault-我是工具控-分享" class="headerlink" title="segmentfault[我是工具控]分享"></a>segmentfault[我是工具控]分享</h2><p> <strong>运维团队中的开发，4年运维工作经验，去年转开发。主要开发语言python，偶尔写shell、javascript.</strong></p>
<p>我的工具箱可能跟别人不太一样<br>大家装机必备的就不提了<br><a href="http://blog.wuliwala.net">我的博客</a> 欢迎交流</p>
<h3 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h3><ul>
<li><strong>ag</strong> 搜索代码炒鸡快！</li>
<li><strong>httpie</strong> 人类用的http测试工具</li>
<li><strong>jq</strong> 格式化json用的，跟<code>python -m json.tool</code>相比，是彩色的</li>
<li><strong>cowsay</strong> <strong>lolcat</strong> 好玩的，不解释</li>
</ul>
<h3 id="生活-效率"><a href="#生活-效率" class="headerlink" title="生活/效率"></a>生活/效率</h3><ul>
<li><strong>Keynote</strong> 特别喜欢苹果的这款产品，简洁易用，码农也能做出很好的幻灯片。曾用它做演讲稿，从产品、前端那里赢得几次分享、项目评比冠军。</li>
<li><strong>MacDown</strong> 以前用Mou，后来发现MacDown，代码着色要比Mou好很多，配合<strong>Hexo</strong>，也能用来写博客。</li>
<li><strong>eWallet</strong> 管理密码的，从windows就开始用，Mac平台也有。</li>
<li><strong>MindNode</strong> 看图，不解释<img src="/images/2016/03/19/mindnode.png" alt="mindnode"></li>
</ul>
<h3 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h3><ul>
<li><strong>MacVim</strong>今年开始学习，平时一般用它，写写shell脚本、python小程序；</li>
<li><strong>Atom</strong>项目用它，写前端不要太爽。</li>
<li><em><strong>TextMate</strong></em> 刚从windows换到Mac的时候非常怀念极轻量的<strong>Editplus</strong>，用了一阵，也还不错，今年主要学习vim，所以不用了。</li>
<li>我不用 <strong>oh~my~zsh</strong> 我用<strong>bash-it</strong> ，因为做了4年运维，对bash较熟，用过oh~my~zsh，感觉各种行为好怪异，简直无法愉快玩耍。<br>自己改的bash主题<img src="/images/2016/03/19/bash-it.png" alt="bash-it"></li>
</ul>
<p>有同学想要这个主题的话，可以访问<a href="https://github.com/arkii/gadgets/tree/master/Terminal" target="_blank" rel="external">我的github</a>。  </p>
<p>vim 插件，一天可是说不完的。。。</p>
<figure class="highlight sml"><table><tr><td class="code"><pre><div class="line"><span class="type">Plugin</span> <span class="symbol">'VundleVim</span>/<span class="type">Vundle</span>.vim'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'Valloric</span>/<span class="type">YouCompleteMe'</span></div><div class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/nerdtree'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/nerdcommenter'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/syntastic'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-airline/vim-airline'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-airline/vim-airline-themes'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-scripts/indentpython.vim'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'nvie</span>/vim-flake8'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'Xuyuanp</span>/nerdtree-git-plugin'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'xolox</span>/vim-misc'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'xolox</span>/vim-session'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'Chiel92</span>/vim-autoformat'</div></pre></td></tr></table></figure>
<p>Atom插件</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><div class="line">atom-beautify</div><div class="line">atom-<span class="keyword">sync</span></div><div class="line">color-picker</div><div class="line"><span class="keyword">file</span>-icons</div><div class="line">git-control</div><div class="line">git-status</div><div class="line">linter</div><div class="line">linter-jshint</div><div class="line">linter-pep8</div><div class="line">linter-<span class="keyword">python</span>-pep8</div><div class="line">minimap</div><div class="line"><span class="keyword">python</span>-tools</div><div class="line">tree-<span class="keyword">view</span>-git-status</div><div class="line"><span class="keyword">vim</span>-<span class="keyword">mode</span></div></pre></td></tr></table></figure>
<h3 id="工位无码图"><a href="#工位无码图" class="headerlink" title="工位无码图"></a>工位无码图</h3><p><img src="/images/2016/03/19/seat.jpeg" alt="工位无码图"></p>
<blockquote>
<p>本文参与了 SegmentFault<a href="https://segmentfault.com/a/1190000004537274" target="_blank" rel="external">「我是工具控」</a>分享，如果你也手持利器，那就一起来分享吧。</p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Migration From Subversion(svn) to Git]]></title>
      <url>http://blog.wuliwala.net/2016/03/14/migrate-to-git-from-svn/</url>
      <content type="html"><![CDATA[<h2 id="migration-from-subversion-svn-to-git"><a href="#migration-from-subversion-svn-to-git" class="headerlink" title="migration from subversion(svn) to git"></a>migration from subversion(svn) to git</h2><p>git officiall documents<br><a href="https://git-scm.com/docs/git-svn" target="_blank" rel="external">https://git-scm.com/docs/git-svn</a><br><a href="https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git" target="_blank" rel="external">https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E4%B8%8E%E5%85%B6%E4%BB%96%E7%B3%BB%E7%BB%9F-%E4%BD%9C%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84-Git" target="_blank" rel="external">https://git-scm.com/book/zh/v2/Git-与其他系统-作为客户端的-Git</a>  </p>
<p>install the latest git  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">yum -y install subversion subversion-perl perl-TermReadKey curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc xmlto docbook2x docbook2X</div><div class="line"></div><div class="line">wget https://www.kernel.org/pub/software/scm/git/git-2.7.3.tar.gz</div><div class="line">tar xvf git-2.7.3.tar.gz </div><div class="line"><span class="built_in">cd</span> git-2.7.3</div><div class="line">make configure</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/git2.7.3</div><div class="line">make -j8 all doc info</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/git2.7.3/bin/git /usr/bin/</div><div class="line"></div><div class="line">vim ~/.subversion/servers</div><div class="line"><span class="comment"># let store-passwords = yes</span></div><div class="line"></div><div class="line">git svn <span class="built_in">clone</span> --username dev https://svn.yourdomain.com/yourrepo</div><div class="line"></div><div class="line"><span class="built_in">cd</span> yourrepo</div><div class="line"></div><div class="line"><span class="comment"># 首次 first time</span></div><div class="line">git branch <span class="_">-a</span> </div><div class="line">git show-ref</div><div class="line"><span class="comment"># push to gitlab server</span></div><div class="line">git remote add origin ssh://git@gitlab.yourdomain.com/svn/yourrepo.git</div><div class="line">git push -u origin master</div><div class="line"></div><div class="line"><span class="comment"># 更新 update</span></div><div class="line">git svn fetch &amp;&amp; git svn rebase</div><div class="line">git push</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Searchcode Server Community Deploy]]></title>
      <url>http://blog.wuliwala.net/2016/03/08/searchcode-server-community-deploy/</url>
      <content type="html"><![CDATA[<h1 id="Searchcode-Server-Community-Deploy"><a href="#Searchcode-Server-Community-Deploy" class="headerlink" title="Searchcode Server Community Deploy"></a>Searchcode Server Community Deploy</h1><h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p><a href="https://searchcode.com" target="_blank" rel="external">https://searchcode.com</a></p>
<h2 id="query-syntax"><a href="#query-syntax" class="headerlink" title="query syntax"></a>query syntax</h2><p><a href="https://searchcode.com/#jumbo-examples" target="_blank" rel="external">https://searchcode.com/#jumbo-examples</a></p>
<h2 id="requirement"><a href="#requirement" class="headerlink" title="requirement"></a>requirement</h2><ul>
<li>Linux (in this example, I’m using CentOS6)  </li>
<li>JRE 8u65 <a href="http://www.oracle.com/technetwork/java/javase/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/archive-139210.html</a>  </li>
<li>searchcode-server-community 1.0.0 <a href="https://searchcode.com/static/searchcode-server-community.tar.gz" target="_blank" rel="external">https://searchcode.com/static/searchcode-server-community.tar.gz</a>  </li>
</ul>
<h2 id="installation"><a href="#installation" class="headerlink" title="installation"></a>installation</h2><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment"># download jre package from java archive website</span></div><div class="line">rpm -ivh jre-8u65-linux-x64.rpm</div><div class="line">wget https://searchcode.com/static/searchcode-server-community.tar.gz</div><div class="line">tar xf searchcode-server-community.tar.gz</div><div class="line">searchcode-server-community/release</div><div class="line">java -jar searchcode-1.0.0.jar</div></pre></td></tr></table></figure>
<p><strong>visit <a href="http://yourserverip:8080/" target="_blank" rel="external">http://yourserverip:8080/</a></strong>  </p>
<h2 id="use-my-docker-image"><a href="#use-my-docker-image" class="headerlink" title="use my docker image"></a>use my docker image</h2><h3 id="fresh-image-auto-build-and-keep-fresh-depend-on-author’s-api"><a href="#fresh-image-auto-build-and-keep-fresh-depend-on-author’s-api" class="headerlink" title="fresh image auto-build and keep fresh, depend on author’s api"></a>fresh image auto-build and keep fresh, depend on author’s api</h3><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">docker run -p 8080:8080 <span class="_">-d</span> docker.io/arkii/searchcode-server-community</div></pre></td></tr></table></figure>
<p>run image directly  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">docker run -p 8080:8080 <span class="_">-d</span> docker.io/arkii/searchcode-server</div></pre></td></tr></table></figure>
<p>or run image with docker-compose<br>docker-compose.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><div class="line"><span class="attr">searchcode:</span></div><div class="line"><span class="attr">  image:</span> arkii/searchcode-server</div><div class="line"><span class="attr">  volumes:</span></div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/index:/srv/index</div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/repo:/srv/repo</div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.properties:/srv/searchcode.properties</div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.sqlite:/srv/searchcode.sqlite</div><div class="line"><span class="attr">  ports:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">"8080:8080/tcp"</span></div></pre></td></tr></table></figure>
<p><strong>visit <a href="http://yourdockerserverip:8080/" target="_blank" rel="external">http://yourdockerserverip:8080/</a></strong>  </p>
<p>To administer your searchcode server instance you need to click on the Admin link in the top right.<br>Enter the default password <strong>Adm1n234</strong></p>
<h2 id="Dockerfiles"><a href="#Dockerfiles" class="headerlink" title="Dockerfiles"></a>Dockerfiles</h2><p><strong>build JRE 8u65 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><div class="line"><span class="keyword">FROM</span>        centos:<span class="number">6</span></div><div class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</div><div class="line"><span class="keyword">COPY</span><span class="bash">        ./jre-8u65-linux-x64.rpm /tmp/jre-8u65-linux-x64.rpm</span></div><div class="line"><span class="keyword">RUN</span><span class="bash">         rpm -ivh /tmp/jre-8u65-linux-x64.rpm &amp;&amp; rm <span class="_">-f</span> /tmp/jre-8u65-linux-x64.rpm</span></div></pre></td></tr></table></figure>
<p><strong>build Searchcode Server Community 1.0.0 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><div class="line"><span class="keyword">FROM</span>        arkii/centos6-jre-<span class="number">8</span>u65</div><div class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</div><div class="line"><span class="keyword">COPY</span><span class="bash">        ./searchcode-server-community/release /srv</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash">     /srv</span></div><div class="line"><span class="keyword">CMD</span><span class="bash">         /usr/bin/java -jar searchcode-1.0.0.jar</span></div><div class="line"><span class="keyword">EXPOSE</span>      <span class="number">8080</span>/tcp</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Wall-E web deployment]]></title>
      <url>http://blog.wuliwala.net/2016/03/01/wall-e-web-deployment/</url>
      <content type="html"><![CDATA[<h1 id="Wall-E-web-deployment"><a href="#Wall-E-web-deployment" class="headerlink" title="Wall-E web deployment"></a>Wall-E web deployment</h1><p>项目地址<br><a href="http://walle-web.io/" target="_blank" rel="external">http://walle-web.io/</a>  </p>
<p>安装文档<br><a href="http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html" target="_blank" rel="external">http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html</a>  </p>
<p>问题FAQ<br><a href="https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md" target="_blank" rel="external">https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md</a>  </p>
<p><a href="https://github.com/meolu/walle-web/archive/master.zip" target="_blank" rel="external">https://github.com/meolu/walle-web/archive/master.zip</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">rpm -Uvh http://mirror.webtatic.com/yum/el6/latest.rpm</div><div class="line">yum install -y php56w.x86_64 php56w-cli.x86_64 php56w-common.x86_64 php56w-gd.x86_64 php56w-ldap.x86_64 php56w-mbstring.x86_64 php56w-mcrypt.x86_64 php56w-mysql.x86_64 php56w-pdo.x86_64 php56w-xml.x86_64</div><div class="line">wget https://getcomposer.org/installer &amp;&amp; php installer &amp;&amp; mv composer.phar /usr/<span class="built_in">local</span>/bin/composer</div><div class="line"></div><div class="line">wget https://github.com/meolu/walle-web/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line"></div><div class="line"><span class="built_in">cd</span> walle-web-master</div><div class="line">composer install</div><div class="line"><span class="comment">#composer install --aprefer-dist --no-dev --optimize-autoloader -vvvv</span></div><div class="line"></div><div class="line">vi config/local.php</div><div class="line"></div><div class="line">./yii walle/setup</div><div class="line"></div><div class="line"><span class="built_in">cd</span> vendor</div><div class="line">ln <span class="_">-s</span> bower-asset/ bower</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'&lt;VirtualHost *:80&gt;</span></div><div class="line">ServerName walle.xxx.com</div><div class="line">DocumentRoot /var/www/html/web</div><div class="line">    &lt;Directory "/var/www/html/web"&gt;</div><div class="line">      Options  FollowSymLinks</div><div class="line">        AllowOverride ALL</div><div class="line">        Order allow,deny</div><div class="line">        Allow from all</div><div class="line">    &lt;/Directory&gt;</div><div class="line">&lt;/VirtualHost&gt;' &gt; /etc/httpd/conf.d/walle.conf</div></pre></td></tr></table></figure>
<p>default account<br>admin:admin</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ionic hybrid app development]]></title>
      <url>http://blog.wuliwala.net/2016/02/15/ionic-web-app-dev/</url>
      <content type="html"><![CDATA[<h1 id="ionic-hybrid-app-development"><a href="#ionic-hybrid-app-development" class="headerlink" title="ionic hybrid app development"></a>ionic hybrid app development</h1><h2 id="Video-Show"><a href="#Video-Show" class="headerlink" title="Video Show"></a>Video Show</h2><p><a href="/images/2016/02/15/ionic-dev-icinga-zol-480p.mp4">video show</a>  </p>
<h2 id="Frontend"><a href="#Frontend" class="headerlink" title="Frontend"></a>Frontend</h2><h3 id="ionic"><a href="#ionic" class="headerlink" title="ionic"></a>ionic</h3><p><a href="http://ionicframework.com/getting-started/" target="_blank" rel="external">getting-started</a><br><a href="http://usecreator.com/" target="_blank" rel="external">usecreator</a><br><a href="https://creator.ionic.io/app/dashboard/help/videos" target="_blank" rel="external">videos for creator</a><br><a href="http://codepen.io/ionic/pens/public/" target="_blank" rel="external">Many examples on codepen</a><br><a href="http://www.runoob.com/ionic" target="_blank" rel="external">courses on w3school.cc</a>  </p>
<h4 id="install-ionic"><a href="#install-ionic" class="headerlink" title="install ionic"></a>install ionic</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">npm install -g cordova ionic</div><div class="line">ionic start myApp blank</div><div class="line">ionic start myApp tabs</div><div class="line">ionic start myApp sidemenu</div></pre></td></tr></table></figure>
<h3 id="run-or-emulate-your-app"><a href="#run-or-emulate-your-app" class="headerlink" title="run or emulate your app"></a>run or emulate your app</h3><p><a href="http://ionicframework.com/docs/cli/run.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/run.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment">#安装cordova/ionic</span></div><div class="line">npm install -g cordova ionic</div><div class="line"></div><div class="line"><span class="comment">#添加平台(ios相关操作请在mac机器下o(&gt;﹏&lt;)o)</span></div><div class="line">ionic platform add android/ios</div><div class="line"></div><div class="line"><span class="comment">#更新项目中的ionic js类库</span></div><div class="line">ionic lib update</div><div class="line"></div><div class="line"><span class="comment">#展示ionic项目结果 (同时显示iOS和android上的样式)</span></div><div class="line">ionic serve --lab</div><div class="line"></div><div class="line"><span class="comment">#安装/删除crosswalk</span></div><div class="line">ionic browser add/remove crosswalk</div></pre></td></tr></table></figure>
<h3 id="Icon-and-Splash-Screen-Image-Generation"><a href="#Icon-and-Splash-Screen-Image-Generation" class="headerlink" title="Icon and Splash Screen Image Generation"></a>Icon and Splash Screen Image Generation</h3><p>Guide below<br><a href="http://ionicframework.com/docs/cli/icon-splashscreen.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/icon-splashscreen.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">cp ~/Downloads/logo11/free_logo_11.ai ./resources/icon.ai</div><div class="line">ionic resources --icon</div></pre></td></tr></table></figure>
<h3 id="splash-screen"><a href="#splash-screen" class="headerlink" title="splash screen"></a>splash screen</h3><p>2208 x 2208 splash.png  </p>
<p>search images on Google , set resolution to 2208 x 2208  </p>
<h2 id="Build-android-package"><a href="#Build-android-package" class="headerlink" title="Build android package"></a>Build android package</h2><p>Follow this guide<br><a href="http://ionicframework.com/docs/guide/publishing.html" target="_blank" rel="external">http://ionicframework.com/docs/guide/publishing.html</a>  </p>
<h3 id="安装android-sdk"><a href="#安装android-sdk" class="headerlink" title="安装android sdk"></a>安装android sdk</h3><p><a href="http://developer.android.com/sdk/installing/index.html" target="_blank" rel="external">http://developer.android.com/sdk/installing/index.html</a><br>Download Stand-alone SDK Tools  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">wget <span class="string">'http://dl.google.com/android/android-sdk_r24.4.1-macosx.zip'</span></div><div class="line">unzip android-sdk_r24.4.1-macosx.zip</div><div class="line">mv android-sdk-macosx /usr/<span class="built_in">local</span>/</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'export ANDROID_HOME="/usr/local/android-sdk-macosx"'</span> &gt;&gt; ~/.bash_profile</div><div class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$PATH:$ANDROID_HOME/tools"'</span> &gt;&gt; ~/.bash_profile</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'http.proxyPort=8123'</span> &gt;&gt; ~/.android/androidtool.cfg</div><div class="line"><span class="built_in">echo</span> <span class="string">'http.proxyHost=127.0.0.1'</span> &gt;&gt; ~/.android/androidtool.cfg</div><div class="line"></div><div class="line"><span class="comment"># android update sdk --no-ui</span></div><div class="line">android update sdk --no-https --no-ui --filter platform,system-image,tool,platform-tool</div><div class="line"></div><div class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT_FOLDER</span></div><div class="line"></div><div class="line">vim config.xml</div><div class="line"></div><div class="line"><span class="comment">#we should remove debug console plugin before generating the release builds</span></div><div class="line"></div><div class="line">cordova plugin rm cordova-plugin-console</div><div class="line"></div><div class="line">cordova build --release android</div><div class="line"></div><div class="line">/bin/cp platforms/android/build/outputs/apk/android-release-unsigned.apk ./</div><div class="line"></div><div class="line"><span class="comment"># keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000</span></div><div class="line">keytool -genkey -v -keystore icinga-mobile-release-key.keystore -alias icinga_mobile -keyalg RSA -keysize 2048 -validity 10000</div><div class="line"></div><div class="line"><span class="comment"># jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore android-release-unsigned.apk alias_name</span></div><div class="line">jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore icinga-mobile-release-key.keystore android-release-unsigned.apk icinga_mobile</div><div class="line"></div><div class="line"><span class="comment"># zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</span></div><div class="line">/usr/<span class="built_in">local</span>/android-sdk-macosx/build-tools/23.0.2/zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</div></pre></td></tr></table></figure>
<h2 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h2><p>style is much mess on Android  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// .config(function($stateProvider, $urlRouterProvider) &#123;</span></div><div class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$stateProvider, $urlRouterProvider , $ionicConfigProvider</span>) </span>&#123;</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.tabs.style(<span class="string">'standard'</span>);</div><div class="line">  $ionicConfigProvider.platform.ios.tabs.position(<span class="string">'bottom'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.tabs.style(<span class="string">'standard'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.tabs.position(<span class="string">'standard'</span>);</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.navBar.alignTitle(<span class="string">'center'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.navBar.alignTitle(<span class="string">'left'</span>);</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-ios-arrow-thin-left'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-android-arrow-back'</span>);</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.views.transition(<span class="string">'ios'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.views.transition(<span class="string">'android'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Ionic uses AngularUI Router which uses the concept of states</span></div><div class="line">  <span class="comment">// Learn more here: https://github.com/angular-ui/ui-router</span></div><div class="line">  <span class="comment">// Set up the various states which the app can be in.</span></div><div class="line">  <span class="comment">// Each state's controller can be found in controllers.js</span></div><div class="line">  $stateProvider</div></pre></td></tr></table></figure>
<h2 id="Useful-resources"><a href="#Useful-resources" class="headerlink" title="Useful resources"></a>Useful resources</h2><h3 id="vuejs"><a href="#vuejs" class="headerlink" title="vuejs"></a>vuejs</h3><p><a href="http://vuejs.org/" target="_blank" rel="external">vuejs</a><br><a href="https://github.com/vuejs/awesome-vue" target="_blank" rel="external">awesome-vue</a></p>
<h3 id="MaterializeCSS"><a href="#MaterializeCSS" class="headerlink" title="MaterializeCSS"></a>MaterializeCSS</h3><p><a href="http://materializecss.com/mobile.html" target="_blank" rel="external">Materialize</a>  </p>
<h2 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h2><p><a href="http://flask-restful.readthedocs.org/" target="_blank" rel="external">Flask-RESTful</a></p>
<h2 id="SDK-installation-output"><a href="#SDK-installation-output" class="headerlink" title="SDK installation output"></a>SDK installation output</h2><figure class="highlight subunit"><table><tr><td class="code"><pre><div class="line">Running command: /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/hooks/after_prepare/010_add_platform_class.js /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend</div><div class="line">add to body class: platform-android</div><div class="line"><span class="keyword">ERROR </span>building one of the platforms: Please install Android target: "android<span class="string">-23</span>".</div><div class="line"></div><div class="line">Hint: Open the SDK manager by running: /usr/local/android-sdk-macosx/tools/android</div><div class="line">You will require:</div><div class="line">1. "SDK Platform" for android<span class="string">-23</span></div><div class="line">2. "Android SDK Platform-tools (latest)</div><div class="line">3. "Android SDK Build-tools" (latest)</div><div class="line">You may not have the required environment or OS to build this project</div><div class="line"><span class="keyword">Error: </span>Please install Android target: "android<span class="string">-23</span>".</div><div class="line"></div><div class="line">Hint: Open the SDK manager by running: /usr/local/android-sdk-macosx/tools/android</div><div class="line">You will require:</div><div class="line">1. "SDK Platform" for android<span class="string">-23</span></div><div class="line">2. "Android SDK Platform-tools (latest)</div><div class="line">3. "Android SDK Build-tools" (latest)</div></pre></td></tr></table></figure>
<h2 id="Android-build-process-output"><a href="#Android-build-process-output" class="headerlink" title="Android build process output"></a>Android build process output</h2><figure class="highlight clean"><table><tr><td class="code"><pre><div class="line">Running command: /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/hooks/after_prepare/<span class="number">010</span>_add_platform_class.js /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend</div><div class="line">add to body <span class="keyword">class</span>: platform-android</div><div class="line">ANDROID_HOME=/usr/local/android-sdk-macosx</div><div class="line">JAVA_HOME=/Library/Java/Home</div><div class="line">Downloading http:<span class="comment">//services.gradle.org/distributions/gradle-2.2.1-all.zip</span></div><div class="line">.........................................................................</div><div class="line">:compileReleaseNdk UP-TO-DATE</div><div class="line">:compileReleaseSources</div><div class="line">:lintVitalRelease</div><div class="line">:transformClassesWithDexForRelease</div><div class="line">:mergeReleaseJniLibFolders</div><div class="line">:transformNative_libsWithMergeJniLibsForRelease</div><div class="line">:processReleaseJavaRes UP-TO-DATE</div><div class="line">:transformResourcesWithMergeJavaResForRelease</div><div class="line">:packageRelease</div><div class="line">:assembleRelease</div><div class="line">:cdvBuildRelease</div><div class="line"></div><div class="line">BUILD SUCCESSFUL</div><div class="line"></div><div class="line">Total time: <span class="number">5</span> mins <span class="number">21.356</span> secs</div><div class="line">Built the following apk(s): </div><div class="line">	/Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/platforms/android/build/outputs/apk/android-release-unsigned.apk</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[BitBar plugin icinga2 overview]]></title>
      <url>http://blog.wuliwala.net/2016/01/25/bitbar-plugin-icinga-overview/</url>
      <content type="html"><![CDATA[<h1 id="MacBitBar-Plugin-icinga2-api-overview-py"><a href="#MacBitBar-Plugin-icinga2-api-overview-py" class="headerlink" title="MacBitBar Plugin icinga2-api-overview.py"></a>MacBitBar Plugin icinga2-api-overview.py</h1><p>Plugin to show icinga2 tactical overview, developed by python, in order to use this plugin, you should enable icinga2-api first.  </p>
<h2 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h2><p><a href="/images/2016/01/25/macbitbar-icinga-overview-480p.mp4">screencast here</a><br><img src="/images/2016/01/25/icinga2-api-overview.png" alt="">  </p>
<h2 id="Install-MacBitBar"><a href="#Install-MacBitBar" class="headerlink" title="Install MacBitBar"></a>Install MacBitBar</h2><p>Download the latest package from site below<br><a href="https://github.com/matryer/bitbar/releases" target="_blank" rel="external">https://github.com/matryer/bitbar/releases</a><br>Or install it by brew cask<br><code>brew cask install bitbar</code></p>
<h2 id="Get-plugin"><a href="#Get-plugin" class="headerlink" title="Get plugin"></a>Get plugin</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py" target="_blank" rel="external">https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py</a>  </p>
<h2 id="Install-Plugin"><a href="#Install-Plugin" class="headerlink" title="Install Plugin"></a>Install Plugin</h2><p>Just download the plugin of your choice into your BitBar plugins directory and choose Refresh from one of the BitBar menu.  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">chmod +x icinga2-api-overview.py</div><div class="line"><span class="built_in">cd</span> Plugins/Enabled</div><div class="line"><span class="comment"># Enable uptime plugin and change update interval to 30 seconds</span></div><div class="line">ln <span class="_">-s</span> ../Utility/icinga2-api-overview.py icinga.30s.py</div></pre></td></tr></table></figure>
<h2 id="Other-plugins-built-by-me"><a href="#Other-plugins-built-by-me" class="headerlink" title="Other plugins built by me"></a>Other plugins built by me</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/" target="_blank" rel="external">https://github.com/arkii/gadgets/Utility/BitBar/</a></p>
<h2 id="MacBitBar"><a href="#MacBitBar" class="headerlink" title="MacBitBar"></a>MacBitBar</h2><p><img src="/images/2016/01/25/bitbar-logo@2x.png" alt=""><br>The BitBar app lets you put the output from any script or program right in your Mac OS X menu bar. And it’s completely free. An impressive number of plugins have already been contributed by a wide range of developers just like you, and this site makes it easy to find them.  </p>
<p>Homepage:<br><a href="https://getbitbar.com" target="_blank" rel="external">https://getbitbar.com</a><br>Projects:<br><a href="https://github.com/matryer/bitbar" target="_blank" rel="external">BitBar</a><br><a href="https://github.com/matryer/bitbar-plugins" target="_blank" rel="external">BitBar-Plugins</a>  </p>
<h2 id="NagBar"><a href="#NagBar" class="headerlink" title="NagBar"></a>NagBar</h2><p><img src="/images/2016/01/25/nagbarapp.png" alt=""><br>NagBar is a freeware Nagios, Icinga and Thruk monitoring client which runs in the status bar and give updates about the monitored services. NagBar is a Mac OS X native application created using the Cocoa framework.  </p>
<p>Homepage:<br><a href="https://sites.google.com/site/nagbarapp/" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/</a><br>Screenshots:<br><a href="https://sites.google.com/site/nagbarapp/screenshots" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/screenshots</a>  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2 influxdb grafana integration]]></title>
      <url>http://blog.wuliwala.net/2015/12/09/icinga2-influxdb-grafana-integration/</url>
      <content type="html"><![CDATA[<h1 id="icinga2-influxdb-grafana-integration"><a href="#icinga2-influxdb-grafana-integration" class="headerlink" title="icinga2 influxdb grafana integration"></a>icinga2 influxdb grafana integration</h1><p>Using influxdb as storage, icinga2 passing the performance data which returned by plugins, and grafana is used for data visulizing.  </p>
<h2 id="preparation"><a href="#preparation" class="headerlink" title="preparation"></a>preparation</h2><p><strong>plugins’ output is STRICTLY nagios standard output</strong></p>
<figure class="highlight cs"><table><tr><td class="code"><pre><div class="line"><span class="meta"># OK - load average: 0.69, 0.97, 0.94|load1=0.690;16.000;30.000;0; load5=0.970;20.000;32.000;0; load15=0.940;24.000;34.000;0; </span></div><div class="line"></div><div class="line"><span class="meta"># hosts</span></div><div class="line">icinga2.server1.host.hostalive.perfdata.pl.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449566712</span></div><div class="line">icinga2.server1.host.hostalive.perfdata.rta.<span class="keyword">value</span> <span class="number">0.0041609999999999998</span> <span class="number">1449566712</span></div><div class="line"></div><div class="line"><span class="meta"># services</span></div><div class="line">icinga2.server1.service.nrpe_load.perfdata.load1.<span class="keyword">value</span> <span class="number">0.01</span> <span class="number">1449567314</span></div><div class="line">icinga2.server1.service.nrpe_load.perfdata.load5.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></div><div class="line">icinga2.server1.service.nrpe_load.perfdata.load15.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></div></pre></td></tr></table></figure>
<h2 id="enable-icinga2-graphite-feature"><a href="#enable-icinga2-graphite-feature" class="headerlink" title="enable icinga2 graphite feature"></a>enable icinga2 graphite feature</h2><p><code># icinga2 feature enable perfdata</code><br><code># icinga2 feature enable graphite</code><br><code># vim /etc/icinga2/features-enabled/graphite.conf</code>  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * The GraphiteWriter type writes check result metrics and</div><div class="line"> * performance data to a graphite tcp socket.</div><div class="line"> */</div><div class="line"></div><div class="line">library <span class="string">"perfdata"</span></div><div class="line"></div><div class="line">object GraphiteWriter <span class="string">"graphite"</span> &#123;</div><div class="line">  <span class="comment">//host = "127.0.0.1"</span></div><div class="line">  <span class="comment">//port = 2003</span></div><div class="line">  host = <span class="string">"influxdb-server-with-graphite-plugin"</span></div><div class="line">  port = <span class="number">2004</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Optional. Metric prefix for host name. Defaults to "icinga2.$host.name$.host.$host.check_command$".</span></div><div class="line">host_name_template = <span class="string">"icinga2.$host.name$.host.$host.check_command$"</span></div><div class="line">service_name_template = <span class="string">"icinga2.$host.name$.service.$service.name$"</span></div><div class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.vars.nrpe_command$"</span></div><div class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.name$.$service.check_command$"</span></div><div class="line"><span class="comment">// Optional. Metric prefix for service name. Defaults to "icinga2.$host.name$.services.$service.name$.$service.check_command$".</span></div><div class="line"><span class="comment">// enable_send_thresholds = false // Optional. Send additional threshold metrics. Defaults to false.</span></div><div class="line"><span class="comment">// enable_send_metadata = false   // Optional. Send additional metadata metrics. Defaults to false.</span></div><div class="line"><span class="comment">// enable_legacy_mode = false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="define-the-internal-link-guiding-to-grafana-dashboard"><a href="#define-the-internal-link-guiding-to-grafana-dashboard" class="headerlink" title="define the internal link, guiding to grafana dashboard"></a>define the internal link, guiding to grafana dashboard</h2><p><code># vim /etc/icinga2/conf.d/templates.conf</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span> Service <span class="string">"grafana-svc"</span> &#123;</div><div class="line">  <span class="comment">// http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=kddi-zol-dealer-web1&amp;var-CMD=nrpe_ss</span></div><div class="line">  notes_url = <span class="string">"http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=$HOSTNAME$&amp;var-CMD=$SERVICEDESC$"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="apply-the-template"><a href="#apply-the-template" class="headerlink" title="apply the template"></a>apply the template</h2><p><code># vim /etc/icinga2/conf.d/services.conf</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line">apply Service <span class="string">"nrpe_ss"</span> &#123;</div><div class="line">        <span class="keyword">import</span> <span class="string">"generic-service"</span></div><div class="line">        <span class="keyword">import</span> <span class="string">"grafana-svc"</span></div><div class="line">                check_command = <span class="string">"nrpe"</span></div><div class="line">                assign where <span class="string">"webserver"</span> in host.groups</div><div class="line">                vars.nrpe_timeout = <span class="number">240</span></div><div class="line">                vars.nrpe_command = <span class="string">"check_ss"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>icinga2 daemon -C &amp;&amp; service icinga2 reload</code>  </p>
<h2 id="Influxdb-graphite-plugin-configuration"><a href="#Influxdb-graphite-plugin-configuration" class="headerlink" title="Influxdb graphite plugin configuration"></a>Influxdb graphite plugin configuration</h2><p><code># vim /etc/influxdb/influxdb.conf</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">[[graphite]]</div><div class="line">  enabled = true</div><div class="line">  database = "icinga"</div><div class="line">  bind-address = ":2004"</div><div class="line">  protocol = "tcp"</div><div class="line">  consistency-level = "one"</div><div class="line">  ignore-unnamed = true</div><div class="line">  name-separator = "|"</div><div class="line">  # name-separator = "_"</div><div class="line">  templates = [</div><div class="line">     "icinga2.*.host.*.perfdata.*.*                   .measurement..cmd..metric.value",</div><div class="line">     "icinga2.*.service.*.perfdata.*.*                .measurement..cmd..metric.value",</div><div class="line">  ]</div><div class="line"></div><div class="line">[[graphite]]</div><div class="line">  enabled = true</div><div class="line">  database = "graphite"</div><div class="line">  bind-address = ":2003"</div><div class="line">  protocol = "tcp"</div><div class="line">  consistency-level = "one"</div><div class="line">  # name-separator = ";"</div><div class="line">  name-separator = "."</div><div class="line"></div><div class="line">  # These next lines control how batching works. You should have this enabled</div><div class="line">  # otherwise you could get dropped metrics or poor performance. Batching</div><div class="line">  # will buffer points in memory if you have many coming in.</div><div class="line"></div><div class="line">  # batch-size = 1000 # will flush if this many points get buffered</div><div class="line">  # batch-pending = 5 # number of batches that may be pending in memory</div><div class="line">  # batch-timeout = "1s" # will flush at least this often even if we haven't hit buffer limit</div><div class="line">  # udp-read-buffer = 0 # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.</div><div class="line"></div><div class="line">  ## "name-schema" configures tag names for parsing the metric name from graphite protocol;</div><div class="line">  ## separated by `name-separator`.</div><div class="line">  ## The "measurement" tag is special and the corresponding field will become</div><div class="line">  ## the name of the metric.</div><div class="line">  ## e.g. "type.host.measurement.device" will parse "server.localhost.cpu.cpu0" as</div><div class="line">  ## &#123;</div><div class="line">  ##     measurement: "cpu",</div><div class="line">  ##     tags: &#123;</div><div class="line">  ##         "type": "server",</div><div class="line">  ##         "host": "localhost,</div><div class="line">  ##         "device": "cpu0"</div><div class="line">  ##     &#125;</div><div class="line">  ## &#125;</div><div class="line">  # name-schema = "type.host.measurement.device"</div><div class="line"></div><div class="line">  ## If set to true, when the input metric name has more fields than `name-schema` specified,</div><div class="line">  ## the extra fields will be ignored.</div><div class="line">  ## Otherwise an error will be logged and the metric rejected.</div><div class="line">  # ignore-unnamed = true</div><div class="line"></div><div class="line">###</div><div class="line">### [collectd]</div><div class="line">###</div><div class="line">### Controls the listener for collectd data.</div><div class="line">###</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line"># grafana template variables</div><div class="line">$HOST</div><div class="line">SHOW MEASUREMENTS</div><div class="line">$CMD</div><div class="line">SHOW TAG VALUES FROM "$HOST" WITH KEY = "cmd"</div><div class="line">$METRIC</div><div class="line">SHOW TAG VALUES FROM "$HOST" WITH KEY = "metric" WHERE cmd = '$CMD'</div></pre></td></tr></table></figure>
<p><strong>grafana query below</strong><br><img src="/images/2015/12/1.png" alt="grafana-query"></p>
<h2 id="Get-the-share-link-from-grafana-dashboard"><a href="#Get-the-share-link-from-grafana-dashboard" class="headerlink" title="Get the share link from grafana dashboard"></a>Get the share link from grafana dashboard</h2><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://grafana.yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen&amp;var-HOST=server1&amp;var-CMD=nrpe_ss"</span> <span class="attr">width</span>=<span class="string">"450"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>cd /etc/icingaweb2/enabledModules/pnp4nagios/</code></p>
<p>icingaweb2 modules API here<br><code>/usr/share/icingaweb2/modules/monitoring/library/Monitoring/Object/Service.php</code></p>
<p>add grafana integration into icingaweb2   </p>
<p><code>/usr/share/icingaweb2/modules/pnp4nagios/library/Pnp4nagios/Grapher.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grapher</span> <span class="keyword">extends</span> <span class="title">GrapherHook</span></span></div><div class="line">&#123;</div><div class="line">    .........OLD COLD BLOCK........</div><div class="line">    </div><div class="line">    <span class="keyword">protected</span> $baseUrl = <span class="string">'/pnp4nagios'</span>;</div><div class="line">    <span class="keyword">protected</span> $grafanaBaseUrl = <span class="string">'http://yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen'</span>;</div><div class="line">    </div><div class="line">    .........OLD COLD BLOCK........</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPreviewHtml</span><span class="params">(MonitoredObject $object)</span></span></div><div class="line">    &#123;</div><div class="line">    </div><div class="line">        .........OLD COLD BLOCK........</div><div class="line">        </div><div class="line">        $html .= <span class="string">"  &lt;/tr&gt;\n  &lt;tr&gt;\n"</span>;</div><div class="line">        <span class="keyword">foreach</span> ($viewKeys <span class="keyword">as</span> $view) &#123;</div><div class="line">            $html .= <span class="string">'    &lt;td style="border-left: 1px solid #555; padding-right: 3px"&gt;'</span></div><div class="line">                   . <span class="keyword">$this</span>-&gt;getPreviewImg($host, $service, $view)</div><div class="line">                   . <span class="string">"&lt;/td&gt;\n"</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Arkii 2015.12.14 added Grafana Integration</span></div><div class="line">        <span class="keyword">if</span> ($service != <span class="string">'_HOST_'</span> &amp;&amp; $object-&gt;service_notes_url) &#123;</div><div class="line">            $html .= <span class="string">"&lt;tr&gt;\n &lt;td&gt;\n"</span>;</div><div class="line">            $grafanaIframe = sprintf(</div><div class="line">                <span class="string">'&lt;iframe src="%s&amp;var-HOST=%s&amp;var-CMD=%s" width="480" height="150" frameborder="0"&gt;&lt;/iframe&gt;'</span>,</div><div class="line">                <span class="keyword">$this</span>-&gt;grafanaBaseUrl,</div><div class="line">                $host,</div><div class="line">                $service);</div><div class="line">            $html .= $grafanaIframe;</div><div class="line">            $html .= <span class="string">"&lt;/td&gt;\n &lt;/tr&gt;\n"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// end of Grafana Integration</span></div><div class="line"></div><div class="line">        $html .= <span class="string">"&lt;/tr&gt;&lt;/table&gt;\n"</span>;</div><div class="line">        <span class="keyword">return</span> $html;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="demos"><a href="#demos" class="headerlink" title="demos"></a>demos</h2><p><strong>work aside pnp4nagios</strong><br><img src="/images/2015/12/5.png" alt=""><br><strong>click the notes_url</strong><br><img src="/images/2015/12/2.png" alt="icinga-"><br><strong>jumped to your grafana dashboard</strong><br><img src="/images/2015/12/3.png" alt="grafana-1"><br><strong>another metric</strong><br><img src="/images/2015/12/4.png" alt="grafana-2"></p>
<h2 id="many-useful-links"><a href="#many-useful-links" class="headerlink" title="many useful links"></a>many useful links</h2><p><a href="http://play.grafana.org/" target="_blank" rel="external">so many grafana examples here</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins#addons-graphing-influxdb" target="_blank" rel="external">enable influxdb writer</a><br><a href="http://www.infoq.com/articles/graphite-intro" target="_blank" rel="external">graphite-intro-en</a><br><a href="http://www.infoq.com/cn/articles/graphite-intro" target="_blank" rel="external">graphite-intro-cn</a><br><a href="https://github.com/influxdb/influxdb/tree/master/services/graphite" target="_blank" rel="external">InfluxDB hook up Graphite as an input source</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/monitoring-basics#runtime-macros" target="_blank" rel="external">icinga2-runtime-macros</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/object-types#objecttype-graphitewriter" target="_blank" rel="external">icinga2-objecttype-graphitewriter</a><br><strong>Intruduced Performance Data Pipe of icinga2 in GREAT DETAIL[非常详细的icinga2性能数据管道说明]:</strong><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/icinga2-features#performance-data" target="_blank" rel="external">icinga2-performance-data</a></p>
<h2 id="updated-2016-07-21"><a href="#updated-2016-07-21" class="headerlink" title="updated 2016.07.21"></a>updated 2016.07.21</h2><p><strong>how to create grafana template variables</strong><br>For this tutorial I’m using Grafana 2.0, I suggest you study on these two dashboards in playground @ grafana. </p>
<p>You can also edit graphs and look at the template settings.</p>
<p><a href="http://play.grafana.org/dashboard/db/monitorama-templating" target="_blank" rel="external">http://play.grafana.org/dashboard/db/monitorama-templating</a>  </p>
<p><a href="http://play.grafana.org/dashboard/db/templating-value-groups" target="_blank" rel="external">http://play.grafana.org/dashboard/db/monitorama-templating</a>  </p>
<p><img src="/images/2015/12/template1.png" alt="template-1">  </p>
<p><img src="/images/2015/12/template2.png" alt="template-2">  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to build tinycorelinux docker image]]></title>
      <url>http://blog.wuliwala.net/2015/12/07/how-to-build-tinycorelinux-docker-image/</url>
      <content type="html"><![CDATA[<h1 id="how-to-build-tinycorelinux-docker-image"><a href="#how-to-build-tinycorelinux-docker-image" class="headerlink" title="how to build tinycorelinux docker image"></a>how to build tinycorelinux docker image</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">wget http://tinycorelinux.net/6.x/x86_64/release/distribution_files/corepure64.gz</div><div class="line">mkdir chroot</div><div class="line">gunzip corepure64.gz</div><div class="line">cd chroot/</div><div class="line">cpio -i &lt; ../corepure64</div><div class="line">cd ..</div><div class="line">tar -C chroot -c . | docker import - tinycorelinux</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to configure httpd proxy with authentication]]></title>
      <url>http://blog.wuliwala.net/2015/12/02/how-to-configure-httpd-proxy-with-authentication/</url>
      <content type="html"><![CDATA[<h1 id="how-to-configure-httpd-proxy-with-authentication"><a href="#how-to-configure-httpd-proxy-with-authentication" class="headerlink" title="how to configure httpd proxy with authentication"></a>how to configure httpd proxy with authentication</h1><p><code>vi gen.php</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;?php</div><div class="line">echo base64_encode(&quot;user:password&quot;);</div><div class="line">?&gt;</div></pre></td></tr></table></figure></p>
<p><code>php gen.php</code><br><code>dXNlcjpwYXNzd29yZA==</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">RewriteEngine On</div><div class="line">RewriteRule ^/orin/(.*)$    http://target.lb.com/$1   [NC,L,P]</div><div class="line"></div><div class="line">&lt;LocationMatch &quot;^/orin/(.*)$&quot;&gt;</div><div class="line">    #AddDefaultCharset GBK</div><div class="line">    RequestHeader set Authorization &quot;dXNlcjpwYXNzd29yZA==&quot;</div><div class="line">    ProxyPass http://target.lb.com/$1</div><div class="line">&lt;/LocationMatch&gt;</div></pre></td></tr></table></figure>
<h2 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h2><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_headers.html" target="_blank" rel="external">mod_headers</a><br><a href="https://httpd.apache.org/docs/2.4/rewrite/flags.html#flag_p" target="_blank" rel="external">rewrite flags</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassreverse" target="_blank" rel="external">mod_proxy.html</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to configure httpd with ldap authentication]]></title>
      <url>http://blog.wuliwala.net/2015/12/01/how-to-configure-httpd-with-ldap-authentication/</url>
      <content type="html"><![CDATA[<h1 id="how-to-configure-httpd-with-ldap-authentication"><a href="#how-to-configure-httpd-with-ldap-authentication" class="headerlink" title="how to configure httpd with ldap authentication"></a>how to configure httpd with ldap authentication</h1><h2 id="httpd-2-4-ldap"><a href="#httpd-2-4-ldap" class="headerlink" title="httpd 2.4 ldap"></a>httpd 2.4 ldap</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">LoadModule authn_core_module modules/mod_authn_core.so</div><div class="line">LoadModule authz_host_module modules/mod_authz_host.so</div><div class="line">LoadModule authz_user_module modules/mod_authz_user.so</div><div class="line">LoadModule authz_core_module modules/mod_authz_core.so</div><div class="line">LoadModule access_compat_module modules/mod_access_compat.so</div><div class="line">LoadModule auth_basic_module modules/mod_auth_basic.so</div><div class="line">LoadModule ldap_module modules/mod_ldap.so</div><div class="line">LoadModule authnz_ldap_module modules/mod_authnz_ldap.so</div><div class="line"></div><div class="line">&lt;VirtualHost *:*&gt;</div><div class="line">ProxyPass / http://elk-kibana:5601/</div><div class="line">ProxyPassReverse / http://elk-kibana:5601/</div><div class="line"></div><div class="line">&lt;Proxy *&gt;</div><div class="line">Require all granted</div><div class="line"></div><div class="line"># LDAPSharedCacheSize 500000</div><div class="line"># LDAPCacheEntries 1024</div><div class="line"># LDAPCacheTTL 600</div><div class="line"># LDAPOpCacheEntries 1024</div><div class="line"># LDAPOpCacheTTL 600</div><div class="line">AuthType Basic</div><div class="line">AuthName &quot;Login with LDAP&quot;</div><div class="line">AuthBasicProvider ldap</div><div class="line">AuthLDAPURL &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;</div><div class="line">AuthLDAPBindDN &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;</div><div class="line">AuthLDAPBindPassword &lt;PUT Operator&apos;s PASSWORD HERE&gt;</div><div class="line">require valid-user</div><div class="line">&lt;/Proxy&gt; </div><div class="line"></div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
<h3 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h3><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_ldap.html" target="_blank" rel="external">mod_ldap</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_authnz_ldap.html" target="_blank" rel="external">mod_authnz_ldap</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to configure nginx with ldap authentication]]></title>
      <url>http://blog.wuliwala.net/2015/12/01/how-to-configure-nginx-with-ldap-authentication/</url>
      <content type="html"><![CDATA[<h1 id="how-to-configure-nginx-with-ldap-authentication"><a href="#how-to-configure-nginx-with-ldap-authentication" class="headerlink" title="how to configure nginx with ldap authentication"></a>how to configure nginx with ldap authentication</h1><h2 id="build-from-source"><a href="#build-from-source" class="headerlink" title="build from source"></a>build from source</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">version=&apos;1.8.0&apos;</div><div class="line"></div><div class="line">apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</div><div class="line"></div><div class="line">mkdir build &amp;&amp; cd build</div><div class="line">wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line">wget http://nginx.org/download/nginx-$&#123;version&#125;.tar.gz</div><div class="line">tar xvf nginx-$&#123;version&#125;.tar.gz &amp;&amp; cd nginx-$&#123;version&#125;</div><div class="line"></div><div class="line">./configure \</div><div class="line">--prefix=/etc/nginx \</div><div class="line">--sbin-path=/usr/sbin/nginx \</div><div class="line">--conf-path=/etc/nginx/nginx.conf \</div><div class="line">--error-log-path=/var/log/nginx/error.log \</div><div class="line">--http-log-path=/var/log/nginx/access.log \</div><div class="line">--pid-path=/var/run/nginx.pid \</div><div class="line">--lock-path=/var/run/nginx.lock \</div><div class="line">--http-client-body-temp-path=/var/cache/nginx/client_temp \</div><div class="line">--http-proxy-temp-path=/var/cache/nginx/proxy_temp \</div><div class="line">--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</div><div class="line">--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</div><div class="line">--http-scgi-temp-path=/var/cache/nginx/scgi_temp \</div><div class="line">--user=nginx \</div><div class="line">--group=nginx \</div><div class="line">--with-http_ssl_module \</div><div class="line">--with-http_realip_module \</div><div class="line">--with-http_addition_module \</div><div class="line">--with-http_sub_module \</div><div class="line">--with-http_dav_module \</div><div class="line">--with-http_flv_module \</div><div class="line">--with-http_mp4_module \</div><div class="line">--with-http_gunzip_module \</div><div class="line">--with-http_gzip_static_module \</div><div class="line">--with-http_random_index_module \</div><div class="line">--with-http_secure_link_module \</div><div class="line">--with-http_stub_status_module \</div><div class="line">--with-http_auth_request_module \</div><div class="line">--with-mail \</div><div class="line">--with-mail_ssl_module \</div><div class="line">--with-file-aio \</div><div class="line">--with-http_spdy_module \</div><div class="line">--with-ipv6 \</div><div class="line">--add-module=../nginx-auth-ldap-master</div><div class="line"></div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">FROM debian:jessie</div><div class="line"># bugs here https://github.com/kvspb/nginx-auth-ldap/issues/88</div><div class="line"># nginx: [emerg] http_auth_ldap: parse_require in /etc/nginx/nginx.conf:45</div><div class="line"># nginx: [emerg] http_auth_ldap: Setting group in /etc/nginx/nginx.conf:45</div><div class="line">MAINTAINER Arkii &quot;sqy6@163.com&quot;</div><div class="line"></div><div class="line">RUN echo &apos;Asia/Shanghai&apos; &gt; /etc/timezone &amp;&amp; \</div><div class="line">    /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</div><div class="line">    groupadd -g 396 nginx &amp;&amp; \</div><div class="line">    useradd nginx -u 396 -g 396 -M -c &apos;Nginx web server&apos; -s /sbin/nologin -d /var/lib/nginx &amp;&amp; \</div><div class="line">    mkdir -p /var/log/nginx /var/lib/nginx /var/cache/nginx /usr/share/nginx &amp;&amp; \</div><div class="line">    chown -R nginx:nginx /var/log/nginx /var/lib/nginx /var/cache/nginx &amp;&amp; \</div><div class="line">    ln -sf /dev/stdout /var/log/nginx/access.log &amp;&amp; \</div><div class="line">    ln -sf /dev/stderr /var/log/nginx/error.log</div><div class="line"></div><div class="line">ENV NGINX_VERSION 1.8.0</div><div class="line"></div><div class="line">RUN apt-get update &amp;&amp; \</div><div class="line">    apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</div><div class="line"></div><div class="line">RUN mkdir /tmp/build &amp;&amp; cd /tmp/build &amp;&amp; \</div><div class="line">    wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip &amp;&amp; \</div><div class="line">    unzip master.zip &amp;&amp; \</div><div class="line">    wget http://nginx.org/download/nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; \</div><div class="line">    tar xf nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; cd nginx-$&#123;NGINX_VERSION&#125; &amp;&amp; \</div><div class="line"></div><div class="line">    ./configure \</div><div class="line">    --prefix=/etc/nginx \</div><div class="line">    --sbin-path=/usr/sbin/nginx \</div><div class="line">    --conf-path=/etc/nginx/nginx.conf \</div><div class="line">    --error-log-path=/var/log/nginx/error.log \</div><div class="line">    --http-log-path=/var/log/nginx/access.log \</div><div class="line">    --pid-path=/var/run/nginx.pid \</div><div class="line">    --lock-path=/var/run/nginx.lock \</div><div class="line">    --http-client-body-temp-path=/var/cache/nginx/client_temp \</div><div class="line">    --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</div><div class="line">    --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</div><div class="line">    --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</div><div class="line">    --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</div><div class="line">    --user=nginx \</div><div class="line">    --group=nginx \</div><div class="line">    --with-http_ssl_module \</div><div class="line">    --with-http_realip_module \</div><div class="line">    --with-http_addition_module \</div><div class="line">    --with-http_sub_module \</div><div class="line">    --with-http_dav_module \</div><div class="line">    --with-http_flv_module \</div><div class="line">    --with-http_mp4_module \</div><div class="line">    --with-http_gunzip_module \</div><div class="line">    --with-http_gzip_static_module \</div><div class="line">    --with-http_random_index_module \</div><div class="line">    --with-http_secure_link_module \</div><div class="line">    --with-http_stub_status_module \</div><div class="line">    --with-http_auth_request_module \</div><div class="line">    --with-mail \</div><div class="line">    --with-mail_ssl_module \</div><div class="line">    --with-file-aio \</div><div class="line">    --with-http_spdy_module \</div><div class="line">    --with-ipv6 \</div><div class="line">    --add-module=../nginx-auth-ldap-master &amp;&amp; \</div><div class="line"></div><div class="line">    make &amp;&amp; make install</div><div class="line"></div><div class="line">RUN apt-get remove -y gcc wget make unzip &amp;&amp; \</div><div class="line">       rm -rf /var/lib/apt/lists/*</div><div class="line"></div><div class="line">EXPOSE 80 443 8000 8080</div><div class="line">ENTRYPOINT [&quot;nginx&quot;]</div><div class="line">CMD [&quot;-g&quot;, &quot;daemon off;&quot;]</div></pre></td></tr></table></figure>
<h2 id="configfile-example"><a href="#configfile-example" class="headerlink" title="configfile example"></a>configfile example</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line"># user  nobody;</div><div class="line">worker_processes  1;</div><div class="line"></div><div class="line"># error_log  logs/error.log;</div><div class="line"># error_log  logs/error.log  notice;</div><div class="line"># error_log  logs/error.log  info;</div><div class="line"></div><div class="line"># pid        logs/nginx.pid;</div><div class="line"></div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line"></div><div class="line">    #access_log  logs/access.log  main;</div><div class="line"></div><div class="line">    sendfile        on;</div><div class="line">    #tcp_nopush     on;</div><div class="line"></div><div class="line">    #keepalive_timeout  0;</div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line">    #gzip  on;</div><div class="line"></div><div class="line">    auth_ldap_cache_enabled on;</div><div class="line">    auth_ldap_cache_expiration_time 10000;</div><div class="line">    auth_ldap_cache_size 1000;</div><div class="line">    ldap_server ad_1 &#123;</div><div class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</div><div class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</div><div class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</div><div class="line">      #connect_timeout 5s;</div><div class="line">      #bind_timeout 5s;</div><div class="line">      #request_timeout 5s;</div><div class="line">      group_attribute member;</div><div class="line">      group_attribute_is_dn on;</div><div class="line">      satisfy any;</div><div class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</div><div class="line">    &#125;</div><div class="line">    ldap_server ad_2 &#123;</div><div class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</div><div class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</div><div class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</div><div class="line">      #connect_timeout 5s;</div><div class="line">      #bind_timeout 5s;</div><div class="line">      #request_timeout 5s;</div><div class="line">      group_attribute member;</div><div class="line">      group_attribute_is_dn on;</div><div class="line">      satisfy any;</div><div class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  localhost;</div><div class="line"></div><div class="line">        auth_ldap &quot;Login with LDAP account&quot;;</div><div class="line">        auth_ldap_servers ad_1;</div><div class="line">        auth_ldap_servers ad_2;</div><div class="line"></div><div class="line">        #charset koi8-r;</div><div class="line"></div><div class="line">        #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        #error_page  404              /404.html;</div><div class="line"></div><div class="line">        # redirect server error pages to the static page /50x.html</div><div class="line">        #</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="image-on-Docker-hub"><a href="#image-on-Docker-hub" class="headerlink" title="image on Docker hub"></a>image on Docker hub</h2><p><code>docker pull docker.io/arkii/nginx-ldap:1.8.0</code></p>
<p><a href="https://github.com/kvspb/nginx-auth-ldap" target="_blank" rel="external">github</a><br><a href="http://deezx.github.io/blog/2015/04/24/how-to-configure-nginx-with-ldap-authentication/" target="_blank" rel="external">blog</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[When A Man Loves A Woman]]></title>
      <url>http://blog.wuliwala.net/2015/11/27/when-a-man-loves-a-woman/</url>
      <content type="html"><![CDATA[<h1 id="When-A-Man-Loves-A-Woman"><a href="#When-A-Man-Loves-A-Woman" class="headerlink" title="When A Man Loves A Woman"></a>When A Man Loves A Woman</h1><p>作词 : Calvin Lewis/Andrew Wright<br>原唱 : Percy Sledge<br>翻唱 : Michael Bolton, 金润吉<br>当一个男人爱上一个女人<br>他的脑子就再也装不下任何东西<br>他宁愿出卖整个世界<br>就为了他寻得的挚爱<br>如果她很坏，他也看不到<br>她不会错<br>他甚至会背弃最好的朋友<br>如果朋友敢轻视她  </p>
<p>当一个男人爱上一个女人<br>会花光他的每一分<br>来维持他所需要的<br>他愿意放弃所有安逸<br>露宿街头 睡在雨中<br>如果她说就该做这些事  </p>
<p>当一个男人爱上一个女人<br>他会献出自己的所有<br>试图保住 这份宝贵的爱<br>宝贝请别忽视我  </p>
<p>当一个男人爱上一个女人<br>他的灵魂深处<br>她能使他痛苦如斯<br>如果她玩弄他如一个傻瓜<br>他也永远后知后觉<br>陷入爱河的人总是盲目  </p>
<p>是的当一个男人爱上一个女人<br>我完全了解他的心思  </p>
<p>当一个男人爱上一个女人  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[给gitlab添加gitlab-ci和gitlab-runner]]></title>
      <url>http://blog.wuliwala.net/2015/11/19/gitlab-ci-and-runner/</url>
      <content type="html"><![CDATA[<h1 id="给gitlab添加gitlab-ci和gitlab-runner"><a href="#给gitlab添加gitlab-ci和gitlab-runner" class="headerlink" title="给gitlab添加gitlab-ci和gitlab-runner"></a>给gitlab添加gitlab-ci和gitlab-runner</h1><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>使用的是<strong>gitlab v7.13.3</strong>。<br>run在docker中。<br>配置了ldap登录，和smtp邮件通知。<strong>失败时会发送邮件通知</strong><br>最近测试gitlab-ci服务。  </p>
<h3 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置:"></a>服务配置:</h3><p>直接在配置文件gitlab.rb底部打开相关配置，即可使用。<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">############################################</div><div class="line"># Url on which GitLab CI will be reachable #</div><div class="line">############################################</div><div class="line">## see https://gitlab.com/gitlab-org/omnibus-gitlab/tree/629def0a7a26e7c2326566f0758d4a27857b52a3/doc/gitlab-ci/README.md</div><div class="line"></div><div class="line">ci_external_url &apos;http://ci.gitlab.yourdomain.com&apos;</div><div class="line"></div><div class="line"></div><div class="line">#################################</div><div class="line"># application.yml configuration #</div><div class="line">#################################</div><div class="line"># 这个app_id在gitlab中创建application后获得</div><div class="line">gitlab_ci[&apos;gitlab_server&apos;] = &#123; &quot;url&quot; =&gt; &apos;http://gitlab.yourdomain.com&apos;, &quot;app_id&quot; =&gt; &apos;xxxxxxxxxxxx&apos;, &quot;app_se</div><div class="line">cret&quot; =&gt; &apos;yyyyyyyyyyyyyyy&apos; &#125;</div><div class="line"></div><div class="line">gitlab_ci[&apos;gitlab_ci_email_from&apos;] = &apos;gitlab@yourdomain.com&apos;</div><div class="line">gitlab_ci[&apos;gitlab_ci_support_email&apos;] = &apos;sysop@yourdomain.com&apos;</div><div class="line">gitlab_ci[&apos;gitlab_ci_all_broken_builds&apos;] = true</div><div class="line">gitlab_ci[&apos;gitlab_ci_add_pusher&apos;] = true</div><div class="line">gitlab_ci[&apos;builds_directory&apos;] = &apos;/var/opt/gitlab/gitlab-ci/builds&apos;</div><div class="line"></div><div class="line">gitlab_ci[&apos;gravatar_enabled&apos;] = false</div><div class="line"># gitlab_ci[&apos;gravatar_plain_url&apos;] = &quot;http://www.gravatar.com/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=mm&quot;</div><div class="line"># gitlab_ci[&apos;gravatar_ssl_url&apos;] =  &quot;https://secure.gravatar.com/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=mm&quot;</div><div class="line"></div><div class="line">## For setting up backups</div><div class="line">## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/README.md#backups</div><div class="line"></div><div class="line">gitlab_ci[&apos;backup_path&apos;] = &quot;/var/opt/gitlab/ci-backups&quot;</div><div class="line"># gitlab_ci[&apos;backup_keep_time&apos;] = 604800</div><div class="line"># gitlab_ci[&apos;backup_upload_connection&apos;] = &#123;</div><div class="line">#   &apos;provider&apos; =&gt; &apos;AWS&apos;,</div><div class="line">#   &apos;region&apos; =&gt; &apos;eu-west-1&apos;,</div><div class="line">#   &apos;aws_access_key_id&apos; =&gt; &apos;AKIAKIAKI&apos;,</div><div class="line">#   &apos;aws_secret_access_key&apos; =&gt; &apos;secret123&apos;</div><div class="line"># &#125;</div></pre></td></tr></table></figure></p>
<h4 id="配置gitlab-runner"><a href="#配置gitlab-runner" class="headerlink" title="配置gitlab-runner"></a>配置gitlab-runner</h4><p>PS:新版本gitlab-runner从ruby改为go语言实现，名字为gitlab-ci-multi-runner，软链接为gitlab-runner<br>官方文档:<a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/docker.md" target="_blank" rel="external">Run gitlab-runner in a container</a><br>启动gitlab-runner服务<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">docker run -d --name gitlab-runner --restart always \</div><div class="line">  -v /srv/gitlab-runner/config:/etc/gitlab-runner \</div><div class="line">  gitlab/gitlab-runner:latest</div></pre></td></tr></table></figure></p>
<p>也可以用官方的另一个实现：<br><figure class="highlight lsl"><table><tr><td class="code"><pre><div class="line">gitlab/gitlab-runner    latest              <span class="number">3e8077</span>e209f5        <span class="number">13</span> hours ago        <span class="number">304.3</span> MB</div><div class="line">gitlab/gitlab-runner    alpine              <span class="number">7</span>c431ac8f30f        <span class="number">13</span> hours ago        <span class="number">25.98</span> MB</div></pre></td></tr></table></figure></p>
<p><strong>注册runner</strong><br><figure class="highlight stata"><table><tr><td class="code"><pre><div class="line">docker exec -it gitlab-runner gitlab-runner register</div><div class="line"></div><div class="line">Please enter the gitlab-<span class="keyword">ci</span> coordinator URL (<span class="keyword">e</span>.<span class="keyword">g</span>. https:<span class="comment">//gitlab.com/ci):</span></div><div class="line">http:<span class="comment">//ci.gitlab.yourdomain.com/</span></div><div class="line">Please enter the gitlab-<span class="keyword">ci</span> <span class="keyword">token</span> <span class="keyword">for</span> this runner:</div><div class="line"># 这个<span class="keyword">token</span>在gitlab-<span class="keyword">ci</span>中Runners选项卡获得</div><div class="line">e0ab42c98fff06b3dd4f3d4c776bc4</div><div class="line">Please enter the gitlab-<span class="keyword">ci</span> description <span class="keyword">for</span> this runner:</div><div class="line">[3366d1121148]: <span class="keyword">test</span>-<span class="keyword">ci</span></div><div class="line">Please enter the gitlab-<span class="keyword">ci</span> tags <span class="keyword">for</span> this runner (comma separated):</div><div class="line">delpoy</div><div class="line">INFO[0086] e0ab42c9 Registering runner... succeeded                    </div><div class="line">Please enter the executor: ssh, <span class="keyword">shell</span>, parallels, docker, docker-ssh:</div><div class="line">[]: <span class="keyword">shell</span></div><div class="line">INFO[0097] Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it's running already the config should be automatically reloaded!</div></pre></td></tr></table></figure></p>
<p><strong>注册成功后，查看生成的配置文件</strong><br><figure class="highlight nix"><table><tr><td class="code"><pre><div class="line"><span class="comment"># cat  /srv/gitlab-runner/config/config.toml </span></div><div class="line"><span class="attr">concurrent</span> = <span class="number">1</span></div><div class="line">[[runners]]</div><div class="line">  <span class="attr">url</span> = <span class="string">"http://ci.gitlab.yourdomain.com/"</span></div><div class="line">  <span class="attr">token</span> = <span class="string">"c87c7ad883af316b7d173c1094c6fe"</span></div><div class="line">  <span class="attr">name</span> = <span class="string">"test-ci"</span></div><div class="line">  <span class="attr">executor</span> = <span class="string">"shell"</span></div><div class="line">  [runners.ssh]</div><div class="line">  [runners.docker]</div><div class="line">    <span class="attr">image</span> = <span class="string">""</span></div><div class="line">    <span class="attr">privileged</span> = <span class="literal">false</span></div><div class="line">  [runners.parallels]</div><div class="line">    <span class="attr">base_name</span> = <span class="string">""</span></div></pre></td></tr></table></figure></p>
<p><strong>debug:</strong><br><code>docker logs -f gitlab-runner</code><br><code>docker exec -it gitlab-runner gitlab-runner --help</code></p>
<h4 id="使用gitlab-ci"><a href="#使用gitlab-ci" class="headerlink" title="使用gitlab-ci"></a>使用gitlab-ci</h4><p>打开<a href="http://ci.gitlab.yourdomain.com" target="_blank" rel="external">http://ci.gitlab.yourdomain.com</a> ，会跳转到<a href="http://gitlab.yourdomain.com去做验证，然后跳回。" target="_blank" rel="external">http://gitlab.yourdomain.com去做验证，然后跳回。</a><br>选择一个需要CI的项目，点击”Add project to CI”。</p>
<p>#####.gitlab-ci.yml配置:<br>在项目中添加.gitlab-ci.yml文件，然后push到gitlab<br><code>git add . ; git commit -m &#39;test&#39; ; git push</code><br><strong>注意：有坑！如果按照官方最新文档的话，会构建失败，因为句法有变化，可用下面这个链接在线验证配置文件。</strong><br><a href="http://ci.gitlab.yourdomain.com/lint" target="_blank" rel="external">在线编辑器</a></p>
<p>下面是一个栗子</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">staging:</div><div class="line">  type: deploy</div><div class="line">  script:</div><div class="line">  - echo &apos;deploy to test env&apos; &gt;&gt; /tmp/test-ci.log</div><div class="line">  - echo &quot;CI:$CI CI_SERVER:$CI_SERVER CI_SERVER_NAME:$CI_SERVER_NAME GITLAB_CI:$GITLAB_CI CI_SERVER_VERSION:$CI_SERVER_VERSION CI_SERVER_REVISION:$CI_SERVER_REVISION CI_BUILD_REF:$CI_BUILD_REF CI_BUILD_BEFORE_SHA:$CI_BUILD_BEFORE_SHA  CI_BUILD_REF_NAME:$CI_BUILD_REF_NAME CI_BUILD_ID:$CI_BUILD_ID CI_BUILD_REPO:$CI_BUILD_REPO CI_PROJECT_DIR:$CI_PROJECT_DIR&quot; &gt;&gt;/tmp/test-ci.log</div><div class="line">#  only:</div><div class="line">#  - master</div><div class="line"></div><div class="line">production:</div><div class="line">  type: deploy</div><div class="line">  script:</div><div class="line">  - echo &apos;deploy to production env&apos;  &gt;&gt; /tmp/test-ci.log</div><div class="line">  - echo &quot;CI:$CI CI_SERVER:$CI_SERVER CI_SERVER_NAME:$CI_SERVER_NAME GITLAB_CI:$GITLAB_CI CI_SERVER_VERSION:$CI_SERVER_VERSION CI_SERVER_REVISION:$CI_SERVER_REVISION CI_BUILD_REF:$CI_BUILD_REF CI_BUILD_BEFORE_SHA:$CI_BUILD_BEFORE_SHA  CI_BUILD_REF_NAME:$CI_BUILD_REF_NAME CI_BUILD_ID:$CI_BUILD_ID CI_BUILD_REPO:$CI_BUILD_REPO CI_PROJECT_DIR:$CI_PROJECT_DIR&quot; &gt;&gt;/tmp/test-ci.log</div><div class="line">  only:</div><div class="line">  - tags</div><div class="line">  # except:</div><div class="line">  #   - stable</div><div class="line">  #   - /^deploy-.*$/</div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line"><span class="meta"># cat /tmp/test-ci.log</span></div><div class="line">deploy to test env</div><div class="line">CI:<span class="literal">true</span> <span class="built_in">CI_SERVER</span>:yes <span class="built_in">CI_SERVER_NAME</span>:GitLab CI GITLAB_CI:<span class="literal">true</span> <span class="built_in">CI_SERVER_VERSION</span>: <span class="built_in">CI_SERVER_REVISION</span>: <span class="built_in">CI_BUILD_REF</span>:<span class="number">66</span>b8d99e51ff39e98629068bb5e9ef302288e899 <span class="built_in">CI_BUILD_BEFORE_SHA</span>:b7c8b5d458375902426bb0777da3c0ddf553f308  <span class="built_in">CI_BUILD_REF_NAME</span>:my-dev <span class="built_in">CI_BUILD_ID</span>:<span class="number">9</span> <span class="built_in">CI_BUILD_REPO</span>:http:<span class="comment">//gitlab-ci-token:e0ab42c98fff06b3dd4f3d4c776bc4@gitlab.yourdomain.com/arkii/test-ci.git CI_PROJECT_DIR:builds/53b58d35/0/arkii/test-ci</span></div><div class="line">deploy to production env</div><div class="line">CI:<span class="literal">true</span> <span class="built_in">CI_SERVER</span>:yes <span class="built_in">CI_SERVER_NAME</span>:GitLab CI GITLAB_CI:<span class="literal">true</span> <span class="built_in">CI_SERVER_VERSION</span>: <span class="built_in">CI_SERVER_REVISION</span>: <span class="built_in">CI_BUILD_REF</span>:<span class="number">66</span>b8d99e51ff39e98629068bb5e9ef302288e899 <span class="built_in">CI_BUILD_BEFORE_SHA</span>:b7c8b5d458375902426bb0777da3c0ddf553f308  <span class="built_in">CI_BUILD_REF_NAME</span>:my-dev <span class="built_in">CI_BUILD_ID</span>:<span class="number">10</span> <span class="built_in">CI_BUILD_REPO</span>:http:<span class="comment">//gitlab-ci-token:e0ab42c98fff06b3dd4f3d4c776bc4@gitlab.yourdomain.com/arkii/test-ci.git CI_PROJECT_DIR:builds/0c3c27e4/0/arkii/test-ci</span></div></pre></td></tr></table></figure>
<p>#####看到这些变量的输出，大家有思路该怎么玩了吗？</p>
<p>官方文档<a href="https://gitlab.com/gitlab-org/gitlab-ci/blob/7-13-stable/doc/builds_configuration/README.md" target="_blank" rel="external">Configuration of your builds with .gitlab-ci.yml</a><br>特别重要的说明<a href="https://gitlab.com/gitlab-org/gitlab-ci/blob/7-13-stable/doc/examples/README.md" target="_blank" rel="external">官方说明</a><br><strong>How your build script is run</strong></p>
<p>The runner runs the line below before it runs the commands in your build script:<br><code>cd /gitlab-ci-runner/tmp/builds &amp;&amp; git clone git@gitlab_server_fqdn:group/project.git project-1 &amp;&amp; cd project-1 &amp;&amp; git checkout master</code><br><strong>Build script example</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">bundle install</div><div class="line">bundle <span class="built_in">exec</span> rake db:create RAILS_ENV=<span class="built_in">test</span></div><div class="line">bundle <span class="built_in">exec</span> rake db:migrate RAILS_ENV=<span class="built_in">test</span></div><div class="line">script/run_all_tests</div></pre></td></tr></table></figure>
<p><strong>Environmental variables</strong></p>
<p>The runner sets the following environmental variables:<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><div class="line">CI=<span class="literal">true</span></div><div class="line"><span class="built_in">CI_SERVER</span>=<span class="literal">true</span></div><div class="line"><span class="built_in">CI_SERVER_NAME</span>=GitLab CI</div><div class="line">GITLAB_CI=<span class="literal">true</span></div><div class="line"><span class="built_in">CI_SERVER_VERSION</span></div><div class="line"><span class="built_in">CI_SERVER_REVISION</span></div><div class="line"><span class="built_in">CI_BUILD_REF</span></div><div class="line"><span class="built_in">CI_BUILD_BEFORE_SHA</span></div><div class="line"><span class="built_in">CI_BUILD_REF_NAME</span> (branch)</div><div class="line"><span class="built_in">CI_BUILD_ID</span></div><div class="line"><span class="built_in">CI_BUILD_REPO</span></div><div class="line"><span class="built_in">CI_PROJECT_DIR</span></div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[aliyunEC云主机磁盘安全扩容]]></title>
      <url>http://blog.wuliwala.net/2015/11/19/aliyun-disk-growth-online/</url>
      <content type="html"><![CDATA[<p>云主机磁盘（块设备），实际是虚拟文件，当磁盘空间不够时，可以在云服务提供商后台增加磁盘容量，下面是用户需要做的操作。  </p>
<ul>
<li>系统版本：CentOS6</li>
<li>数据盘文件系统：xfs</li>
<li>数据盘挂载点：/mount_point</li>
<li>数据盘设备名：/dev/xvdb</li>
<li>当前容量: <code>df -lh</code><br><code>/dev/xvdb1       27G   23G  4.0G  85% /mount_point</code></li>
<li>扩容后容量：</li>
</ul>
<h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ul>
<li>停止服务 <code>service nginx stop</code></li>
<li>查看是否有其他程序正在打开分区<code>lsof /mount_point</code></li>
<li>umount分区 <code>umount /mount_point</code></li>
<li><p>查看磁盘信息，可看到这块盘已经是100GB大小，但是系统还不能使用。</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><div class="line"><span class="comment"># fdisl -l /dev/xvdb</span></div><div class="line">Disk /dev/xvdb: 107.4 GB,<span class="number"> 107374182400 </span>bytes,<span class="number"> 209715200 </span>    sectors</div><div class="line">Device       Start      End         Blocks     Id  System</div><div class="line">/dev/xvdb1  <span class="number"> 7999488 </span>  <span class="number"> 62914559 </span>  <span class="number"> 27457536 </span> <span class="number"> 83 </span> Linux</div></pre></td></tr></table></figure>
</li>
<li><p>修改分区表</p>
<figure class="highlight ocaml"><table><tr><td class="code"><pre><div class="line"># fdisk /dev/xvdb</div><div class="line"><span class="type">Welcome</span> <span class="keyword">to</span> fdisk (util-linux <span class="number">2.23</span>.<span class="number">2</span>).</div><div class="line"></div><div class="line"><span class="type">Changes</span> will remain <span class="keyword">in</span> memory only, until you decide <span class="keyword">to</span> write them.</div><div class="line"><span class="type">Be</span> careful before using the write command.</div><div class="line"></div><div class="line"></div><div class="line"><span class="type">Command</span> (m <span class="keyword">for</span> help): p</div><div class="line"></div><div class="line"><span class="type">Disk</span> /dev/xvdb: <span class="number">107.4</span> <span class="type">GB</span>, <span class="number">107374182400</span> <span class="built_in">bytes</span>, <span class="number">209715200</span> sectors</div><div class="line"><span class="type">Units</span> = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">Sector</span> size (logical/physical): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">I</span>/<span class="type">O</span> size (minimum/optimal): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">Disk</span> label <span class="keyword">type</span>: dos</div><div class="line"><span class="type">Disk</span> identifier: <span class="number">0x000dc675</span></div><div class="line"></div><div class="line">    <span class="type">Device</span> <span class="type">Boot</span>      <span class="type">Start</span>         <span class="type">End</span>      <span class="type">Blocks</span>   <span class="type">Id</span>  <span class="type">System</span></div><div class="line">/dev/xvdb1         <span class="number">7999488</span>    <span class="number">62914559</span>    <span class="number">27457536</span>   <span class="number">83</span>  <span class="type">Linux</span></div><div class="line"></div><div class="line"><span class="type">Command</span> (m <span class="keyword">for</span> help): d</div><div class="line"><span class="type">Selected</span> partition <span class="number">1</span></div><div class="line"><span class="type">Partition</span> <span class="number">1</span> is deleted</div><div class="line"></div><div class="line"><span class="type">Command</span> (m <span class="keyword">for</span> help): p</div><div class="line"></div><div class="line"><span class="type">Disk</span> /dev/xvdb: <span class="number">107.4</span> <span class="type">GB</span>, <span class="number">107374182400</span> <span class="built_in">bytes</span>, <span class="number">209715200</span> sectors</div><div class="line"><span class="type">Units</span> = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">Sector</span> size (logical/physical): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">I</span>/<span class="type">O</span> size (minimum/optimal): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">Disk</span> label <span class="keyword">type</span>: dos</div><div class="line"><span class="type">Disk</span> identifier: <span class="number">0x000dc675</span></div><div class="line"></div><div class="line">    <span class="type">Device</span> <span class="type">Boot</span>      <span class="type">Start</span>         <span class="type">End</span>      <span class="type">Blocks</span>   <span class="type">Id</span>  <span class="type">System</span></div><div class="line"></div><div class="line"><span class="type">Command</span> (m <span class="keyword">for</span> help): n</div><div class="line"><span class="type">Partition</span> <span class="keyword">type</span>:</div><div class="line">   p   primary (<span class="number">0</span> primary, <span class="number">0</span> extended, <span class="number">4</span> free)</div><div class="line">   e   extended</div><div class="line"><span class="type">Select</span> (default p): p</div><div class="line"><span class="type">Partition</span> number (<span class="number">1</span>-<span class="number">4</span>, default <span class="number">1</span>): </div><div class="line"><span class="type">First</span> sector (<span class="number">2048</span>-<span class="number">209715199</span>, default <span class="number">2048</span>): <span class="number">7999488</span></div><div class="line"><span class="type">Last</span> sector, +sectors <span class="keyword">or</span> +size&#123;<span class="type">K</span>,<span class="type">M</span>,<span class="type">G</span>&#125; (<span class="number">7999488</span>-<span class="number">209715199</span>, default <span class="number">209715199</span>): </div><div class="line"><span class="type">Using</span> default <span class="keyword">value</span> <span class="number">209715199</span></div><div class="line"><span class="type">Partition</span> <span class="number">1</span> <span class="keyword">of</span> <span class="keyword">type</span> <span class="type">Linux</span> <span class="keyword">and</span> <span class="keyword">of</span> size <span class="number">96.2</span> <span class="type">GiB</span> is set</div><div class="line"></div><div class="line"><span class="type">Command</span> (m <span class="keyword">for</span> help): p</div><div class="line"></div><div class="line"><span class="type">Disk</span> /dev/xvdb: <span class="number">107.4</span> <span class="type">GB</span>, <span class="number">107374182400</span> <span class="built_in">bytes</span>, <span class="number">209715200</span> sectors</div><div class="line"><span class="type">Units</span> = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">Sector</span> size (logical/physical): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">I</span>/<span class="type">O</span> size (minimum/optimal): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></div><div class="line"><span class="type">Disk</span> label <span class="keyword">type</span>: dos</div><div class="line"><span class="type">Disk</span> identifier: <span class="number">0x000dc675</span></div><div class="line"></div><div class="line">    <span class="type">Device</span> <span class="type">Boot</span>      <span class="type">Start</span>         <span class="type">End</span>      <span class="type">Blocks</span>   <span class="type">Id</span>  <span class="type">System</span></div><div class="line">/dev/xvdb1         <span class="number">7999488</span>   <span class="number">209715199</span>   <span class="number">100857856</span>   <span class="number">83</span>  <span class="type">Linux</span></div><div class="line"></div><div class="line"><span class="type">Command</span> (m <span class="keyword">for</span> help): wq</div><div class="line"><span class="type">The</span> partition table has been altered!</div><div class="line"></div><div class="line"><span class="type">Calling</span> ioctl<span class="literal">()</span> <span class="keyword">to</span> re-read partition table.</div><div class="line"><span class="type">Syncing</span> disks.</div></pre></td></tr></table></figure>
</li>
<li><p>查看修改结果</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><div class="line"><span class="comment"># fdisk -l /dev/xvdb</span></div><div class="line">Disk /dev/xvdb: 107.4 GB,<span class="number"> 107374182400 </span>bytes,<span class="number"> 209715200 </span>sectors</div><div class="line">Units = sectors of<span class="number"> 1 </span>*<span class="number"> 512 </span>=<span class="number"> 512 </span>bytes</div><div class="line">Sector size (logical/physical):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</div><div class="line">I/O size (minimum/optimal):<span class="number"> 512 </span>bytes /<span class="number"> 512 </span>bytes</div><div class="line">Disk label type: dos</div><div class="line">Disk identifier: 0x000dc675</div><div class="line"></div><div class="line">    Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/xvdb1        <span class="number"> 7999488 </span> <span class="number"> 209715199 </span> <span class="number"> 100857856 </span> <span class="number"> 83 </span> Linux</div></pre></td></tr></table></figure>
</li>
<li><p>使用xfs_growfs命令对xfs文件系统进行扩容</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><div class="line"><span class="comment"># xfs_growfs /dev/xvdb1 </span></div><div class="line"><span class="attr">meta-data=/dev/xvdb1</span>             <span class="attr">isize=256</span>    <span class="attr">agcount=4,</span> <span class="attr">agsize=1716096</span> <span class="attr">blks</span></div><div class="line">         =                       <span class="attr">sectsz=512</span>   <span class="attr">attr=2,</span> <span class="attr">projid32bit=0</span></div><div class="line">         =                       <span class="attr">crc=0</span></div><div class="line"><span class="attr">data</span>     =                       <span class="attr">bsize=4096</span>   <span class="attr">blocks=6864384,</span> <span class="attr">imaxpct=25</span></div><div class="line">         =                       <span class="attr">sunit=0</span>      <span class="attr">swidth=0</span> blks</div><div class="line"><span class="attr">naming</span>   =version <span class="number">2</span>              <span class="attr">bsize=4096</span>   <span class="attr">ascii-ci=0</span> <span class="attr">ftype=0</span></div><div class="line"><span class="attr">log</span>      =internal               <span class="attr">bsize=4096</span>   <span class="attr">blocks=3351,</span> <span class="attr">version=2</span></div><div class="line">         =                       <span class="attr">sectsz=512</span>   <span class="attr">sunit=0</span> blks, <span class="attr">lazy-count=1</span></div><div class="line"><span class="attr">realtime</span> =none                   <span class="attr">extsz=4096</span>   <span class="attr">blocks=0,</span> <span class="attr">rtextents=0</span></div><div class="line">data blocks changed from <span class="number">6864384</span> to <span class="number">25214464</span></div></pre></td></tr></table></figure>
</li>
<li><p>挂载分区<code># mount -a</code></p>
</li>
<li>查看目前可用空间<figure class="highlight lsl"><table><tr><td class="code"><pre><div class="line"># df -lh</div><div class="line">Filesystem      Size  Used Avail Use% Mounted on</div><div class="line">/dev/xvdb1       <span class="number">97</span>G   <span class="number">23</span>G   <span class="number">74</span>G  <span class="number">24</span>% /mount_point</div></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="http://bbs.aliyun.com/read/239398.html" target="_blank" rel="external">aliyun磁盘原地扩容官方说明</a></p>
<p><a href="http://help.aliyun.com/document_detail/ecs/operation-guide/disk-operation/resize.html" target="_blank" rel="external">aliyun磁盘原地扩容官方操作说明</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2/nagios 分级通知]]></title>
      <url>http://blog.wuliwala.net/2015/09/22/icinga2-escalation-notification/</url>
      <content type="html"><![CDATA[<p>icinga是nagios的派生版，但又增加了很多改进，icinga2版本配置文件变化较大。<br>下面是设置分级别通知策略的配置方法。<br>分级通知主要用于 业务负责人员未收到通知的情况通知全体联系人。   </p>
<p>下面的配置解析：<br>出现问题后立刻通知web组管理员，如果15分钟后问题没有得到处理，接下来的30分钟以每5分钟一次的频率再次通知web组管理员；45分钟后问题仍存在，通知所有管理员。</p>
<p><code>vim /etc/icinga2/conf.d/notifications.conf</code>  </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">// <span class="keyword">start</span> <span class="keyword">of</span> escalation notification <span class="keyword">level</span></div><div class="line"><span class="keyword">apply</span> Notification <span class="string">"wechat-2nd-level-web"</span> <span class="keyword">to</span> Service &#123;</div><div class="line">  <span class="keyword">import</span> <span class="string">"wechat-service-notification-template"</span></div><div class="line"></div><div class="line">  user_groups = [ <span class="string">"admins-web"</span> ]</div><div class="line"></div><div class="line">  <span class="built_in">interval</span> = <span class="number">5</span>m</div><div class="line">  times = &#123;</div><div class="line">    <span class="keyword">begin</span> = <span class="number">15</span>m</div><div class="line">    <span class="keyword">end</span> = <span class="number">45</span>m</div><div class="line">  &#125;</div><div class="line">  assign <span class="keyword">where</span> service.name == <span class="string">"ping4"</span></div><div class="line">  assign <span class="keyword">where</span> <span class="keyword">match</span>(<span class="string">"nrpe_disk_read_write"</span>, service.name)</div><div class="line">&#125;           </div><div class="line"><span class="keyword">apply</span> Notification <span class="string">"wechat-1st-level-web"</span> <span class="keyword">to</span> Service &#123;</div><div class="line">  <span class="keyword">import</span> <span class="string">"wechat-service-notification-template"</span></div><div class="line">           </div><div class="line">  user_groups = [ <span class="string">"icingaadmins"</span> ]</div><div class="line">              </div><div class="line">  <span class="built_in">interval</span> = <span class="number">15</span>m</div><div class="line">  times = &#123; </div><div class="line">    <span class="keyword">begin</span> = <span class="number">45</span>m</div><div class="line">    <span class="keyword">end</span> = <span class="number">2</span>h</div><div class="line">  &#125; </div><div class="line">  assign <span class="keyword">where</span> service.name == <span class="string">"ping4"</span></div><div class="line">  assign <span class="keyword">where</span> <span class="keyword">match</span>(<span class="string">"nrpe_disk_read_write"</span>, service.name)</div><div class="line">&#125;   </div><div class="line">// <span class="keyword">end</span> <span class="keyword">of</span> escalation notification <span class="keyword">level</span></div></pre></td></tr></table></figure>
<h3 id="官方的文档如下"><a href="#官方的文档如下" class="headerlink" title="官方的文档如下"></a>官方的文档如下</h3><p>Similar example for advanced notification apply rule filters: If the service attribute notes contains the has gold support 24x7 string AND one of the two condition passes: Either the customer host custom attribute is set to customer-xy OR the host custom attribute always_notify is set to true.</p>
<p>The notification is ignored for services whose host name ends with *internal OR the priority custom attribute is less than 2.</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><div class="line">template Notification <span class="string">"cust-xy-notification"</span> &#123;</div><div class="line">  <span class="attr">users</span> = [ <span class="string">"noc-xy"</span>, <span class="string">"mgmt-xy"</span> ]</div><div class="line">  <span class="attr">command</span> = <span class="string">"mail-service-notification"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">apply Notification <span class="string">"notify-cust-xy-mysql"</span> to Service &#123;</div><div class="line">  <span class="built_in">import</span> <span class="string">"cust-xy-notification"</span></div><div class="line"></div><div class="line">  assign where match(<span class="string">"*has gold support 24x7*"</span>, service.notes) &amp;&amp; (host.vars.<span class="attr">customer</span> == <span class="string">"customer-xy"</span> || host.vars.<span class="attr">always_notify</span> == <span class="literal">true</span>)</div><div class="line">  ignore where match(<span class="string">"*internal"</span>, host.name) || (service.vars.priority &lt; <span class="number">2</span> &amp;&amp; host.vars.<span class="attr">is_clustered</span> == <span class="literal">true</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If the problem does not get resolved nor acknowledged preventing further notifications the escalation-sms-1st-level user will be escalated 1h after the initial problem was notified, but only for one hour (2h as end key for the times dictionary).  </p>
<figure class="highlight nix"><table><tr><td class="code"><pre><div class="line">apply Notification <span class="string">"mail"</span> to Service &#123;</div><div class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></div><div class="line"></div><div class="line">  <span class="attr">command</span> = <span class="string">"mail-notification"</span></div><div class="line">  <span class="attr">users</span> = [ <span class="string">"icingaadmin"</span> ]</div><div class="line"></div><div class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">apply Notification <span class="string">"escalation-sms-2nd-level"</span> to Service &#123;</div><div class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></div><div class="line"></div><div class="line">  <span class="attr">command</span> = <span class="string">"sms-notification"</span></div><div class="line">  <span class="attr">users</span> = [ <span class="string">"icinga-oncall-2nd-level"</span> ]</div><div class="line"></div><div class="line">  <span class="attr">times</span> = &#123;</div><div class="line">    <span class="attr">begin</span> = <span class="number">30</span>m</div><div class="line">    <span class="attr">end</span> = <span class="number">1</span>h</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">apply Notification <span class="string">"escalation-sms-1st-level"</span> to Service &#123;</div><div class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></div><div class="line"></div><div class="line">  <span class="attr">command</span> = <span class="string">"sms-notification"</span></div><div class="line">  <span class="attr">users</span> = [ <span class="string">"icinga-oncall-1st-level"</span> ]</div><div class="line"></div><div class="line">  <span class="attr">times</span> = &#123;</div><div class="line">    <span class="attr">begin</span> = <span class="number">1</span>h</div><div class="line">    <span class="attr">end</span> = <span class="number">2</span>h</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/object-types#objecttype-notification" target="_blank" rel="external">官方关于notification定义的文档</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/monitoring-basics#notification-delay" target="_blank" rel="external">官方关于notification配置技巧文档</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ssh注入秘钥要求密码]]></title>
      <url>http://blog.wuliwala.net/2015/09/15/ssh-key-auth-require-password/</url>
      <content type="html"><![CDATA[<p>已经通过kickstart安装过程中注入ssh秘钥的系统，启动后ssh连接的时候仍然要求输入密码。<br>但是再执行一遍ssh-copy-id后，ssh就又能免密码连接。<br>最后确认是selinux问题。<br>解决办法是执行<code>/sbin/restorecon -r /root/.ssh</code><br>安装系统时关闭SELinux，可以在kickstart中增加一行<code>selinux --disabled</code>。<br>已经完整完系统的，可以<code>sed -i -e &#39;/SELINUX/s/enforcing/disabled/&#39; /etc/selinux/config</code> 重启系统来关闭SELinux。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[pnp4nagios数值缩短问题]]></title>
      <url>http://blog.wuliwala.net/2015/09/08/pnp4nagioszi-dong-diao-zheng-shu-zhi/</url>
      <content type="html"><![CDATA[<p>其实就是指定rrdtool的一个参数 –units-exponent 0<br><code>vim /usr/local/pnp4nagios/share/templates/get_cdn_bw_usage.php</code><br><figure class="highlight nsis"><table><tr><td class="code"><pre><div class="line">&lt;?php</div><div class="line"><span class="comment"># Plugin: get_cdn_bw_usage</span></div><div class="line"><span class="comment"># Output: Last 5mins 10140.73218Mbp/s | data=11040.73218Mbps;</span></div><div class="line"></div><div class="line"><span class="variable">$opt</span>[<span class="number">1</span>] = <span class="string">" --units-exponent 0 --vertical-label \"</span><span class="variable">$UNIT</span>[<span class="number">1</span>]\<span class="string">" --title \"</span><span class="variable">$servicedesc</span>\<span class="string">" "</span><span class="comment">;</span></div><div class="line"></div><div class="line"><span class="variable">$def</span>[<span class="number">1</span>]  = <span class="string">"DEF:var1=<span class="variable">$RRDFILE</span>[1]:<span class="variable">$DS</span>[1]:AVERAGE "</span> <span class="comment">;</span></div><div class="line"><span class="variable">$def</span>[<span class="number">1</span>] .= <span class="string">"AREA:var1#0066FF:\"</span>bandwidth\<span class="string">" "</span> <span class="comment">;</span></div><div class="line"><span class="variable">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:LAST:\"</span>%.<span class="number">5</span>lf %s<span class="variable">$UNIT</span>[<span class="number">1</span>] last\<span class="string">" "</span> <span class="comment">;</span></div><div class="line"><span class="variable">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:AVERAGE:\"</span>%.<span class="number">5</span>lf %s<span class="variable">$UNIT</span>[<span class="number">1</span>] avg\<span class="string">" "</span> <span class="comment">;</span></div><div class="line"><span class="variable">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:MAX:\"</span>%.<span class="number">5</span>lf %s<span class="variable">$UNIT</span>[<span class="number">1</span>] max\\n\<span class="string">" "</span> <span class="comment">;</span></div><div class="line">?&gt;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[rsyslog收集本地系统和服务日志到logstash]]></title>
      <url>http://blog.wuliwala.net/2015/09/07/rsyslog-send-locallog-to-logstash/</url>
      <content type="html"><![CDATA[<p>最近做了一个项目，将Linux服务器的系统日志以及服务日志收集到elk。<br>期间从头学习了syslog rsyslog。<br>有几个比较重要的概念: facility, input module。<br>input module使用了imfile，功能为：将文本文件读取到rsyslog。<br>将所有服务软件的日志标记为service，最后使用规则匹配，之后发送到远端logstash服务器。<br>我使用local3作为所有服务软件的facility配置。主要是为了便于日志归集，因为默认情况下读取文件的内容会记录到本机/var/log/messages一份。<br>步骤如下<br>首先增加rsyslog主配置文件:<br><code>sed -i -e &#39;/\/var\/log\/messages/s/^/&amp;local3.none\;/&#39; -e &#39;6a\$ModLoad imfile\n&#39; /etc/rsyslog.conf</code><br><code>echo &quot;if \$programname == &#39;service&#39; then @@elk.zol.com.cn&quot;  &gt;&gt;/etc/rsyslog.conf</code><br>添加Apache错误日志:  </p>
<pre><code>cat &lt;&lt;-&quot;RSYSLOGEOF&quot; &gt;/etc/rsyslog.d/httpd.conf 
$InputFileName /var/log/httpd/error_log
$InputFileStateFile httpd_error.stat
$InputFileTag service:
$InputFileFacility local3
$InputRunFileMonitor
$InputFilePollingInterval 60
RSYSLOGEOF
</code></pre><p>重启rsyslog<br><code>service rsyslog restart</code></p>
<p>然后，如果Apache服务报错，而且已经开启日志记录到/var/log/httpd/error_log，远端kibana界面中就能搜索到。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vmware esxi log server]]></title>
      <url>http://blog.wuliwala.net/2015/08/31/set-esxi-log-server/</url>
      <content type="html"><![CDATA[<p>ESXi client –&gt; Configuration –&gt; Advanced Settings –&gt; Syslog –&gt; Syslog.global.logHost=udp://your-syslog-server:514  </p>
<p>ESXi client –&gt; Configuration –&gt; Security Profile –&gt; Firewall –&gt; Properties –&gt; √ syslog</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[给esxi编译ipmitool]]></title>
      <url>http://blog.wuliwala.net/2015/08/31/compile-tool-for-esxi/</url>
      <content type="html"><![CDATA[<p>vmware 的 ESXi服务器是不带包管理系统的，也不带任何编译工具，所以遇到需要安装软件的情况，需要其他Linux环境来编译跨平台二进制文件。<br>本文主要讲述在CentOS下给ESXi服务器编译ipmitool。<br><figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line">yum -y install autoconf make gcc gcc-c++ glibc glibc-<span class="keyword">static</span> glibc-devel libstdc++ libstdc++-devel</div><div class="line">wget <span class="string">http:</span><span class="comment">//nchc.dl.sourceforge.net/project/ipmitool/ipmitool/1.8.15/ipmitool-1.8.15.tar.bz2</span></div><div class="line">tar xvf ipmitool<span class="number">-1.8</span><span class="number">.15</span>.tar.bz2</div><div class="line">cd ipmitool<span class="number">-1.8</span><span class="number">.15</span></div><div class="line">./configure CFLAGS=-m32 LDFLAGS=-<span class="keyword">static</span></div><div class="line">make -j8</div><div class="line">scp src<span class="regexp">/ipmitool root@your-esxi-host-ip:/</span>opt/</div></pre></td></tr></table></figure></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line"><span class="regexp">/opt # ./</span>ipmitool mc info</div><div class="line">Device <span class="string">ID                 :</span> <span class="number">32</span></div><div class="line">Device <span class="string">Revision           :</span> <span class="number">0</span></div><div class="line">Firmware <span class="string">Revision         :</span> <span class="number">1.50</span></div><div class="line">IPMI <span class="string">Version              :</span> <span class="number">2.0</span></div><div class="line">Manufacturer <span class="string">ID           :</span> <span class="number">674</span></div><div class="line">Manufacturer <span class="string">Name         :</span> DELL Inc</div><div class="line">Product <span class="string">ID                :</span> <span class="number">256</span> (<span class="number">0x0100</span>)</div><div class="line">Product <span class="string">Name              :</span> Unknown (<span class="number">0x100</span>)</div><div class="line">Device <span class="string">Available          :</span> yes</div><div class="line">Provides Device <span class="string">SDRs      :</span> yes</div><div class="line">Additional Device <span class="string">Support :</span></div><div class="line">    Sensor Device</div><div class="line">    SDR Repository Device</div><div class="line">    SEL Device</div><div class="line">    FRU Inventory Device</div><div class="line">    IPMB Event Receiver</div><div class="line">    Bridge</div><div class="line">    Chassis Device</div><div class="line">Aux Firmware Rev <span class="string">Info     :</span> </div><div class="line">    <span class="number">0x00</span></div><div class="line">    <span class="number">0x18</span></div><div class="line">    <span class="number">0x00</span></div><div class="line">    <span class="number">0x00</span></div></pre></td></tr></table></figure>
<p><code>/opt # ./ipmitool lan print</code>  </p>
<figure class="highlight ada"><table><tr><td class="code"><pre><div class="line">Set <span class="keyword">in</span> Progress         : <span class="type">Set</span> Complete</div><div class="line">Auth <span class="keyword">Type</span> <span class="type">Support       </span>: NONE MD2 MD5 PASSWORD </div><div class="line">Auth <span class="keyword">Type</span> <span class="type">Enable        </span>: Callback : <span class="type">MD2</span> MD5 </div><div class="line">                        : <span class="type">User</span>     : <span class="type">MD2</span> MD5 </div><div class="line">                        : <span class="type">Operator</span> : <span class="type">MD2</span> MD5 </div><div class="line">                        : <span class="type">Admin</span>    : <span class="type">MD2</span> MD5 </div><div class="line">                        : <span class="type">OEM</span>      : </div><div class="line"><span class="type">IP</span> Address Source       : <span class="type">Static</span> Address</div><div class="line">IP Address              : 10.3.0.35</div><div class="line">Subnet Mask             : 255.255.255.0</div><div class="line">MAC Address             : <span class="type">e4</span>:<span class="number">5</span>b:dd:dd:dd:dd</div><div class="line">SNMP Community String   : <span class="type">public</span></div><div class="line">IP Header               : <span class="type">TTL</span>=<span class="number">0</span>x40 Flags=<span class="number">0</span>x40 Precedence=<span class="number">0</span>x00 TOS=<span class="number">0</span>x10</div><div class="line">Default Gateway IP      : 10.3.0.1</div><div class="line">Default Gateway MAC     : 00:00:00:00:00:00</div><div class="line">Backup Gateway IP       : 0.0.0.0</div><div class="line">Backup Gateway MAC      : 00:00:00:00:00:00</div><div class="line"><span class="number">802.1</span>q VLAN ID          : <span class="type">Disabled</span></div><div class="line"><span class="number">802.1</span>q VLAN Priority    : 0</div><div class="line">RMCP+ Cipher Suites     : 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14</div><div class="line">Cipher Suite Priv Max   : <span class="type">aaaaaaaaaaaaaaa</span></div><div class="line">                        :     <span class="type">X</span>=Cipher Suite Unused</div><div class="line">                        :     <span class="type">c</span>=CALLBACK</div><div class="line">                        :     <span class="type">u</span>=USER</div><div class="line">                        :     <span class="type">o</span>=OPERATOR</div><div class="line">                        :     <span class="type">a</span>=ADMIN</div><div class="line">                        :     <span class="type">O</span>=OEM</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[cygwin下安装mysqld]]></title>
      <url>http://blog.wuliwala.net/2015/08/24/cygwin-mysqld/</url>
      <content type="html"><![CDATA[<h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><p>首先运行cygwin_setup，选装包：<br>mysql （客户端）<br>mysqld （服务端）</p>
<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><p><code>#mysql_install_db</code><br><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Installing MySQL system tables...</div><div class="line">OK</div><div class="line">Filling <span class="keyword">help</span> tables...</div><div class="line">OK</div><div class="line"></div><div class="line"><span class="keyword">To</span> <span class="keyword">start</span> mysqld <span class="keyword">at</span> boot <span class="keyword">time</span> you have <span class="keyword">to</span> copy</div><div class="line">support-files/mysql.server <span class="keyword">to</span> the <span class="keyword">right</span> place <span class="keyword">for</span> your <span class="keyword">system</span></div><div class="line"></div><div class="line">PLEASE REMEMBER <span class="keyword">TO</span> <span class="keyword">SET</span> A <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> THE MySQL root <span class="keyword">USER</span> !</div><div class="line"><span class="keyword">To</span> <span class="keyword">do</span> so, <span class="keyword">start</span> the <span class="keyword">server</span>, <span class="keyword">then</span> issue the <span class="keyword">following</span> commands:</div><div class="line"></div><div class="line">/usr/<span class="keyword">bin</span>/mysqladmin -u root <span class="keyword">password</span> <span class="string">'new-password'</span></div><div class="line">/usr/<span class="keyword">bin</span>/mysqladmin -u root -h brix <span class="keyword">password</span> <span class="string">'new-password'</span></div><div class="line"></div><div class="line">Alternatively you can run:</div><div class="line">/usr/<span class="keyword">bin</span>/mysql_secure_installation</div><div class="line"></div><div class="line">which will also give you the <span class="keyword">option</span> <span class="keyword">of</span> removing the <span class="keyword">test</span></div><div class="line"><span class="keyword">databases</span> <span class="keyword">and</span> anonymous <span class="keyword">user</span> created <span class="keyword">by</span> default.  This <span class="keyword">is</span></div><div class="line">strongly recommended <span class="keyword">for</span> production servers.</div><div class="line"></div><div class="line">See the <span class="keyword">manual</span> <span class="keyword">for</span> more instructions.</div><div class="line"></div><div class="line">You can <span class="keyword">start</span> the MySQL daemon <span class="keyword">with</span>:</div><div class="line">cd /usr ; /usr/bin/mysqld_safe &amp;</div><div class="line"></div><div class="line">You can test the MySQL daemon with mysql-test-run.pl</div><div class="line">cd /usr/mysql-test ; perl mysql-test-run.pl</div><div class="line"></div><div class="line">Please report any problems at http://bugs.mysql.com/</div></pre></td></tr></table></figure></p>
<h3 id="启动mysqld服务"><a href="#启动mysqld服务" class="headerlink" title="启动mysqld服务"></a>启动mysqld服务</h3><p>执行<code>cd /usr ; /usr/bin/mysqld_safe &amp;</code>启动mysql的守护进程。<br>执行<code>mysql_secure_installation</code>，设置root用户的密码，配置一些安全选项。</p>
<p>基本上mysql就安装完了，以后就可以用下面两条命令开启和关闭mysql守护进程：</p>
<p><code>mysqld_safe &amp;</code><br><code>mysqladmin -u root -p shutdown</code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2集成pnp4nagios]]></title>
      <url>http://blog.wuliwala.net/2015/08/24/icinga2-pnp4nagios/</url>
      <content type="html"><![CDATA[<p><img src="/images/2015/08/icinga2-pnp4nagios-ifio-2-1.png" alt="alt"></p>
<h1 id="PNP4nagios"><a href="#PNP4nagios" class="headerlink" title="PNP4nagios"></a>PNP4nagios</h1><p><code>cp -r modules/* /usr/share/icingaweb2/modules/</code><br><code>ln -s /usr/local/pnp4nagios/etc/* /etc/pnp4nagios/</code><br><code>#vim /etc/pnp4nagios/npcd.cfg</code><br><figure class="highlight ini"><table><tr><td class="code"><pre><div class="line"><span class="attr">user</span> = icinga</div><div class="line"><span class="attr">group</span> = icinga</div><div class="line"><span class="attr">log_type</span> = file</div><div class="line"><span class="attr">log_file</span> = /usr/local/pnp4nagios/var/npcd.log</div><div class="line"><span class="attr">max_logfile_size</span> = <span class="number">10485760</span></div><div class="line"><span class="attr">log_level</span> = <span class="number">0</span> #debug时打开</div><div class="line"><span class="attr">perfdata_file_run_cmd</span> = /usr/local/pnp4nagios/libexec/process_perfdata.pl</div><div class="line"><span class="attr">perfdata_file_run_cmd_args</span> = --bulk</div><div class="line"><span class="attr">identify_npcd</span> = <span class="number">1</span></div><div class="line"><span class="attr">npcd_max_threads</span> = <span class="number">5</span></div><div class="line"><span class="attr">sleep_time</span> = <span class="number">15</span></div><div class="line"><span class="attr">load_threshold</span> = <span class="number">0.0</span></div><div class="line"><span class="attr">pid_file</span>=/var/run/npcd.pid</div><div class="line"><span class="attr">perfdata_file</span> = /usr/local/pnp4nagios/var/perfdata.dump</div><div class="line"><span class="attr">perfdata_spool_dir</span> = /var/spool/icinga2/perfdata</div><div class="line"><span class="attr">perfdata_spool_filename</span> = perfdata</div><div class="line"><span class="attr">perfdata_file_processing_interval</span> = <span class="number">15</span></div></pre></td></tr></table></figure></p>
<p><code>#vim /etc/pnp4nagios/process_perfdata.cfg</code></p>
<figure class="highlight nix"><table><tr><td class="code"><pre><div class="line"><span class="attr">TIMEOUT</span> = <span class="number">15</span></div><div class="line"><span class="attr">USE_RRDs</span> = <span class="number">1</span></div><div class="line"><span class="attr">RRDPATH</span> = /usr/local/pnp4nagios/var/perfdata</div><div class="line"><span class="attr">RRDTOOL</span> = /usr/bin/rrdtool</div><div class="line"><span class="attr">CFG_DIR</span> = /usr/local/pnp4nagios/etc</div><div class="line"><span class="attr">RRD_STORAGE_TYPE</span> = SINGLE</div><div class="line"><span class="attr">RRD_HEARTBEAT</span> = <span class="number">8460</span></div><div class="line"><span class="attr">RRA_CFG</span> = /usr/local/pnp4nagios/etc/rra.cfg</div><div class="line"><span class="attr">RRA_STEP</span> = <span class="number">60</span></div><div class="line"><span class="attr">LOG_FILE</span> = /usr/local/pnp4nagios/var/perfdata.log</div><div class="line"><span class="attr">LOG_LEVEL</span> = <span class="number">0</span> <span class="comment">#debug时打开</span></div><div class="line"><span class="attr">XML_ENC</span> = UTF-<span class="number">8</span></div><div class="line"><span class="attr">XML_UPDATE_DELAY</span> = <span class="number">0</span></div><div class="line"><span class="attr">RRD_DAEMON_OPTS</span> = </div><div class="line"><span class="attr">STATS_DIR</span> = /usr/local/pnp4nagios/var/stats</div><div class="line"><span class="attr">PREFORK</span> = <span class="number">1</span></div><div class="line"><span class="attr">GEARMAN_HOST</span> = localhost:<span class="number">4730</span></div><div class="line"><span class="attr">REQUESTS_PER_CHILD</span> = <span class="number">10000</span></div><div class="line"><span class="attr">ENCRYPTION</span> = <span class="number">1</span></div><div class="line"><span class="attr">KEY</span> = should_be_changed</div><div class="line">```  </div><div class="line"></div><div class="line">`<span class="comment">#vim /etc/icinga2/features-enabled/perfdata.conf`</span></div></pre></td></tr></table></figure>
<p>library “perfdata”<br>object PerfdataWriter “perfdata” {<br>  service_format_template = “DATATYPE::SERVICEPERFDATA\tTIMET::$icinga.timet$\tHOSTNAME::$host.name$\tSERVICEDESC::$service.name$\tSERVICEPERFDATA::$service.<br>  perfdata$\tSERVICECHECKCOMMAND::$service.check_command$$pnp_check_arg1$\tHOSTSTATE::$host.state$\tHOSTSTATETYPE::$host.state_type$\tSERVICESTATE::$service.<br>  state$\tSERVICESTATETYPE::$service.state_type$”<br>}<br><figure class="highlight clean"><table><tr><td class="code"><pre><div class="line"></div><div class="line">`# vim /etc/icinga2/conf.d/templates.conf`</div></pre></td></tr></table></figure></p>
<p>template Service “pnp-svc” {<br>  action_url = “/pnp4nagios/graph?host=$HOSTNAME$&amp;srv=$SERVICEDESC$”<br>  vars.pnp_check_arg1 = “”<br>}<br><figure class="highlight clean"><table><tr><td class="code"><pre><div class="line"></div><div class="line">`#vim /etc/icinga2/conf.d/services.conf`</div></pre></td></tr></table></figure></p>
<p>apply Service “nrpe_traffic” {<br>  import “generic-service”<br>  import “pnp-svc”<br>  check_command = “nrpe”<br>  assign where host.name == “kddi-pxe”<br>  assign where host.name == “kddi-deploy”<br>  vars.nrpe_timeout = 240<br>  vars.nrpe_command = “check_traffic”<br>  vars.pnp_check_arg1 = “!$nrpe_command$”<br>}<br><figure class="highlight clean"><table><tr><td class="code"><pre><div class="line"></div><div class="line">`#vim /usr/local/pnp4nagios/etc/check_commands/nrpe.cfg`</div></pre></td></tr></table></figure></p>
<p>CUSTOM_TEMPLATE = 0,1<br>DATATYPE = GAUGE<br>USE_MAX_ON_CREATE = 0<br><figure class="highlight clean"><table><tr><td class="code"><pre><div class="line"></div><div class="line">`#vim /usr/local/pnp4nagios/var/perfdata/kddi-deploy/nrpe_traffic.xml`  </div><div class="line"></div><div class="line">看这个值  </div><div class="line"></div><div class="line">`&lt;TEMPLATE&gt;nrpe_check_traffic&lt;/TEMPLATE&gt;`  </div><div class="line"></div><div class="line">然后根据xml中的名字创建模板  </div><div class="line"></div><div class="line">`#vim /usr/local/pnp4nagios/share/templates/nrpe_check_traffic.php`</div></pre></td></tr></table></figure></p>
<p>&lt;?php<br>#</p>
<h1 id="Copyright-c-2006-2010-Joerg-Linge-http-www-pnp4nagios-org"><a href="#Copyright-c-2006-2010-Joerg-Linge-http-www-pnp4nagios-org" class="headerlink" title="Copyright (c) 2006-2010 Joerg Linge (http://www.pnp4nagios.org)"></a>Copyright (c) 2006-2010 Joerg Linge (<a href="http://www.pnp4nagios.org" target="_blank" rel="external">http://www.pnp4nagios.org</a>)</h1><h1 id="Plugin-check-bmon"><a href="#Plugin-check-bmon" class="headerlink" title="Plugin: check_bmon"></a>Plugin: check_bmon</h1><h1 id="Output-TRAFFIC-OK-in-131-9Bps-out-185Bps"><a href="#Output-TRAFFIC-OK-in-131-9Bps-out-185Bps" class="headerlink" title="Output: TRAFFIC OK|in=131.9Bps; out=185Bps;"></a>Output: TRAFFIC OK|in=131.9Bps; out=185Bps;</h1><p>$opt[1] = “–vertical-label \”Bytes/s\” –title \”$servicedesc\” “;</p>
<p>$def[1]  = “DEF:var1=$RRDFILE[1]:$DS[1]:AVERAGE “ ;<br>$def[1] .= “DEF:var2=$RRDFILE[2]:$DS[2]:AVERAGE “ ;<br>$def[1] .= “CDEF:var3=var2,-1,* “ ;<br>$def[1] .= “AREA:var1#00ff00:\”in\” “ ;<br>$def[1] .= “GPRINT:var1:LAST:\”%.1lf %SBytes last\” “ ;<br>$def[1] .= “GPRINT:var1:AVERAGE:\”%.1lf %SBytes avg\” “ ;<br>$def[1] .= “GPRINT:var1:MAX:\”%.1lf %SBytes max\n\” “ ;</p>
<h1 id="def-1-“AREA-var2-0066FF-”out-”-“"><a href="#def-1-“AREA-var2-0066FF-”out-”-“" class="headerlink" title="$def[1] .= “AREA:var2#0066FF:\”out\” “ ;"></a>$def[1] .= “AREA:var2#0066FF:\”out\” “ ;</h1><p>$def[1] .= “AREA:var3#0066FF:\”out\” “ ;<br>$def[1] .= “GPRINT:var2:LAST:\”%.1lf %SBytes last\” “ ;<br>$def[1] .= “GPRINT:var2:AVERAGE:\”%.1lf %SBytes avg\” “ ;<br>$def[1] .= “GPRINT:var2:MAX:\”%.1lf %SBytes max\” “;<br>?&gt;<br>```<br>pnp template 文档<br><a href="https://docs.pnp4nagios.org/pnp-0.6/tpl_custom" target="_blank" rel="external">https://docs.pnp4nagios.org/pnp-0.6/tpl_custom</a><br>icinga2官方集成pnp4nagios模板攻略<br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins?highlight-search=pnp4nagios#addons-graphing-pnp-custom-templates" target="_blank" rel="external">http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins?highlight-search=pnp4nagios#addons-graphing-pnp-custom-templates</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[cacti批量添加device和graph]]></title>
      <url>http://blog.wuliwala.net/2015/08/21/cacti-add-multi-devices-graphs/</url>
      <content type="html"><![CDATA[<p>cacti添加监控项和绘图项不一般得麻烦，华为s5700交换机有48口，鼠标点得点到死。<br>好在有一些cli工具可以帮助我们批量添加。<br>工具目录：<br>/var/www/html/cli<br>脚本中涉及到的host-id template-id 等各种id请参阅文章底部的使用手册，理明白各id用途再使用本脚本。<br><code>cat add_multi.sh</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"># path=/var/www/html/cli</div><div class="line">for host_ip in $(cat hosts)</div><div class="line">do</div><div class="line">    echo $host_ip</div><div class="line">    php -q add_device.php --description=$host_ip --ip=&quot;$host_ip&quot; --template=6</div><div class="line">    host_id=$(php -q add_graphs.php --list-hosts --quiet|grep $host_ip|awk -F &quot; &quot; &apos;&#123;print $1&#125;&apos;)</div><div class="line">    php -q add_graphs.php --host-id=$host_id --graph-type=cg --graph-template-id=24</div><div class="line">    ######php add_graphs.php --host-id=$host_id --snmp-field=ifDescr --list-snmp-values</div><div class="line">    for host_if in $(php -q add_graphs.php --host-id=$host_id --snmp-field=ifDescr --list-snmp-values --quiet)</div><div class="line">    do</div><div class="line">        echo $host_if</div><div class="line">        php -q add_graphs.php --host-id=$host_id --graph-type=ds --graph-title=&apos;|host_description| - Traffic - |query_ifName|&apos; --graph-template-id=12 --snmp-quer</div><div class="line">y-id=3 --snmp-query-type-id=6 --snmp-field=ifDescr --snmp-value=&quot;$host_if&quot;</div><div class="line">    done</div><div class="line">done</div></pre></td></tr></table></figure></p>
<p><code>sh add_multi.sh</code><br><figure class="highlight haskell"><table><tr><td class="code"><pre><div class="line"><span class="title">bj</span>-cnc<span class="number">-1.</span>arkii.cn</div><div class="line"><span class="type">Adding</span> bj-cnc<span class="number">-1.</span>arkii.cn (bj-cnc-s5700<span class="number">-1.</span>arkii.cn) <span class="keyword">as</span> <span class="string">"Huawei"</span> using <span class="type">SNMP</span> v2 with community <span class="string">"public"</span></div><div class="line"><span class="type">Success</span> - new device-id: (<span class="number">100</span>)</div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7835</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6968)</span></div><div class="line"><span class="type">Console9</span>/<span class="number">0</span>/<span class="number">0</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7836</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6969, 6969)</span></div><div class="line"><span class="type">Eth</span>-<span class="type">Trunk1</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7837</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6970, 6970)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">1</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7838</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6971, 6971)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">10</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7839</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6972, 6972)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">11</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7840</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6973, 6973)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">12</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7841</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6974, 6974)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">13</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7842</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6975, 6975)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">14</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7843</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6976, 6976)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">15</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7844</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6977, 6977)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">16</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7845</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6978, 6978)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">17</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7846</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6979, 6979)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">18</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7847</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6980, 6980)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">19</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7848</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6981, 6981)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">2</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7849</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6982, 6982)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">20</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7850</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6983, 6983)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">21</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7851</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6984, 6984)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">22</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7852</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6985, 6985)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">23</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7853</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6986, 6986)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">24</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7854</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6987, 6987)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">25</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7855</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6988, 6988)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">26</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7856</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6989, 6989)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">27</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7857</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6990, 6990)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">28</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7858</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6991, 6991)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">29</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7859</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6992, 6992)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">3</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7860</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6993, 6993)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">30</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7861</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6994, 6994)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">31</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7862</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6995, 6995)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">32</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7863</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6996, 6996)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">33</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7864</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6997, 6997)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">34</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7865</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6998, 6998)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">35</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7866</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (6999, 6999)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">36</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7867</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7000, 7000)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">37</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7868</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7001, 7001)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">38</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7869</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7002, 7002)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">39</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7870</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7003, 7003)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">4</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7871</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7004, 7004)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">40</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7872</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7005, 7005)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">41</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7873</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7006, 7006)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">42</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7874</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7007, 7007)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">43</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7875</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7008, 7008)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">44</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7876</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7009, 7009)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">45</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7877</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7010, 7010)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">46</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7878</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7011, 7011)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">47</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7879</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7012, 7012)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">48</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7880</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7013, 7013)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">5</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7881</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7014, 7014)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">6</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7882</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7015, 7015)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">7</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7883</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7016, 7016)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">8</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7884</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7017, 7017)</span></div><div class="line"><span class="type">GigabitEthernet0</span>/<span class="number">0</span>/<span class="number">9</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7885</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7018, 7018)</span></div><div class="line"><span class="type">InLoopBack0</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7886</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7019, 7019)</span></div><div class="line"><span class="type">MEth0</span>/<span class="number">0</span>/<span class="number">1</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7887</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7020, 7020)</span></div><div class="line"><span class="type">NULL0</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7888</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7021, 7021)</span></div><div class="line"><span class="type">Vlanif1</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7889</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7022, 7022)</span></div><div class="line"><span class="type">Vlanif200</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7890</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7023, 7023)</span></div><div class="line"><span class="type">XGigabitEthernet0</span>/<span class="number">1</span>/<span class="number">1</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7891</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7024, 7024)</span></div><div class="line"><span class="type">XGigabitEthernet0</span>/<span class="number">1</span>/<span class="number">2</span></div><div class="line"><span class="type">Graph</span> <span class="type">Added</span> - graph-id: (<span class="number">7892</span>) - <span class="class"><span class="keyword">data</span>-source-ids: (7025, 7025)</span></div></pre></td></tr></table></figure></p>
<p>参考资料<br><a href="http://www.cacti.net/downloads/docs/html/cli_add_graphs.html" target="_blank" rel="external">www.cacti.net</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[自动化中使用ssh命令]]></title>
      <url>http://blog.wuliwala.net/2015/08/18/ssh-automatic/</url>
      <content type="html"><![CDATA[<p>有一台master服务器，做自动部署，其中一个环节是使用ssh命令链接新装完系统的服务器，做一些初始化工作，但是由于dhcp池会重复分配IP，ssh在脚本中会报如下两个错误。<br><figure class="highlight gauss"><table><tr><td class="code"><pre><div class="line"><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@</span></div><div class="line">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     <span class="comment">@</span></div><div class="line">@<span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span></div><div class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</div><div class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</div><div class="line">It is also possible that the RSA host <span class="built_in">key</span> has just been changed.</div><div class="line">The fingerprint <span class="keyword">for</span> the RSA <span class="built_in">key</span> sent by the remote host is</div><div class="line">j8:<span class="number">98</span>:o8:cm:<span class="number">23</span>:<span class="number">16</span>:<span class="number">62</span>:cd.</div><div class="line">Please contact your <span class="keyword">system</span> administrator.</div><div class="line">Add correct host <span class="built_in">key</span> in /root/.ssh/known_hosts to get rid of this message.</div><div class="line">Offending <span class="built_in">key</span> in /root/.ssh/known_hosts:<span class="number">6</span></div><div class="line">RSA host <span class="built_in">key</span> <span class="keyword">for</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.13</span> has changed <span class="keyword">and</span> you have requested strict checking.</div><div class="line">Host <span class="built_in">key</span> verification failed.</div></pre></td></tr></table></figure></p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><div class="line">The authenticity <span class="keyword">of</span> host <span class="comment">'10.0.0.13 (10.0.0.13)' can't be established.</span></div><div class="line">RSA <span class="keyword">key</span> fingerprint <span class="keyword">is</span> j8:<span class="number">98</span>:o8:cm:<span class="number">23</span>:<span class="number">16</span>:<span class="number">62</span>:cd.</div><div class="line">Are you sure you want <span class="keyword">to</span> <span class="keyword">continue</span> connecting (yes/no)?</div></pre></td></tr></table></figure>
<p>在ssh配置文件中添加如下两行:<br>~/.ssh/config<br><figure class="highlight coffeescript"><table><tr><td class="code"><pre><div class="line">StrictHostKeyChecking <span class="literal">no</span></div><div class="line">UserKnownHostsFile /dev/<span class="literal">null</span></div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2添加自定义通知插件]]></title>
      <url>http://blog.wuliwala.net/2015/08/10/icinga2-my-notification/</url>
      <content type="html"><![CDATA[<p>添加模板<br>/etc/icinga2/conf.d/templates.conf<br><figure class="highlight nix"><table><tr><td class="code"><pre><div class="line">template Notification <span class="string">"wechat-host-notification"</span> &#123;</div><div class="line">  <span class="attr">command</span> = <span class="string">"wechat-host-notification"</span></div><div class="line">  <span class="attr">states</span> = [ Up, Down ]</div><div class="line">  <span class="attr">types</span> = [ Problem, Recovery ]</div><div class="line">  <span class="attr">period</span> = <span class="string">"24x7"</span></div><div class="line">&#125;</div><div class="line">template Notification <span class="string">"wechat-service-notification"</span> &#123;</div><div class="line">  <span class="attr">command</span> = <span class="string">"wechat-service-notification"</span></div><div class="line">  <span class="attr">states</span> = [ OK, Warning, Critical, Unknown ]</div><div class="line">  <span class="attr">types</span> = [ Problem, Recovery ]</div><div class="line">  <span class="attr">period</span> = <span class="string">"24x7"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>添加command<br>/etc/icinga2/conf.d/commands.conf<br><figure class="highlight nix"><table><tr><td class="code"><pre><div class="line">object NotificationCommand <span class="string">"wechat-host-notification"</span> &#123;</div><div class="line">  <span class="built_in">import</span> <span class="string">"plugin-notification-command"</span></div><div class="line"></div><div class="line">  <span class="attr">command</span> = [ SysconfDir + <span class="string">"/icinga2/scripts/wechat-host-notification.sh"</span> ]</div><div class="line"></div><div class="line">  <span class="attr">env</span> = &#123;</div><div class="line">    <span class="attr">NOTIFICATIONTYPE</span> = <span class="string">"$notification.type$"</span></div><div class="line">    <span class="attr">HOSTALIAS</span> = <span class="string">"$host.display_name$"</span></div><div class="line">    <span class="attr">HOSTADDRESS</span> = <span class="string">"$address$"</span></div><div class="line">    <span class="attr">HOSTSTATE</span> = <span class="string">"$host.state$"</span></div><div class="line">    <span class="attr">LONGDATETIME</span> = <span class="string">"$icinga.long_date_time$"</span></div><div class="line">    <span class="attr">SHORTDATETIME</span> = <span class="string">"$icinga.short_date_time$"</span></div><div class="line">    <span class="attr">TIME</span> = <span class="string">"$icinga.time$"</span></div><div class="line">    <span class="attr">HOSTOUTPUT</span> = <span class="string">"$host.output$"</span></div><div class="line">    <span class="attr">NOTIFICATIONAUTHORNAME</span> = <span class="string">"$notification.author$"</span></div><div class="line">    <span class="attr">NOTIFICATIONCOMMENT</span> = <span class="string">"$notification.comment$"</span></div><div class="line">    <span class="attr">HOSTDISPLAYNAME</span> = <span class="string">"$host.display_name$"</span></div><div class="line">    <span class="attr">USEREMAIL</span> = <span class="string">"$user.email$"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">object NotificationCommand <span class="string">"wechat-service-notification"</span> &#123;</div><div class="line">  <span class="built_in">import</span> <span class="string">"plugin-notification-command"</span></div><div class="line"></div><div class="line">  <span class="attr">command</span> = [ SysconfDir + <span class="string">"/icinga2/scripts/wechat-service-notification.sh"</span> ]</div><div class="line"></div><div class="line">  <span class="attr">env</span> = &#123;</div><div class="line">    <span class="attr">NOTIFICATIONTYPE</span> = <span class="string">"$notification.type$"</span></div><div class="line">    <span class="attr">SERVICEDESC</span> = <span class="string">"$service.name$"</span></div><div class="line">    <span class="attr">HOSTALIAS</span> = <span class="string">"$host.display_name$"</span></div><div class="line">    <span class="attr">HOSTADDRESS</span> = <span class="string">"$address$"</span></div><div class="line">    <span class="attr">SERVICESTATE</span> = <span class="string">"$service.state$"</span></div><div class="line">    <span class="attr">LONGDATETIME</span> = <span class="string">"$icinga.long_date_time$"</span></div><div class="line">    <span class="attr">SHORTDATETIME</span> = <span class="string">"$icinga.short_date_time$"</span></div><div class="line">    <span class="attr">TIME</span> = <span class="string">"$icinga.time$"</span></div><div class="line">    <span class="attr">SERVICEOUTPUT</span> = <span class="string">"$service.output$"</span></div><div class="line">    <span class="attr">NOTIFICATIONAUTHORNAME</span> = <span class="string">"$notification.author$"</span></div><div class="line">    <span class="attr">NOTIFICATIONCOMMENT</span> = <span class="string">"$notification.comment$"</span></div><div class="line">    <span class="attr">HOSTDISPLAYNAME</span> = <span class="string">"$host.display_name$"</span></div><div class="line">    <span class="attr">SERVICEDISPLAYNAME</span> = <span class="string">"$service.display_name$"</span></div><div class="line">    <span class="attr">USEREMAIL</span> = <span class="string">"$user.email$"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注册通知到主机和服务<br>/etc/icinga2/conf.d/notifications.conf<br><figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">apply Notification <span class="string">"wechat-icingaadmin"</span> to Host &#123;</div><div class="line">  import <span class="string">"wechat-host-notification"</span></div><div class="line">  user_groups = host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span><span class="selector-class">.groups</span></div><div class="line">  assign where host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span></div><div class="line">  interval = <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">apply Notification <span class="string">"wechat-icingaadmin"</span> to Service &#123;</div><div class="line">  import <span class="string">"wechat-service-notification"</span></div><div class="line">  user_groups = host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span><span class="selector-class">.groups</span></div><div class="line">  assign where host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span></div><div class="line">  interval = <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>路径/etc/icinga2/scripts  </p>
<p><code># cat wechat-host-notification.sh</code>  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">template=\`cat &lt;&lt;TEMPLATE</div><div class="line"><span class="variable">$SHORTDATETIME</span>|<span class="variable">$HOSTALIAS</span>|<span class="variable">$HOSTADDRESS</span>|<span class="variable">$HOSTSTATE</span>|<span class="variable">$HOSTOUTPUT</span></div><div class="line">TEMPLATE</div><div class="line">\`</div><div class="line">/usr/<span class="built_in">local</span>/bin/send_wechat.py <span class="variable">$USEREMAIL</span> <span class="string">"<span class="variable">$template</span>"</span></div></pre></td></tr></table></figure>
<p><code># cat wechat-service-notification.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">template=\`cat &lt;&lt;TEMPLATE</div><div class="line"><span class="variable">$SHORTDATETIME</span>|<span class="variable">$HOSTALIAS</span>|<span class="variable">$HOSTADDRESS</span>|<span class="variable">$SERVICEDESC</span>|<span class="variable">$SERVICESTATE</span>|<span class="variable">$SERVICEOUTPUT</span></div><div class="line">TEMPLATE</div><div class="line">\`</div><div class="line">/usr/<span class="built_in">local</span>/bin/send_wechat.py <span class="variable">$USEREMAIL</span> <span class="string">"<span class="variable">$template</span>"</span></div></pre></td></tr></table></figure>
<p>检查配置文件<br>icinga2 daemon -C</p>
<p>重启icinga2</p>
<p>service icinga2 restart</p>
<p>相关资料：  <a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/migration" target="_blank" rel="external">http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/migration</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[OSX下合并MP4文件]]></title>
      <url>http://blog.wuliwala.net/2015/08/07/mp4box-concat-mp4/</url>
      <content type="html"><![CDATA[<p><code>brew install mp4box</code><br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">MP4Box -cat 1.mp4 -cat 2.mp4 -cat 3.mp4 output.mp4</div><div class="line">Appending file 1.mp4</div><div class="line">No suitable destination track found - creating new one (<span class="built_in">type</span> vide)</div><div class="line">No suitable destination track found - creating new one (<span class="built_in">type</span> soun)</div><div class="line">Appending file 2.mp4                             </div><div class="line">Appending file 3.mp4                             </div><div class="line">Saving to output.mp4: 0.500 secs Interleaving</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[gitlab服务搭建，配置ldap登陆]]></title>
      <url>http://blog.wuliwala.net/2015/08/06/gitlab-service-deploy/</url>
      <content type="html"><![CDATA[<p>准备数据目录<br><code>mkdir -p /srv/gitlab/config /srv/gitlab/logs /srv/gitlab/data</code></p>
<p>docker-compose.yml文件<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">gitlabCE:</div><div class="line">  image: gitlab/gitlab-ce</div><div class="line">  dns: 172.17.42.1</div><div class="line">  ports:</div><div class="line">    - &quot;8443:443&quot;</div><div class="line">    - &quot;8008:80&quot;</div><div class="line">    - &quot;2222:22&quot;</div><div class="line">  volumes:</div><div class="line">    - /srv/gitlab/config:/etc/gitlab</div><div class="line">    - /srv/gitlab/logs:/var/log/gitlab</div><div class="line">    - /srv/gitlab/data:/var/opt/gitlab</div><div class="line">  environment:</div><div class="line">    - PATH=/sbin:/usr/sbin:/bin:/usr/bin</div></pre></td></tr></table></figure></p>
<p>配置ldap登陆<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">gitlab_rails[&apos;ldap_enabled&apos;] = true</div><div class="line">gitlab_rails[&apos;ldap_servers&apos;] = YAML.load &lt;&lt;-&apos;EOS&apos; # remember to close this block with &apos;EOS&apos; below</div><div class="line">  main: # &apos;main&apos; is the GitLab &apos;provider ID&apos; of this LDAP server</div><div class="line">    label: &apos;LDAP&apos;</div><div class="line">    host: &apos;10.x.xx.xx&apos;</div><div class="line">    port: 389</div><div class="line">    uid: &apos;sAMAccountName&apos;</div><div class="line">    method: &apos;plain&apos; # &quot;tls&quot; or &quot;ssl&quot; or &quot;plain&quot;</div><div class="line">    bind_dn: &apos;cn=sysop,ou=zol,dc=office,dc=zol&apos;</div><div class="line">    password: &apos;password&apos;</div><div class="line">    active_directory: true</div><div class="line">    allow_username_or_email_login: false</div><div class="line">    block_auto_created_users: false</div><div class="line">    base: &apos;ou=zol,dc=office,dc=zol&apos;</div><div class="line">    user_filter: &apos;&apos;</div><div class="line">EOS</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS6免编译yum升级3.10内核]]></title>
      <url>http://blog.wuliwala.net/2015/08/04/centos6-update-kernel-to-3-10/</url>
      <content type="html"><![CDATA[<p>使用elrepo来更新<br>导入key<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</div></pre></td></tr></table></figure></p>
<p>安装repo<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm</div></pre></td></tr></table></figure></p>
<p>安装kernel<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">yum install kernel<span class="_">-lt</span> kernel<span class="_">-lt</span>-firmware kernel<span class="_">-lt</span>-headers</div></pre></td></tr></table></figure></p>
<p>启用新kernel<br><code>vi /etc/grub.conf</code><br>修改<br><code>default=0</code><br>查看当前kernel版本<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment"># uname -a</span></div><div class="line">Linux localhost.localdomain 2.6.32-504.30.3.el6.x86_64 <span class="comment">#1 SMP Wed Jul 15 10:13:09 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span></div></pre></td></tr></table></figure></p>
<p>重启系统<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment"># uname -a</span></div><div class="line">Linux localhost.localdomain 3.10.84-1.el6.elrepo.x86_64 <span class="comment">#1 SMP Sat Jul 11 11:33:48 EDT 2015 x86_64 x86_64 x86_64 GNU/Linux</span></div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[elk分析nginx访问日志]]></title>
      <url>http://blog.wuliwala.net/2015/07/25/elk/</url>
      <content type="html"><![CDATA[<h1 id="使用rsyslog-elk分析nginx访问日志。"><a href="#使用rsyslog-elk分析nginx访问日志。" class="headerlink" title="使用rsyslog + elk分析nginx访问日志。"></a>使用rsyslog + elk分析nginx访问日志。</h1><p>elk日志分析栈，即elasticsearch logstash kibana。  </p>
<p>为了减少对现有系统的改造，故使用rsyslog来读取应用服务器的nginx access_log，使用udp的方式发送到elk日志分析服务器的logstash，logstash解析日志后写入elasticsearch，进行存储和索引，最后由kibana来查询elasticsearch中的数据进行分析。</p>
<p>nginx.conf</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$request_time</span> <span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" <span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" "<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</div></pre></td></tr></table></figure>
<p>nginx日志</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">0.083 111.112.113.119 - - [25/Jul/2015:17:39:12 +0800] &quot;POST /m/write?&amp;title=xxx&amp;img= HTTP/1.1&quot; 200 83 &quot;-&quot; &quot;Dalvik/1.6.0 (Linux; U; Android 4.4.4; MI 4LTE MIUI/V6.5.3.0.KXGCNCD)&quot; &quot;-&quot;</div></pre></td></tr></table></figure>
<p>/etc/rsyslog.conf</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><div class="line"><span class="meta"><span class="meta-keyword">$ModLoad</span> imuxsock</span></div><div class="line"><span class="meta"><span class="meta-keyword">$ModLoad</span> imklog</span></div><div class="line"><span class="meta"><span class="meta-keyword">$ActionFileDefaultTemplate</span> RSYSLOG_TraditionalFileFormat</span></div><div class="line"><span class="meta"><span class="meta-keyword">$IncludeConfig</span> /etc/rsyslog.d/*.conf</span></div><div class="line"><span class="comment">*.info;mail.none;authpriv.none;cron.none                /var/log/messages</span></div><div class="line">authpriv.*                                              /var/<span class="built-in">log</span>/secure</div><div class="line">mail.*                                                  -/var/<span class="built-in">log</span>/maillog</div><div class="line">cron.*                                                  /var/<span class="built-in">log</span>/cron</div><div class="line"><span class="comment">*.emerg                                                 *</span></div><div class="line">uucp,news.crit                                          /var/<span class="built-in">log</span>/spooler</div><div class="line">local7.*                                                /var/<span class="built-in">log</span>/boot.<span class="built-in">log</span></div><div class="line"><span class="meta"><span class="meta-keyword">$ModLoad</span> imfile</span></div><div class="line"><span class="meta"><span class="meta-keyword">$InputFileName</span> /var/log/nginx/access.log</span></div><div class="line"><span class="meta"><span class="meta-keyword">$InputFileTag</span> nginx-access:</span></div><div class="line"><span class="meta"><span class="meta-keyword">$InputFileStateFile</span> state-nginx-accesslog</span></div><div class="line"><span class="meta"><span class="meta-keyword">$InputRunFileMonitor</span></span></div><div class="line"><span class="meta"><span class="meta-keyword">$InputFilePollInterval</span> 10</span></div><div class="line"><span class="keyword">if</span> <span class="symbol">$</span>programname == <span class="string">'nginx-access'</span> <span class="keyword">then</span> @@YOUR_ELK_IP:<span class="number">514</span></div><div class="line"><span class="keyword">if</span> <span class="symbol">$</span>programname == <span class="string">'nginx-access'</span> <span class="keyword">then</span> ~</div></pre></td></tr></table></figure>
<p>最终logstash接收到的信息如下：<br>里面包含了一些rsyslog附加的信息。</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><div class="line">&lt;<span class="number">133</span>&gt;Jul <span class="number">25</span> <span class="number">10</span>:<span class="number">37</span>:<span class="number">45</span> APPSERVE_RNAME nginx-access: <span class="number">0</span>.<span class="number">455</span> <span class="number">111.112.113.119</span> - - <span class="string">[25/Jul/2015:10:37:43 +0800]</span> <span class="string">"<span class="keyword">POST</span> /m/write?&amp;title=xxx&amp;create=1 HTTP/1.1"</span> <span class="number">200</span> <span class="number">121</span> <span class="string">"-"</span> <span class="string">"Dalvik/v3.3.86_update2 (Linux; U; Android 4.4.4; m1 Build/KTU84P)"</span> <span class="string">"-"</span></div></pre></td></tr></table></figure>
<p>下面是最终的filter<br>logstash.conf</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">input &#123;</div><div class="line">  tcp &#123;</div><div class="line">    port =&gt; <span class="number">514</span></div><div class="line">    type =&gt; syslog</div><div class="line">  &#125;</div><div class="line">  udp &#123;</div><div class="line">    port =&gt; <span class="number">514</span></div><div class="line">    type =&gt; syslog</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">filter &#123;</div><div class="line">  <span class="keyword">if</span> [type] == <span class="string">"syslog"</span> &#123;</div><div class="line">    grok &#123;</div><div class="line">      match =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;SYSLOGTIMESTAMP:syslog_timestamp&#125; %&#123;SYSLOGHOST:syslog_hostname&#125; %&#123;DATA:syslog_program&#125;(?:\[%&#123;POSINT:syslog_pid&#125;\])?: %&#123;NUMBER:request_time&#125; %&#123;IPORHOST:client_ip&#125; \- (%&#123;WORD:remote_user&#125;|-) \[%&#123;HTTPDATE:timestamp&#125;\] \"(?:%&#123;WORD:http_verb&#125; %&#123;NOTSPACE:http_request&#125;(?: HTTP/%&#123;NUMBER:http _version&#125;)?)\" %&#123;NUMBER:http_status_code&#125; (?:%&#123;NUMBER:bytes_read&#125;|-) %&#123;QS:referrer&#125; %&#123;QS:agent&#125; \"(%&#123;IP:x_forwarder_for&#125;|-)\""</span> &#125;</div><div class="line">    &#125;</div><div class="line">    kv &#123;</div><div class="line">      source =&gt; <span class="string">"http_request"</span></div><div class="line">      prefix =&gt; <span class="string">"arg_"</span></div><div class="line">      field_split =&gt; <span class="string">"&amp;?"</span></div><div class="line">      value_split =&gt; <span class="string">"="</span></div><div class="line">      exclude_keys =&gt; [ <span class="string">"title"</span>, <span class="string">"content"</span> ]</div><div class="line">    &#125;</div><div class="line">    urldecode &#123;</div><div class="line">      field =&gt; <span class="string">"http_request"</span></div><div class="line">    &#125;</div><div class="line">    mutate &#123;</div><div class="line">      remove_field =&gt; [ <span class="string">"message"</span> ]</div><div class="line">    &#125;</div><div class="line">    geoip &#123;</div><div class="line">      source =&gt; <span class="string">"client_ip"</span></div><div class="line">    &#125;</div><div class="line">    syslog_pri &#123; &#125;</div><div class="line">    date &#123;</div><div class="line">      match =&gt; [ <span class="string">"timestamp"</span>, <span class="string">"d/MMM/y:HH:mm:ss Z"</span>, <span class="string">"MMM  d HH:mm:ss"</span>, <span class="string">"MMM dd HH:mm:ss"</span> ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">  elasticsearch &#123; </div><div class="line">    host =&gt; <span class="string">"elk-elasticsearch"</span></div><div class="line">    protocol =&gt; <span class="string">"http"</span></div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2016-08-01-更新"><a href="#2016-08-01-更新" class="headerlink" title="2016.08.01 更新"></a>2016.08.01 更新</h2><p>nginx 1.7.1 版本之后支持将error_log和access_log发送到syslog，当然也支持远端syslog服务。  </p>
<p>这样的话，可以将上面 /etc/rsyslog.conf 的部分去掉，简单地把下面这行配置加到nginx配置文件中即可。</p>
<p><code>access_log syslog:server=syslog.yourdomain.com:514 default;</code></p>
<p><a href="http://nginx.org/en/CHANGES" target="_blank" rel="external">官方CHANGES LIST</a></p>
<p><a href="http://nginx.org/en/docs/syslog.html" target="_blank" rel="external">官方教程 Logging to syslog </a></p>
<p><a href="http://nginx.org/en/docs/http/ngx_http_log_module.html" target="_blank" rel="external">官方文档 ngx_http_log_module </a></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><div class="line">Changes <span class="keyword">with</span> nginx <span class="number">1.7</span><span class="number">.1</span>                                         <span class="number">27</span> May <span class="number">2014</span></div><div class="line">    *) Feature: <span class="keyword">the</span> <span class="string">"error_log"</span> <span class="keyword">and</span> <span class="string">"access_log"</span> directives now support</div><div class="line">       logging <span class="built_in">to</span> syslog.</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[yum安装dell官方OpenIPMI失败问题]]></title>
      <url>http://blog.wuliwala.net/2015/07/24/yuman-zhuang-dellguan-fang-openipmishi-bai-wen-ti/</url>
      <content type="html"><![CDATA[<p>dell openmanage repo CentOS5<br>安装 OpenIPMI时报如下错误：<br><a href="http://mirrors.private.com/hardware/dell/5/x86_64/ipmitool/OpenIPMI-2.0.16-99.dell.4.99.1.el5.x86_64.rpm" target="_blank" rel="external">http://mirrors.private.com/hardware/dell/5/x86_64/ipmitool/OpenIPMI-2.0.16-99.dell.4.99.1.el5.x86_64.rpm</a>: [Errno -1] Package does not match intended download<br>Trying other mirror.<br>问题分析：<br>从mirror服务器的nginx访问日志中看，是200状态，表明yum成功下载了该rpm包<br>于是怀疑是repo数据库中此rpm包的值不对，于是用createrepo命令来创建</p>
<p>又遇到了Error performing checksum错误<br>原因为：<br>CentOS5中的yum不能计算sha256，于是改用 sha1算法来生成针对centos5版本的repo数据库</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><div class="line"><span class="meta-keyword">/usr/</span>bin/createrepo -s sha1 --simple-md-filenames -d -o <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50 <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50</div><div class="line"><span class="meta-keyword">/usr/</span>bin/createrepo -s sha1 --simple-md-filenames -d -o <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50_64 <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50_64</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ghost添加代码高亮highlight.js]]></title>
      <url>http://blog.wuliwala.net/2015/07/24/ghosttian-jia-dai-ma-gao-liang-highlight-js/</url>
      <content type="html"><![CDATA[<p>下载highlight代码，拷贝到当前使用主题的assets目录<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">mv highlight ~/blog/content/themes/casper-zh/assets/hl</div><div class="line">vim ~/blog/content/themes/casper-zh/default.hbs</div></pre></td></tr></table></figure></p>
<p>修改模板，css添加到<code>&lt;head&gt;</code>标签内，js添加到<code>&lt;/body&gt;</code>前面。<br><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;asset "</span><span class="attr">hl</span>/<span class="attr">styles</span>/<span class="attr">github-gist.css</span>"&#125;&#125;" /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;asset "</span><span class="attr">hl</span>/<span class="attr">highlight.pack.js</span>"&#125;&#125;"&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">hljs.initHighlightingOnLoad();</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>重启ghost<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sudo service supervisord restart</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vmware ESXi 监控]]></title>
      <url>http://blog.wuliwala.net/2015/07/23/vmware-esxi-jian-kong/</url>
      <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">vicfg-snmp --server 10.1.0.15 --username USER --password PASS --t 10.19.8.15@162/public</div><div class="line">vicfg-snmp --server 10.1.0.15  --username USER --password PASS --enable</div><div class="line">snmpwalk -v 1 -c public 10.1.0.15 1.3.6.1.2.1.25.3.3</div></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.1</span> = <span class="string">INTEGER:</span> <span class="number">5</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.2</span> = <span class="string">INTEGER:</span> <span class="number">4</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.3</span> = <span class="string">INTEGER:</span> <span class="number">5</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.4</span> = <span class="string">INTEGER:</span> <span class="number">4</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.5</span> = <span class="string">INTEGER:</span> <span class="number">4</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.6</span> = <span class="string">INTEGER:</span> <span class="number">5</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.7</span> = <span class="string">INTEGER:</span> <span class="number">4</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.8</span> = <span class="string">INTEGER:</span> <span class="number">5</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.10</span> = <span class="string">INTEGER:</span> <span class="number">1</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.11</span> = <span class="string">INTEGER:</span> <span class="number">2</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.12</span> = <span class="string">INTEGER:</span> <span class="number">3</span></div><div class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.13</span> = <span class="string">INTEGER:</span> <span class="number">4</span></div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[iptables NAT 动态切换 IP]]></title>
      <url>http://blog.wuliwala.net/2015/07/17/iptables-nat-dong-tai-qie-huan-ip/</url>
      <content type="html"><![CDATA[<p>iptables 动态切换出口IP<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 100); <span class="keyword">do</span> iptables -t nat -I POSTROUTING -m statistic --mode nth --packet 0 --every 5 -j SNAT --to-source 10.0.0.<span class="variable">$i</span>; <span class="keyword">done</span></div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[pip 报错from versions: 问题]]></title>
      <url>http://blog.wuliwala.net/2015/07/16/pip-bao-cuo-from-versions-wen-ti/</url>
      <content type="html"><![CDATA[<p>pip升级到6\7版本后，使用自搭建mirror的报错问题</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">pip_pypy <span class="keyword">install</span> Flask</div><div class="line">You <span class="keyword">are</span> <span class="keyword">using</span> pip <span class="keyword">version</span> <span class="number">7.0</span><span class="number">.1</span>, however <span class="keyword">version</span> <span class="number">7.1</span><span class="number">.0</span> <span class="keyword">is</span> available.</div><div class="line">You should <span class="keyword">consider</span> upgrading via the <span class="string">'pip install --upgrade pip'</span> command.</div><div class="line">Collecting Flask</div><div class="line">  The repository located <span class="keyword">at</span> mirrors.zol.com.cn <span class="keyword">is</span> <span class="keyword">not</span> a trusted <span class="keyword">or</span> secure host <span class="keyword">and</span> <span class="keyword">is</span> being ignored. <span class="keyword">If</span> this repository <span class="keyword">is</span> available via HTTPS it <span class="keyword">is</span> recommended <span class="keyword">to</span> <span class="keyword">use</span> HTTPS instead, otherwise you may silence this <span class="keyword">warning</span> <span class="keyword">and</span> <span class="keyword">allow</span> it anyways <span class="keyword">with</span> <span class="string">'--trusted-host mirrors.zol.com.cn'</span>.</div><div class="line">  Could <span class="keyword">not</span> find a <span class="keyword">version</span> that satisfies the requirement Flask (<span class="keyword">from</span> <span class="keyword">versions</span>: )</div><div class="line"><span class="keyword">No</span> matching distribution <span class="keyword">found</span> <span class="keyword">for</span> Flask</div></pre></td></tr></table></figure>
<p>主要是这句：<br>Could not find a version that satisfies the requirement Flask (from versions: )<br>No matching distribution found for Flask</p>
<p>困扰了好久，google也不到答案。 </p>
<p>其实这样使用就可以了：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">pip_pypy --trusted-host mirrors<span class="selector-class">.zol</span><span class="selector-class">.com</span><span class="selector-class">.cn</span> install Flask</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS6 ruby gems 安装]]></title>
      <url>http://blog.wuliwala.net/2015/07/14/centos6-ruby-gems-an-zhuang/</url>
      <content type="html"><![CDATA[<p>平时很少用到ruby，今天用到了，记录一下<br>ruby安装，并导入阿里云gems镜像</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><div class="line">yum -<span class="keyword">y</span> install <span class="keyword">ruby</span> rubygems</div><div class="line">gem <span class="keyword">source</span> -r http<span class="variable">s:</span>//rubygems.org/</div><div class="line">gem <span class="keyword">source</span> -<span class="keyword">a</span> http://mirrors.aliyun.<span class="keyword">com</span>/rubygems/</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS6 配置 vagrant + VirtualBox]]></title>
      <url>http://blog.wuliwala.net/2015/07/14/centos6-pei-zhi-vagrant-virtualbox/</url>
      <content type="html"><![CDATA[<p>安装vagrant1.7.2<br><figure class="highlight vim"><table><tr><td class="code"><pre><div class="line">wget http<span class="variable">s:</span>//<span class="keyword">dl</span>.bintray.<span class="keyword">com</span>/mitchellh/vagrant/vagrant_1.<span class="number">7.2</span>_x86_64.rpm</div><div class="line">rpm -ivh vagrant_1.<span class="number">7.2</span>_x86_64.rpm</div></pre></td></tr></table></figure></p>
<p>安装VirtualBox 4.2<br><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="meta"># curl http:<span class="comment">//download.virtualbox.org/virtualbox/rpm/el/virtualbox.repo &gt;/etc/yum.repos.d/virtualbox.repo</span></span></div><div class="line">yum -y install gcc make dkms libGL libXmu libXt SDL SDL-devel SDL-<span class="keyword">static</span> kernel-devel libpng libXcursor libXinerama fontconfig-devel freetype-devel VirtualBox<span class="number">-4.2</span></div></pre></td></tr></table></figure></p>
<p>安装VitrualBox中的重要提示信息<br><figure class="highlight oxygene"><table><tr><td class="code"><pre><div class="line">reating <span class="keyword">group</span> <span class="string">'vboxusers'</span>. VM users must be member <span class="keyword">of</span> that <span class="keyword">group</span>!</div></pre></td></tr></table></figure></p>
<p>启用dbus<br><figure class="highlight applescript"><table><tr><td class="code"><pre><div class="line">chkconfig messagebus <span class="keyword">on</span></div></pre></td></tr></table></figure></p>
<p>如果执行VirtualBox报如下错误<br><figure class="highlight livescript"><table><tr><td class="code"><pre><div class="line">No precompiled <span class="built_in">module</span> <span class="keyword">for</span> <span class="keyword">this</span> kernel found -- trying <span class="keyword">to</span> build one. Messages</div><div class="line">emitted during <span class="built_in">module</span> compilation will be logged <span class="keyword">to</span> /<span class="keyword">var</span>/log/vbox-install.log.</div></pre></td></tr></table></figure></p>
<p>查看日志可发现</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><div class="line">Makefile:<span class="number">185</span>: *** <span class="built_in">Error</span>: unable to find the sources of your current Linux kernel. Specify KERN_DIR=&lt;directory&gt; <span class="keyword">and</span> <span class="keyword">run</span> <span class="built_in">Make</span> again.  <span class="keyword">Stop</span>.</div></pre></td></tr></table></figure>
<p>然后执行<br><figure class="highlight lsl"><table><tr><td class="code"><pre><div class="line"># KERN_DIR=/usr/src/kernels/<span class="number">2.6</span><span class="number">.32</span><span class="number">-504.23</span><span class="number">.4</span>.el6.x86_64 /etc/init.d/vboxdrv setup</div></pre></td></tr></table></figure></p>
<p>运行过程中输出如下<br><figure class="highlight accesslog"><table><tr><td class="code"><pre><div class="line">Stopping VirtualBox kernel modules <span class="string">[  OK  ]</span></div><div class="line">Uninstalling old VirtualBox DKMS kernel modules <span class="string">[  OK  ]</span></div><div class="line">Trying to register the VirtualBox kernel modules using DKMS <span class="string">[  OK  ]</span></div><div class="line">Starting VirtualBox kernel modules <span class="string">[  OK  ]</span></div></pre></td></tr></table></figure></p>
<p>然后重启系统<br><figure class="highlight applescript"><table><tr><td class="code"><pre><div class="line">VBoxManage <span class="built_in">list</span> vms</div><div class="line">VBoxManage <span class="built_in">list</span> runningvms</div></pre></td></tr></table></figure></p>
<p>vagrant安装爬 墙 插件<br><figure class="highlight awk"><table><tr><td class="code"><pre><div class="line">https_proxy=https:<span class="regexp">//y</span>ourporxy:<span class="number">3128</span> http_proxy=http:<span class="regexp">//y</span>ourporxy:<span class="number">3128</span> vagrant plugin install vagrant-proxyconf</div></pre></td></tr></table></figure></p>
<p>vi Vagrantfile<br><figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">config<span class="selector-class">.proxy</span><span class="selector-class">.http</span>     = <span class="string">"http://yourporxy:3128"</span></div><div class="line">config<span class="selector-class">.proxy</span><span class="selector-class">.https</span>    = <span class="string">"https://yourporxy:3128"</span></div><div class="line">config<span class="selector-class">.proxy</span><span class="selector-class">.no_proxy</span> = <span class="string">"localhost,127.0.0.1"</span></div></pre></td></tr></table></figure></p>
<p>vagrant的box文件可以通过迅雷加速下载到本地硬盘，然后通过命令导入，可节省大量时间<br><figure class="highlight processing"><table><tr><td class="code"><pre><div class="line">vagrant <span class="built_in">box</span> <span class="built_in">add</span> --name <span class="string">"centos-6.5-i386-vbox"</span> centos<span class="number">-65</span>-i386-vbox.<span class="built_in">box</span></div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[OSv安装测试]]></title>
      <url>http://blog.wuliwala.net/2015/07/09/osvan-zhuang-ce-shi/</url>
      <content type="html"><![CDATA[<figure class="highlight clean"><table><tr><td class="code"><pre><div class="line">curl https:<span class="comment">//raw.githubusercontent.com/cloudius-systems/capstan/master/scripts/download &gt;&gt;./ installcapstan</span></div><div class="line"></div><div class="line">[root@localhost ~]# sh installcapstan </div><div class="line">Downloading Capstan binary: http:<span class="comment">//osv.capstan.s3.amazonaws.com/capstan/v0.1.8/linux_amd64/capstan</span></div><div class="line">######################################################################## <span class="number">100.0</span>%</div></pre></td></tr></table></figure>
<p>执行命令<br><figure class="highlight vim"><table><tr><td class="code"><pre><div class="line">[root@localhost ~]# capstan </div><div class="line">NAME:</div><div class="line">   capstan - pack, ship, <span class="built_in">and</span> run applications in light-weight VMs</div><div class="line"></div><div class="line">USAGE:</div><div class="line">   capstan [<span class="keyword">global</span> <span class="keyword">options</span>] <span class="keyword">command</span> [<span class="keyword">command</span> <span class="keyword">options</span>] [arguments...]</div><div class="line"></div><div class="line">VERSION:</div><div class="line">   v0.<span class="number">1.8</span></div><div class="line"></div><div class="line">COMMANDS:</div><div class="line">   info		show disk image information</div><div class="line">   import	import <span class="keyword">an</span> image <span class="keyword">to</span> the local repository</div><div class="line">   pull		pull <span class="keyword">an</span> image from <span class="keyword">a</span> repository</div><div class="line">   rmi		<span class="keyword">delete</span> <span class="keyword">an</span> image from <span class="keyword">a</span> repository</div><div class="line">   run		launch <span class="keyword">a</span> VM. You may pass the image name <span class="keyword">as</span> the <span class="keyword">first</span> <span class="keyword">argument</span>.</div><div class="line">   build	build <span class="keyword">an</span> image</div><div class="line">   images, i	<span class="keyword">list</span> images</div><div class="line">   <span class="built_in">search</span>	<span class="built_in">search</span> <span class="keyword">a</span> remote images</div><div class="line">   instances, I	<span class="keyword">list</span> instances</div><div class="line">   <span class="keyword">stop</span>		<span class="keyword">stop</span> <span class="keyword">an</span> instance</div><div class="line">   <span class="keyword">delete</span>	<span class="keyword">delete</span> <span class="keyword">an</span> instance</div><div class="line">   <span class="keyword">help</span>, h	Shows <span class="keyword">a</span> <span class="keyword">list</span> of commands <span class="built_in">or</span> <span class="keyword">help</span> <span class="keyword">for</span> one <span class="keyword">command</span></div><div class="line">   </div><div class="line">GLOBAL OPTIONS:</div><div class="line">   --<span class="keyword">help</span>, -h		show <span class="keyword">help</span></div><div class="line">   --<span class="keyword">version</span>, -v	<span class="keyword">print</span> the <span class="keyword">version</span></div></pre></td></tr></table></figure></p>
<p>搜索官方镜像<br><figure class="highlight less"><table><tr><td class="code"><pre><div class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">capstan</span> <span class="selector-tag">search</span></div><div class="line"><span class="selector-tag">Name</span>                           <span class="selector-tag">Description</span>                                        <span class="selector-tag">Version</span>                   <span class="selector-tag">Created</span>        </div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-base</span>              <span class="selector-tag">OSv</span> <span class="selector-tag">base</span> <span class="selector-tag">image</span> <span class="selector-tag">for</span> <span class="selector-tag">developers</span>                      <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:29</span><span class="selector-pseudo">:46</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-cassandra</span>         <span class="selector-tag">Apache</span> <span class="selector-tag">Cassandra</span>/<span class="selector-tag">OSv</span>                               <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:38</span><span class="selector-pseudo">:48</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-crash</span>             <span class="selector-tag">OSv</span>/<span class="selector-tag">CRaSH</span> <span class="selector-tag">shell</span> <span class="selector-tag">for</span> <span class="selector-tag">developers</span>                     <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:35</span><span class="selector-pseudo">:59</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-iperf</span>             <span class="selector-tag">iperf</span>/<span class="selector-tag">OSv</span>                                          <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:40</span><span class="selector-pseudo">:46</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-memcached-opt</span>     <span class="selector-tag">OSv</span> <span class="selector-tag">memcached</span> <span class="selector-tag">server</span> (optimized)                   <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:41</span><span class="selector-pseudo">:14</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-node</span>              <span class="selector-tag">Node</span>/<span class="selector-tag">OSv</span>                                           <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:35</span><span class="selector-pseudo">:30</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-openjdk</span>           <span class="selector-tag">OpenJDK</span> <span class="selector-tag">7</span>/<span class="selector-tag">OSv</span> <span class="selector-tag">base</span> <span class="selector-tag">image</span> <span class="selector-tag">for</span> <span class="selector-tag">developers</span>            <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:32</span><span class="selector-pseudo">:52</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-openjdk8</span>          <span class="selector-tag">OpenJDK</span> <span class="selector-tag">8</span>/<span class="selector-tag">OSv</span> <span class="selector-tag">base</span> <span class="selector-tag">image</span> <span class="selector-tag">for</span> <span class="selector-tag">developers</span>            <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:33</span><span class="selector-pseudo">:57</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-redis-memonly</span>     <span class="selector-tag">Redis</span> (in-memory only)                             <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:41</span><span class="selector-pseudo">:45</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv-tomcat</span>            <span class="selector-tag">Apache</span> <span class="selector-tag">Tomcat</span>/<span class="selector-tag">OSv</span>                                  <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:39</span><span class="selector-pseudo">:48</span></div><div class="line"><span class="selector-tag">cloudius</span>/<span class="selector-tag">osv</span>                   <span class="selector-tag">OSv</span> <span class="selector-tag">with</span> <span class="selector-tag">shell</span> <span class="selector-tag">for</span> <span class="selector-tag">users</span>                           <span class="selector-tag">v0</span><span class="selector-class">.22</span>                     <span class="selector-tag">2015-07-06T09</span><span class="selector-pseudo">:36</span><span class="selector-pseudo">:59</span></div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Linux命令行获取HP iLo配置信息]]></title>
      <url>http://blog.wuliwala.net/2015/07/08/linux-hp-ilo-ming-ling-xing-gong-ju/</url>
      <content type="html"><![CDATA[<p>安装命令行工具</p>
<pre><code>#yum install hponcfg
</code></pre><p>测试一下</p>
<pre><code>#hponcfg -g
</code></pre><p>输出如下<br><figure class="highlight fortran"><table><tr><td class="code"><pre><div class="line">HP Lights-<span class="keyword">Out</span> Online Configuration utility</div><div class="line">Version <span class="number">4.1.</span><span class="number">0</span> Date <span class="number">1</span>/<span class="number">3</span>/<span class="number">2013</span> (c) Hewlett-Packard Company, <span class="number">2013</span></div><div class="line">Firmware Revision = <span class="number">1.81</span> Device <span class="keyword">type</span> = iLO <span class="number">2</span> Driver <span class="keyword">name</span> = hpilo</div><div class="line">Host Information:</div><div class="line">                        Server <span class="keyword">Name</span>: DL380G5PXXXX</div><div class="line">                        Server <span class="keyword">Number</span>: <span class="number">000000000</span></div></pre></td></tr></table></figure></p>
<p>编辑一个xml文件<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"># cat getinfo.xml</div><div class="line"><span class="tag">&lt;<span class="name">RIBCL</span> <span class="attr">VERSION</span>=<span class="string">"2.0"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">LOGIN</span> <span class="attr">USER_LOGIN</span>=<span class="string">'yourusername'</span> <span class="attr">PASSWORD</span>=<span class="string">'yourpassword'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">RIB_INFO</span> <span class="attr">MODE</span>=<span class="string">"read"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">GET_NETWORK_SETTINGS</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">RIB_INFO</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">LOGIN</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">RIBCL</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>执行命令</p>
<pre><code>#hponcfg -f getinfo.xml
</code></pre><p>输出如下<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">HP Lights-Out Online Configuration utility</div><div class="line">Version 4.1.0 Date 1/3/2013 (c) Hewlett-Packard Company, 2013</div><div class="line">Firmware Revision = 1.81 Device type = iLO 2 Driver name = hpilo</div><div class="line"><span class="tag">&lt;<span class="name">GET_NETWORK_SETTINGS</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ENABLE_NIC</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">SHARED_NETWORK_PORT</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">VLAN</span> <span class="attr">ENABLED</span>=<span class="string">"N"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">VLAN_ID</span> <span class="attr">VALUE</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">SPEED_AUTOSELECT</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">NIC_SPEED</span> <span class="attr">VALUE</span>=<span class="string">"10"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">FULL_DUPLEX</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DHCP_ENABLE</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DHCP_GATEWAY</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DHCP_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DHCP_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DHCP_STATIC_ROUTE</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DHCP_DOMAIN_NAME</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">REG_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">REG_DDNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">PING_GATEWAY</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">MAC_ADDRESS</span> <span class="attr">VALUE</span>=<span class="string">"00:1e:0b:d9:a8:7a"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">IP_ADDRESS</span> <span class="attr">VALUE</span>=<span class="string">"10.15.xxx.xxx"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">SUBNET_MASK</span> <span class="attr">VALUE</span>=<span class="string">"255.255.254.0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">GATEWAY_IP_ADDRESS</span> <span class="attr">VALUE</span>=<span class="string">"10.15.xxx.1"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DNS_NAME</span> <span class="attr">VALUE</span>=<span class="string">"ILOCNGxxxxxxx"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">DOMAIN_NAME</span> <span class="attr">VALUE</span>=<span class="string">""</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">PRIM_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">SEC_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">TER_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">PRIM_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">SEC_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">STATIC_ROUTE_1</span> <span class="attr">DEST</span>=<span class="string">"0.0.0.0"</span></span></div><div class="line">                    <span class="attr">GATEWAY</span>=<span class="string">"0.0.0.0"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">STATIC_ROUTE_2</span> <span class="attr">DEST</span>=<span class="string">"0.0.0.0"</span></span></div><div class="line">                    <span class="attr">GATEWAY</span>=<span class="string">"0.0.0.0"</span>/&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">STATIC_ROUTE_3</span> <span class="attr">DEST</span>=<span class="string">"0.0.0.0"</span></span></div><div class="line">                    <span class="attr">GATEWAY</span>=<span class="string">"0.0.0.0"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">GET_NETWORK_SETTINGS</span>&gt;</span></div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[DELL 部分型号 iPXE 不兼容问题]]></title>
      <url>http://blog.wuliwala.net/2015/07/03/dell-ipxe/</url>
      <content type="html"><![CDATA[<p>DELL R710 服务器iPXE启动报错问题，报错信息如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><div class="line">1<span class="selector-class">.0</span><span class="selector-class">.0</span>(<span class="selector-tag">f557</span>)</div><div class="line"><span class="selector-tag">Link</span><span class="selector-pseudo">:up</span></div><div class="line"><span class="selector-tag">Configuring</span> (<span class="selector-tag">net0</span>)…… <span class="selector-tag">Error</span> 0<span class="selector-tag">x040ee119</span> </div><div class="line"><span class="selector-tag">No</span> <span class="selector-tag">more</span> <span class="selector-tag">network</span> <span class="selector-tag">devices</span></div></pre></td></tr></table></figure>
<p>在官网可以看到错误代码文档，以及可能的问题分析，还有直达源码的链接。<br><a href="http://ipxe.org/err/040ee1" target="_blank" rel="external">http://ipxe.org/err/040ee1</a></p>
<p>解决方案是升级 引导文件undionly.kpxe</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line">yum -y install lzma xz-devel xz-libs lzip syslinux cdw</div><div class="line">git clone <span class="string">http:</span><span class="comment">//git.ipxe.org/ipxe.git</span></div><div class="line">cd ipxe<span class="regexp">/src/</span></div><div class="line">make</div><div class="line">cp bin<span class="regexp">/undionly.kpxe /</span>home<span class="regexp">/service/</span>PXE/</div></pre></td></tr></table></figure>
<p>把文件替换旧版本即可</p>
<p>重启服务器，网络引导成功</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用squid代理rsync]]></title>
      <url>http://blog.wuliwala.net/2015/06/23/squid/</url>
      <content type="html"><![CDATA[<p>由于新IDC和老IDC需要迁移部分数据，但新老两个IDC之间网络目前还没打通，但办公室网络两边都可以连通。<br>于是用squid搭个代理来同步数据。</p>
<p>office 10.21.2.2 squid proxy<br>老IDC  10.15.3.8 rsync src<br>新IDC  10.19.1.3 rsync dst</p>
<p>office的服务器10.21.2.2上搭建squid服务<br>yum install -y squid<br>vim /etc/squid/squid.conf<br>在配置文件最前面添加<br><figure class="highlight lsl"><table><tr><td class="code"><pre><div class="line">acl idc_rule src <span class="number">10.19</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">22</span></div><div class="line">acl SSL_port port <span class="number">873</span> # for rsync  </div><div class="line">acl Safe_port port <span class="number">873</span> # for rsync  </div><div class="line">visible_hostname localhost</div><div class="line">http_access allow idc_rule</div></pre></td></tr></table></figure></p>
<p>service squid restart</p>
<p>在新idc的机器10.19.1.3上，运行下面命令<br>export RSYNC_PROXY=”10.21.2.2:3128”<br>rsync -avz –progress 10.15.3.8::iso/ ./</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[32位 XP server2003 连接vmware vCenter ESXi 5.5以上版本失败问题]]></title>
      <url>http://blog.wuliwala.net/2015/06/23/32wei-xp-server2003-lian-jie-vmware-vcenter-esxi-5-5yi-shang-ban-ben-shi-bai-wen-ti/</url>
      <content type="html"><![CDATA[<p>vSphere Client and vSphere PowerCLI may fail to connect to vCenter Server 5.5 due to a Handshake failure (2049143)</p>
<p>连到esxi 5.5 或 vCenter 5.5都要增加<cipherlist>ALL</cipherlist></p>
<p>F2 ，输入账号密码<br>进入Troubleshooting Options<br>EnableSSH</p>
<p>ssh 到 ESXi<br>cd /etc/vmware/rhttpproxy/<br>cp config.xml config_bak.xml<br>修改 config.xml ：vi config.xml<br>找到 <vmacore> 的 <ssl> 配置段<br>加上一行：<cipherlist>ALL</cipherlist></ssl></vmacore></p>
<figure class="highlight dts"><table><tr><td class="code"><pre><div class="line"><span class="params">&lt;ssl&gt;</span></div><div class="line">          <span class="params">&lt;doVersionCheck&gt;</span> false <span class="params">&lt;/doVersionCheck&gt;</span></div><div class="line">          <span class="params">&lt;useCompression&gt;</span>true<span class="params">&lt;/useCompression&gt;</span></div><div class="line">          <span class="params">&lt;libraryPath&gt;</span><span class="meta-keyword">/lib/</span><span class="params">&lt;/libraryPath&gt;</span></div><div class="line">          <span class="params">&lt;cipherList&gt;</span>ALL<span class="params">&lt;/cipherList&gt;</span></div><div class="line"><span class="params">&lt;/ssl&gt;</span></div></pre></td></tr></table></figure>
<p>保存后重启服务：/etc/init.d/rhttpproxy restart</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS 6.x git 1.7 clone gitlab 验证失败]]></title>
      <url>http://blog.wuliwala.net/2015/06/15/centos-6-x-git-1-7-clone-gitlab-yan-zheng-shi-bai/</url>
      <content type="html"><![CDATA[<p>最近要用测试机（CentOS6)测试项目代码，代码放在gitlab。<br>yum安装的git版本是1.7.1，在clone gitlab repo的时候，报如下错误。</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><div class="line"><span class="keyword">error: </span>The requested URL returned error: 401 Unauthorized while accessing https://gitlab.com/arkii/xxx.git/info/refs</div><div class="line">fatal: HTTP request failed</div></pre></td></tr></table></figure>
<p>解决办法是升级git版本到2以上。<br>升级过程如下</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">wget https://github.com/git/git/archive/v2.4.3.tar.gz</div><div class="line">yum -y <span class="keyword">install</span> curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc xmlto docbook2x docbook2X</div><div class="line">tar -zxf v2<span class="number">.4</span><span class="number">.3</span>.tar.gz</div><div class="line">cd git<span class="number">-2.4</span><span class="number">.3</span></div><div class="line">make configure</div><div class="line">./configure <span class="comment">--prefix=/usr/local/git2.4.3</span></div><div class="line">make -j8 all doc info</div><div class="line">make <span class="keyword">install</span> <span class="keyword">install</span>-doc <span class="keyword">install</span>-html <span class="keyword">install</span>-info</div><div class="line"><span class="keyword">ln</span> -s /usr/<span class="keyword">local</span>/git2<span class="number">.4</span><span class="number">.3</span>/<span class="keyword">bin</span>/git /usr/<span class="keyword">bin</span>/</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[禁用chrome增强型书签管理器]]></title>
      <url>http://blog.wuliwala.net/2015/05/25/jin-yong-chromezeng-qiang-xing-shu-qian-guan-li-qi/</url>
      <content type="html"><![CDATA[<p>一直开着chrome自动更新，突然前段时间书签管理器变了，习惯之前的树形，书签都归类好了，突然来一简单粗暴的，还不习惯，每次添加都新书签都觉得好难用。</p>
<p>先关了吧，过一阵再研究。</p>
<p>打开 chrome://flags/#enhanced-bookmarks-experiment</p>
<p>设置为“Disabled”</p>
<p>重启chrome</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[docker-statsd-influxdb]]></title>
      <url>http://blog.wuliwala.net/2015/05/12/docker-statsd-influxdb/</url>
      <content type="html"><![CDATA[<p>本文介绍如何用docker封装一个支持graphite和influxdb作为后端数据存储的statsd image。</p>
<p>最近折腾监控系统<br>选用statsd作为数据代理，用于接收各种agent发来的读数，然后存到influxdb中。<br>statsd 目前在github上star有7500+。</p>
<p>注意:<br>使用statsd数据刷到influxdb中有10秒钟延迟，这是由于statsd的机制。</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><div class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/etsy/statsd.git</div></pre></td></tr></table></figure>
<p>Dockerfile<br><figure class="highlight dockerfile"><table><tr><td class="code"><pre><div class="line"><span class="comment"># cat Dockerfile </span></div><div class="line"><span class="keyword">FROM</span>        arkii/node:slim</div><div class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</div><div class="line"><span class="keyword">COPY</span><span class="bash">        ./statsd /statsd</span></div><div class="line"><span class="keyword">ADD</span><span class="bash">         config.js /statsd/config.js</span></div><div class="line"><span class="keyword">RUN</span><span class="bash">         <span class="built_in">echo</span> <span class="string">'Asia/Shanghai'</span> &gt; /etc/timezone &amp;&amp; /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; <span class="built_in">cd</span> /statsd &amp;&amp; npm install statsd-influxdb-backend</span></div><div class="line"><span class="keyword">CMD</span><span class="bash">         /statsd/bin/statsd <span class="string">"<span class="variable">$&#123;CONFIG_PATH:=/statsd/config.js&#125;</span>"</span></span></div><div class="line"><span class="keyword">EXPOSE</span>      <span class="number">8125</span>/udp <span class="number">8126</span>/tcp</div></pre></td></tr></table></figure></p>
<p>docker-compose/fig 配置文件<br><figure class="highlight haml"><table><tr><td class="code"><pre><div class="line"># cat fig.yml </div><div class="line">statsd:</div><div class="line">  image: arkii/statsd:influxdb</div><div class="line">  dns: 172.17.42.1</div><div class="line">  ports:</div><div class="line">    -<span class="ruby"> <span class="string">"8125:8125/udp"</span></span></div><div class="line">    -<span class="ruby"> <span class="string">"8126:8126/tcp"</span></span></div><div class="line">  environment:</div><div class="line">    -<span class="ruby"> PATH=<span class="regexp">/sbin:/usr</span><span class="regexp">/sbin:/bin</span><span class="symbol">:/usr/bin</span><span class="symbol">:/usr/local/bin</span></span></div><div class="line">    -<span class="ruby"> INFLUXDB_HOST=<span class="number">10.21</span>.<span class="number">9.61</span></span></div><div class="line">    -<span class="ruby"> STATSD_DEBUG=<span class="literal">true</span></span></div></pre></td></tr></table></figure></p>
<p>启动脚本<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment"># cat service.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">sysctl -w net.nf_conntrack_max=655360</div><div class="line">sysctl -w vm.max_map_count=262144</div><div class="line"><span class="built_in">ulimit</span> -n 65536</div><div class="line">/usr/bin/fig up <span class="_">-d</span> --allow-insecure-ssl</div></pre></td></tr></table></figure></p>
<p>statsd配置文件，支持启动时指定变量<br><figure class="highlight less"><table><tr><td class="code"><pre><div class="line"># <span class="selector-tag">cat</span> <span class="selector-tag">config</span><span class="selector-class">.js</span> </div><div class="line">&#123;</div><div class="line"><span class="comment">//  graphitePort: 2003,</span></div><div class="line"><span class="comment">//  graphiteHost: "graphite.example.com",</span></div><div class="line">  <span class="attribute">port</span>: <span class="number">8125</span>,</div><div class="line"><span class="comment">//  backends: [ "./backends/graphite", "statsd-influxdb-backend" ],</span></div><div class="line">  <span class="attribute">debug</span>: process.env.STATSD_DEBUG || false,</div><div class="line">  <span class="attribute">backends</span>: [ <span class="string">"statsd-influxdb-backend"</span> ],</div><div class="line">  <span class="attribute">influxdb</span>: &#123;</div><div class="line">    <span class="attribute">host</span>: process.env.INFLUXDB_HOST || <span class="string">'127.0.0.1'</span>,   <span class="comment">// InfluxDB host. (default 127.0.0.1)</span></div><div class="line">    <span class="attribute">port</span>: process.env.INFLUXDB_PORT || <span class="number">8086</span>,          <span class="comment">// InfluxDB port. (default 8086)</span></div><div class="line">    <span class="attribute">version</span>: <span class="number">0.8</span>,                                     <span class="comment">// InfluxDB port. (default 0.8)</span></div><div class="line">    <span class="attribute">ssl</span>: false,                                       <span class="comment">// InfluxDB is hosted over SSL. (default false)</span></div><div class="line">    <span class="attribute">database</span>: process.env.INFLUXDB_DB || <span class="string">"statsd"</span>,    <span class="comment">// InfluxDB database instance. (required)</span></div><div class="line">    <span class="attribute">username</span>: process.env.INFLUXDB_USER || <span class="string">"root"</span>,    <span class="comment">// InfluxDB database username. (required)</span></div><div class="line">    <span class="attribute">password</span>: process.env.INFLUXDB_PASS || <span class="string">"root"</span>,    <span class="comment">// InfluxDB database password. (required)</span></div><div class="line">    <span class="attribute">flush</span>: &#123;</div><div class="line">      <span class="attribute">enable</span>: true       <span class="comment">// Enable regular flush strategy. (default true)</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attribute">proxy</span>: &#123;</div><div class="line">      <span class="attribute">enable</span>: false,       <span class="comment">// Enable the proxy strategy. (default false)</span></div><div class="line">      <span class="attribute">suffix</span>: <span class="string">'raw'</span>,       <span class="comment">// Metric name suffix. (default 'raw')</span></div><div class="line">      <span class="attribute">flushInterval</span>: <span class="number">1000</span>  <span class="comment">// Flush interval for the internal buffer.</span></div><div class="line">                           <span class="comment">// (default 1000)</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attribute">includeStatsdMetrics</span>: false, <span class="comment">// Send internal statsd metrics to InfluxDB. (default false)</span></div><div class="line">    <span class="attribute">includeInfluxdbMetrics</span>: false <span class="comment">// Send internal backend metrics to InfluxDB. (default false)</span></div><div class="line">                                  <span class="comment">// Requires includeStatsdMetrics to be enabled.</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>启动容器<br><figure class="highlight protobuf"><table><tr><td class="code"><pre><div class="line">./<span class="class"><span class="keyword">service</span>.<span class="title">sh</span></span></div></pre></td></tr></table></figure></p>
<p>查看容器日志和debug信息<br><figure class="highlight ebnf"><table><tr><td class="code"><pre><div class="line"><span class="attribute">fig logs</span></div></pre></td></tr></table></figure></p>
<p>直接使用我的镜像<br><figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line">docker pull arkii/<span class="string">statsd:</span>influxdb</div></pre></td></tr></table></figure></p>
<p><a href="https://github.com/etsy/statsd" target="_blank" rel="external">statsd项目地址</a></p>
<p><a href="https://github.com/bernd/statsd-influxdb-backend" target="_blank" rel="external">statsd-influxdb-backend项目地址</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>http://blog.wuliwala.net/2015/01/23/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(data, key)</span>:</span></div><div class="line">    <span class="string">"""docstring for query"""</span></div><div class="line">    pattern = re.compile(key, re.IGNORECASE)</div><div class="line">    records = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> data.items():</div><div class="line">        match = <span class="keyword">False</span></div><div class="line">        <span class="keyword">if</span> pattern.match(k):</div><div class="line">            match = <span class="keyword">True</span></div><div class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> v.items():</div><div class="line">            <span class="keyword">if</span> isinstance(y, list):</div><div class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> y:</div><div class="line">                    <span class="keyword">if</span> pattern.match(i):</div><div class="line">                        match = <span class="keyword">True</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">if</span> pattern.match(x):</div><div class="line">                    match = <span class="keyword">True</span></div><div class="line">        <span class="keyword">if</span> match:</div><div class="line">            <span class="keyword">if</span> records.get(k):</div><div class="line">                records[k] = v</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                records.setdefault(k, v)</div><div class="line">    <span class="keyword">return</span> records</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用dnspod实现动态dns]]></title>
      <url>http://blog.wuliwala.net/2015/01/12/dnspod-ddns/</url>
      <content type="html"><![CDATA[<p>最近家里换了联通的30M带宽，刚好可以在家里电脑上搭个网站。</p>
<p>域名是托管在dnspod上。</p>
<p>用python写了个程序，获取公网IP，并调用dnspod的API，来更新dns记录。</p>
<p>DNSPod 貌似现在更改了 API 接口了，会自动读取请求主机的 IP 并且更新记录。</p>
<ul>
<li><p>注意事项：</p>
<ul>
<li>如果1小时之内，提交了超过5次没有任何变动的记录修改请求，该记录会被系统锁定1小时，不允许再次修改，所以在开发和测试的过程中，请自行处理IP变动，仅在本地IP发生变动的情况下才调用本接口。</li>
<li>如何理解没有任何变动的记录修改请求？比如原记录值已经是 1.1.1.1，新的请求还要求修改为 1.1.1.1。</li>
</ul>
</li>
</ul>
<p>替换上你的Email，密码，域名ID，记录ID等参数，就可以运行了。 会在后台一直运行，每隔30秒检查一遍IP，如果修改了就更新IP。</p>
<p>获得domain_id可以用curl</p>
<pre><code>curl -k https://dnsapi.cn/Domain.List -d &quot;login_email=xxx&amp;login_password=xxx&quot;
</code></pre><p>获得record_id类似</p>
<pre><code>curl -k https://dnsapi.cn/Record.List -d &quot;login_email=xxx&amp;login_password=xxx&amp;domain_id=xxx&quot;
</code></pre><p><a href="https://github.com/ARKII/dnspod-ddns" target="_blank" rel="external">下载</a></p>
<p><a href="https://www.dnspod.cn/docs/records.html#dns" target="_blank" rel="external">dnspod api文档</a></p>
<p><a href="https://gist.github.com/chuangbo/833369" target="_blank" rel="external">参考</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[在docker中使用cron]]></title>
      <url>http://blog.wuliwala.net/2015/01/12/run-crond-in-container/</url>
      <content type="html"><![CDATA[<h2 id="docker-crond解决方案"><a href="#docker-crond解决方案" class="headerlink" title="docker crond解决方案"></a>docker crond解决方案</h2><p>容器技术给我们带来极大便利的同时也带来一些必须要做的改变，比如以前在应用服务器中运行的cron定时任务就不能用原有的方式运行。<br>本文基于centos，介绍如何解决使用容器技术时的定时任务问题。</p>
<p>具体思路就是：<br>在你的应用环境image上面再commit一层crond<br>1.封装一个应用image<br>2.封装一个crond image，但是以应用image为base</p>
<p>假设已有的应用环境image为 arkii/lamp 是我的 php运行环境</p>
<p>mkdir build &amp;&amp; cd build<br>cat Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><div class="line"><span class="keyword">FROM</span>        arii/lamp</div><div class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</div><div class="line"><span class="keyword">RUN</span><span class="bash">         yum -y install vixie-cron supervisor &amp;&amp; yum clean all &amp;&amp; rm <span class="_">-f</span> /var/<span class="built_in">log</span>/yum.log</span></div><div class="line"><span class="keyword">RUN</span><span class="bash">         sed -ie <span class="string">'/pam_loginuid/d'</span> /etc/pam.d/crond</span></div><div class="line"><span class="keyword">ADD</span><span class="bash">         supervisord.conf /etc/supervisord.conf</span></div><div class="line"><span class="keyword">CMD</span><span class="bash">         [<span class="string">"/usr/bin/supervisord"</span>, <span class="string">"-c"</span>, <span class="string">"/etc/supervisord.conf"</span>]</span></div></pre></td></tr></table></figure>
<p>cat supervisord.conf</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><div class="line"><span class="section">[supervisord]</span></div><div class="line"><span class="attr">nodaemon</span>=<span class="literal">true</span></div><div class="line"><span class="section">[program:crond]</span></div><div class="line"><span class="attr">command</span>=/usr/sbin/crond -n</div><div class="line"><span class="attr">log_stdout</span>=<span class="literal">true</span>             </div><div class="line"><span class="attr">log_stderr</span>=<span class="literal">true</span>             </div><div class="line"><span class="attr">logfile</span>=/db/logs/crond.log  </div><div class="line"><span class="attr">logfile_maxbytes</span>=<span class="number">512</span>MB</div><div class="line"><span class="attr">logfile_backups</span>=<span class="number">10</span></div><div class="line"><span class="section"></span></div><div class="line">[program:crontab]</div><div class="line"><span class="attr">command</span>=/usr/bin/crontab /db/config/crontab</div></pre></td></tr></table></figure>
<p>从宿主机启动crond容器</p>
<p>宿主机中</p>
<p>日志目录/db/logs</p>
<p>crontab文件存放位置/db/app/config/crontab</p>
<p>在宿主机中修改/db/app/config/crontab 容器中inotify机制会自动更新crontab，不需重启容器。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">APPNAME=<span class="string">'crond-in-container'</span></div><div class="line">APPID=$(docker ps| grep <span class="variable">$&#123;APPNAME&#125;</span> | awk <span class="string">'&#123;print$1&#125;'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ -z <span class="variable">$&#123;APPID&#125;</span> ]</div><div class="line">    <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;APPNAME&#125;</span> not running ..."</span></div><div class="line"><span class="keyword">else</span></div><div class="line">    docker stop <span class="variable">$&#123;APPID&#125;</span></div><div class="line">    docker rm <span class="variable">$&#123;APPID&#125;</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">docker run <span class="_">-d</span> --name=<span class="variable">$&#123;APPNAME&#125;</span> \</div><div class="line">-v /db/logs:/db/logs \</div><div class="line">-v /db/app/config/crontab:/db/config/crontab \</div><div class="line">arkii/crond</div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
  
  
    
    <entry>
      <title><![CDATA[about]]></title>
      <url>http://blog.wuliwala.net/about/index.html</url>
      <content type="html"><![CDATA[<p>关于我<br>email sqy6#163.com<br>blog <a href="http://blog.wuliwala.net">http://blog.wuliwala.net</a><br>blog mirror <a href="http://arkii.github.io" target="_blank" rel="external">http://arkii.github.io</a><br>github <a href="https://github.com/arkii" target="_blank" rel="external">https://github.com/arkii</a><br>dockerhub <a href="https://hub.docker.com/u/arkii/" target="_blank" rel="external">https://hub.docker.com/u/arkii/</a>  </p>
<p>wechat<br><img src="/images/2015/07/1-pic_hd-1.jpg" alt="alt"></p>
]]></content>
    </entry>
    
  
</search>
