<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Upgrade influxdb from v0.9 to v0.12]]></title>
      <url>http://blog.wuliwala.net/2016/04/12/upgrade_influxdb_from_v0.9_to_v0.10/</url>
      <content type="html"><![CDATA[<h2 id="Upgrade-influxdb-from-v0-9-to-v0-10"><a href="#Upgrade-influxdb-from-v0-9-to-v0-10" class="headerlink" title="Upgrade influxdb from v0.9 to v0.10"></a>Upgrade influxdb from v0.9 to v0.10</h2><h4 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h4><table>
<thead>
<tr>
<th>Comparison</th>
<th>0.9</th>
<th>0.10</th>
</tr>
</thead>
<tbody>
<tr>
<td>engine</td>
<td>b1\</td>
<td>bz1</td>
<td>tsm1</td>
</tr>
</tbody>
</table>
<h3 id="upgrade-from-v0-9-to-v0-10"><a href="#upgrade-from-v0-9-to-v0-10" class="headerlink" title="upgrade from v0.9 to v0.10"></a>upgrade from v0.9 to v0.10</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ influx_tsm -h</span><br><span class="line">:&lt;&lt;DOC</span><br><span class="line">Usage: influx_tsm [options] &lt;data-path&gt; </span><br><span class="line"></span><br><span class="line">Convert a database from b1 or bz1 format to tsm1 format.</span><br><span class="line"></span><br><span class="line">This tool will backup the directories before conversion (<span class="keyword">if</span> not disabled).</span><br><span class="line">The backed-up files must be removed manually, generally after starting up the</span><br><span class="line">node again to make sure all of data has been converted correctly.</span><br><span class="line"></span><br><span class="line">To restore a backup:</span><br><span class="line">  Shut down the node, remove the converted directory, and</span><br><span class="line">  copy the backed-up directory to the original location.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -backup=<span class="string">""</span>: The location to backup up the current databases. Must not be within the data directory.</span><br><span class="line">  -dbs=<span class="string">""</span>: Comma-delimited list of databases to convert. Default is to convert all databases.</span><br><span class="line">  -debug=<span class="string">""</span>: If <span class="built_in">set</span>, http debugging endpoints will be enabled on the given address</span><br><span class="line">  -interval=5s: How often status updates are printed.</span><br><span class="line">  -nobackup=<span class="literal">false</span>: Disable database backups. Not recommended.</span><br><span class="line">  -parallel=<span class="literal">false</span>: Perform parallel conversion. (up to GOMAXPROCS shards at once)</span><br><span class="line">  -profile=<span class="string">""</span>: CPU Profile location</span><br><span class="line">  -sz=2147483648: Maximum size of individual TSM files.</span><br><span class="line">  -y=<span class="literal">false</span>: Don<span class="string">'t ask, just convert</span><br><span class="line">DOC</span><br><span class="line"></span><br><span class="line">$ ls /var/lib/influxdb</span><br><span class="line">data  hh  meta  wal</span><br><span class="line"></span><br><span class="line">$ mkdir /tmp/influxdb_backup</span><br><span class="line"></span><br><span class="line">$ influx_tsm -backup /tmp/influxdb_backup /var/lib/influxdb/data</span><br><span class="line"></span><br><span class="line"># If you wish to minimize the time conversion takes, enable parallel mode with -parallel:</span><br><span class="line">$ influx_tsm -parallel=true -backup /tmp/influxdb_backup /var/lib/influxdb/data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">:&lt;&lt;OUTPUT</span><br><span class="line">2016/04/19 00:18:44.362167 Still Working: Completed Shards: 27/28 Points read/written: 4192583424/4192583424</span><br><span class="line">2016/04/19 00:18:49.362387 Still Working: Completed Shards: 27/28 Points read/written: 4192625739/4192625739</span><br><span class="line">2016/04/19 00:18:54.362674 Still Working: Completed Shards: 27/28 Points read/written: 4192700371/4192700371</span><br><span class="line">2016/04/19 00:18:59.362906 Still Working: Completed Shards: 27/28 Points read/written: 4192806162/4192806162</span><br><span class="line">2016/04/19 00:19:04.363121 Still Working: Completed Shards: 27/28 Points read/written: 4192911040/4192911040</span><br><span class="line">2016/04/19 00:19:09.363313 Still Working: Completed Shards: 27/28 Points read/written: 4192911040/4192911040</span><br><span class="line">2016/04/19 00:19:13.912142 Conversion of /data/data/icinga/default/136 successful (8h6m31.481348028s)</span><br><span class="line"></span><br><span class="line">Summary statistics</span><br><span class="line">========================================</span><br><span class="line">Databases converted:                 2</span><br><span class="line">Shards converted:                    28</span><br><span class="line">TSM files created:                   28</span><br><span class="line">Points read:                         4192911040</span><br><span class="line">Points written:                      4192911040</span><br><span class="line">NaN filtered:                        0</span><br><span class="line">Inf filtered:                        0</span><br><span class="line">Points without fields filtered:      0</span><br><span class="line">Disk usage pre-conversion (bytes):   118480699392</span><br><span class="line">Disk usage post-conversion (bytes):  17643390726</span><br><span class="line">Reduction factor:                    85%</span><br><span class="line">Bytes per TSM point:                 4.21</span><br><span class="line">Total conversion time:               13h56m43.515786407s</span><br><span class="line">OUTPUT</span></span><br></pre></td></tr></table></figure>
<h3 id="official-upgrading-guides"><a href="#official-upgrading-guides" class="headerlink" title="official upgrading guides"></a>official upgrading guides</h3><p><a href="https://docs.influxdata.com/influxdb/v0.10/administration/upgrading/" target="_blank" rel="external">v0.10/administration/upgrading/</a><br><a href="https://docs.influxdata.com/influxdb/v0.11/administration/upgrading/" target="_blank" rel="external">v0.11/administration/upgrading/</a><br><a href="https://docs.influxdata.com/influxdb/v0.12/administration/upgrading/" target="_blank" rel="external">v0.12/administration/upgrading/</a><br><a href="http://www.slideshare.net/SeanBeckett4/influxdb-upgrade-to-010-considerations" target="_blank" rel="external">SeanBeckett4 influxdb-upgrade-to-010-considerations</a></p>
<h4 id="Example-Migration-2"><a href="#Example-Migration-2" class="headerlink" title="Example Migration #2"></a>Example Migration #2</h4><p>Conditions: </p>
<ul>
<li>Downtime is unacceptable  </li>
<li>Converting from 0.9  </li>
<li>Not clustered  </li>
</ul>
<ol>
<li>Install 0.10.1 on top of 0.9 and restart</li>
<li>Copy “cold” B1/BZ1 shards to /tmp</li>
<li>Run <code>./influx_tsm to convert cold shards influx_tsm -backup /tmp/influxdb_backup /tmp/data</code></li>
<li>Remove cold B1/BZ1 shards and replace with converted TSM shards</li>
<li>Wait until current “hot” shards become “cold”, repeat steps 2-4 on newly cold shards</li>
</ol>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SuperMicro Auto Deploy]]></title>
      <url>http://blog.wuliwala.net/2016/04/07/supermicro_auto_deploy/</url>
      <content type="html"><![CDATA[<h2 id="SuperMicro-Auto-Deploy"><a href="#SuperMicro-Auto-Deploy" class="headerlink" title="SuperMicro Auto Deploy"></a>SuperMicro Auto Deploy</h2><h3 id="SMCIPMITool-Usage"><a href="#SMCIPMITool-Usage" class="headerlink" title="SMCIPMITool Usage"></a>SMCIPMITool Usage</h3><h4 id="Query-FRU-info"><a href="#Query-FRU-info" class="headerlink" title="Query FRU info"></a>Query FRU info</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi fru</span><br><span class="line">:&lt;&lt;EOF</span><br><span class="line">Getting FRU ...</span><br><span class="line">Chassis Type (CT)              = Other (01h)</span><br><span class="line">Chassis Part Number (CP)       = CSE-217HQ-XXXX</span><br><span class="line">Chassis Serial Number (CS)     = C2170FE0XXXX</span><br><span class="line">Board mfg. Date/Time (BDT)     = 1996/01/01 00:00:00 (00 00 00)</span><br><span class="line">Board Manufacturer Name (BM)   = Supermicro</span><br><span class="line">Board Product Name (BPN)       = </span><br><span class="line">Board Serial Number (BS)       = VM15CSXXXX</span><br><span class="line">Board Part Number (BP)         = X10DRT-H</span><br><span class="line">Board FRU File ID              = </span><br><span class="line">Product Manufacturer Name (PM) = Supermicro</span><br><span class="line">Product Name (PN)              = </span><br><span class="line">Product PartModel Number (PPM) = SYS-2028TR-H72R</span><br><span class="line">Product Version (PV)           = </span><br><span class="line">Product Serial Number (PS)     = S173440XXXXXXX</span><br><span class="line">Product Asset Tag (PAT)        = </span><br><span class="line">Product FRU File ID            = </span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h4 id="Set-Next-Boot-from-PXE"><a href="#Set-Next-Boot-from-PXE" class="headerlink" title="Set Next Boot from PXE"></a>Set Next Boot from PXE</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">:&lt;&lt;EOF</span><br><span class="line">For bootoption index :</span><br><span class="line">1: PXE              2:  Hard-drive</span><br><span class="line">3: CD/DVD           4:  Bios</span><br><span class="line">5: USB KEY          6:  USB HDD</span><br><span class="line">7: USB Floppy       8:  USB CD/DVD</span><br><span class="line">9: UEFI Hard-drive  10: UEFI CD/DVD</span><br><span class="line">11: UEFI USB KEY    12: UEFI USB HDD</span><br><span class="line">13: UEFI USB CD/DVD    </span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi power bootoption 1 </span><br><span class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi power reset</span><br><span class="line"></span><br><span class="line">:&lt;&lt;EOF</span><br><span class="line">3.39.2 wsiso mount</span><br><span class="line">Use this <span class="built_in">command</span> to mount an ISO file.</span><br><span class="line">Usage:wsiso mount &lt;IP&gt; &lt;path&gt; [username] [password]</span><br><span class="line">      IP: IP or domain name of share host</span><br><span class="line">      path: path to iso file</span><br><span class="line">      username: username of share host (optional)</span><br><span class="line">      password: password of share host (optional)</span><br><span class="line">      Ex 1: mount linux.iso</span><br><span class="line">       wsiso mount 192.168.1.100 /iso/linux.iso</span><br><span class="line">      Ex 2: mount linux.iso with username and password</span><br><span class="line">       wsiso mount 192.168.1.100 /iso/linux.iso admin admin</span><br><span class="line">      * Use one ISO file at a time. Make sure umount existing ISO before mount new ISO</span><br><span class="line">    file</span><br><span class="line">      * This <span class="built_in">command</span> is available <span class="keyword">for</span> X9 and X10 platform with SFT-OOB-LIC node</span><br><span class="line">    product key</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="RAID-Configuration"><a href="#RAID-Configuration" class="headerlink" title="RAID Configuration"></a>RAID Configuration</h3><p><code>&lt;Ctrl&gt; - &lt;Y&gt;</code><br><strong>LSI Preboot CLI</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pager 20 lines per page</span></span><br><span class="line">PDList a0 page20</span><br><span class="line"><span class="comment"># create one raid0 ld with one disk</span></span><br><span class="line">C<span class="built_in">fg</span>LdAdd r0 [252:0] a0<span class="comment"># create one raid1 ld with two disks</span>C<span class="built_in">fg</span>LdAdd r1 [252:0,252:1] a0C<span class="built_in">fg</span>Foreign Clear a0</span><br></pre></td></tr></table></figure>
<p><strong>Full Screen Cast Below</strong></p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">Battery Status: Not present                                                                         </span><br><span class="line">                                                                                                    </span><br><span class="line">PCI SLOT ID LUN VENDOR    PRODUCT                   REVISION       CAPACITY                         </span><br><span class="line">-------- -- --- ------    -------                   --------       --------                         </span><br><span class="line">3               LSI       Supermicro SMC2208        3.240.05-2282  1024MB                           </span><br><span class="line">3        7  0   SEAGATE   ST9146853SS               YS09           140014MB                         </span><br><span class="line">3        8  0   SEAGATE   ST9146853SS               YS09           140014MB                         </span><br><span class="line">0 Virtual Drive(s) found <span class="keyword">on</span> the host adapter.                                                       </span><br><span class="line">                                                                                                    </span><br><span class="line">0 Virtual Drive(s) handled <span class="keyword">by</span> BIOS                                                                  </span><br><span class="line">Press &lt;Ctrl&gt;&lt;<span class="keyword">H</span>&gt; <span class="keyword">for</span> WebBIOS or press &lt;Ctrl&gt;&lt;Y&gt; <span class="keyword">for</span> Preboot <span class="keyword">CLI</span>                                      </span><br><span class="line">                                                                                                    </span><br><span class="line">MegaPCLI SAS RAID Management Tool.                                                                  </span><br><span class="line"><span class="keyword">Copyright</span>(c) LSI Corporation, 2008.                                                                 </span><br><span class="line"><span class="keyword">Use</span> -<span class="keyword">h</span> -a&lt;<span class="keyword">n</span>&gt; <span class="keyword">for</span> controller specific <span class="keyword">help</span>, where <span class="keyword">n</span> is the controller index                          </span><br><span class="line"><span class="keyword">Use</span> -v -a&lt;<span class="keyword">n</span>&gt; <span class="keyword">for</span> controller specific <span class="keyword">version</span>, where <span class="keyword">n</span> is the controller index                       </span><br><span class="line"><span class="keyword">Use</span> q to <span class="keyword">exit</span> from $ prompt                                                                         </span><br><span class="line">                                                                                                    </span><br><span class="line">Controller(s) Found                                                                                 </span><br><span class="line">HA-0 (Bus 3 DevFn 0)                                                                                </span><br><span class="line">$                                                                                                   </span><br><span class="line">                                                                                                    </span><br><span class="line"><span class="variable">$cfgforeign</span> <span class="keyword">clear</span> a0                                                                                </span><br><span class="line">                                                                                                    </span><br><span class="line">                                                                                                    </span><br><span class="line">Foreign configuration 0 is cleared <span class="keyword">on</span> controller 0.                                                 </span><br><span class="line">Foreign configuration 1 is cleared <span class="keyword">on</span> controller 0.                                                 </span><br><span class="line"><span class="keyword">Exit</span> Code = 0x0                                                                                     </span><br><span class="line"><span class="variable">$cfgldadd</span> r1 [252:0,252:1] a0                                                                       </span><br><span class="line">                                                                                                    </span><br><span class="line">                                                                                                    </span><br><span class="line">Adapter 0: Created VD 0                                                                             </span><br><span class="line">                                                                                                    </span><br><span class="line">Adapter 0: Configured the Adapter!!                                                                 </span><br><span class="line"><span class="keyword">Exit</span> Code = 0x0                                                                                     </span><br><span class="line"><span class="variable">$q</span>                                                                                                  </span><br><span class="line">Press &lt;CTL&gt;&lt;ALT&gt;&lt;DEL&gt; to reboot.</span><br></pre></td></tr></table></figure>
<p><strong>After Rebooting POST message will show</strong></p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">LSI</span> MegaRAID SAS-MFI <span class="keyword">BIOS </span>                                                                          </span><br><span class="line"><span class="symbol">Version</span> <span class="number">5</span>.<span class="number">38</span>.<span class="number">00</span> (<span class="keyword">Build </span>October <span class="number">11</span>, <span class="number">2012</span>)                                                            </span><br><span class="line"><span class="symbol">Copyright</span>(c) <span class="number">2012</span> LSI Corporation                                                                   </span><br><span class="line"><span class="symbol">HA</span> -<span class="number">0</span> (<span class="keyword">Bus </span><span class="number">3</span> Dev <span class="number">0</span>) Supermicro <span class="keyword">SMC2208 </span>                                                             </span><br><span class="line"><span class="symbol">FW</span> package: <span class="number">23</span>.<span class="number">12</span>.<span class="number">0</span>.<span class="number">0011</span>                                                                            </span><br><span class="line">                                                                                                    </span><br><span class="line"><span class="keyword">Battery </span>Status: Not present                                                                         </span><br><span class="line">                                                                                                    </span><br><span class="line"><span class="symbol">PCI</span> SLOT ID LUN VENDOR    PRODUCT                   <span class="keyword">REVISION </span>      CAPACITY                         </span><br><span class="line">-------- -- --- ------    -------                   --------       --------                         </span><br><span class="line"><span class="number">3</span>               LSI       Supermicro <span class="keyword">SMC2208 </span>       <span class="number">3</span>.<span class="number">240</span>.<span class="number">05</span>-<span class="number">2282</span>  <span class="number">1024</span>MB                           </span><br><span class="line"><span class="number">3</span>        <span class="number">7</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </span><br><span class="line"><span class="number">3</span>        <span class="number">8</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </span><br><span class="line"><span class="number">3</span>           <span class="number">0</span>   LSI       Virtual Drive             RAID1          <span class="number">139236</span>MB                         </span><br><span class="line"><span class="number">1</span> Virtual Drive(s) found on the host adapter.                                                       </span><br><span class="line">                                                                                                    </span><br><span class="line"><span class="number">1</span> Virtual Drive(s) handled <span class="keyword">by </span><span class="keyword">BIOS </span>                                                                 </span><br><span class="line"><span class="symbol">Press</span> &lt;Ctrl&gt;&lt;H&gt; for WebBIOS or press &lt;Ctrl&gt;&lt;Y&gt; for Preboot CLI</span><br></pre></td></tr></table></figure>
<h3 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h3><p>错误信息为:<br><code>PXE-E7B: Missing MTFTP server IP address</code>  </p>
<p>Cisco设备是PortFast<br>Huawei设备里是<br>临时关掉生成树<br><code>stp disable</code><br>或者标记为边界端口<br><code>stp edged-port enable</code></p>
<h3 id="other-resources"><a href="#other-resources" class="headerlink" title="other resources"></a>other resources</h3><h4 id="boot-ipxe"><a href="#boot-ipxe" class="headerlink" title="boot.ipxe"></a>boot.ipxe</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">http://10.0.0.9/cgi-bin/pxe.py?mac=<span class="variable">$&#123;netX/mac&#125;</span>&amp;manufacturer=<span class="variable">$&#123;manufacturer&#125;</span>&amp;product=<span class="variable">$&#123;product&#125;</span>&amp;serial=<span class="variable">$&#123;serial&#125;</span>&amp;bserial=<span class="variable">$&#123;smbios/board-serial:string&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="WS-Management"><a href="#WS-Management" class="headerlink" title="WS-Management"></a>WS-Management</h4><p><code>wsman identify -h 10.0.0.100 -P 5985 -u ADMIN -p ADMIN</code></p>
<h4 id="flashrom"><a href="#flashrom" class="headerlink" title="flashrom"></a>flashrom</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flashrom-0.9.9 install</span></span><br><span class="line">yum install -y zlib-devel libpciaccess-devel pciutils-devel libusb1-devel             </span><br><span class="line">make DESTDIR=/usr install</span><br></pre></td></tr></table></figure>
<h4 id="Intel-BootUtil"><a href="#Intel-BootUtil" class="headerlink" title="Intel BootUtil"></a>Intel BootUtil</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install -y make gcc perl kernel-devel</span><br><span class="line">./install </span><br><span class="line"></span><br><span class="line">./bootutil64e <span class="_">-e</span></span><br><span class="line"></span><br><span class="line">:&lt;&lt;EOF</span><br><span class="line">Intel(R) Ethernet Flash Firmware Utility</span><br><span class="line">BootUtil version 1.5.94.2</span><br><span class="line">Copyright (C) 2003-2015 Intel Corporation</span><br><span class="line"></span><br><span class="line">NIC= 1 MACAddress=0CC47AB4C12E</span><br><span class="line">NIC= 2 MACAddress=0CC47AB4C12F</span><br><span class="line"></span><br><span class="line">Port Network Address Location Series  WOL Flash Firmware                Version</span><br><span class="line">==== =============== ======== ======= === ============================= =======</span><br><span class="line">  1   0CC47AB4C12E     1:00.0 Gigabit YES FLASH Not Present</span><br><span class="line">  2   0CC47AB4C12F     1:00.1 Gigabit NO  FLASH Not Present</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">./bootutil64e -nic 1 -saveimage -file 0CC47AB4C12E.rom</span><br><span class="line"></span><br><span class="line">./bootutil64e -nic 1 -saveimage -file 80861521.rom</span><br></pre></td></tr></table></figure>
<h4 id="SerialNumber"><a href="#SerialNumber" class="headerlink" title="SerialNumber"></a>SerialNumber</h4><p><code>dmidecode -s baseboard-serial-number</code> instead of <code>dmidecode -s system-serial-number</code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Learning ElasticSearch]]></title>
      <url>http://blog.wuliwala.net/2016/03/29/learning-elasticsearch/</url>
      <content type="html"><![CDATA[<h2 id="Learning-ElasticSearch"><a href="#Learning-ElasticSearch" class="headerlink" title="Learning ElasticSearch"></a>Learning ElasticSearch</h2><p>最近在学习ElasticSearch，从底层的Lucene开始了解<br>特别推荐这两本书，非常非常感谢社区的贡献，有机会还是支持出版的纸质书籍<br>这篇文章等于是对这两本书阅读后做了摘要，方便零基础的用户快速上手ElasticSearch<br><a href="https://github.com/looly/elasticsearch-definitive-guide-cn" target="_blank" rel="external">Elasticsearch 权威指南（中文版）</a><br><a href="https://www.gitbook.com/book/chenryn/kibana-guide-cn/details" target="_blank" rel="external">ELKstack 中文指南（ElasticSearch章节）</a>  </p>
<h3 id="ES-vs-SQL"><a href="#ES-vs-SQL" class="headerlink" title="ES vs SQL"></a>ES vs SQL</h3><table>
<thead>
<tr>
<th>Relational DB</th>
<th>Elasticsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Databases</td>
<td>Indices</td>
</tr>
<tr>
<td>Tables</td>
<td>Types</td>
</tr>
<tr>
<td>Rows</td>
<td>Documents</td>
</tr>
<tr>
<td>Columns</td>
<td>Fields</td>
</tr>
</tbody>
</table>
<p>Elasticsearch集群可以包含多个索引(indices)（数据库），每一个索引可以包含多个类型(types)（表），每一个类型包含多个文档(documents)（行），然后每个文档包含多个字段(Fields)（列）。  </p>
<h3 id="“索引”含义的区分"><a href="#“索引”含义的区分" class="headerlink" title="“索引”含义的区分"></a>“索引”含义的区分</h3><p>你可能已经注意到索引(index)这个词在Elasticsearch中有着不同的含义，所以有必要在此做一下区分:  </p>
<ul>
<li>索引（名词） 如上文所述，一个索引(index)就像是传统关系数据库中的数据库，它是相关文档存储的地方，index的复数是indices 或indexes。  </li>
<li>索引（动词） 「索引一个文档」表示把一个文档存储到索引（名词）里，以便它可以被检索或者查询。这很像SQL中的INSERT关键字，差别是，如果文档已经存在，新的文档将覆盖旧的文档。  </li>
<li>倒排索引 传统数据库为特定列增加一个索引，例如B-Tree索引来加速检索。Elasticsearch和Lucene使用一种叫做倒排索引(inverted index)的数据结构来达到相同目的。   </li>
</ul>
<h3 id="Excerise"><a href="#Excerise" class="headerlink" title="Excerise"></a>Excerise</h3><ol>
<li><p>Ping &amp; Server info</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http http://127.0.0.1:9200/</span><br><span class="line">&#123;</span><br><span class="line">    "cluster_name": "elasticsearch", </span><br><span class="line">    "name": "Goliath", </span><br><span class="line">    "status": 200, </span><br><span class="line">    "tagline": "You Know, for Search", </span><br><span class="line">    "version": &#123;</span><br><span class="line">        "build_hash": "c88f77ffc81301dfa9dfd81ca2232f09588bd512", </span><br><span class="line">        "build_snapshot": false, </span><br><span class="line">        "build_timestamp": "2015-02-19T13:05:36Z", </span><br><span class="line">        "lucene_version": "4.10.3", </span><br><span class="line">        "number": "1.4.4"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>All rows</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http 'http://localhost:9200/_count'                   </span><br><span class="line">&#123;</span><br><span class="line">    "_shards": &#123;</span><br><span class="line">        "failed": 0, </span><br><span class="line">        "successful": 436, </span><br><span class="line">        "total": 436</span><br><span class="line">    &#125;, </span><br><span class="line">    "count": 35672472</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>All indices</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">http <span class="string">'localhost:9200/_cat/indices?v'</span></span><br><span class="line">health status index                pri rep docs<span class="selector-class">.count</span> docs<span class="selector-class">.deleted</span> store<span class="selector-class">.size</span> pri<span class="selector-class">.store</span><span class="selector-class">.size</span> </span><br><span class="line">yellow open   <span class="selector-class">.kibana</span>                <span class="number">1</span>   <span class="number">1</span>         <span class="number">10</span>            <span class="number">2</span>     <span class="number">27.5</span>kb         <span class="number">27.5</span>kb </span><br><span class="line">yellow open   logstash-<span class="number">2016.01</span>.<span class="number">18</span>    <span class="number">5</span>   <span class="number">1</span>     <span class="number">289193</span>            <span class="number">0</span>    <span class="number">170.8</span>mb        <span class="number">170.8</span>mb </span><br><span class="line">yellow open   logstash-<span class="number">2016.03</span>.<span class="number">22</span>    <span class="number">5</span>   <span class="number">1</span>     <span class="number">597585</span>            <span class="number">0</span>    <span class="number">141.1</span>mb        <span class="number">141.1</span>mb </span><br><span class="line">yellow open   logstash-<span class="number">2016.03</span>.<span class="number">17</span>    <span class="number">5</span>   <span class="number">1</span>     <span class="number">582696</span>            <span class="number">0</span>    <span class="number">138.5</span>mb        <span class="number">138.5</span>mb </span><br><span class="line">yellow open   logstash-<span class="number">2016.02</span>.<span class="number">25</span>    <span class="number">5</span>   <span class="number">1</span>     <span class="number">304186</span>            <span class="number">0</span>    <span class="number">103.2</span>mb        <span class="number">103.2</span>mb </span><br><span class="line">yellow open   logstash-<span class="number">2016.02</span>.<span class="number">24</span>    <span class="number">5</span>   <span class="number">1</span>     <span class="number">298755</span>            <span class="number">0</span>    <span class="number">102.5</span>mb        <span class="number">102.5</span>mb</span><br></pre></td></tr></table></figure>
</li>
<li><p>Cluster health</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http '127.0.0.1:9200/_cluster/health?pretty'</span><br><span class="line">&#123;</span><br><span class="line">    "active_primary_shards": 436, </span><br><span class="line">    "active_shards": 436, </span><br><span class="line">    "cluster_name": "elasticsearch", </span><br><span class="line">    "initializing_shards": 0, </span><br><span class="line">    "number_of_data_nodes": 1, </span><br><span class="line">    "number_of_nodes": 1, </span><br><span class="line">    "relocating_shards": 0, </span><br><span class="line">    "status": "yellow", </span><br><span class="line">    "timed_out": false, </span><br><span class="line">    "unassigned_shards": 436</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Nodes list</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">http '<span class="number">127.0.0.1</span>:<span class="number">9200</span>/_cat/nodes'</span><br><span class="line"><span class="number">366d</span>cee<span class="number">51992 172.17</span>.<span class="number">5.127 78 80</span> <span class="number">1</span>.<span class="number">21</span> d * Goliath</span><br></pre></td></tr></table></figure>
</li>
<li><p>Task list</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">http 'http://<span class="number">127.0.0.1:9200</span>/_cluster/pending_tasks'</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"tasks"</span>: <span class="string">[]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Node health<br><strong>jvm</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http '127.0.0.1:9200/_nodes/stats/jvm'</span><br><span class="line">&#123;</span><br><span class="line">    "cluster_name": "elasticsearch", </span><br><span class="line">    "nodes": &#123;</span><br><span class="line">        "vwKzZrSrTDidFr-jtZdRjg": &#123;</span><br><span class="line">            "host": "366dcee51992", </span><br><span class="line">            "ip": [</span><br><span class="line">                "inet[/172.17.5.127:9300]", </span><br><span class="line">                "NONE"</span><br><span class="line">            ], </span><br><span class="line">            "jvm": &#123;</span><br><span class="line">                "buffer_pools": &#123;</span><br><span class="line">                    "direct": &#123;</span><br><span class="line">                        "count": 1610, </span><br><span class="line">                        "total_capacity_in_bytes": 39064123, </span><br><span class="line">                        "used_in_bytes": 39064123</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "mapped": &#123;</span><br><span class="line">                        "count": 2656, </span><br><span class="line">                        "total_capacity_in_bytes": 6260870265, </span><br><span class="line">                        "used_in_bytes": 6260870265</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, </span><br><span class="line">                "gc": &#123;</span><br><span class="line">                    "collectors": &#123;</span><br><span class="line">                        "old": &#123;</span><br><span class="line">                            "collection_count": 20469, </span><br><span class="line">                            "collection_time_in_millis": 1804674</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "young": &#123;</span><br><span class="line">                            "collection_count": 396171, </span><br><span class="line">                            "collection_time_in_millis": 4463746</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, </span><br><span class="line">                "mem": &#123;</span><br><span class="line">                    "heap_committed_in_bytes": 1037959168, </span><br><span class="line">                    "heap_max_in_bytes": 1037959168, </span><br><span class="line">                    "heap_used_in_bytes": 849427344, </span><br><span class="line">                    "heap_used_percent": 81, </span><br><span class="line">                    "non_heap_committed_in_bytes": 85303296, </span><br><span class="line">                    "non_heap_used_in_bytes": 56807912, </span><br><span class="line">                    "pools": &#123;</span><br><span class="line">                        "old": &#123;</span><br><span class="line">                            "max_in_bytes": 715849728, </span><br><span class="line">                            "peak_max_in_bytes": 715849728, </span><br><span class="line">                            "peak_used_in_bytes": 672561680, </span><br><span class="line">                            "used_in_bytes": 602039528</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "survivor": &#123;</span><br><span class="line">                            "max_in_bytes": 35782656, </span><br><span class="line">                            "peak_max_in_bytes": 35782656, </span><br><span class="line">                            "peak_used_in_bytes": 35782656, </span><br><span class="line">                            "used_in_bytes": 6359176</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "young": &#123;</span><br><span class="line">                            "max_in_bytes": 286326784, </span><br><span class="line">                            "peak_max_in_bytes": 286326784, </span><br><span class="line">                            "peak_used_in_bytes": 286326784, </span><br><span class="line">                            "used_in_bytes": 241028640</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, </span><br><span class="line">                "threads": &#123;</span><br><span class="line">                    "count": 130, </span><br><span class="line">                    "peak_count": 135</span><br><span class="line">                &#125;, </span><br><span class="line">                "timestamp": 1459242935482, </span><br><span class="line">                "uptime_in_millis": 2528035636</span><br><span class="line">            &#125;, </span><br><span class="line">            "name": "Goliath", </span><br><span class="line">            "timestamp": 1459242935482, </span><br><span class="line">            "transport_address": "inet[/172.17.5.127:9300]"</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>os</strong></p>
 <figure class="highlight"><table><tr><td class="code"><pre><span class="line">http '127.0.0.1:9200/_nodes/stats/os'</span><br><span class="line">&#123;</span><br><span class="line">    "cluster_name": "elasticsearch", </span><br><span class="line">    "nodes": &#123;</span><br><span class="line">        "vwKzZrSrTDidFr-jtZdRjg": &#123;</span><br><span class="line">            "host": "366dcee51992", </span><br><span class="line">            "ip": [</span><br><span class="line">                "inet[/172.17.5.127:9300]", </span><br><span class="line">                "NONE"</span><br><span class="line">            ], </span><br><span class="line">            "name": "Goliath", </span><br><span class="line">            "os": &#123;</span><br><span class="line">                "cpu": &#123;</span><br><span class="line">                    "idle": 75, </span><br><span class="line">                    "stolen": 0, </span><br><span class="line">                    "sys": 2, </span><br><span class="line">                    "usage": 17, </span><br><span class="line">                    "user": 15</span><br><span class="line">                &#125;, </span><br><span class="line">                "load_average": [</span><br><span class="line">                    3.23, </span><br><span class="line">                    2.33, </span><br><span class="line">                    2.27</span><br><span class="line">                ], </span><br><span class="line">                "mem": &#123;</span><br><span class="line">                    "actual_free_in_bytes": 5407027200, </span><br><span class="line">                    "actual_used_in_bytes": 28110413824, </span><br><span class="line">                    "free_in_bytes": 2586775552, </span><br><span class="line">                    "free_percent": 16, </span><br><span class="line">                    "used_in_bytes": 30930665472, </span><br><span class="line">                    "used_percent": 83</span><br><span class="line">                &#125;, </span><br><span class="line">                "swap": &#123;</span><br><span class="line">                    "free_in_bytes": 7885094912, </span><br><span class="line">                    "used_in_bytes": 8892116992</span><br><span class="line">                &#125;, </span><br><span class="line">                "timestamp": 1459245065474, </span><br><span class="line">                "uptime_in_millis": 21615006</span><br><span class="line">            &#125;, </span><br><span class="line">            "timestamp": 1459245065474, </span><br><span class="line">            "transport_address": "inet[/172.17.5.127:9300]"</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>Index info</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http http://127.0.0.1:9200/logstash-2016.03.29/</span><br><span class="line">&#123;</span><br><span class="line">    "logstash-2016.03.29": &#123;</span><br><span class="line">        "aliases": &#123;&#125;, </span><br><span class="line">        "mappings": &#123;</span><br><span class="line">            "_default_": &#123;</span><br><span class="line">                "_all": &#123;</span><br><span class="line">                    "enabled": true</span><br><span class="line">                &#125;, </span><br><span class="line">                "dynamic_templates": [</span><br><span class="line">                    &#123;</span><br><span class="line">                        "string_fields": &#123;</span><br><span class="line">                            "mapping": &#123;</span><br><span class="line">                                "fields": &#123;</span><br><span class="line">                                    "raw": &#123;</span><br><span class="line">                                        "ignore_above": 256, </span><br><span class="line">                                        "index": "not_analyzed", </span><br><span class="line">                                        "type": "string"</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;, </span><br><span class="line">                                "index": "analyzed", </span><br><span class="line">                                "omit_norms": true, </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;, </span><br><span class="line">                            "match": "*", </span><br><span class="line">                            "match_mapping_type": "string"</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ], </span><br><span class="line">                "properties": &#123;</span><br><span class="line">                    "@version": &#123;</span><br><span class="line">                        "index": "not_analyzed", </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "geoip": &#123;</span><br><span class="line">                        "dynamic": "true", </span><br><span class="line">                        "properties": &#123;</span><br><span class="line">                            "location": &#123;</span><br><span class="line">                                "type": "geo_point"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, </span><br><span class="line">            "syslog": &#123;</span><br><span class="line">                "_all": &#123;</span><br><span class="line">                    "enabled": true</span><br><span class="line">                &#125;, </span><br><span class="line">                "dynamic_templates": [</span><br><span class="line">                    &#123;</span><br><span class="line">                        "string_fields": &#123;</span><br><span class="line">                            "mapping": &#123;</span><br><span class="line">                                "fields": &#123;</span><br><span class="line">                                    "raw": &#123;</span><br><span class="line">                                        "ignore_above": 256, </span><br><span class="line">                                        "index": "not_analyzed", </span><br><span class="line">                                        "type": "string"</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;, </span><br><span class="line">                                "index": "analyzed", </span><br><span class="line">                                "omit_norms": true, </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;, </span><br><span class="line">                            "match": "*", </span><br><span class="line">                            "match_mapping_type": "string"</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ], </span><br><span class="line">                "properties": &#123;</span><br><span class="line">                    "@timestamp": &#123;</span><br><span class="line">                        "format": "dateOptionalTime", </span><br><span class="line">                        "type": "date"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "@version": &#123;</span><br><span class="line">                        "index": "not_analyzed", </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "brief": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "count": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "geoip": &#123;</span><br><span class="line">                        "dynamic": "true", </span><br><span class="line">                        "properties": &#123;</span><br><span class="line">                            "location": &#123;</span><br><span class="line">                                "type": "geo_point"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "host": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "hostname": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "info": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "log_type": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "module": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "msg": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "oid": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "serverity": &#123;</span><br><span class="line">                        "type": "long"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "severity": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "status": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "syslog5424_pri": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "syslog_facility": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "syslog_facility_code": &#123;</span><br><span class="line">                        "type": "long"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "syslog_message": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "syslog_program": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "syslog_severity": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "syslog_severity_code": &#123;</span><br><span class="line">                        "type": "long"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "tags": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "timestamp": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;, </span><br><span class="line">                    "type": &#123;</span><br><span class="line">                        "fields": &#123;</span><br><span class="line">                            "raw": &#123;</span><br><span class="line">                                "ignore_above": 256, </span><br><span class="line">                                "index": "not_analyzed", </span><br><span class="line">                                "type": "string"</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "norms": &#123;</span><br><span class="line">                            "enabled": false</span><br><span class="line">                        &#125;, </span><br><span class="line">                        "type": "string"</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        "settings": &#123;</span><br><span class="line">            "index": &#123;</span><br><span class="line">                "creation_date": "1459189864276", </span><br><span class="line">                "number_of_replicas": "1", </span><br><span class="line">                "number_of_shards": "5", </span><br><span class="line">                "refresh_interval": "5s", </span><br><span class="line">                "uuid": "qUZ_ZY3_RPOdhrdJ5mi32A", </span><br><span class="line">                "version": &#123;</span><br><span class="line">                    "created": "1040499"</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        "warmers": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="cat-接口的命令行使用"><a href="#cat-接口的命令行使用" class="headerlink" title="cat 接口的命令行使用"></a>cat 接口的命令行使用</h3><p>之前介绍的各种接口数据，其响应数据都是 JSON 格式，更适用于程序处理。对于我们日常运维，在 Linux 命令行终端环境来说，简单的分行和分列表格才是更方便的样式。为此，Elasticsearch 提供了 cat 接口。</p>
<p>cat 接口可以读取各种监控数据，可用接口列表如下：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/_cat/</span>allocation</span><br><span class="line"><span class="regexp">/_cat/</span>shards</span><br><span class="line"><span class="regexp">/_cat/</span>shards/&#123;index&#125;</span><br><span class="line"><span class="regexp">/_cat/</span>master</span><br><span class="line"><span class="regexp">/_cat/</span>nodes</span><br><span class="line"><span class="regexp">/_cat/</span>indices</span><br><span class="line"><span class="regexp">/_cat/</span>indices/&#123;index&#125;</span><br><span class="line"><span class="regexp">/_cat/</span>segments</span><br><span class="line"><span class="regexp">/_cat/</span>segments/&#123;index&#125;</span><br><span class="line"><span class="regexp">/_cat/</span>count</span><br><span class="line"><span class="regexp">/_cat/</span>count/&#123;index&#125;</span><br><span class="line"><span class="regexp">/_cat/</span>recovery</span><br><span class="line"><span class="regexp">/_cat/</span>recovery/&#123;index&#125;</span><br><span class="line"><span class="regexp">/_cat/</span>health</span><br><span class="line"><span class="regexp">/_cat/</span>pending_tasks</span><br><span class="line"><span class="regexp">/_cat/</span>aliases</span><br><span class="line"><span class="regexp">/_cat/</span>aliases/&#123;alias&#125;</span><br><span class="line"><span class="regexp">/_cat/</span>thread_pool</span><br><span class="line"><span class="regexp">/_cat/</span>plugins</span><br><span class="line"><span class="regexp">/_cat/</span>fielddata</span><br><span class="line"><span class="regexp">/_cat/</span>fielddata/&#123;fields&#125;</span><br></pre></td></tr></table></figure>
<h3 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h3><p>增删改查是数据库的基础操作方法。ES 虽然不是数据库，但是很多场合下，都被人们当做一个文档型 NoSQL 数据库在使用，原因自然是因为在接口和分布式架构层面的相似性。虽然在 ELKstack 场景下，数据的写入和查询，分别由 Logstash 和 Kibana 代劳，作为测试、调研和排错时的基本功，还是需要了解一下 ES 的增删改查用法的。</p>
<h3 id="数据写入"><a href="#数据写入" class="headerlink" title="数据写入"></a>数据写入</h3><p>ES 的一大特点，就是全 RESTful 接口处理 JSON 请求。所以，数据写入非常简单：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">curl -XPOST http://127.0.0.1:9200/logstash-2015.06.21/testlog -d '&#123;</span><br><span class="line">    "date" : "1434966686000",</span><br><span class="line">    "user" : "chenlin7",</span><br><span class="line">    "mesg" : "first message into Elasticsearch"</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<p>命令返回响应结果为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"created"</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h3><p>“可以看到，在数据写入的时候，会返回该数据的 _id。这就是后续用来获取数据的关键：</p>
<p><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK</code><br>命令返回响应结果为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"found"</span>:<span class="literal">true</span>,<span class="attr">"_source"</span>:&#123;</span><br><span class="line">    <span class="attr">"date"</span> : <span class="string">"1434966686000"</span>,</span><br><span class="line">    <span class="attr">"user"</span> : <span class="string">"chenlin7"</span>,</span><br><span class="line">    <span class="attr">"mesg"</span> : <span class="string">"first message into Elasticsearch"</span></span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>这个 _source 里的内容，正是之前写入的数据。</p>
<p>如果觉得这个返回看起来有点太过麻烦，可以使用<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_source</code><br>来指明只获取源数据部分。</p>
<p>更进一步的，如果你只想看数据中的一部分字段内容，可以使用<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK?fields=user,mesg</code><br>来指明获取字段，结果如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"found"</span>:<span class="literal">true</span>,<span class="attr">"fields"</span>:&#123;<span class="attr">"user"</span>:[<span class="string">"chenlin7"</span>],<span class="attr">"mesg"</span>:[<span class="string">"first message into Elasticsearch"</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据删除"><a href="#数据删除" class="headerlink" title="数据删除"></a>数据删除</h3><p>要删除数据，修改发送的 HTTP 请求方法为 DELETE 即可：<br><code>curl -XDELETE http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK</code><br>删除不单针对单条数据，还可以删除整个 type，乃至整个索引。甚至可以用通配符。<br><code>curl -XDELETE http://127.0.0.1:9200/logstash-2015.06.0*</code></p>
<h3 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h3><p>已经写过的数据，同样还是可以修改的。有两种办法，一种是全量提交，即指明 _id 再发送一次写入请求。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">curl -XPOST http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK -d '&#123;</span><br><span class="line">    "date" : "1434966686000",</span><br><span class="line">    "user" : "chenlin7",</span><br><span class="line">    "mesg" " "first message into Elasticsearch but version 2"</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<p>另一种是局部更新，使用 /_update 接口：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_update' -d '&#123;</span><br><span class="line">    "doc" : &#123;</span><br><span class="line">        "user" : "someone"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_update' -d '&#123;</span><br><span class="line">    "script" : "ctx._source.user = \"someone\""</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<h3 id="搜索请求"><a href="#搜索请求" class="headerlink" title="搜索请求"></a>搜索请求</h3><p>上节介绍的，都是针对单条数据的操作。在 ES 环境中，更多的是搜索和聚合请求。在之前章节中，我们也介绍过数据获取和数据搜索的一点区别：==刚写入的数据，可以通过 translog 立刻获取；但是却要等到 refresh 成为一个 segment 后，才能被搜索到。==本节就介绍一下 ES 的搜索语法。</p>
<h3 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h3><p>ES 对搜索请求，有简易语法和完整语法两种方式。简易语法作为以后在 Kibana 上最常用的方式，一定是需要学会的。而在命令行里，我们可以通过最简单的方式来做到。还是上节输入的数据：<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/_search?q=first</code><br>可以看到返回结果：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"took"</span>:<span class="number">240</span>,<span class="attr">"timed_out"</span>:<span class="literal">false</span>,<span class="attr">"_shards"</span>:&#123;<span class="attr">"total"</span>:<span class="number">27</span>,<span class="attr">"successful"</span>:<span class="number">27</span>,<span class="attr">"failed"</span>:<span class="number">0</span>&#125;,<span class="attr">"hits"</span>:&#123;<span class="attr">"total"</span>:<span class="number">1</span>,<span class="attr">"max_score"</span>:<span class="number">0.11506981</span>,<span class="attr">"hits"</span>:[&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_score"</span>:<span class="number">0.11506981</span>,<span class="attr">"_source"</span>:&#123;</span><br><span class="line">    <span class="attr">"date"</span> : <span class="string">"1434966686000"</span>,</span><br><span class="line">    <span class="attr">"user"</span> : <span class="string">"chenlin7"</span>,</span><br><span class="line">    <span class="attr">"mesg"</span> : <span class="string">"first message into Elasticsearch"</span></span><br><span class="line">&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>还可以用下面语句搜索，结果是一样的。<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/_search?q=user:&quot;chenlin7</code></p>
<p>Excerpt From: 饶琛琳. “ELKstack 中文指南.” iBooks. </p>
<h3 id="querystring-语法"><a href="#querystring-语法" class="headerlink" title="querystring 语法"></a>querystring 语法</h3><p><code>curl -XGET http://127.0.0.1:9200/logstash-2016.03.29/_search?q=first</code></p>
<p>上例中，<code>?q=</code>后面写的，就是 querystring 语法。鉴于这部分内容会在 Kibana 上经常使用，这里详细解析一下语法：  </p>
<ul>
<li><strong>全文检索</strong>：直接写搜索的单词，如上例中的 <code>first</code>；</li>
<li><strong>单字段的全文检索</strong>：在搜索单词之前加上字段名和冒号，比如如果知道单词 first 肯定出现在 mesg 字段，可以写作 <code>mesg:first</code>；</li>
<li><strong>单字段的精确检索</strong>：在搜索单词前后加双引号，比如 <code>user:&quot;chenlin7&quot;</code>；<br>多个检索条件的组合：可以使用 NOT, AND 和 OR 来组合检索，注意必须是大写。比如 <code>user:(&quot;chenlin7&quot; OR &quot;chenlin&quot;) AND NOT mesg:first</code>；</li>
<li><strong>字段是否存在</strong>：<code>_exists_:user</code> 表示要求 user 字段存在，<code>_missing_:user</code> 表示要求 user 字段不存在；</li>
<li><strong>通配符</strong>：用 ? 表示单字母，<em> 表示任意个字母。比如 `fir?t mess</em>`；</li>
<li><strong>正则</strong>：需要比通配符更复杂一点的表达式，可以使用正则。比如 <code>mesg:/mes{2}ages?/</code>。注意 ES 中正则性能很差，而且支持的功能也不是特别强大，尽量不要使用。ES 支持的正则语法见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="external">query-dsl-regexp-query.html</a></li>
<li><strong>近似搜索</strong>：用 ~ 表示搜索单词可能有一两个字母写的不对，请 ES 按照相似度返回结果。比如 <code>frist~</code>；</li>
<li><strong>范围搜索</strong>：对数值和时间，ES 都可以使用范围搜索，比如：<code>rtt:&gt;300</code>，<code>date:[&quot;now-6h&quot; TO &quot;now&quot;}</code> 等。其中，<code>[]</code> 表示端点数值包含在范围内，<code>{}</code> 表示端点数值不包含在范围内；</li>
</ul>
<h3 id="完整语法"><a href="#完整语法" class="headerlink" title="完整语法"></a>完整语法</h3><p>ES 支持各种类型的检索请求，除了可以用 querystring 语法表达的以外，还有很多其他类型，具体列表和示例可参见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-queries.html" target="_blank" rel="external">query-dsl-regexp-query.html</a>。</p>
<p>作为最简单和常用的示例，这里展示一下 term query 的写法，相当于 querystring 语法中的 <code>user:&quot;chenlin7&quot;</code>：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">curl -XGET http://127.0.0.1:9200/_search -d '</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "term": &#123;</span><br><span class="line">      "user": "chenlin7" </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<h3 id="聚合请求"><a href="#聚合请求" class="headerlink" title="聚合请求"></a>聚合请求</h3><p>在检索范围确定之后，ES 还支持对结果集做聚合查询，返回更直接的聚合统计结果。在 ES 1.0 版本之前，这个接口叫 Facet，1.0 版本之后，这个接口改为 Aggregation。</p>
<p>Kibana 分别在 v3 中使用 Facet，v4 中使用 Aggregation。不过总的来说，Aggregation 是 Facet 接口的强化升级版本，我们直接了解 Aggregation 即可。本书后续章节也会介绍如何在 Kibana 的 v3 版本中使用 aggregation 接口做二次开发。</p>
<p>Aggregation 分为 bucket 和 metric 两种，分别用作词元划分和数值计算。而其中的 bucket aggregation，还支持在自身结果集的基础上，叠加新的 aggregation。这就是 aggregation 比 facet 最领先的地方。比如实现一个时序百分比统计，在 facet 接口就无法直接完成，而在 aggregation 接口就很简单了：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"># curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.22/_search?size=0&amp;pretty' -d'&#123;</span><br><span class="line">    "aggs" : &#123;</span><br><span class="line">        "percentile_over_time" : &#123;</span><br><span class="line">            "date_histogram" : &#123;</span><br><span class="line">                "field"    : "@timestamp",</span><br><span class="line">                "interval" : "1h"</span><br><span class="line">            &#125;,</span><br><span class="line">            "aggs" : &#123;</span><br><span class="line">                "percentile_one_time" : &#123;</span><br><span class="line">                    "percentiles" : &#123;</span><br><span class="line">                        "field" : "requesttime"</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<p>得到结果如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span> : <span class="number">151595</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span> : &#123;</span><br><span class="line">    <span class="attr">"total"</span> : <span class="number">81</span>,</span><br><span class="line">    <span class="attr">"successful"</span> : <span class="number">81</span>,</span><br><span class="line">    <span class="attr">"failed"</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span> : &#123;</span><br><span class="line">    <span class="attr">"total"</span> : <span class="number">3307142043</span>,</span><br><span class="line">    <span class="attr">"max_score"</span> : <span class="number">1.0</span>,</span><br><span class="line">    <span class="attr">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"aggregations"</span> : &#123;</span><br><span class="line">    <span class="attr">"percentile_over_time"</span> : &#123;</span><br><span class="line">      <span class="attr">"buckets"</span> : [ &#123;</span><br><span class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"22/Jun/2015:22:00:00 +0000"</span>,</span><br><span class="line">        <span class="attr">"key"</span> : <span class="number">1435010400000</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">459273981</span>,</span><br><span class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</span><br><span class="line">          <span class="attr">"values"</span> : &#123;</span><br><span class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</span><br><span class="line">            <span class="attr">"5.0"</span> : <span class="number">0.006</span>,</span><br><span class="line">            <span class="attr">"25.0"</span> : <span class="number">0.023</span>,</span><br><span class="line">            <span class="attr">"50.0"</span> : <span class="number">0.035</span>,</span><br><span class="line">            <span class="attr">"75.0"</span> : <span class="number">0.08774675719725569</span>,</span><br><span class="line">            <span class="attr">"95.0"</span> : <span class="number">0.25732934416125663</span>,</span><br><span class="line">            <span class="attr">"99.0"</span> : <span class="number">0.7508899754871812</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"23/Jun/2015:00:00:00 +0000"</span>,</span><br><span class="line">        <span class="attr">"key"</span> : <span class="number">1435017600000</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">768620219</span>,</span><br><span class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</span><br><span class="line">          <span class="attr">"values"</span> : &#123;</span><br><span class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</span><br><span class="line">            <span class="attr">"5.0"</span> : <span class="number">0.007000000000000001</span>,</span><br><span class="line">            <span class="attr">"25.0"</span> : <span class="number">0.025</span>,</span><br><span class="line">            <span class="attr">"50.0"</span> : <span class="number">0.03987809503972864</span>,</span><br><span class="line">            <span class="attr">"75.0"</span> : <span class="number">0.10297843567746187</span>,</span><br><span class="line">            <span class="attr">"95.0"</span> : <span class="number">0.30047269327062875</span>,</span><br><span class="line">            <span class="attr">"99.0"</span> : <span class="number">1.015495933753329</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"23/Jun/2015:02:00:00 +0000"</span>,</span><br><span class="line">        <span class="attr">"key"</span> : <span class="number">1435024800000</span>,</span><br><span class="line">        <span class="attr">"doc_count"</span> : <span class="number">849467060</span>,</span><br><span class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</span><br><span class="line">          <span class="attr">"values"</span> : &#123;</span><br><span class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</span><br><span class="line">            <span class="attr">"5.0"</span> : <span class="number">0.008</span>,</span><br><span class="line">            <span class="attr">"25.0"</span> : <span class="number">0.027000000000000003</span>,</span><br><span class="line">            <span class="attr">"50.0"</span> : <span class="number">0.0439999899006102</span>,</span><br><span class="line">            <span class="attr">"75.0"</span> : <span class="number">0.1160416197625958</span>,</span><br><span class="line">            <span class="attr">"95.0"</span> : <span class="number">0.3383140614483838</span>,</span><br><span class="line">            <span class="attr">"99.0"</span> : <span class="number">1.0275839684542212</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ES 目前能支持的聚合请求列表，参见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_blank" rel="external">search-aggregations.html</a></p>
<h3 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h3><p>对不了解 JVM 的 GC 的读者，这里先介绍一下 GC(垃圾收集)以及 GC 对 Elasticsearch 的影响。</p>
<p>Java is a garbage-collected language, which means that the programmer does not manually manage memory allocation and deallocation. The programmer simply writes code, and the Java Virtual Machine (JVM) manages the process of allocating memory as needed, and then later cleaning up that memory when no longer needed. Java 是一个自动垃圾收集的编程语言，启动 JVM 虚拟机的时候，会分配到固定大小的内存块，这个块叫做 heap(堆)。JVM 会把 heap 分成两个组：</p>
<ul>
<li>Young 新实例化的对象所分配的空间。这个空间一般来说只有 100MB 到 500MB 大小。Young 空间又分为两个 survivor(幸存)空间。当 Young 空间满，就会发生一次 young gc，还存活的对象，就被移入幸存空间里，已失效的对象则被移除。</li>
<li>Old 老对象存储的空间。这些对象应该是长期存活而且在较长一段时间内不会变化的内容。“这个空间会大很多，在 ES 来说，一节点上可能就有 30GB 内存是这个空间。前面提到的 young gc 中，如果某个对象连续多次幸存下来，就会被移进 Old 空间内。而等到 Old 空间满，就会发生一次 old gc，把失效对象移除。<br>听起来很美好的样子，但是这些都是有代价的！在 GC 发生的时候，JVM 需要暂停程序运行，以便自己追踪对象图收集全部失效对象。在这期间，其他一切都不会继续运行。请求没有响应，ping 没有应答，分片不会分配……</li>
</ul>
<p>当然，young gc 一般来说执行极快，没太大影响。但是 old 空间那么大，稍慢一点的 gc 就意味着程序几秒乃至十几秒的不可用，这太危险了。</p>
<p>JVM 本身对 gc 算法一直在努力优化，Elasticsearch 也尽量复用内部对象，复用网络缓冲，然后还提供像 Doc Values 这样的特性。但不管怎么说，gc 性能总是我们需要密切关注的数据，因为它是集群稳定性最大的影响因子。</p>
<p>如果你的 ES 集群监控里发现经常有很耗时的 GC，说明集群负载很重，内存不足。严重情况下，这些 GC 导致节点无法正确响应集群之间的 ping ，可能就直接从集群里退出了。然后数据分片也随之在集群中重新迁移，引发更大的网络和磁盘 IO，正常的写入和搜索也会受到影响。</p>
<h3 id="查询慢"><a href="#查询慢" class="headerlink" title="查询慢"></a>查询慢</h3><p>更常见的可能，是集群存储长期数据导致索引映射数据确实大到了 master 节点内存不足以快速处理的地步。</p>
<p>这时候，根据实际情况，可以有以下几种选择：</p>
<p>索引就是特别多：给 master 加内存。<br>索引里字段太多：改用 nested object 方式节省字段数量。<br>索引多到内存就是不够了：把一部分数据拆出来另一个集群。</p>
<h3 id="Web-Console"><a href="#Web-Console" class="headerlink" title="Web Console"></a>Web Console</h3><p><a href="https://github.com/lmenezes/elasticsearch-kopf" target="_blank" rel="external">elasticsearch-kopf</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[segmentfault「我是工具控」分享]]></title>
      <url>http://blog.wuliwala.net/2016/03/19/segmentfault-tools-sharing/</url>
      <content type="html"><![CDATA[<h2 id="segmentfault-我是工具控-分享"><a href="#segmentfault-我是工具控-分享" class="headerlink" title="segmentfault[我是工具控]分享"></a>segmentfault[我是工具控]分享</h2><p> <strong>运维团队中的开发，4年运维工作经验，去年转开发。主要开发语言python，偶尔写shell、javascript.</strong></p>
<p>我的工具箱可能跟别人不太一样<br>大家装机必备的就不提了</p>
<h3 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h3><ul>
<li><strong>ag</strong> 搜索代码炒鸡快！</li>
<li><strong>httpie</strong> 人类用的http测试工具</li>
<li><strong>jq</strong> 格式化json用的，跟<code>python -m json.tool</code>相比，是彩色的</li>
<li><strong>cowsay</strong> <strong>lolcat</strong> 好玩的，不解释</li>
</ul>
<h3 id="生活-效率"><a href="#生活-效率" class="headerlink" title="生活/效率"></a>生活/效率</h3><ul>
<li><strong>Keynote</strong> 特别喜欢苹果的这款产品，简洁易用，码农也能做出很好的幻灯片。曾用它做演讲稿，从产品、前端那里赢得3次分享、项目评比冠军。</li>
<li><strong>MacDown</strong> 以前用Mou，后来发现MacDown，代码着色要比Mou好很多，配合<strong>Hexo</strong>，也能用来写博客。</li>
<li><strong>eWallet</strong> 管理密码的，从windows就开始用，Mac平台也有。</li>
<li><strong>MindNode</strong> 看图，不解释<img src="/images/2016/03/19/mindnode.png" alt="mindnode"></li>
</ul>
<h3 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h3><ul>
<li><strong>MacVim</strong>今年开始学习，平时一般用它，写写shell脚本、python小程序；</li>
<li><strong>Atom</strong>项目用它，写前端不要太爽。</li>
<li><em><strong>TextMate</strong></em> 刚从windows换到Mac的时候非常怀念极轻量的<strong>Editplus</strong>，用了一阵，也还不错，今年主要学习vim，所以不用了。</li>
<li>我不用 <strong>oh~my~zsh</strong> 我用<strong>bash-it</strong> ，因为做了4年运维，对bash较熟，用过oh~my~zsh，感觉各种行为好怪异，简直无法愉快玩耍。<br>自己改的bash主题<img src="/images/2016/03/19/bash-it.png" alt="bash-it"></li>
</ul>
<p>vim 插件，一天可是说不完的。。。</p>
<figure class="highlight sml"><table><tr><td class="code"><pre><span class="line"><span class="type">Plugin</span> <span class="symbol">'VundleVim</span>/<span class="type">Vundle</span>.vim'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'Valloric</span>/<span class="type">YouCompleteMe'</span></span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/nerdtree'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/nerdcommenter'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/syntastic'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-airline/vim-airline'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-airline/vim-airline-themes'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-scripts/indentpython.vim'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'nvie</span>/vim-flake8'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'Xuyuanp</span>/nerdtree-git-plugin'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'xolox</span>/vim-misc'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'xolox</span>/vim-session'</span><br><span class="line"><span class="type">Plugin</span> <span class="symbol">'Chiel92</span>/vim-autoformat'</span><br></pre></td></tr></table></figure>
<p>Atom插件</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">atom-beautify</span><br><span class="line">atom-<span class="keyword">sync</span></span><br><span class="line">color-picker</span><br><span class="line"><span class="keyword">file</span>-icons</span><br><span class="line">git-control</span><br><span class="line">git-status</span><br><span class="line">linter</span><br><span class="line">linter-jshint</span><br><span class="line">linter-pep8</span><br><span class="line">linter-<span class="keyword">python</span>-pep8</span><br><span class="line">minimap</span><br><span class="line"><span class="keyword">python</span>-tools</span><br><span class="line">tree-<span class="keyword">view</span>-git-status</span><br><span class="line"><span class="keyword">vim</span>-<span class="keyword">mode</span></span><br></pre></td></tr></table></figure>
<h3 id="工位无码图"><a href="#工位无码图" class="headerlink" title="工位无码图"></a>工位无码图</h3><p><img src="/images/2016/03/19/seat.jpeg" alt="工位无码图"></p>
<blockquote>
<p>本文参与了 SegmentFault<a href="https://segmentfault.com/a/1190000004537274" target="_blank" rel="external">「我是工具控」</a>分享，如果你也手持利器，那就一起来分享吧。</p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Migration From Subversion(svn) to Git]]></title>
      <url>http://blog.wuliwala.net/2016/03/14/migrate-to-git-from-svn/</url>
      <content type="html"><![CDATA[<h2 id="migration-from-subversion-svn-to-git"><a href="#migration-from-subversion-svn-to-git" class="headerlink" title="migration from subversion(svn) to git"></a>migration from subversion(svn) to git</h2><p>git officiall documents<br><a href="https://git-scm.com/docs/git-svn" target="_blank" rel="external">https://git-scm.com/docs/git-svn</a><br><a href="https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git" target="_blank" rel="external">https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E4%B8%8E%E5%85%B6%E4%BB%96%E7%B3%BB%E7%BB%9F-%E4%BD%9C%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84-Git" target="_blank" rel="external">https://git-scm.com/book/zh/v2/Git-与其他系统-作为客户端的-Git</a>  </p>
<p>install the latest git  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum -y install subversion subversion-perl perl-TermReadKey curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc xmlto docbook2x docbook2X</span><br><span class="line"></span><br><span class="line">wget https://www.kernel.org/pub/software/scm/git/git-2.7.3.tar.gz</span><br><span class="line">tar xvf git-2.7.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> git-2.7.3</span><br><span class="line">make configure</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/git2.7.3</span><br><span class="line">make -j8 all doc info</span><br><span class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/git2.7.3/bin/git /usr/bin/</span><br><span class="line"></span><br><span class="line">vim ~/.subversion/servers</span><br><span class="line"><span class="comment"># let store-passwords = yes</span></span><br><span class="line"></span><br><span class="line">git svn <span class="built_in">clone</span> --username dev https://svn.yourdomain.com/yourrepo</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> yourrepo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首次 first time</span></span><br><span class="line">git branch <span class="_">-a</span> </span><br><span class="line">git show-ref</span><br><span class="line"><span class="comment"># push to gitlab server</span></span><br><span class="line">git remote add origin ssh://git@gitlab.yourdomain.com/svn/yourrepo.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 update</span></span><br><span class="line">git svn fetch &amp;&amp; git svn rebase</span><br><span class="line">git push</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Searchcode Server Community Deploy]]></title>
      <url>http://blog.wuliwala.net/2016/03/08/searchcode-server-community-deploy/</url>
      <content type="html"><![CDATA[<h1 id="Searchcode-Server-Community-Deploy"><a href="#Searchcode-Server-Community-Deploy" class="headerlink" title="Searchcode Server Community Deploy"></a>Searchcode Server Community Deploy</h1><h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p><a href="https://searchcode.com" target="_blank" rel="external">https://searchcode.com</a></p>
<h2 id="query-syntax"><a href="#query-syntax" class="headerlink" title="query syntax"></a>query syntax</h2><p><a href="https://searchcode.com/#jumbo-examples" target="_blank" rel="external">https://searchcode.com/#jumbo-examples</a></p>
<h2 id="requirement"><a href="#requirement" class="headerlink" title="requirement"></a>requirement</h2><ul>
<li>Linux (in this example, I’m using CentOS6)  </li>
<li>JRE 8u65 <a href="http://www.oracle.com/technetwork/java/javase/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/archive-139210.html</a>  </li>
<li>searchcode-server-community 1.0.0 <a href="https://searchcode.com/static/searchcode-server-community.tar.gz" target="_blank" rel="external">https://searchcode.com/static/searchcode-server-community.tar.gz</a>  </li>
</ul>
<h2 id="installation"><a href="#installation" class="headerlink" title="installation"></a>installation</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># download jre package from java archive website</span></span><br><span class="line">rpm -ivh jre-8u65-linux-x64.rpm</span><br><span class="line">wget https://searchcode.com/static/searchcode-server-community.tar.gz</span><br><span class="line">tar xf searchcode-server-community.tar.gz</span><br><span class="line">searchcode-server-community/release</span><br><span class="line">java -jar searchcode-1.0.0.jar</span><br></pre></td></tr></table></figure>
<p><strong>visit <a href="http://yourserverip:8080/" target="_blank" rel="external">http://yourserverip:8080/</a></strong>  </p>
<h2 id="use-my-docker-image"><a href="#use-my-docker-image" class="headerlink" title="use my docker image"></a>use my docker image</h2><h3 id="fresh-image-auto-build-and-keep-fresh-depend-on-author’s-api"><a href="#fresh-image-auto-build-and-keep-fresh-depend-on-author’s-api" class="headerlink" title="fresh image auto-build and keep fresh, depend on author’s api"></a>fresh image auto-build and keep fresh, depend on author’s api</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -p 8080:8080 <span class="_">-d</span> docker.io/arkii/searchcode-server-community</span><br></pre></td></tr></table></figure>
<p>run image directly  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -p 8080:8080 <span class="_">-d</span> docker.io/arkii/searchcode-server</span><br></pre></td></tr></table></figure>
<p>or run image with docker-compose<br>docker-compose.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">searchcode:</span></span><br><span class="line"><span class="attr">  image:</span> arkii/searchcode-server</span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/index:/srv/index</span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/repo:/srv/repo</span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.properties:/srv/searchcode.properties</span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.sqlite:/srv/searchcode.sqlite</span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"8080:8080/tcp"</span></span><br></pre></td></tr></table></figure>
<p><strong>visit <a href="http://yourdockerserverip:8080/" target="_blank" rel="external">http://yourdockerserverip:8080/</a></strong>  </p>
<p>To administer your searchcode server instance you need to click on the Admin link in the top right.<br>Enter the default password <strong>Adm1n234</strong></p>
<h2 id="Dockerfiles"><a href="#Dockerfiles" class="headerlink" title="Dockerfiles"></a>Dockerfiles</h2><p><strong>build JRE 8u65 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span>        centos:<span class="number">6</span></span><br><span class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</span><br><span class="line"><span class="keyword">COPY</span>        <span class="bash">./jre-8u65-linux-x64.rpm /tmp/jre-8u65-linux-x64.rpm</span><br><span class="line"></span><span class="keyword">RUN</span>         <span class="bash">rpm -ivh /tmp/jre-8u65-linux-x64.rpm &amp;&amp; rm <span class="_">-f</span> /tmp/jre-8u65-linux-x64.rpm</span></span><br></pre></td></tr></table></figure>
<p><strong>build Searchcode Server Community 1.0.0 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span>        arkii/centos6-jre-<span class="number">8</span>u6<span class="number">5</span><br><span class="line"></span><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</span><br><span class="line"><span class="keyword">COPY</span>        <span class="bash">./searchcode-server-community/release /srv</span><br><span class="line"></span><span class="keyword">WORKDIR</span>     <span class="bash">/srv</span><br><span class="line"></span><span class="keyword">CMD</span>         <span class="bash">/usr/bin/java -jar searchcode-1.0.0.jar</span><br><span class="line"></span><span class="keyword">EXPOSE</span>      <span class="number">8080</span>/tcp</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Wall-E web deployment]]></title>
      <url>http://blog.wuliwala.net/2016/03/01/wall-e-web-deployment/</url>
      <content type="html"><![CDATA[<h1 id="Wall-E-web-deployment"><a href="#Wall-E-web-deployment" class="headerlink" title="Wall-E web deployment"></a>Wall-E web deployment</h1><p>项目地址<br><a href="http://walle-web.io/" target="_blank" rel="external">http://walle-web.io/</a>  </p>
<p>安装文档<br><a href="http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html" target="_blank" rel="external">http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html</a>  </p>
<p>问题FAQ<br><a href="https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md" target="_blank" rel="external">https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md</a>  </p>
<p><a href="https://github.com/meolu/walle-web/archive/master.zip" target="_blank" rel="external">https://github.com/meolu/walle-web/archive/master.zip</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">rpm -Uvh http://mirror.webtatic.com/yum/el6/latest.rpm</span><br><span class="line">yum install -y php56w.x86_64 php56w-cli.x86_64 php56w-common.x86_64 php56w-gd.x86_64 php56w-ldap.x86_64 php56w-mbstring.x86_64 php56w-mcrypt.x86_64 php56w-mysql.x86_64 php56w-pdo.x86_64 php56w-xml.x86_64</span><br><span class="line">wget https://getcomposer.org/installer &amp;&amp; php installer &amp;&amp; mv composer.phar /usr/<span class="built_in">local</span>/bin/composer</span><br><span class="line"></span><br><span class="line">wget https://github.com/meolu/walle-web/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> walle-web-master</span><br><span class="line">composer install</span><br><span class="line"><span class="comment">#composer install --aprefer-dist --no-dev --optimize-autoloader -vvvv</span></span><br><span class="line"></span><br><span class="line">vi config/local.php</span><br><span class="line"></span><br><span class="line">./yii walle/setup</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> vendor</span><br><span class="line">ln <span class="_">-s</span> bower-asset/ bower</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;VirtualHost *:80&gt;</span><br><span class="line">ServerName walle.xxx.com</span><br><span class="line">DocumentRoot /var/www/html/web</span><br><span class="line">    &lt;Directory "/var/www/html/web"&gt;</span><br><span class="line">      Options  FollowSymLinks</span><br><span class="line">        AllowOverride ALL</span><br><span class="line">        Order allow,deny</span><br><span class="line">        Allow from all</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;'</span> &gt; /etc/httpd/conf.d/walle.conf</span><br></pre></td></tr></table></figure>
<p>default account<br>admin:admin</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ionic hybrid app development]]></title>
      <url>http://blog.wuliwala.net/2016/02/15/ionic-web-app-dev/</url>
      <content type="html"><![CDATA[<h1 id="ionic-hybrid-app-development"><a href="#ionic-hybrid-app-development" class="headerlink" title="ionic hybrid app development"></a>ionic hybrid app development</h1><h2 id="Video-Show"><a href="#Video-Show" class="headerlink" title="Video Show"></a>Video Show</h2><p><a href="/images/2016/02/15/ionic-dev-icinga-zol-480p.mp4">video show</a>  </p>
<h2 id="Frontend"><a href="#Frontend" class="headerlink" title="Frontend"></a>Frontend</h2><h3 id="ionic"><a href="#ionic" class="headerlink" title="ionic"></a>ionic</h3><p><a href="http://ionicframework.com/getting-started/" target="_blank" rel="external">getting-started</a><br><a href="http://usecreator.com/" target="_blank" rel="external">usecreator</a><br><a href="https://creator.ionic.io/app/dashboard/help/videos" target="_blank" rel="external">videos for creator</a><br><a href="http://codepen.io/ionic/pens/public/" target="_blank" rel="external">Many examples on codepen</a><br><a href="http://www.runoob.com/ionic" target="_blank" rel="external">courses on w3school.cc</a>  </p>
<h4 id="install-ionic"><a href="#install-ionic" class="headerlink" title="install ionic"></a>install ionic</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install -g cordova ionic</span><br><span class="line">ionic start myApp blank</span><br><span class="line">ionic start myApp tabs</span><br><span class="line">ionic start myApp sidemenu</span><br></pre></td></tr></table></figure>
<h3 id="run-or-emulate-your-app"><a href="#run-or-emulate-your-app" class="headerlink" title="run or emulate your app"></a>run or emulate your app</h3><p><a href="http://ionicframework.com/docs/cli/run.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/run.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装cordova/ionic</span></span><br><span class="line">npm install -g cordova ionic</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加平台(ios相关操作请在mac机器下o(&gt;﹏&lt;)o)</span></span><br><span class="line">ionic platform add android/ios</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新项目中的ionic js类库</span></span><br><span class="line">ionic lib update</span><br><span class="line"></span><br><span class="line"><span class="comment">#展示ionic项目结果 (同时显示iOS和android上的样式)</span></span><br><span class="line">ionic serve --lab</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装/删除crosswalk</span></span><br><span class="line">ionic browser add/remove crosswalk</span><br></pre></td></tr></table></figure>
<h3 id="Icon-and-Splash-Screen-Image-Generation"><a href="#Icon-and-Splash-Screen-Image-Generation" class="headerlink" title="Icon and Splash Screen Image Generation"></a>Icon and Splash Screen Image Generation</h3><p>Guide below<br><a href="http://ionicframework.com/docs/cli/icon-splashscreen.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/icon-splashscreen.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cp ~/Downloads/logo11/free_logo_11.ai ./resources/icon.ai</span><br><span class="line">ionic resources --icon</span><br></pre></td></tr></table></figure>
<h3 id="splash-screen"><a href="#splash-screen" class="headerlink" title="splash screen"></a>splash screen</h3><p>2208 x 2208 splash.png  </p>
<p>search images on Google , set resolution to 2208 x 2208  </p>
<h2 id="Build-android-package"><a href="#Build-android-package" class="headerlink" title="Build android package"></a>Build android package</h2><p>Follow this guide<br><a href="http://ionicframework.com/docs/guide/publishing.html" target="_blank" rel="external">http://ionicframework.com/docs/guide/publishing.html</a>  </p>
<h3 id="安装android-sdk"><a href="#安装android-sdk" class="headerlink" title="安装android sdk"></a>安装android sdk</h3><p><a href="http://developer.android.com/sdk/installing/index.html" target="_blank" rel="external">http://developer.android.com/sdk/installing/index.html</a><br>Download Stand-alone SDK Tools  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget <span class="string">'http://dl.google.com/android/android-sdk_r24.4.1-macosx.zip'</span></span><br><span class="line">unzip android-sdk_r24.4.1-macosx.zip</span><br><span class="line">mv android-sdk-macosx /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export ANDROID_HOME="/usr/local/android-sdk-macosx"'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$PATH:$ANDROID_HOME/tools"'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'http.proxyPort=8123'</span> &gt;&gt; ~/.android/androidtool.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'http.proxyHost=127.0.0.1'</span> &gt;&gt; ~/.android/androidtool.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># android update sdk --no-ui</span></span><br><span class="line">android update sdk --no-https --no-ui --filter platform,system-image,tool,platform-tool</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT_FOLDER</span></span><br><span class="line"></span><br><span class="line">vim config.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">#we should remove debug console plugin before generating the release builds</span></span><br><span class="line"></span><br><span class="line">cordova plugin rm cordova-plugin-console</span><br><span class="line"></span><br><span class="line">cordova build --release android</span><br><span class="line"></span><br><span class="line">/bin/cp platforms/android/build/outputs/apk/android-release-unsigned.apk ./</span><br><span class="line"></span><br><span class="line"><span class="comment"># keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000</span></span><br><span class="line">keytool -genkey -v -keystore icinga-mobile-release-key.keystore -alias icinga_mobile -keyalg RSA -keysize 2048 -validity 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore android-release-unsigned.apk alias_name</span></span><br><span class="line">jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore icinga-mobile-release-key.keystore android-release-unsigned.apk icinga_mobile</span><br><span class="line"></span><br><span class="line"><span class="comment"># zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</span></span><br><span class="line">/usr/<span class="built_in">local</span>/android-sdk-macosx/build-tools/23.0.2/zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</span><br></pre></td></tr></table></figure>
<h2 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h2><p>style is much mess on Android  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .config(function($stateProvider, $urlRouterProvider) &#123;</span></span><br><span class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$stateProvider, $urlRouterProvider , $ionicConfigProvider</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.tabs.style(<span class="string">'standard'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.ios.tabs.position(<span class="string">'bottom'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.tabs.style(<span class="string">'standard'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.tabs.position(<span class="string">'standard'</span>);</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.navBar.alignTitle(<span class="string">'center'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.navBar.alignTitle(<span class="string">'left'</span>);</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-ios-arrow-thin-left'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-android-arrow-back'</span>);</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.views.transition(<span class="string">'ios'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.views.transition(<span class="string">'android'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ionic uses AngularUI Router which uses the concept of states</span></span><br><span class="line">  <span class="comment">// Learn more here: https://github.com/angular-ui/ui-router</span></span><br><span class="line">  <span class="comment">// Set up the various states which the app can be in.</span></span><br><span class="line">  <span class="comment">// Each state's controller can be found in controllers.js</span></span><br><span class="line">  $stateProvider</span><br></pre></td></tr></table></figure>
<h2 id="Useful-resources"><a href="#Useful-resources" class="headerlink" title="Useful resources"></a>Useful resources</h2><h3 id="vuejs"><a href="#vuejs" class="headerlink" title="vuejs"></a>vuejs</h3><p><a href="http://vuejs.org/" target="_blank" rel="external">vuejs</a><br><a href="https://github.com/vuejs/awesome-vue" target="_blank" rel="external">awesome-vue</a></p>
<h3 id="MaterializeCSS"><a href="#MaterializeCSS" class="headerlink" title="MaterializeCSS"></a>MaterializeCSS</h3><p><a href="http://materializecss.com/mobile.html" target="_blank" rel="external">Materialize</a>  </p>
<h2 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h2><p><a href="http://flask-restful.readthedocs.org/" target="_blank" rel="external">Flask-RESTful</a></p>
<h2 id="SDK-installation-output"><a href="#SDK-installation-output" class="headerlink" title="SDK installation output"></a>SDK installation output</h2><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">Running command: /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/hooks/after_prepare/010_add_platform_class.js /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend</span><br><span class="line">add to body <span class="keyword">class</span>: platform-android</span><br><span class="line"><span class="keyword">ERROR</span> building <span class="keyword">one</span> of the platforms: Please install Android target: <span class="string">"android-23"</span>.</span><br><span class="line"></span><br><span class="line">Hint: <span class="keyword">Open</span> the SDK manager <span class="keyword">by</span> running: /usr/<span class="keyword">local</span>/android-sdk-macosx/tools/android</span><br><span class="line">You will require:</span><br><span class="line">1. <span class="string">"SDK Platform"</span> <span class="keyword">for</span> android-23</span><br><span class="line">2. "Android SDK Platform-tools (latest)</span><br><span class="line">3. <span class="string">"Android SDK Build-tools"</span> (latest)</span><br><span class="line">You may not have the required environment or OS to build this project</span><br><span class="line"><span class="keyword">Error</span>: Please install Android target: <span class="string">"android-23"</span>.</span><br><span class="line"></span><br><span class="line">Hint: <span class="keyword">Open</span> the SDK manager <span class="keyword">by</span> running: /usr/<span class="keyword">local</span>/android-sdk-macosx/tools/android</span><br><span class="line">You will require:</span><br><span class="line">1. <span class="string">"SDK Platform"</span> <span class="keyword">for</span> android-23</span><br><span class="line">2. "Android SDK Platform-tools (latest)</span><br><span class="line">3. <span class="string">"Android SDK Build-tools"</span> (latest)</span><br></pre></td></tr></table></figure>
<h2 id="Android-build-process-output"><a href="#Android-build-process-output" class="headerlink" title="Android build process output"></a>Android build process output</h2><figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">Running command: /Users/arkii/Workspace/Projects/icinga<span class="attr">-dashboard</span><span class="attr">-mobile</span>/frontend/hooks/after_prepare/<span class="number">010</span>_add_platform_class.js /Users/arkii/Workspace/Projects/icinga<span class="attr">-dashboard</span><span class="attr">-mobile</span>/frontend</span><br><span class="line">add <span class="keyword">to</span> body class: platform<span class="attr">-android</span></span><br><span class="line">ANDROID_HOME=/usr/<span class="built_in">local</span>/android<span class="attr">-sdk</span><span class="attr">-macosx</span></span><br><span class="line">JAVA_HOME=/Library/Java/Home</span><br><span class="line">Downloading http:<span class="comment">//services.gradle.org/distributions/gradle-2.2.1-all.zip</span></span><br><span class="line"><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.</span><br><span class="line">:compileReleaseNdk UP<span class="attr">-TO</span><span class="attr">-DATE</span></span><br><span class="line">:compileReleaseSources</span><br><span class="line">:lintVitalRelease</span><br><span class="line">:transformClassesWithDexForRelease</span><br><span class="line">:mergeReleaseJniLibFolders</span><br><span class="line">:transformNative_libsWithMergeJniLibsForRelease</span><br><span class="line">:processReleaseJavaRes UP<span class="attr">-TO</span><span class="attr">-DATE</span></span><br><span class="line">:transformResourcesWithMergeJavaResForRelease</span><br><span class="line">:packageRelease</span><br><span class="line">:assembleRelease</span><br><span class="line">:cdvBuildRelease</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: <span class="number">5</span> mins <span class="number">21.356</span> secs</span><br><span class="line">Built the following apk(s): </span><br><span class="line">	/Users/arkii/Workspace/Projects/icinga<span class="attr">-dashboard</span><span class="attr">-mobile</span>/frontend/platforms/android/build/outputs/apk/android<span class="attr">-release</span><span class="attr">-unsigned</span>.apk</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[BitBar plugin icinga2 overview]]></title>
      <url>http://blog.wuliwala.net/2016/01/25/bitbar-plugin-icinga-overview/</url>
      <content type="html"><![CDATA[<h1 id="MacBitBar-Plugin-icinga2-api-overview-py"><a href="#MacBitBar-Plugin-icinga2-api-overview-py" class="headerlink" title="MacBitBar Plugin icinga2-api-overview.py"></a>MacBitBar Plugin icinga2-api-overview.py</h1><p>Plugin to show icinga2 tactical overview, developed by python, in order to use this plugin, you should enable icinga2-api first.  </p>
<h2 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h2><p><a href="/images/2016/01/25/macbitbar-icinga-overview-480p.mp4">screencast here</a><br><img src="/images/2016/01/25/icinga2-api-overview.png" alt="">  </p>
<h2 id="Install-MacBitBar"><a href="#Install-MacBitBar" class="headerlink" title="Install MacBitBar"></a>Install MacBitBar</h2><p>Download the latest package from site below<br><a href="https://github.com/matryer/bitbar/releases" target="_blank" rel="external">https://github.com/matryer/bitbar/releases</a><br>Or install it by brew cask<br><code>brew cask install bitbar</code></p>
<h2 id="Get-plugin"><a href="#Get-plugin" class="headerlink" title="Get plugin"></a>Get plugin</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py" target="_blank" rel="external">https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py</a>  </p>
<h2 id="Install-Plugin"><a href="#Install-Plugin" class="headerlink" title="Install Plugin"></a>Install Plugin</h2><p>Just download the plugin of your choice into your BitBar plugins directory and choose Refresh from one of the BitBar menu.  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod +x icinga2-api-overview.py</span><br><span class="line"><span class="built_in">cd</span> Plugins/Enabled</span><br><span class="line"><span class="comment"># Enable uptime plugin and change update interval to 30 seconds</span></span><br><span class="line">ln <span class="_">-s</span> ../Utility/icinga2-api-overview.py icinga.30s.py</span><br></pre></td></tr></table></figure>
<h2 id="Other-plugins-built-by-me"><a href="#Other-plugins-built-by-me" class="headerlink" title="Other plugins built by me"></a>Other plugins built by me</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/" target="_blank" rel="external">https://github.com/arkii/gadgets/Utility/BitBar/</a></p>
<h2 id="MacBitBar"><a href="#MacBitBar" class="headerlink" title="MacBitBar"></a>MacBitBar</h2><p><img src="/images/2016/01/25/bitbar-logo@2x.png" alt=""><br>The BitBar app lets you put the output from any script or program right in your Mac OS X menu bar. And it’s completely free. An impressive number of plugins have already been contributed by a wide range of developers just like you, and this site makes it easy to find them.  </p>
<p>Homepage:<br><a href="https://getbitbar.com" target="_blank" rel="external">https://getbitbar.com</a><br>Projects:<br><a href="https://github.com/matryer/bitbar" target="_blank" rel="external">BitBar</a><br><a href="https://github.com/matryer/bitbar-plugins" target="_blank" rel="external">BitBar-Plugins</a>  </p>
<h2 id="NagBar"><a href="#NagBar" class="headerlink" title="NagBar"></a>NagBar</h2><p><img src="/images/2016/01/25/nagbarapp.png" alt=""><br>NagBar is a freeware Nagios, Icinga and Thruk monitoring client which runs in the status bar and give updates about the monitored services. NagBar is a Mac OS X native application created using the Cocoa framework.  </p>
<p>Homepage:<br><a href="https://sites.google.com/site/nagbarapp/" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/</a><br>Screenshots:<br><a href="https://sites.google.com/site/nagbarapp/screenshots" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/screenshots</a>  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2 influxdb grafana integration]]></title>
      <url>http://blog.wuliwala.net/2015/12/09/icinga2-influxdb-grafana-integration/</url>
      <content type="html"><![CDATA[<h1 id="icinga2-influxdb-grafana-integration"><a href="#icinga2-influxdb-grafana-integration" class="headerlink" title="icinga2 influxdb grafana integration"></a>icinga2 influxdb grafana integration</h1><p>Using influxdb as storage, icinga2 passing the performance data which returned by plugins, and grafana is used for data visulizing.  </p>
<h2 id="preparation"><a href="#preparation" class="headerlink" title="preparation"></a>preparation</h2><p><strong>plugins’ output is STRICTLY nagios standard output</strong></p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="meta"># OK - load average: 0.69, 0.97, 0.94|load1=0.690;16.000;30.000;0; load5=0.970;20.000;32.000;0; load15=0.940;24.000;34.000;0; </span></span><br><span class="line"></span><br><span class="line"><span class="meta"># hosts</span></span><br><span class="line">icinga2.server1.host.hostalive.perfdata.pl.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449566712</span></span><br><span class="line">icinga2.server1.host.hostalive.perfdata.rta.<span class="keyword">value</span> <span class="number">0.0041609999999999998</span> <span class="number">1449566712</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># services</span></span><br><span class="line">icinga2.server1.service.nrpe_load.perfdata.load1.<span class="keyword">value</span> <span class="number">0.01</span> <span class="number">1449567314</span></span><br><span class="line">icinga2.server1.service.nrpe_load.perfdata.load5.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></span><br><span class="line">icinga2.server1.service.nrpe_load.perfdata.load15.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></span><br></pre></td></tr></table></figure>
<h2 id="enable-icinga2-graphite-feature"><a href="#enable-icinga2-graphite-feature" class="headerlink" title="enable icinga2 graphite feature"></a>enable icinga2 graphite feature</h2><p><code># icinga2 feature enable perfdata</code><br><code># icinga2 feature enable graphite</code><br><code># vim /etc/icinga2/features-enabled/graphite.conf</code>  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * The GraphiteWriter type writes check result metrics and</span><br><span class="line"> * performance data to a graphite tcp socket.</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line">library <span class="string">"perfdata"</span></span><br><span class="line"></span><br><span class="line">object GraphiteWriter <span class="string">"graphite"</span> &#123;</span><br><span class="line">  <span class="comment">//host = "127.0.0.1"</span></span><br><span class="line">  <span class="comment">//port = 2003</span></span><br><span class="line">  host = <span class="string">"influxdb-server-with-graphite-plugin"</span></span><br><span class="line">  port = <span class="number">2004</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Optional. Metric prefix for host name. Defaults to "icinga2.$host.name$.host.$host.check_command$".</span></span><br><span class="line">host_name_template = <span class="string">"icinga2.$host.name$.host.$host.check_command$"</span></span><br><span class="line">service_name_template = <span class="string">"icinga2.$host.name$.service.$service.name$"</span></span><br><span class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.vars.nrpe_command$"</span></span><br><span class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.name$.$service.check_command$"</span></span><br><span class="line"><span class="comment">// Optional. Metric prefix for service name. Defaults to "icinga2.$host.name$.services.$service.name$.$service.check_command$".</span></span><br><span class="line"><span class="comment">// enable_send_thresholds = false // Optional. Send additional threshold metrics. Defaults to false.</span></span><br><span class="line"><span class="comment">// enable_send_metadata = false   // Optional. Send additional metadata metrics. Defaults to false.</span></span><br><span class="line"><span class="comment">// enable_legacy_mode = false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="define-the-internal-link-guiding-to-grafana-dashboard"><a href="#define-the-internal-link-guiding-to-grafana-dashboard" class="headerlink" title="define the internal link, guiding to grafana dashboard"></a>define the internal link, guiding to grafana dashboard</h2><p><code># vim /etc/icinga2/conf.d/templates.conf</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> Service <span class="string">"grafana-svc"</span> &#123;</span><br><span class="line">  <span class="comment">// http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=kddi-zol-dealer-web1&amp;var-CMD=nrpe_ss</span></span><br><span class="line">  notes_url = <span class="string">"http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=$HOSTNAME$&amp;var-CMD=$SERVICEDESC$"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="apply-the-template"><a href="#apply-the-template" class="headerlink" title="apply the template"></a>apply the template</h2><p><code># vim /etc/icinga2/conf.d/services.conf</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">apply Service <span class="string">"nrpe_ss"</span> &#123;</span><br><span class="line">        import <span class="string">"generic-service"</span></span><br><span class="line">        import <span class="string">"grafana-svc"</span></span><br><span class="line">                check_command = <span class="string">"nrpe"</span></span><br><span class="line">                assign where <span class="string">"webserver"</span> in host.groups</span><br><span class="line">                vars.nrpe_timeout = <span class="number">240</span></span><br><span class="line">                vars.nrpe_command = <span class="string">"check_ss"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>icinga2 daemon -C &amp;&amp; service icinga2 reload</code>  </p>
<h2 id="Influxdb-graphite-plugin-configuration"><a href="#Influxdb-graphite-plugin-configuration" class="headerlink" title="Influxdb graphite plugin configuration"></a>Influxdb graphite plugin configuration</h2><p><code># vim /etc/influxdb/influxdb.conf</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">[[graphite]]</span><br><span class="line">  enabled = true</span><br><span class="line">  database = "icinga"</span><br><span class="line">  bind-address = ":2004"</span><br><span class="line">  protocol = "tcp"</span><br><span class="line">  consistency-level = "one"</span><br><span class="line">  ignore-unnamed = true</span><br><span class="line">  name-separator = "|"</span><br><span class="line">  # name-separator = "_"</span><br><span class="line">  templates = [</span><br><span class="line">     "icinga2.*.host.*.perfdata.*.*                   .measurement..cmd..metric.value",</span><br><span class="line">     "icinga2.*.service.*.perfdata.*.*                .measurement..cmd..metric.value",</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">[[graphite]]</span><br><span class="line">  enabled = true</span><br><span class="line">  database = "graphite"</span><br><span class="line">  bind-address = ":2003"</span><br><span class="line">  protocol = "tcp"</span><br><span class="line">  consistency-level = "one"</span><br><span class="line">  # name-separator = ";"</span><br><span class="line">  name-separator = "."</span><br><span class="line"></span><br><span class="line">  # These next lines control how batching works. You should have this enabled</span><br><span class="line">  # otherwise you could get dropped metrics or poor performance. Batching</span><br><span class="line">  # will buffer points in memory if you have many coming in.</span><br><span class="line"></span><br><span class="line">  # batch-size = 1000 # will flush if this many points get buffered</span><br><span class="line">  # batch-pending = 5 # number of batches that may be pending in memory</span><br><span class="line">  # batch-timeout = "1s" # will flush at least this often even if we haven't hit buffer limit</span><br><span class="line">  # udp-read-buffer = 0 # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.</span><br><span class="line"></span><br><span class="line">  ## "name-schema" configures tag names for parsing the metric name from graphite protocol;</span><br><span class="line">  ## separated by `name-separator`.</span><br><span class="line">  ## The "measurement" tag is special and the corresponding field will become</span><br><span class="line">  ## the name of the metric.</span><br><span class="line">  ## e.g. "type.host.measurement.device" will parse "server.localhost.cpu.cpu0" as</span><br><span class="line">  ## &#123;</span><br><span class="line">  ##     measurement: "cpu",</span><br><span class="line">  ##     tags: &#123;</span><br><span class="line">  ##         "type": "server",</span><br><span class="line">  ##         "host": "localhost,</span><br><span class="line">  ##         "device": "cpu0"</span><br><span class="line">  ##     &#125;</span><br><span class="line">  ## &#125;</span><br><span class="line">  # name-schema = "type.host.measurement.device"</span><br><span class="line"></span><br><span class="line">  ## If set to true, when the input metric name has more fields than `name-schema` specified,</span><br><span class="line">  ## the extra fields will be ignored.</span><br><span class="line">  ## Otherwise an error will be logged and the metric rejected.</span><br><span class="line">  # ignore-unnamed = true</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [collectd]</span><br><span class="line">###</span><br><span class="line">### Controls the listener for collectd data.</span><br><span class="line">###</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># grafana template variables</span><br><span class="line">$HOST</span><br><span class="line"><span class="keyword">SHOW</span> MEASUREMENTS</span><br><span class="line">$CMD</span><br><span class="line"><span class="keyword">SHOW</span> TAG <span class="keyword">VALUES</span> <span class="keyword">FROM</span> <span class="string">"$HOST"</span> <span class="keyword">WITH</span> <span class="keyword">KEY</span> = <span class="string">"cmd"</span></span><br><span class="line">$METRIC</span><br><span class="line"><span class="keyword">SHOW</span> TAG <span class="keyword">VALUES</span> <span class="keyword">FROM</span> <span class="string">"$HOST"</span> <span class="keyword">WITH</span> <span class="keyword">KEY</span> = <span class="string">"metric"</span> <span class="keyword">WHERE</span> cmd = <span class="string">'$CMD'</span></span><br></pre></td></tr></table></figure>
<p><strong>grafana query below</strong><br><img src="/images/2015/12/1.png" alt="grafana-query"></p>
<h2 id="Get-the-share-link-from-grafana-dashboard"><a href="#Get-the-share-link-from-grafana-dashboard" class="headerlink" title="Get the share link from grafana dashboard"></a>Get the share link from grafana dashboard</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://grafana.yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen&amp;var-HOST=server1&amp;var-CMD=nrpe_ss"</span> <span class="attr">width</span>=<span class="string">"450"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>cd /etc/icingaweb2/enabledModules/pnp4nagios/</code></p>
<p>icingaweb2 modules API here<br><code>/usr/share/icingaweb2/modules/monitoring/library/Monitoring/Object/Service.php</code></p>
<p>add grafana integration into icingaweb2   </p>
<p><code>/usr/share/icingaweb2/modules/pnp4nagios/library/Pnp4nagios/Grapher.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grapher</span> <span class="keyword">extends</span> <span class="title">GrapherHook</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    .........OLD COLD BLOCK........</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> $baseUrl = <span class="string">'/pnp4nagios'</span>;</span><br><span class="line">    <span class="keyword">protected</span> $grafanaBaseUrl = <span class="string">'http://yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen'</span>;</span><br><span class="line">    </span><br><span class="line">    .........OLD COLD BLOCK........</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPreviewHtml</span><span class="params">(MonitoredObject $object)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">        .........OLD COLD BLOCK........</span><br><span class="line">        </span><br><span class="line">        $html .= <span class="string">"  &lt;/tr&gt;\n  &lt;tr&gt;\n"</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($viewKeys <span class="keyword">as</span> $view) &#123;</span><br><span class="line">            $html .= <span class="string">'    &lt;td style="border-left: 1px solid #555; padding-right: 3px"&gt;'</span></span><br><span class="line">                   . $this-&gt;getPreviewImg($host, $service, $view)</span><br><span class="line">                   . <span class="string">"&lt;/td&gt;\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Arkii 2015.12.14 added Grafana Integration</span></span><br><span class="line">        <span class="keyword">if</span> ($service != <span class="string">'_HOST_'</span> &amp;&amp; $object-&gt;service_notes_url) &#123;</span><br><span class="line">            $html .= <span class="string">"&lt;tr&gt;\n &lt;td&gt;\n"</span>;</span><br><span class="line">            $grafanaIframe = sprintf(</span><br><span class="line">                <span class="string">'&lt;iframe src="%s&amp;var-HOST=%s&amp;var-CMD=%s" width="480" height="150" frameborder="0"&gt;&lt;/iframe&gt;'</span>,</span><br><span class="line">                $this-&gt;grafanaBaseUrl,</span><br><span class="line">                $host,</span><br><span class="line">                $service);</span><br><span class="line">            $html .= $grafanaIframe;</span><br><span class="line">            $html .= <span class="string">"&lt;/td&gt;\n &lt;/tr&gt;\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// end of Grafana Integration</span></span><br><span class="line"></span><br><span class="line">        $html .= <span class="string">"&lt;/tr&gt;&lt;/table&gt;\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> $html;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="demos"><a href="#demos" class="headerlink" title="demos"></a>demos</h2><p><strong>work with pnp4nagios</strong><br><img src="/images/2015/12/5.png" alt=""><br><strong>click the notes_url</strong><br><img src="/images/2015/12/2.png" alt="icinga-"><br><strong>jumped to your grafana dashboard</strong><br><img src="/images/2015/12/3.png" alt="grafana-1"><br><strong>another metric</strong><br><img src="/images/2015/12/4.png" alt="grafana-2"></p>
<h2 id="many-useful-links"><a href="#many-useful-links" class="headerlink" title="many useful links"></a>many useful links</h2><p><a href="http://play.grafana.org/" target="_blank" rel="external">so many grafana examples here</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins#addons-graphing-influxdb" target="_blank" rel="external">enable influxdb writer</a><br><a href="http://www.infoq.com/articles/graphite-intro" target="_blank" rel="external">graphite-intro-en</a><br><a href="http://www.infoq.com/cn/articles/graphite-intro" target="_blank" rel="external">graphite-intro-cn</a><br><a href="https://github.com/influxdb/influxdb/tree/master/services/graphite" target="_blank" rel="external">InfluxDB hook up Graphite as an input source</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/monitoring-basics#runtime-macros" target="_blank" rel="external">icinga2-runtime-macros</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/object-types#objecttype-graphitewriter" target="_blank" rel="external">icinga2-objecttype-graphitewriter</a><br><strong>Intruduced Performance Data Pipe of icinga2 in GREAT DETAIL[非常详细的icinga2性能数据管道说明]:</strong><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/icinga2-features#performance-data" target="_blank" rel="external">icinga2-performance-data</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to build tinycorelinux docker image]]></title>
      <url>http://blog.wuliwala.net/2015/12/07/how-to-build-tinycorelinux-docker-image/</url>
      <content type="html"><![CDATA[<h1 id="how-to-build-tinycorelinux-docker-image"><a href="#how-to-build-tinycorelinux-docker-image" class="headerlink" title="how to build tinycorelinux docker image"></a>how to build tinycorelinux docker image</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http://tinycorelinux.net/6.x/x86_64/release/distribution_files/corepure64.gz</span><br><span class="line">mkdir chroot</span><br><span class="line">gunzip corepure64.gz</span><br><span class="line">cd chroot/</span><br><span class="line">cpio -i &lt; ../corepure64</span><br><span class="line">cd ..</span><br><span class="line">tar -C chroot -c . | docker import - tinycorelinux</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to configure httpd proxy with authentication]]></title>
      <url>http://blog.wuliwala.net/2015/12/02/how-to-configure-httpd-proxy-with-authentication/</url>
      <content type="html"><![CDATA[<h1 id="how-to-configure-httpd-proxy-with-authentication"><a href="#how-to-configure-httpd-proxy-with-authentication" class="headerlink" title="how to configure httpd proxy with authentication"></a>how to configure httpd proxy with authentication</h1><p><code>vi gen.php</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo base64_encode(&quot;user:password&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p><code>php gen.php</code><br><code>dXNlcjpwYXNzd29yZA==</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RewriteEngine On</span><br><span class="line">RewriteRule ^/orin/(.*)$    http://target.lb.com/$1   [NC,L,P]</span><br><span class="line"></span><br><span class="line">&lt;LocationMatch &quot;^/orin/(.*)$&quot;&gt;</span><br><span class="line">    #AddDefaultCharset GBK</span><br><span class="line">    RequestHeader set Authorization &quot;dXNlcjpwYXNzd29yZA==&quot;</span><br><span class="line">    ProxyPass http://target.lb.com/$1</span><br><span class="line">&lt;/LocationMatch&gt;</span><br></pre></td></tr></table></figure>
<h2 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h2><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_headers.html" target="_blank" rel="external">mod_headers</a><br><a href="https://httpd.apache.org/docs/2.4/rewrite/flags.html#flag_p" target="_blank" rel="external">rewrite flags</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassreverse" target="_blank" rel="external">mod_proxy.html</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to configure httpd with ldap authentication]]></title>
      <url>http://blog.wuliwala.net/2015/12/01/how-to-configure-httpd-with-ldap-authentication/</url>
      <content type="html"><![CDATA[<h1 id="how-to-configure-httpd-with-ldap-authentication"><a href="#how-to-configure-httpd-with-ldap-authentication" class="headerlink" title="how to configure httpd with ldap authentication"></a>how to configure httpd with ldap authentication</h1><h2 id="httpd-2-4-ldap"><a href="#httpd-2-4-ldap" class="headerlink" title="httpd 2.4 ldap"></a>httpd 2.4 ldap</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LoadModule authn_core_module modules/mod_authn_core.so</span><br><span class="line">LoadModule authz_host_module modules/mod_authz_host.so</span><br><span class="line">LoadModule authz_user_module modules/mod_authz_user.so</span><br><span class="line">LoadModule authz_core_module modules/mod_authz_core.so</span><br><span class="line">LoadModule access_compat_module modules/mod_access_compat.so</span><br><span class="line">LoadModule auth_basic_module modules/mod_auth_basic.so</span><br><span class="line">LoadModule ldap_module modules/mod_ldap.so</span><br><span class="line">LoadModule authnz_ldap_module modules/mod_authnz_ldap.so</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:*&gt;</span><br><span class="line">ProxyPass / http://elk-kibana:5601/</span><br><span class="line">ProxyPassReverse / http://elk-kibana:5601/</span><br><span class="line"></span><br><span class="line">&lt;Proxy *&gt;</span><br><span class="line">Require all granted</span><br><span class="line"></span><br><span class="line"># LDAPSharedCacheSize 500000</span><br><span class="line"># LDAPCacheEntries 1024</span><br><span class="line"># LDAPCacheTTL 600</span><br><span class="line"># LDAPOpCacheEntries 1024</span><br><span class="line"># LDAPOpCacheTTL 600</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName &quot;Login with LDAP&quot;</span><br><span class="line">AuthBasicProvider ldap</span><br><span class="line">AuthLDAPURL &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;</span><br><span class="line">AuthLDAPBindDN &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;</span><br><span class="line">AuthLDAPBindPassword &lt;PUT Operator&apos;s PASSWORD HERE&gt;</span><br><span class="line">require valid-user</span><br><span class="line">&lt;/Proxy&gt; </span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<h3 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h3><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_ldap.html" target="_blank" rel="external">mod_ldap</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_authnz_ldap.html" target="_blank" rel="external">mod_authnz_ldap</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[how to configure nginx with ldap authentication]]></title>
      <url>http://blog.wuliwala.net/2015/12/01/how-to-configure-nginx-with-ldap-authentication/</url>
      <content type="html"><![CDATA[<h1 id="how-to-configure-nginx-with-ldap-authentication"><a href="#how-to-configure-nginx-with-ldap-authentication" class="headerlink" title="how to configure nginx with ldap authentication"></a>how to configure nginx with ldap authentication</h1><h2 id="build-from-source"><a href="#build-from-source" class="headerlink" title="build from source"></a>build from source</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">version=&apos;1.8.0&apos;</span><br><span class="line"></span><br><span class="line">apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</span><br><span class="line"></span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line">wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">wget http://nginx.org/download/nginx-$&#123;version&#125;.tar.gz</span><br><span class="line">tar xvf nginx-$&#123;version&#125;.tar.gz &amp;&amp; cd nginx-$&#123;version&#125;</span><br><span class="line"></span><br><span class="line">./configure \</span><br><span class="line">--prefix=/etc/nginx \</span><br><span class="line">--sbin-path=/usr/sbin/nginx \</span><br><span class="line">--conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">--error-log-path=/var/log/nginx/error.log \</span><br><span class="line">--http-log-path=/var/log/nginx/access.log \</span><br><span class="line">--pid-path=/var/run/nginx.pid \</span><br><span class="line">--lock-path=/var/run/nginx.lock \</span><br><span class="line">--http-client-body-temp-path=/var/cache/nginx/client_temp \</span><br><span class="line">--http-proxy-temp-path=/var/cache/nginx/proxy_temp \</span><br><span class="line">--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</span><br><span class="line">--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</span><br><span class="line">--http-scgi-temp-path=/var/cache/nginx/scgi_temp \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_addition_module \</span><br><span class="line">--with-http_sub_module \</span><br><span class="line">--with-http_dav_module \</span><br><span class="line">--with-http_flv_module \</span><br><span class="line">--with-http_mp4_module \</span><br><span class="line">--with-http_gunzip_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-http_random_index_module \</span><br><span class="line">--with-http_secure_link_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_auth_request_module \</span><br><span class="line">--with-mail \</span><br><span class="line">--with-mail_ssl_module \</span><br><span class="line">--with-file-aio \</span><br><span class="line">--with-http_spdy_module \</span><br><span class="line">--with-ipv6 \</span><br><span class="line">--add-module=../nginx-auth-ldap-master</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM debian:jessie</span><br><span class="line"># bugs here https://github.com/kvspb/nginx-auth-ldap/issues/88</span><br><span class="line"># nginx: [emerg] http_auth_ldap: parse_require in /etc/nginx/nginx.conf:45</span><br><span class="line"># nginx: [emerg] http_auth_ldap: Setting group in /etc/nginx/nginx.conf:45</span><br><span class="line">MAINTAINER Arkii &quot;sqy6@163.com&quot;</span><br><span class="line"></span><br><span class="line">RUN echo &apos;Asia/Shanghai&apos; &gt; /etc/timezone &amp;&amp; \</span><br><span class="line">    /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</span><br><span class="line">    groupadd -g 396 nginx &amp;&amp; \</span><br><span class="line">    useradd nginx -u 396 -g 396 -M -c &apos;Nginx web server&apos; -s /sbin/nologin -d /var/lib/nginx &amp;&amp; \</span><br><span class="line">    mkdir -p /var/log/nginx /var/lib/nginx /var/cache/nginx /usr/share/nginx &amp;&amp; \</span><br><span class="line">    chown -R nginx:nginx /var/log/nginx /var/lib/nginx /var/cache/nginx &amp;&amp; \</span><br><span class="line">    ln -sf /dev/stdout /var/log/nginx/access.log &amp;&amp; \</span><br><span class="line">    ln -sf /dev/stderr /var/log/nginx/error.log</span><br><span class="line"></span><br><span class="line">ENV NGINX_VERSION 1.8.0</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; \</span><br><span class="line">    apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</span><br><span class="line"></span><br><span class="line">RUN mkdir /tmp/build &amp;&amp; cd /tmp/build &amp;&amp; \</span><br><span class="line">    wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip &amp;&amp; \</span><br><span class="line">    unzip master.zip &amp;&amp; \</span><br><span class="line">    wget http://nginx.org/download/nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; \</span><br><span class="line">    tar xf nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; cd nginx-$&#123;NGINX_VERSION&#125; &amp;&amp; \</span><br><span class="line"></span><br><span class="line">    ./configure \</span><br><span class="line">    --prefix=/etc/nginx \</span><br><span class="line">    --sbin-path=/usr/sbin/nginx \</span><br><span class="line">    --conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">    --error-log-path=/var/log/nginx/error.log \</span><br><span class="line">    --http-log-path=/var/log/nginx/access.log \</span><br><span class="line">    --pid-path=/var/run/nginx.pid \</span><br><span class="line">    --lock-path=/var/run/nginx.lock \</span><br><span class="line">    --http-client-body-temp-path=/var/cache/nginx/client_temp \</span><br><span class="line">    --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</span><br><span class="line">    --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</span><br><span class="line">    --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</span><br><span class="line">    --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</span><br><span class="line">    --user=nginx \</span><br><span class="line">    --group=nginx \</span><br><span class="line">    --with-http_ssl_module \</span><br><span class="line">    --with-http_realip_module \</span><br><span class="line">    --with-http_addition_module \</span><br><span class="line">    --with-http_sub_module \</span><br><span class="line">    --with-http_dav_module \</span><br><span class="line">    --with-http_flv_module \</span><br><span class="line">    --with-http_mp4_module \</span><br><span class="line">    --with-http_gunzip_module \</span><br><span class="line">    --with-http_gzip_static_module \</span><br><span class="line">    --with-http_random_index_module \</span><br><span class="line">    --with-http_secure_link_module \</span><br><span class="line">    --with-http_stub_status_module \</span><br><span class="line">    --with-http_auth_request_module \</span><br><span class="line">    --with-mail \</span><br><span class="line">    --with-mail_ssl_module \</span><br><span class="line">    --with-file-aio \</span><br><span class="line">    --with-http_spdy_module \</span><br><span class="line">    --with-ipv6 \</span><br><span class="line">    --add-module=../nginx-auth-ldap-master &amp;&amp; \</span><br><span class="line"></span><br><span class="line">    make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">RUN apt-get remove -y gcc wget make unzip &amp;&amp; \</span><br><span class="line">       rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">EXPOSE 80 443 8000 8080</span><br><span class="line">ENTRYPOINT [&quot;nginx&quot;]</span><br><span class="line">CMD [&quot;-g&quot;, &quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="configfile-example"><a href="#configfile-example" class="headerlink" title="configfile example"></a>configfile example</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"># user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"># error_log  logs/error.log;</span><br><span class="line"># error_log  logs/error.log  notice;</span><br><span class="line"># error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"># pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    auth_ldap_cache_enabled on;</span><br><span class="line">    auth_ldap_cache_expiration_time 10000;</span><br><span class="line">    auth_ldap_cache_size 1000;</span><br><span class="line">    ldap_server ad_1 &#123;</span><br><span class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</span><br><span class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</span><br><span class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</span><br><span class="line">      #connect_timeout 5s;</span><br><span class="line">      #bind_timeout 5s;</span><br><span class="line">      #request_timeout 5s;</span><br><span class="line">      group_attribute member;</span><br><span class="line">      group_attribute_is_dn on;</span><br><span class="line">      satisfy any;</span><br><span class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    ldap_server ad_2 &#123;</span><br><span class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</span><br><span class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</span><br><span class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</span><br><span class="line">      #connect_timeout 5s;</span><br><span class="line">      #bind_timeout 5s;</span><br><span class="line">      #request_timeout 5s;</span><br><span class="line">      group_attribute member;</span><br><span class="line">      group_attribute_is_dn on;</span><br><span class="line">      satisfy any;</span><br><span class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        auth_ldap &quot;Login with LDAP account&quot;;</span><br><span class="line">        auth_ldap_servers ad_1;</span><br><span class="line">        auth_ldap_servers ad_2;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="image-on-Docker-hub"><a href="#image-on-Docker-hub" class="headerlink" title="image on Docker hub"></a>image on Docker hub</h2><p><code>docker pull docker.io/arkii/nginx-ldap:1.8.0</code></p>
<p><a href="https://github.com/kvspb/nginx-auth-ldap" target="_blank" rel="external">github</a><br><a href="http://deezx.github.io/blog/2015/04/24/how-to-configure-nginx-with-ldap-authentication/" target="_blank" rel="external">blog</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[When A Man Loves A Woman]]></title>
      <url>http://blog.wuliwala.net/2015/11/27/when-a-man-loves-a-woman/</url>
      <content type="html"><![CDATA[<h1 id="When-A-Man-Loves-A-Woman"><a href="#When-A-Man-Loves-A-Woman" class="headerlink" title="When A Man Loves A Woman"></a>When A Man Loves A Woman</h1><p>作词 : Calvin Lewis/Andrew Wright<br>原唱 : Percy Sledge<br>翻唱 : Michael Bolton, 金润吉<br>当一个男人爱上一个女人<br>他的脑子就再也装不下任何东西<br>他宁愿出卖整个世界<br>就为了他寻得的挚爱<br>如果她很坏，他也看不到<br>她不会错<br>他甚至会背弃最好的朋友<br>如果朋友敢轻视她  </p>
<p>当一个男人爱上一个女人<br>会花光他的每一分<br>来维持他所需要的<br>他愿意放弃所有安逸<br>露宿街头 睡在雨中<br>如果她说就该做这些事  </p>
<p>当一个男人爱上一个女人<br>他会献出自己的所有<br>试图保住 这份宝贵的爱<br>宝贝请别忽视我  </p>
<p>当一个男人爱上一个女人<br>他的灵魂深处<br>她能使他痛苦如斯<br>如果她玩弄他如一个傻瓜<br>他也永远后知后觉<br>陷入爱河的人总是盲目  </p>
<p>是的当一个男人爱上一个女人<br>我完全了解他的心思  </p>
<p>当一个男人爱上一个女人  </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[给gitlab添加gitlab-ci和gitlab-runner]]></title>
      <url>http://blog.wuliwala.net/2015/11/19/gitlab-ci-and-runner/</url>
      <content type="html"><![CDATA[<h1 id="给gitlab添加gitlab-ci和gitlab-runner"><a href="#给gitlab添加gitlab-ci和gitlab-runner" class="headerlink" title="给gitlab添加gitlab-ci和gitlab-runner"></a>给gitlab添加gitlab-ci和gitlab-runner</h1><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>使用的是<strong>gitlab v7.13.3</strong>。<br>run在docker中。<br>配置了ldap登录，和smtp邮件通知。<strong>失败时会发送邮件通知</strong><br>最近测试gitlab-ci服务。  </p>
<h3 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置:"></a>服务配置:</h3><p>直接在配置文件gitlab.rb底部打开相关配置，即可使用。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">############################################</span><br><span class="line"># Url on which GitLab CI will be reachable #</span><br><span class="line">############################################</span><br><span class="line">## see https://gitlab.com/gitlab-org/omnibus-gitlab/tree/629def0a7a26e7c2326566f0758d4a27857b52a3/doc/gitlab-ci/README.md</span><br><span class="line"></span><br><span class="line">ci_external_url &apos;http://ci.gitlab.yourdomain.com&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line"># application.yml configuration #</span><br><span class="line">#################################</span><br><span class="line"># 这个app_id在gitlab中创建application后获得</span><br><span class="line">gitlab_ci[&apos;gitlab_server&apos;] = &#123; &quot;url&quot; =&gt; &apos;http://gitlab.yourdomain.com&apos;, &quot;app_id&quot; =&gt; &apos;xxxxxxxxxxxx&apos;, &quot;app_se</span><br><span class="line">cret&quot; =&gt; &apos;yyyyyyyyyyyyyyy&apos; &#125;</span><br><span class="line"></span><br><span class="line">gitlab_ci[&apos;gitlab_ci_email_from&apos;] = &apos;gitlab@yourdomain.com&apos;</span><br><span class="line">gitlab_ci[&apos;gitlab_ci_support_email&apos;] = &apos;sysop@yourdomain.com&apos;</span><br><span class="line">gitlab_ci[&apos;gitlab_ci_all_broken_builds&apos;] = true</span><br><span class="line">gitlab_ci[&apos;gitlab_ci_add_pusher&apos;] = true</span><br><span class="line">gitlab_ci[&apos;builds_directory&apos;] = &apos;/var/opt/gitlab/gitlab-ci/builds&apos;</span><br><span class="line"></span><br><span class="line">gitlab_ci[&apos;gravatar_enabled&apos;] = false</span><br><span class="line"># gitlab_ci[&apos;gravatar_plain_url&apos;] = &quot;http://www.gravatar.com/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=mm&quot;</span><br><span class="line"># gitlab_ci[&apos;gravatar_ssl_url&apos;] =  &quot;https://secure.gravatar.com/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=mm&quot;</span><br><span class="line"></span><br><span class="line">## For setting up backups</span><br><span class="line">## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/README.md#backups</span><br><span class="line"></span><br><span class="line">gitlab_ci[&apos;backup_path&apos;] = &quot;/var/opt/gitlab/ci-backups&quot;</span><br><span class="line"># gitlab_ci[&apos;backup_keep_time&apos;] = 604800</span><br><span class="line"># gitlab_ci[&apos;backup_upload_connection&apos;] = &#123;</span><br><span class="line">#   &apos;provider&apos; =&gt; &apos;AWS&apos;,</span><br><span class="line">#   &apos;region&apos; =&gt; &apos;eu-west-1&apos;,</span><br><span class="line">#   &apos;aws_access_key_id&apos; =&gt; &apos;AKIAKIAKI&apos;,</span><br><span class="line">#   &apos;aws_secret_access_key&apos; =&gt; &apos;secret123&apos;</span><br><span class="line"># &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="配置gitlab-runner"><a href="#配置gitlab-runner" class="headerlink" title="配置gitlab-runner"></a>配置gitlab-runner</h4><p>PS:新版本gitlab-runner从ruby改为go语言实现，名字为gitlab-ci-multi-runner，软链接为gitlab-runner<br>官方文档:<a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/docker.md" target="_blank" rel="external">Run gitlab-runner in a container</a><br>启动gitlab-runner服务<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -d --name gitlab-runner --restart always \</span><br><span class="line">  -v /srv/gitlab-runner/config:/etc/gitlab-runner \</span><br><span class="line">  gitlab/gitlab-runner:latest</span><br></pre></td></tr></table></figure></p>
<p>也可以用官方的另一个实现：<br><figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">gitlab/gitlab-runner    latest              <span class="number">3</span>e<span class="number">8077e209f5</span>        <span class="number">13</span> hours ago        <span class="number">304</span>.<span class="number">3</span> MB</span><br><span class="line">gitlab/gitlab-runner    alpine              <span class="number">7</span>c431ac8f30f        <span class="number">13</span> hours ago        <span class="number">25</span>.<span class="number">98</span> MB</span><br></pre></td></tr></table></figure></p>
<p><strong>注册runner</strong><br><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">docker exec -it gitlab-runner gitlab-runner register</span><br><span class="line"></span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> coordinator URL (<span class="keyword">e</span>.<span class="keyword">g</span>. https:<span class="comment">//gitlab.com/ci):</span></span><br><span class="line">http:<span class="comment">//ci.gitlab.yourdomain.com/</span></span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> <span class="keyword">token</span> <span class="keyword">for</span> this runner:</span><br><span class="line"># 这个<span class="keyword">token</span>在gitlab-<span class="keyword">ci</span>中Runners选项卡获得</span><br><span class="line">e0ab42c98fff06b3dd4f3d4c776bc4</span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> description <span class="keyword">for</span> this runner:</span><br><span class="line">[3366d1121148]: <span class="keyword">test</span>-<span class="keyword">ci</span></span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">delpoy</span><br><span class="line">INFO[0086] e0ab42c9 Registering runner... succeeded                    </span><br><span class="line">Please enter the executor: ssh, <span class="keyword">shell</span>, parallels, docker, docker-ssh:</span><br><span class="line">[]: <span class="keyword">shell</span></span><br><span class="line">INFO[0097] Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it's running already the config should be automatically reloaded!</span><br></pre></td></tr></table></figure></p>
<p><strong>注册成功后，查看生成的配置文件</strong><br><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat  /srv/gitlab-runner/config/config.toml </span></span><br><span class="line"><span class="attr">concurrent</span> = <span class="number">1</span></span><br><span class="line">[[runners]]</span><br><span class="line">  <span class="attr">url</span> = <span class="string">"http://ci.gitlab.yourdomain.com/"</span></span><br><span class="line">  <span class="attr">token</span> = <span class="string">"c87c7ad883af316b7d173c1094c6fe"</span></span><br><span class="line">  <span class="attr">name</span> = <span class="string">"test-ci"</span></span><br><span class="line">  <span class="attr">executor</span> = <span class="string">"shell"</span></span><br><span class="line">  [runners.ssh]</span><br><span class="line">  [runners.docker]</span><br><span class="line">    <span class="attr">image</span> = <span class="string">""</span></span><br><span class="line">    <span class="attr">privileged</span> = <span class="literal">false</span></span><br><span class="line">  [runners.parallels]</span><br><span class="line">    <span class="attr">base_name</span> = <span class="string">""</span></span><br></pre></td></tr></table></figure></p>
<p><strong>debug:</strong><br><code>docker logs -f gitlab-runner</code><br><code>docker exec -it gitlab-runner gitlab-runner --help</code></p>
<h4 id="使用gitlab-ci"><a href="#使用gitlab-ci" class="headerlink" title="使用gitlab-ci"></a>使用gitlab-ci</h4><p>打开<a href="http://ci.gitlab.yourdomain.com" target="_blank" rel="external">http://ci.gitlab.yourdomain.com</a> ，会跳转到<a href="http://gitlab.yourdomain.com去做验证，然后跳回。" target="_blank" rel="external">http://gitlab.yourdomain.com去做验证，然后跳回。</a><br>选择一个需要CI的项目，点击”Add project to CI”。</p>
<p>#####.gitlab-ci.yml配置:<br>在项目中添加.gitlab-ci.yml文件，然后push到gitlab<br><code>git add . ; git commit -m &#39;test&#39; ; git push</code><br><strong>注意：有坑！如果按照官方最新文档的话，会构建失败，因为句法有变化，可用下面这个链接在线验证配置文件。</strong><br><a href="http://ci.gitlab.yourdomain.com/lint" target="_blank" rel="external">在线编辑器</a></p>
<p>下面是一个栗子</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">staging:</span><br><span class="line">  type: deploy</span><br><span class="line">  script:</span><br><span class="line">  - echo &apos;deploy to test env&apos; &gt;&gt; /tmp/test-ci.log</span><br><span class="line">  - echo &quot;CI:$CI CI_SERVER:$CI_SERVER CI_SERVER_NAME:$CI_SERVER_NAME GITLAB_CI:$GITLAB_CI CI_SERVER_VERSION:$CI_SERVER_VERSION CI_SERVER_REVISION:$CI_SERVER_REVISION CI_BUILD_REF:$CI_BUILD_REF CI_BUILD_BEFORE_SHA:$CI_BUILD_BEFORE_SHA  CI_BUILD_REF_NAME:$CI_BUILD_REF_NAME CI_BUILD_ID:$CI_BUILD_ID CI_BUILD_REPO:$CI_BUILD_REPO CI_PROJECT_DIR:$CI_PROJECT_DIR&quot; &gt;&gt;/tmp/test-ci.log</span><br><span class="line">#  only:</span><br><span class="line">#  - master</span><br><span class="line"></span><br><span class="line">production:</span><br><span class="line">  type: deploy</span><br><span class="line">  script:</span><br><span class="line">  - echo &apos;deploy to production env&apos;  &gt;&gt; /tmp/test-ci.log</span><br><span class="line">  - echo &quot;CI:$CI CI_SERVER:$CI_SERVER CI_SERVER_NAME:$CI_SERVER_NAME GITLAB_CI:$GITLAB_CI CI_SERVER_VERSION:$CI_SERVER_VERSION CI_SERVER_REVISION:$CI_SERVER_REVISION CI_BUILD_REF:$CI_BUILD_REF CI_BUILD_BEFORE_SHA:$CI_BUILD_BEFORE_SHA  CI_BUILD_REF_NAME:$CI_BUILD_REF_NAME CI_BUILD_ID:$CI_BUILD_ID CI_BUILD_REPO:$CI_BUILD_REPO CI_PROJECT_DIR:$CI_PROJECT_DIR&quot; &gt;&gt;/tmp/test-ci.log</span><br><span class="line">  only:</span><br><span class="line">  - tags</span><br><span class="line">  # except:</span><br><span class="line">  #   - stable</span><br><span class="line">  #   - /^deploy-.*$/</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta"># cat /tmp/test-ci.log</span></span><br><span class="line">deploy to test env</span><br><span class="line">CI:<span class="literal">true</span> <span class="built_in">CI_SERVER</span>:yes <span class="built_in">CI_SERVER_NAME</span>:GitLab CI GITLAB_CI:<span class="literal">true</span> <span class="built_in">CI_SERVER_VERSION</span>: <span class="built_in">CI_SERVER_REVISION</span>: <span class="built_in">CI_BUILD_REF</span>:<span class="number">66</span>b8d99e51ff39e98629068bb5e9ef302288e899 <span class="built_in">CI_BUILD_BEFORE_SHA</span>:b7c8b5d458375902426bb0777da3c0ddf553f308  <span class="built_in">CI_BUILD_REF_NAME</span>:my-dev <span class="built_in">CI_BUILD_ID</span>:<span class="number">9</span> <span class="built_in">CI_BUILD_REPO</span>:http:<span class="comment">//gitlab-ci-token:e0ab42c98fff06b3dd4f3d4c776bc4@gitlab.yourdomain.com/arkii/test-ci.git CI_PROJECT_DIR:builds/53b58d35/0/arkii/test-ci</span></span><br><span class="line">deploy to production env</span><br><span class="line">CI:<span class="literal">true</span> <span class="built_in">CI_SERVER</span>:yes <span class="built_in">CI_SERVER_NAME</span>:GitLab CI GITLAB_CI:<span class="literal">true</span> <span class="built_in">CI_SERVER_VERSION</span>: <span class="built_in">CI_SERVER_REVISION</span>: <span class="built_in">CI_BUILD_REF</span>:<span class="number">66</span>b8d99e51ff39e98629068bb5e9ef302288e899 <span class="built_in">CI_BUILD_BEFORE_SHA</span>:b7c8b5d458375902426bb0777da3c0ddf553f308  <span class="built_in">CI_BUILD_REF_NAME</span>:my-dev <span class="built_in">CI_BUILD_ID</span>:<span class="number">10</span> <span class="built_in">CI_BUILD_REPO</span>:http:<span class="comment">//gitlab-ci-token:e0ab42c98fff06b3dd4f3d4c776bc4@gitlab.yourdomain.com/arkii/test-ci.git CI_PROJECT_DIR:builds/0c3c27e4/0/arkii/test-ci</span></span><br></pre></td></tr></table></figure>
<p>#####看到这些变量的输出，大家有思路该怎么玩了吗？</p>
<p>官方文档<a href="https://gitlab.com/gitlab-org/gitlab-ci/blob/7-13-stable/doc/builds_configuration/README.md" target="_blank" rel="external">Configuration of your builds with .gitlab-ci.yml</a><br>特别重要的说明<a href="https://gitlab.com/gitlab-org/gitlab-ci/blob/7-13-stable/doc/examples/README.md" target="_blank" rel="external">官方说明</a><br><strong>How your build script is run</strong></p>
<p>The runner runs the line below before it runs the commands in your build script:<br><code>cd /gitlab-ci-runner/tmp/builds &amp;&amp; git clone git@gitlab_server_fqdn:group/project.git project-1 &amp;&amp; cd project-1 &amp;&amp; git checkout master</code><br><strong>Build script example</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bundle install</span><br><span class="line">bundle <span class="built_in">exec</span> rake db:create RAILS_ENV=<span class="built_in">test</span></span><br><span class="line">bundle <span class="built_in">exec</span> rake db:migrate RAILS_ENV=<span class="built_in">test</span></span><br><span class="line">script/run_all_tests</span><br></pre></td></tr></table></figure>
<p><strong>Environmental variables</strong></p>
<p>The runner sets the following environmental variables:<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">CI=<span class="literal">true</span></span><br><span class="line"><span class="built_in">CI_SERVER</span>=<span class="literal">true</span></span><br><span class="line"><span class="built_in">CI_SERVER_NAME</span>=GitLab CI</span><br><span class="line">GITLAB_CI=<span class="literal">true</span></span><br><span class="line"><span class="built_in">CI_SERVER_VERSION</span></span><br><span class="line"><span class="built_in">CI_SERVER_REVISION</span></span><br><span class="line"><span class="built_in">CI_BUILD_REF</span></span><br><span class="line"><span class="built_in">CI_BUILD_BEFORE_SHA</span></span><br><span class="line"><span class="built_in">CI_BUILD_REF_NAME</span> (branch)</span><br><span class="line"><span class="built_in">CI_BUILD_ID</span></span><br><span class="line"><span class="built_in">CI_BUILD_REPO</span></span><br><span class="line"><span class="built_in">CI_PROJECT_DIR</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[aliyunEC云主机磁盘安全扩容]]></title>
      <url>http://blog.wuliwala.net/2015/11/19/aliyun-disk-growth-online/</url>
      <content type="html"><![CDATA[<p>云主机磁盘（块设备），实际是虚拟文件，当磁盘空间不够时，可以在云服务提供商后台增加磁盘容量，下面是用户需要做的操作。  </p>
<ul>
<li>系统版本：CentOS6</li>
<li>数据盘文件系统：xfs</li>
<li>数据盘挂载点：/mount_point</li>
<li>数据盘设备名：/dev/xvdb</li>
<li>当前容量: <code>df -lh</code><br><code>/dev/xvdb1       27G   23G  4.0G  85% /mount_point</code></li>
<li>扩容后容量：</li>
</ul>
<h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ul>
<li>停止服务 <code>service nginx stop</code></li>
<li>查看是否有其他程序正在打开分区<code>lsof /mount_point</code></li>
<li>umount分区 <code>umount /mount_point</code></li>
<li><p>查看磁盘信息，可看到这块盘已经是100GB大小，但是系统还不能使用。</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line"># fdisl -l /dev/xvdb</span><br><span class="line">Disk /dev/xvdb: <span class="number">107</span>.<span class="number">4</span> GB, <span class="number">107374182400</span> bytes, <span class="number">209715200</span>     sectors</span><br><span class="line">Device       Start      End         Blocks     Id  System</span><br><span class="line">/dev/xvdb1   <span class="number">7999488</span>    <span class="number">62914559</span>    <span class="number">27457536</span>   <span class="number">83</span>  Linux</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改分区表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># fdisk /dev/xvdb</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m for <span class="keyword">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: <span class="number">107.4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes</span>, <span class="number">209715200</span> sectors</span><br><span class="line">Units = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disk label <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device Boot      <span class="keyword">Start</span>         <span class="keyword">End</span>      Blocks   <span class="keyword">Id</span>  <span class="keyword">System</span></span><br><span class="line">/dev/xvdb1         <span class="number">7999488</span>    <span class="number">62914559</span>    <span class="number">27457536</span>   <span class="number">83</span>  Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): d</span><br><span class="line">Selected <span class="keyword">partition</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">Partition</span> <span class="number">1</span> <span class="keyword">is</span> deleted</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: <span class="number">107.4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes</span>, <span class="number">209715200</span> sectors</span><br><span class="line">Units = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disk label <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device Boot      <span class="keyword">Start</span>         <span class="keyword">End</span>      Blocks   <span class="keyword">Id</span>  <span class="keyword">System</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): n</span><br><span class="line"><span class="keyword">Partition</span> <span class="keyword">type</span>:</span><br><span class="line">   p   primary (<span class="number">0</span> primary, <span class="number">0</span> <span class="keyword">extended</span>, <span class="number">4</span> free)</span><br><span class="line">   e   <span class="keyword">extended</span></span><br><span class="line"><span class="keyword">Select</span> (<span class="keyword">default</span> p): p</span><br><span class="line"><span class="keyword">Partition</span> <span class="built_in">number</span> (<span class="number">1</span><span class="number">-4</span>, <span class="keyword">default</span> <span class="number">1</span>): </span><br><span class="line"><span class="keyword">First</span> sector (<span class="number">2048</span><span class="number">-209715199</span>, <span class="keyword">default</span> <span class="number">2048</span>): <span class="number">7999488</span></span><br><span class="line"><span class="keyword">Last</span> sector, +sectors <span class="keyword">or</span> +<span class="keyword">size</span>&#123;K,M,G&#125; (<span class="number">7999488</span><span class="number">-209715199</span>, <span class="keyword">default</span> <span class="number">209715199</span>): </span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">default</span> <span class="keyword">value</span> <span class="number">209715199</span></span><br><span class="line"><span class="keyword">Partition</span> <span class="number">1</span> <span class="keyword">of</span> <span class="keyword">type</span> Linux <span class="keyword">and</span> <span class="keyword">of</span> <span class="keyword">size</span> <span class="number">96.2</span> GiB <span class="keyword">is</span> <span class="keyword">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: <span class="number">107.4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes</span>, <span class="number">209715200</span> sectors</span><br><span class="line">Units = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disk label <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device Boot      <span class="keyword">Start</span>         <span class="keyword">End</span>      Blocks   <span class="keyword">Id</span>  <span class="keyword">System</span></span><br><span class="line">/dev/xvdb1         <span class="number">7999488</span>   <span class="number">209715199</span>   <span class="number">100857856</span>   <span class="number">83</span>  Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): wq</span><br><span class="line">The <span class="keyword">partition</span> <span class="keyword">table</span> has been altered!</span><br><span class="line"></span><br><span class="line"><span class="keyword">Calling</span> ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> <span class="keyword">partition</span> <span class="keyword">table</span>.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看修改结果</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"># fdisk -l /dev/xvdb</span><br><span class="line"><span class="symbol">Disk</span> /dev/xvdb: <span class="number">107</span>.<span class="number">4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes, </span><span class="number">209715200</span> sectors</span><br><span class="line"><span class="symbol">Units</span> = sectors of <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Sector</span> size (logical/physical): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span>I/O size (minimum/optimal): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Disk</span> label type: dos</span><br><span class="line"><span class="symbol">Disk</span> identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device <span class="keyword">Boot </span>     Start         <span class="meta">End</span>      <span class="keyword">Blocks </span>  Id  System</span><br><span class="line">/dev/xvdb1         <span class="number">7999488</span>   <span class="number">209715199</span>   <span class="number">100857856</span>   <span class="number">83</span>  Linux</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用xfs_growfs命令对xfs文件系统进行扩容</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="comment"># xfs_growfs /dev/xvdb1 </span></span><br><span class="line"><span class="attr">meta-data=/dev/xvdb1</span>             <span class="attr">isize=256</span>    <span class="attr">agcount=4,</span> <span class="attr">agsize=1716096</span> <span class="attr">blks</span></span><br><span class="line">         =                       <span class="attr">sectsz=512</span>   <span class="attr">attr=2,</span> <span class="attr">projid32bit=0</span></span><br><span class="line">         =                       <span class="attr">crc=0</span></span><br><span class="line"><span class="attr">data</span>     =                       <span class="attr">bsize=4096</span>   <span class="attr">blocks=6864384,</span> <span class="attr">imaxpct=25</span></span><br><span class="line">         =                       <span class="attr">sunit=0</span>      <span class="attr">swidth=0</span> blks</span><br><span class="line"><span class="attr">naming</span>   =version <span class="number">2</span>              <span class="attr">bsize=4096</span>   <span class="attr">ascii-ci=0</span> <span class="attr">ftype=0</span></span><br><span class="line"><span class="attr">log</span>      =internal               <span class="attr">bsize=4096</span>   <span class="attr">blocks=3351,</span> <span class="attr">version=2</span></span><br><span class="line">         =                       <span class="attr">sectsz=512</span>   <span class="attr">sunit=0</span> blks, <span class="attr">lazy-count=1</span></span><br><span class="line"><span class="attr">realtime</span> =none                   <span class="attr">extsz=4096</span>   <span class="attr">blocks=0,</span> <span class="attr">rtextents=0</span></span><br><span class="line">data blocks changed from <span class="number">6864384</span> to <span class="number">25214464</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>挂载分区<code># mount -a</code></p>
</li>
<li>查看目前可用空间<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># df -lh</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted <span class="keyword">on</span></span><br><span class="line">/dev/xvdb1       <span class="number">97</span>G   <span class="number">23</span>G   <span class="number">74</span>G  <span class="number">24</span>% /mount_point</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="http://bbs.aliyun.com/read/239398.html" target="_blank" rel="external">aliyun磁盘原地扩容官方说明</a></p>
<p><a href="http://help.aliyun.com/document_detail/ecs/operation-guide/disk-operation/resize.html" target="_blank" rel="external">aliyun磁盘原地扩容官方操作说明</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2/nagios 分级通知]]></title>
      <url>http://blog.wuliwala.net/2015/09/22/icinga2-escalation-notification/</url>
      <content type="html"><![CDATA[<p>icinga是nagios的派生版，但又增加了很多改进，icinga2版本配置文件变化较大。<br>下面是设置分级别通知策略的配置方法。<br>分级通知主要用于 业务负责人员未收到通知的情况通知全体联系人。   </p>
<p>下面的配置解析：<br>出现问题后立刻通知web组管理员，如果15分钟后问题没有得到处理，接下来的30分钟以每5分钟一次的频率再次通知web组管理员；45分钟后问题仍存在，通知所有管理员。</p>
<p><code>vim /etc/icinga2/conf.d/notifications.conf</code>  </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">// <span class="keyword">start</span> <span class="keyword">of</span> escalation notification <span class="keyword">level</span></span><br><span class="line"><span class="keyword">apply</span> Notification <span class="string">"wechat-2nd-level-web"</span> <span class="keyword">to</span> Service &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="string">"wechat-service-notification-template"</span></span><br><span class="line"></span><br><span class="line">  user_groups = [ <span class="string">"admins-web"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="built_in">interval</span> = <span class="number">5</span>m</span><br><span class="line">  times = &#123;</span><br><span class="line">    <span class="keyword">begin</span> = <span class="number">15</span>m</span><br><span class="line">    <span class="keyword">end</span> = <span class="number">45</span>m</span><br><span class="line">  &#125;</span><br><span class="line">  assign <span class="keyword">where</span> service.<span class="keyword">name</span> == <span class="string">"ping4"</span></span><br><span class="line">  assign <span class="keyword">where</span> <span class="keyword">match</span>(<span class="string">"nrpe_disk_read_write"</span>, service.<span class="keyword">name</span>)</span><br><span class="line">&#125;           </span><br><span class="line"><span class="keyword">apply</span> Notification <span class="string">"wechat-1st-level-web"</span> <span class="keyword">to</span> Service &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="string">"wechat-service-notification-template"</span></span><br><span class="line">           </span><br><span class="line">  user_groups = [ <span class="string">"icingaadmins"</span> ]</span><br><span class="line">              </span><br><span class="line">  <span class="built_in">interval</span> = <span class="number">15</span>m</span><br><span class="line">  times = &#123; </span><br><span class="line">    <span class="keyword">begin</span> = <span class="number">45</span>m</span><br><span class="line">    <span class="keyword">end</span> = <span class="number">2</span>h</span><br><span class="line">  &#125; </span><br><span class="line">  assign <span class="keyword">where</span> service.<span class="keyword">name</span> == <span class="string">"ping4"</span></span><br><span class="line">  assign <span class="keyword">where</span> <span class="keyword">match</span>(<span class="string">"nrpe_disk_read_write"</span>, service.<span class="keyword">name</span>)</span><br><span class="line">&#125;   </span><br><span class="line">// <span class="keyword">end</span> <span class="keyword">of</span> escalation notification <span class="keyword">level</span></span><br></pre></td></tr></table></figure>
<h3 id="官方的文档如下"><a href="#官方的文档如下" class="headerlink" title="官方的文档如下"></a>官方的文档如下</h3><p>Similar example for advanced notification apply rule filters: If the service attribute notes contains the has gold support 24x7 string AND one of the two condition passes: Either the customer host custom attribute is set to customer-xy OR the host custom attribute always_notify is set to true.</p>
<p>The notification is ignored for services whose host name ends with *internal OR the priority custom attribute is less than 2.</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">template Notification <span class="string">"cust-xy-notification"</span> &#123;</span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"noc-xy"</span>, <span class="string">"mgmt-xy"</span> ]</span><br><span class="line">  <span class="attr">command</span> = <span class="string">"mail-service-notification"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply Notification <span class="string">"notify-cust-xy-mysql"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"cust-xy-notification"</span></span><br><span class="line"></span><br><span class="line">  assign where match(<span class="string">"*has gold support 24x7*"</span>, service.notes) &amp;&amp; (host.vars.<span class="attr">customer</span> == <span class="string">"customer-xy"</span> || host.vars.<span class="attr">always_notify</span> == <span class="literal">true</span>)</span><br><span class="line">  ignore where match(<span class="string">"*internal"</span>, host.name) || (service.vars.priority &lt; <span class="number">2</span> &amp;&amp; host.vars.<span class="attr">is_clustered</span> == <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If the problem does not get resolved nor acknowledged preventing further notifications the escalation-sms-1st-level user will be escalated 1h after the initial problem was notified, but only for one hour (2h as end key for the times dictionary).  </p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">apply Notification <span class="string">"mail"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = <span class="string">"mail-notification"</span></span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"icingaadmin"</span> ]</span><br><span class="line"></span><br><span class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply Notification <span class="string">"escalation-sms-2nd-level"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = <span class="string">"sms-notification"</span></span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"icinga-oncall-2nd-level"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="attr">times</span> = &#123;</span><br><span class="line">    <span class="attr">begin</span> = <span class="number">30</span>m</span><br><span class="line">    <span class="attr">end</span> = <span class="number">1</span>h</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply Notification <span class="string">"escalation-sms-1st-level"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = <span class="string">"sms-notification"</span></span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"icinga-oncall-1st-level"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="attr">times</span> = &#123;</span><br><span class="line">    <span class="attr">begin</span> = <span class="number">1</span>h</span><br><span class="line">    <span class="attr">end</span> = <span class="number">2</span>h</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/object-types#objecttype-notification" target="_blank" rel="external">官方关于notification定义的文档</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/monitoring-basics#notification-delay" target="_blank" rel="external">官方关于notification配置技巧文档</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ssh注入秘钥要求密码]]></title>
      <url>http://blog.wuliwala.net/2015/09/15/ssh-key-auth-require-password/</url>
      <content type="html"><![CDATA[<p>已经通过kickstart安装过程中注入ssh秘钥的系统，启动后ssh连接的时候仍然要求输入密码。<br>但是再执行一遍ssh-copy-id后，ssh就又能免密码连接。<br>最后确认是selinux问题。<br>解决办法是执行<code>/sbin/restorecon -r /root/.ssh</code><br>安装系统时关闭SELinux，可以在kickstart中增加一行<code>selinux --disabled</code>。<br>已经完整完系统的，可以<code>sed -i -e &#39;/SELINUX/s/enforcing/disabled/&#39; /etc/selinux/config</code> 重启系统来关闭SELinux。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[pnp4nagios数值缩短问题]]></title>
      <url>http://blog.wuliwala.net/2015/09/08/pnp4nagioszi-dong-diao-zheng-shu-zhi/</url>
      <content type="html"><![CDATA[<p>其实就是指定rrdtool的一个参数 –units-exponent 0<br><code>vim /usr/local/pnp4nagios/share/templates/get_cdn_bw_usage.php</code><br><figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"># Plugin: get_cdn_bw_usage</span><br><span class="line"># Output: Last <span class="number">5</span>mins <span class="number">10140.73218</span>Mbp/<span class="keyword">s</span> | data=<span class="number">11040.73218</span>Mbps<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">$opt</span>[<span class="number">1</span>] = <span class="string">" --units-exponent 0 --vertical-label \"</span><span class="built_in">$UNIT</span>[<span class="number">1</span>]\<span class="string">" --title \"</span><span class="built_in">$servicedesc</span>\<span class="string">" "</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>]  = <span class="string">"DEF:var1=$RRDFILE[1]:$DS[1]:AVERAGE "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"AREA:var1#0066FF:\"</span>bandwidth\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:LAST:\"</span>%.<span class="number">5</span>lf <span class="built_in">%s</span><span class="built_in">$UNIT</span>[<span class="number">1</span>] last\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:AVERAGE:\"</span>%.<span class="number">5</span>lf <span class="built_in">%s</span><span class="built_in">$UNIT</span>[<span class="number">1</span>] avg\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:MAX:\"</span>%.<span class="number">5</span>lf <span class="built_in">%s</span><span class="built_in">$UNIT</span>[<span class="number">1</span>] max\\n\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[rsyslog收集本地系统和服务日志到logstash]]></title>
      <url>http://blog.wuliwala.net/2015/09/07/rsyslog-send-locallog-to-logstash/</url>
      <content type="html"><![CDATA[<p>最近做了一个项目，将Linux服务器的系统日志以及服务日志收集到elk。<br>期间从头学习了syslog rsyslog。<br>有几个比较重要的概念: facility, input module。<br>input module使用了imfile，功能为：将文本文件读取到rsyslog。<br>将所有服务软件的日志标记为service，最后使用规则匹配，之后发送到远端logstash服务器。<br>我使用local3作为所有服务软件的facility配置。主要是为了便于日志归集，因为默认情况下读取文件的内容会记录到本机/var/log/messages一份。<br>步骤如下<br>首先增加rsyslog主配置文件:<br><code>sed -i -e &#39;/\/var\/log\/messages/s/^/&amp;local3.none\;/&#39; -e &#39;6a\$ModLoad imfile\n&#39; /etc/rsyslog.conf</code><br><code>echo &quot;if \$programname == &#39;service&#39; then @@elk.zol.com.cn&quot;  &gt;&gt;/etc/rsyslog.conf</code><br>添加Apache错误日志:  </p>
<pre><code>cat &lt;&lt;-&quot;RSYSLOGEOF&quot; &gt;/etc/rsyslog.d/httpd.conf 
$InputFileName /var/log/httpd/error_log
$InputFileStateFile httpd_error.stat
$InputFileTag service:
$InputFileFacility local3
$InputRunFileMonitor
$InputFilePollingInterval 60
RSYSLOGEOF
</code></pre><p>重启rsyslog<br><code>service rsyslog restart</code></p>
<p>然后，如果Apache服务报错，而且已经开启日志记录到/var/log/httpd/error_log，远端kibana界面中就能搜索到。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vmware esxi log server]]></title>
      <url>http://blog.wuliwala.net/2015/08/31/set-esxi-log-server/</url>
      <content type="html"><![CDATA[<p>ESXi client –&gt; Configuration –&gt; Advanced Settings –&gt; Syslog –&gt; Syslog.global.logHost=udp://your-syslog-server:514  </p>
<p>ESXi client –&gt; Configuration –&gt; Security Profile –&gt; Firewall –&gt; Properties –&gt; √ syslog</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[给esxi编译ipmitool]]></title>
      <url>http://blog.wuliwala.net/2015/08/31/compile-tool-for-esxi/</url>
      <content type="html"><![CDATA[<p>vmware 的 ESXi服务器是不带包管理系统的，也不带任何编译工具，所以遇到需要安装软件的情况，需要其他Linux环境来编译跨平台二进制文件。<br>本文主要讲述在CentOS下给ESXi服务器编译ipmitool。<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">yum -y install autoconf make gcc gcc-c++ glibc glibc-<span class="keyword">static</span> glibc-devel libstdc++ libstdc++-devel</span><br><span class="line">wget <span class="string">http:</span><span class="comment">//nchc.dl.sourceforge.net/project/ipmitool/ipmitool/1.8.15/ipmitool-1.8.15.tar.bz2</span></span><br><span class="line">tar xvf ipmitool<span class="number">-1.8</span><span class="number">.15</span>.tar.bz2</span><br><span class="line">cd ipmitool<span class="number">-1.8</span><span class="number">.15</span></span><br><span class="line">./configure CFLAGS=-m32 LDFLAGS=-<span class="keyword">static</span></span><br><span class="line">make -j8</span><br><span class="line">scp src<span class="regexp">/ipmitool root@your-esxi-host-ip:/</span>opt/</span><br></pre></td></tr></table></figure></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt # ./</span>ipmitool mc info</span><br><span class="line">Device <span class="string">ID                 :</span> <span class="number">32</span></span><br><span class="line">Device <span class="string">Revision           :</span> <span class="number">0</span></span><br><span class="line">Firmware <span class="string">Revision         :</span> <span class="number">1.50</span></span><br><span class="line">IPMI <span class="string">Version              :</span> <span class="number">2.0</span></span><br><span class="line">Manufacturer <span class="string">ID           :</span> <span class="number">674</span></span><br><span class="line">Manufacturer <span class="string">Name         :</span> DELL Inc</span><br><span class="line">Product <span class="string">ID                :</span> <span class="number">256</span> (<span class="number">0x0100</span>)</span><br><span class="line">Product <span class="string">Name              :</span> Unknown (<span class="number">0x100</span>)</span><br><span class="line">Device <span class="string">Available          :</span> yes</span><br><span class="line">Provides Device <span class="string">SDRs      :</span> yes</span><br><span class="line">Additional Device <span class="string">Support :</span></span><br><span class="line">    Sensor Device</span><br><span class="line">    SDR Repository Device</span><br><span class="line">    SEL Device</span><br><span class="line">    FRU Inventory Device</span><br><span class="line">    IPMB Event Receiver</span><br><span class="line">    Bridge</span><br><span class="line">    Chassis Device</span><br><span class="line">Aux Firmware Rev <span class="string">Info     :</span> </span><br><span class="line">    <span class="number">0x00</span></span><br><span class="line">    <span class="number">0x18</span></span><br><span class="line">    <span class="number">0x00</span></span><br><span class="line">    <span class="number">0x00</span></span><br></pre></td></tr></table></figure>
<p><code>/opt # ./ipmitool lan print</code>  </p>
<figure class="highlight qml"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set</span> <span class="keyword">in</span> <span class="attribute">Progress</span>         : <span class="built_in">Set</span> Complete</span><br><span class="line">Auth Type <span class="attribute">Support</span>       : NONE MD2 MD5 PASSWORD </span><br><span class="line">Auth Type <span class="attribute">Enable</span>        : <span class="attribute">Callback</span> : MD2 <span class="attribute">MD5</span> </span><br><span class="line">                        : <span class="attribute">User</span>     : MD2 <span class="attribute">MD5</span> </span><br><span class="line">                        : <span class="attribute">Operator</span> : MD2 <span class="attribute">MD5</span> </span><br><span class="line">                        : <span class="attribute">Admin</span>    : MD2 <span class="attribute">MD5</span> </span><br><span class="line">                        : <span class="attribute">OEM</span>      : </span><br><span class="line">IP Address <span class="attribute">Source</span>       : Static Address</span><br><span class="line">IP <span class="attribute">Address</span>              : <span class="number">10.3</span><span class="number">.0</span><span class="number">.35</span></span><br><span class="line">Subnet <span class="attribute">Mask</span>             : <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">MAC <span class="attribute">Address</span>             : <span class="attribute">e4</span>:<span class="number">5</span><span class="attribute">b</span>:<span class="attribute">dd</span>:<span class="attribute">dd</span>:<span class="attribute">dd</span>:<span class="attribute">dd</span><br><span class="line">SNMP Community String</span>   : public</span><br><span class="line">IP <span class="attribute">Header</span>               : TTL=<span class="number">0x40</span> Flags=<span class="number">0x40</span> Precedence=<span class="number">0x00</span> TOS=<span class="number">0x10</span></span><br><span class="line">Default Gateway <span class="attribute">IP</span>      : <span class="number">10.3</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">Default Gateway <span class="attribute">MAC</span>     : <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">Backup Gateway <span class="attribute">IP</span>       : <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">Backup Gateway <span class="attribute">MAC</span>      : <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">802.1</span>q VLAN <span class="attribute">ID</span>          : Disabled</span><br><span class="line"><span class="number">802.1</span>q VLAN <span class="attribute">Priority</span>    : <span class="number">0</span></span><br><span class="line">RMCP+ Cipher <span class="attribute">Suites</span>     : <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span></span><br><span class="line">Cipher Suite Priv <span class="attribute">Max</span>   : <span class="attribute">aaaaaaaaaaaaaaa</span></span><br><span class="line">                        :     X=Cipher Suite <span class="attribute">Unused</span></span><br><span class="line">                        :     c=<span class="attribute">CALLBACK</span></span><br><span class="line">                        :     u=<span class="attribute">USER</span></span><br><span class="line">                        :     o=<span class="attribute">OPERATOR</span></span><br><span class="line">                        :     a=<span class="attribute">ADMIN</span></span><br><span class="line">                        :     O=OEM</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[cygwin下安装mysqld]]></title>
      <url>http://blog.wuliwala.net/2015/08/24/cygwin-mysqld/</url>
      <content type="html"><![CDATA[<h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><p>首先运行cygwin_setup，选装包：<br>mysql （客户端）<br>mysqld （服务端）</p>
<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><p><code>#mysql_install_db</code><br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Installing MySQL system tables...</span><br><span class="line">OK</span><br><span class="line">Filling <span class="keyword">help</span> <span class="keyword">tables</span>...</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="keyword">To</span> <span class="keyword">start</span> mysqld <span class="keyword">at</span> boot <span class="keyword">time</span> you have <span class="keyword">to</span> copy</span><br><span class="line">support-files/mysql.<span class="keyword">server</span> <span class="keyword">to</span> the <span class="keyword">right</span> place <span class="keyword">for</span> your <span class="keyword">system</span></span><br><span class="line"></span><br><span class="line">PLEASE REMEMBER <span class="keyword">TO</span> <span class="keyword">SET</span> A <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> THE MySQL root <span class="keyword">USER</span> !</span><br><span class="line"><span class="keyword">To</span> <span class="keyword">do</span> so, <span class="keyword">start</span> the <span class="keyword">server</span>, <span class="keyword">then</span> issue the <span class="keyword">following</span> commands:</span><br><span class="line"></span><br><span class="line">/usr/<span class="keyword">bin</span>/mysqladmin -u root <span class="keyword">password</span> <span class="string">'new-password'</span></span><br><span class="line">/usr/<span class="keyword">bin</span>/mysqladmin -u root -h brix <span class="keyword">password</span> <span class="string">'new-password'</span></span><br><span class="line"></span><br><span class="line">Alternatively you can run:</span><br><span class="line">/usr/<span class="keyword">bin</span>/mysql_secure_installation</span><br><span class="line"></span><br><span class="line">which will also give you the <span class="keyword">option</span> <span class="keyword">of</span> removing the <span class="keyword">test</span></span><br><span class="line"><span class="keyword">databases</span> <span class="keyword">and</span> anonymous <span class="keyword">user</span> created <span class="keyword">by</span> <span class="keyword">default</span>.  This <span class="keyword">is</span></span><br><span class="line">strongly recommended <span class="keyword">for</span> production servers.</span><br><span class="line"></span><br><span class="line">See the <span class="keyword">manual</span> <span class="keyword">for</span> more instructions.</span><br><span class="line"></span><br><span class="line">You can <span class="keyword">start</span> the MySQL daemon <span class="keyword">with</span>:</span><br><span class="line">cd /usr ; /usr/bin/mysqld_safe &amp;</span><br><span class="line"></span><br><span class="line">You can test the MySQL daemon with mysql-test-run.pl</span><br><span class="line">cd /usr/mysql-test ; perl mysql-test-run.pl</span><br><span class="line"></span><br><span class="line">Please report any problems at http://bugs.mysql.com/</span><br></pre></td></tr></table></figure></p>
<h3 id="启动mysqld服务"><a href="#启动mysqld服务" class="headerlink" title="启动mysqld服务"></a>启动mysqld服务</h3><p>执行<code>cd /usr ; /usr/bin/mysqld_safe &amp;</code>启动mysql的守护进程。<br>执行<code>mysql_secure_installation</code>，设置root用户的密码，配置一些安全选项。</p>
<p>基本上mysql就安装完了，以后就可以用下面两条命令开启和关闭mysql守护进程：</p>
<p><code>mysqld_safe &amp;</code><br><code>mysqladmin -u root -p shutdown</code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2集成pnp4nagios]]></title>
      <url>http://blog.wuliwala.net/2015/08/24/icinga2-pnp4nagios/</url>
      <content type="html"><![CDATA[<p><img src="/images/2015/08/icinga2-pnp4nagios-ifio-2-1.png" alt="alt"></p>
<h1 id="PNP4nagios"><a href="#PNP4nagios" class="headerlink" title="PNP4nagios"></a>PNP4nagios</h1><p><code>cp -r modules/* /usr/share/icingaweb2/modules/</code><br><code>ln -s /usr/local/pnp4nagios/etc/* /etc/pnp4nagios/</code><br><code>#vim /etc/pnp4nagios/npcd.cfg</code><br><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">user</span> = icinga</span><br><span class="line"><span class="attr">group</span> = icinga</span><br><span class="line"><span class="attr">log_type</span> = file</span><br><span class="line"><span class="attr">log_file</span> = /usr/local/pnp4nagios/var/npcd.log</span><br><span class="line"><span class="attr">max_logfile_size</span> = <span class="number">10485760</span></span><br><span class="line"><span class="attr">log_level</span> = <span class="number">0</span> #debug时打开</span><br><span class="line"><span class="attr">perfdata_file_run_cmd</span> = /usr/local/pnp4nagios/libexec/process_perfdata.pl</span><br><span class="line"><span class="attr">perfdata_file_run_cmd_args</span> = --bulk</span><br><span class="line"><span class="attr">identify_npcd</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">npcd_max_threads</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">sleep_time</span> = <span class="number">15</span></span><br><span class="line"><span class="attr">load_threshold</span> = <span class="number">0.0</span></span><br><span class="line"><span class="attr">pid_file</span>=/var/run/npcd.pid</span><br><span class="line"><span class="attr">perfdata_file</span> = /usr/local/pnp4nagios/var/perfdata.dump</span><br><span class="line"><span class="attr">perfdata_spool_dir</span> = /var/spool/icinga2/perfdata</span><br><span class="line"><span class="attr">perfdata_spool_filename</span> = perfdata</span><br><span class="line"><span class="attr">perfdata_file_processing_interval</span> = <span class="number">15</span></span><br></pre></td></tr></table></figure></p>
<p><code>#vim /etc/pnp4nagios/process_perfdata.cfg</code></p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="attr">TIMEOUT</span> = <span class="number">15</span></span><br><span class="line"><span class="attr">USE_RRDs</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">RRDPATH</span> = /usr/local/pnp4nagios/var/perfdata</span><br><span class="line"><span class="attr">RRDTOOL</span> = /usr/bin/rrdtool</span><br><span class="line"><span class="attr">CFG_DIR</span> = /usr/local/pnp4nagios/etc</span><br><span class="line"><span class="attr">RRD_STORAGE_TYPE</span> = SINGLE</span><br><span class="line"><span class="attr">RRD_HEARTBEAT</span> = <span class="number">8460</span></span><br><span class="line"><span class="attr">RRA_CFG</span> = /usr/local/pnp4nagios/etc/rra.cfg</span><br><span class="line"><span class="attr">RRA_STEP</span> = <span class="number">60</span></span><br><span class="line"><span class="attr">LOG_FILE</span> = /usr/local/pnp4nagios/var/perfdata.log</span><br><span class="line"><span class="attr">LOG_LEVEL</span> = <span class="number">0</span> <span class="comment">#debug时打开</span></span><br><span class="line"><span class="attr">XML_ENC</span> = UTF-<span class="number">8</span></span><br><span class="line"><span class="attr">XML_UPDATE_DELAY</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">RRD_DAEMON_OPTS</span> = </span><br><span class="line"><span class="attr">STATS_DIR</span> = /usr/local/pnp4nagios/var/stats</span><br><span class="line"><span class="attr">PREFORK</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">GEARMAN_HOST</span> = localhost:<span class="number">4730</span></span><br><span class="line"><span class="attr">REQUESTS_PER_CHILD</span> = <span class="number">10000</span></span><br><span class="line"><span class="attr">ENCRYPTION</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">KEY</span> = should_be_changed</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">`<span class="comment">#vim /etc/icinga2/features-enabled/perfdata.conf`</span></span><br></pre></td></tr></table></figure>
<p>library “perfdata”<br>object PerfdataWriter “perfdata” {<br>  service_format_template = “DATATYPE::SERVICEPERFDATA\tTIMET::$icinga.timet$\tHOSTNAME::$host.name$\tSERVICEDESC::$service.name$\tSERVICEPERFDATA::$service.<br>  perfdata$\tSERVICECHECKCOMMAND::$service.check_command$$pnp_check_arg1$\tHOSTSTATE::$host.state$\tHOSTSTATETYPE::$host.state_type$\tSERVICESTATE::$service.<br>  state$\tSERVICESTATETYPE::$service.state_type$”<br>}<br><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">`# vim /etc/icinga2/<span class="keyword">conf</span>.<span class="keyword">d</span>/templates.<span class="keyword">conf</span>`</span><br></pre></td></tr></table></figure></p>
<p>template Service “pnp-svc” {<br>  action_url = “/pnp4nagios/graph?host=$HOSTNAME$&amp;srv=$SERVICEDESC$”<br>  vars.pnp_check_arg1 = “”<br>}<br><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">`#vim /etc/icinga2/<span class="keyword">conf</span>.<span class="keyword">d</span>/services.<span class="keyword">conf</span>`</span><br></pre></td></tr></table></figure></p>
<p>apply Service “nrpe_traffic” {<br>  import “generic-service”<br>  import “pnp-svc”<br>  check_command = “nrpe”<br>  assign where host.name == “kddi-pxe”<br>  assign where host.name == “kddi-deploy”<br>  vars.nrpe_timeout = 240<br>  vars.nrpe_command = “check_traffic”<br>  vars.pnp_check_arg1 = “!$nrpe_command$”<br>}<br><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">`#vim <span class="regexp">/usr/</span>local<span class="regexp">/pnp4nagios/</span>etc<span class="regexp">/check_commands/</span>nrpe.cfg`</span><br></pre></td></tr></table></figure></p>
<p>CUSTOM_TEMPLATE = 0,1<br>DATATYPE = GAUGE<br>USE_MAX_ON_CREATE = 0<br><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">`#vim /usr/local/pnp4nagios/var/perfdata/kddi-deploy/nrpe_traffic.xml`  </span><br><span class="line"></span><br><span class="line">看这个值  </span><br><span class="line"></span><br><span class="line">`&lt;TEMPLATE&gt;nrpe_check_traffic&lt;/TEMPLATE&gt;`  </span><br><span class="line"></span><br><span class="line">然后根据xml中的名字创建模板  </span><br><span class="line"></span><br><span class="line">`#vim /usr/local/pnp4nagios/share/templates/nrpe_check_traffic.php`</span><br></pre></td></tr></table></figure></p>
<p>&lt;?php<br>#</p>
<h1 id="Copyright-c-2006-2010-Joerg-Linge-http-www-pnp4nagios-org"><a href="#Copyright-c-2006-2010-Joerg-Linge-http-www-pnp4nagios-org" class="headerlink" title="Copyright (c) 2006-2010 Joerg Linge (http://www.pnp4nagios.org)"></a>Copyright (c) 2006-2010 Joerg Linge (<a href="http://www.pnp4nagios.org" target="_blank" rel="external">http://www.pnp4nagios.org</a>)</h1><h1 id="Plugin-check-bmon"><a href="#Plugin-check-bmon" class="headerlink" title="Plugin: check_bmon"></a>Plugin: check_bmon</h1><h1 id="Output-TRAFFIC-OK-in-131-9Bps-out-185Bps"><a href="#Output-TRAFFIC-OK-in-131-9Bps-out-185Bps" class="headerlink" title="Output: TRAFFIC OK|in=131.9Bps; out=185Bps;"></a>Output: TRAFFIC OK|in=131.9Bps; out=185Bps;</h1><p>$opt[1] = “–vertical-label \”Bytes/s\” –title \”$servicedesc\” “;</p>
<p>$def[1]  = “DEF:var1=$RRDFILE[1]:$DS[1]:AVERAGE “ ;<br>$def[1] .= “DEF:var2=$RRDFILE[2]:$DS[2]:AVERAGE “ ;<br>$def[1] .= “CDEF:var3=var2,-1,* “ ;<br>$def[1] .= “AREA:var1#00ff00:\”in\” “ ;<br>$def[1] .= “GPRINT:var1:LAST:\”%.1lf %SBytes last\” “ ;<br>$def[1] .= “GPRINT:var1:AVERAGE:\”%.1lf %SBytes avg\” “ ;<br>$def[1] .= “GPRINT:var1:MAX:\”%.1lf %SBytes max\n\” “ ;</p>
<h1 id="def-1-“AREA-var2-0066FF-”out-”-“"><a href="#def-1-“AREA-var2-0066FF-”out-”-“" class="headerlink" title="$def[1] .= “AREA:var2#0066FF:\”out\” “ ;"></a>$def[1] .= “AREA:var2#0066FF:\”out\” “ ;</h1><p>$def[1] .= “AREA:var3#0066FF:\”out\” “ ;<br>$def[1] .= “GPRINT:var2:LAST:\”%.1lf %SBytes last\” “ ;<br>$def[1] .= “GPRINT:var2:AVERAGE:\”%.1lf %SBytes avg\” “ ;<br>$def[1] .= “GPRINT:var2:MAX:\”%.1lf %SBytes max\” “;<br>?&gt;<br>```<br>pnp template 文档<br><a href="https://docs.pnp4nagios.org/pnp-0.6/tpl_custom" target="_blank" rel="external">https://docs.pnp4nagios.org/pnp-0.6/tpl_custom</a><br>icinga2官方集成pnp4nagios模板攻略<br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins?highlight-search=pnp4nagios#addons-graphing-pnp-custom-templates" target="_blank" rel="external">http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins?highlight-search=pnp4nagios#addons-graphing-pnp-custom-templates</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[cacti批量添加device和graph]]></title>
      <url>http://blog.wuliwala.net/2015/08/21/cacti-add-multi-devices-graphs/</url>
      <content type="html"><![CDATA[<p>cacti添加监控项和绘图项不一般得麻烦，华为s5700交换机有48口，鼠标点得点到死。<br>好在有一些cli工具可以帮助我们批量添加。<br>工具目录：<br>/var/www/html/cli<br>脚本中涉及到的host-id template-id 等各种id请参阅文章底部的使用手册，理明白各id用途再使用本脚本。<br><code>cat add_multi.sh</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># path=/var/www/html/cli</span><br><span class="line">for host_ip in $(cat hosts)</span><br><span class="line">do</span><br><span class="line">    echo $host_ip</span><br><span class="line">    php -q add_device.php --description=$host_ip --ip=&quot;$host_ip&quot; --template=6</span><br><span class="line">    host_id=$(php -q add_graphs.php --list-hosts --quiet|grep $host_ip|awk -F &quot; &quot; &apos;&#123;print $1&#125;&apos;)</span><br><span class="line">    php -q add_graphs.php --host-id=$host_id --graph-type=cg --graph-template-id=24</span><br><span class="line">    ######php add_graphs.php --host-id=$host_id --snmp-field=ifDescr --list-snmp-values</span><br><span class="line">    for host_if in $(php -q add_graphs.php --host-id=$host_id --snmp-field=ifDescr --list-snmp-values --quiet)</span><br><span class="line">    do</span><br><span class="line">        echo $host_if</span><br><span class="line">        php -q add_graphs.php --host-id=$host_id --graph-type=ds --graph-title=&apos;|host_description| - Traffic - |query_ifName|&apos; --graph-template-id=12 --snmp-quer</span><br><span class="line">y-id=3 --snmp-query-type-id=6 --snmp-field=ifDescr --snmp-value=&quot;$host_if&quot;</span><br><span class="line">    done</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p><code>sh add_multi.sh</code><br><figure class="highlight qml"><table><tr><td class="code"><pre><span class="line">bj-cnc<span class="number">-1.</span>arkii.cn</span><br><span class="line">Adding bj-cnc<span class="number">-1.</span>arkii.cn (bj-cnc-s5700<span class="number">-1.</span>arkii.cn) <span class="keyword">as</span> <span class="string">"Huawei"</span> using SNMP v2 <span class="keyword">with</span> community <span class="string">"public"</span></span><br><span class="line">Success - <span class="keyword">new</span> device-<span class="attribute">id:</span><span class="emphasis"> (100)</span><br><span class="line">Graph</span> Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7835) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6968</span>)</span><br><span class="line">Console9/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7836) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6969</span>, <span class="number">6969</span>)</span><br><span class="line">Eth-Trunk1</span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7837) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6970</span>, <span class="number">6970</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7838) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6971</span>, <span class="number">6971</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">10</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7839) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6972</span>, <span class="number">6972</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">11</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7840) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6973</span>, <span class="number">6973</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">12</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7841) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6974</span>, <span class="number">6974</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">13</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7842) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6975</span>, <span class="number">6975</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">14</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7843) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6976</span>, <span class="number">6976</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">15</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7844) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6977</span>, <span class="number">6977</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">16</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7845) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6978</span>, <span class="number">6978</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">17</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7846) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6979</span>, <span class="number">6979</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">18</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7847) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6980</span>, <span class="number">6980</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">19</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7848) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6981</span>, <span class="number">6981</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">2</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7849) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6982</span>, <span class="number">6982</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">20</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7850) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6983</span>, <span class="number">6983</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">21</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7851) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6984</span>, <span class="number">6984</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">22</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7852) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6985</span>, <span class="number">6985</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">23</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7853) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6986</span>, <span class="number">6986</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">24</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7854) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6987</span>, <span class="number">6987</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">25</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7855) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6988</span>, <span class="number">6988</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">26</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7856) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6989</span>, <span class="number">6989</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">27</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7857) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6990</span>, <span class="number">6990</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">28</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7858) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6991</span>, <span class="number">6991</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">29</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7859) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6992</span>, <span class="number">6992</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">3</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7860) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6993</span>, <span class="number">6993</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">30</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7861) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6994</span>, <span class="number">6994</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">31</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7862) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6995</span>, <span class="number">6995</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">32</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7863) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6996</span>, <span class="number">6996</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">33</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7864) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6997</span>, <span class="number">6997</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">34</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7865) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6998</span>, <span class="number">6998</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">35</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7866) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">6999</span>, <span class="number">6999</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">36</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7867) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7000</span>, <span class="number">7000</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">37</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7868) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7001</span>, <span class="number">7001</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">38</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7869) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7002</span>, <span class="number">7002</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">39</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7870) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7003</span>, <span class="number">7003</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">4</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7871) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7004</span>, <span class="number">7004</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">40</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7872) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7005</span>, <span class="number">7005</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">41</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7873) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7006</span>, <span class="number">7006</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">42</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7874) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7007</span>, <span class="number">7007</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">43</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7875) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7008</span>, <span class="number">7008</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">44</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7876) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7009</span>, <span class="number">7009</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">45</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7877) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7010</span>, <span class="number">7010</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">46</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7878) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7011</span>, <span class="number">7011</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">47</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7879) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7012</span>, <span class="number">7012</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">48</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7880) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7013</span>, <span class="number">7013</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">5</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7881) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7014</span>, <span class="number">7014</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">6</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7882) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7015</span>, <span class="number">7015</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">7</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7883) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7016</span>, <span class="number">7016</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">8</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7884) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7017</span>, <span class="number">7017</span>)</span><br><span class="line">GigabitEthernet0/<span class="number">0</span>/<span class="number">9</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7885) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7018</span>, <span class="number">7018</span>)</span><br><span class="line">InLoopBack0</span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7886) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7019</span>, <span class="number">7019</span>)</span><br><span class="line">MEth0/<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7887) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7020</span>, <span class="number">7020</span>)</span><br><span class="line">NULL0</span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7888) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7021</span>, <span class="number">7021</span>)</span><br><span class="line">Vlanif1</span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7889) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7022</span>, <span class="number">7022</span>)</span><br><span class="line">Vlanif200</span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7890) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7023</span>, <span class="number">7023</span>)</span><br><span class="line">XGigabitEthernet0/<span class="number">1</span>/<span class="number">1</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7891) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7024</span>, <span class="number">7024</span>)</span><br><span class="line">XGigabitEthernet0/<span class="number">1</span>/<span class="number">2</span></span><br><span class="line">Graph Added - graph-<span class="attribute">id:</span><span class="emphasis"> (7892) - data</span>-source-<span class="attribute">ids</span>: (<span class="number">7025</span>, <span class="number">7025</span>)</span><br></pre></td></tr></table></figure></p>
<p>参考资料<br><a href="http://www.cacti.net/downloads/docs/html/cli_add_graphs.html" target="_blank" rel="external">www.cacti.net</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[自动化中使用ssh命令]]></title>
      <url>http://blog.wuliwala.net/2015/08/18/ssh-automatic/</url>
      <content type="html"><![CDATA[<p>有一台master服务器，做自动部署，其中一个环节是使用ssh命令链接新装完系统的服务器，做一些初始化工作，但是由于dhcp池会重复分配IP，ssh在脚本中会报如下两个错误。<br><figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@</span><br><span class="line">@</span>    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     <span class="comment">@</span><br><span class="line">@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span><span class="comment">@@</span></span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class="line">It is also possible that the RSA host <span class="built_in">key</span> has just been changed.</span><br><span class="line">The fingerprint <span class="keyword">for</span> the RSA <span class="built_in">key</span> sent by the remote host is</span><br><span class="line">j8:<span class="number">98</span>:o8:cm:<span class="number">23</span>:<span class="number">16</span>:<span class="number">62</span>:cd.</span><br><span class="line">Please contact your <span class="keyword">system</span> administrator.</span><br><span class="line">Add correct host <span class="built_in">key</span> in /root/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending <span class="built_in">key</span> in /root/.ssh/known_hosts:<span class="number">6</span></span><br><span class="line">RSA host <span class="built_in">key</span> <span class="keyword">for</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.13</span> has changed <span class="keyword">and</span> you have requested strict checking.</span><br><span class="line">Host <span class="built_in">key</span> verification failed.</span><br></pre></td></tr></table></figure></p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">The authenticity <span class="keyword">of</span> host <span class="comment">'10.0.0.13 (10.0.0.13)' can't be established.</span></span><br><span class="line">RSA <span class="keyword">key</span> fingerprint <span class="keyword">is</span> j8:<span class="number">98</span>:o8:cm:<span class="number">23</span>:<span class="number">16</span>:<span class="number">62</span>:cd.</span><br><span class="line">Are you sure you want <span class="keyword">to</span> <span class="keyword">continue</span> connecting (yes/no)?</span><br></pre></td></tr></table></figure>
<p>在ssh配置文件中添加如下两行:<br>~/.ssh/config<br><figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">StrictHostKeyChecking <span class="literal">no</span></span><br><span class="line">UserKnownHostsFile /dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[icinga2添加自定义通知插件]]></title>
      <url>http://blog.wuliwala.net/2015/08/10/icinga2-my-notification/</url>
      <content type="html"><![CDATA[<p>添加模板<br>/etc/icinga2/conf.d/templates.conf<br><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">template Notification <span class="string">"wechat-host-notification"</span> &#123;</span><br><span class="line">  <span class="attr">command</span> = <span class="string">"wechat-host-notification"</span></span><br><span class="line">  <span class="attr">states</span> = [ Up, Down ]</span><br><span class="line">  <span class="attr">types</span> = [ Problem, Recovery ]</span><br><span class="line">  <span class="attr">period</span> = <span class="string">"24x7"</span></span><br><span class="line">&#125;</span><br><span class="line">template Notification <span class="string">"wechat-service-notification"</span> &#123;</span><br><span class="line">  <span class="attr">command</span> = <span class="string">"wechat-service-notification"</span></span><br><span class="line">  <span class="attr">states</span> = [ OK, Warning, Critical, Unknown ]</span><br><span class="line">  <span class="attr">types</span> = [ Problem, Recovery ]</span><br><span class="line">  <span class="attr">period</span> = <span class="string">"24x7"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>添加command<br>/etc/icinga2/conf.d/commands.conf<br><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">object NotificationCommand <span class="string">"wechat-host-notification"</span> &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"plugin-notification-command"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = [ SysconfDir + <span class="string">"/icinga2/scripts/wechat-host-notification.sh"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="attr">env</span> = &#123;</span><br><span class="line">    <span class="attr">NOTIFICATIONTYPE</span> = <span class="string">"$notification.type$"</span></span><br><span class="line">    <span class="attr">HOSTALIAS</span> = <span class="string">"$host.display_name$"</span></span><br><span class="line">    <span class="attr">HOSTADDRESS</span> = <span class="string">"$address$"</span></span><br><span class="line">    <span class="attr">HOSTSTATE</span> = <span class="string">"$host.state$"</span></span><br><span class="line">    <span class="attr">LONGDATETIME</span> = <span class="string">"$icinga.long_date_time$"</span></span><br><span class="line">    <span class="attr">SHORTDATETIME</span> = <span class="string">"$icinga.short_date_time$"</span></span><br><span class="line">    <span class="attr">TIME</span> = <span class="string">"$icinga.time$"</span></span><br><span class="line">    <span class="attr">HOSTOUTPUT</span> = <span class="string">"$host.output$"</span></span><br><span class="line">    <span class="attr">NOTIFICATIONAUTHORNAME</span> = <span class="string">"$notification.author$"</span></span><br><span class="line">    <span class="attr">NOTIFICATIONCOMMENT</span> = <span class="string">"$notification.comment$"</span></span><br><span class="line">    <span class="attr">HOSTDISPLAYNAME</span> = <span class="string">"$host.display_name$"</span></span><br><span class="line">    <span class="attr">USEREMAIL</span> = <span class="string">"$user.email$"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">object NotificationCommand <span class="string">"wechat-service-notification"</span> &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"plugin-notification-command"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = [ SysconfDir + <span class="string">"/icinga2/scripts/wechat-service-notification.sh"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="attr">env</span> = &#123;</span><br><span class="line">    <span class="attr">NOTIFICATIONTYPE</span> = <span class="string">"$notification.type$"</span></span><br><span class="line">    <span class="attr">SERVICEDESC</span> = <span class="string">"$service.name$"</span></span><br><span class="line">    <span class="attr">HOSTALIAS</span> = <span class="string">"$host.display_name$"</span></span><br><span class="line">    <span class="attr">HOSTADDRESS</span> = <span class="string">"$address$"</span></span><br><span class="line">    <span class="attr">SERVICESTATE</span> = <span class="string">"$service.state$"</span></span><br><span class="line">    <span class="attr">LONGDATETIME</span> = <span class="string">"$icinga.long_date_time$"</span></span><br><span class="line">    <span class="attr">SHORTDATETIME</span> = <span class="string">"$icinga.short_date_time$"</span></span><br><span class="line">    <span class="attr">TIME</span> = <span class="string">"$icinga.time$"</span></span><br><span class="line">    <span class="attr">SERVICEOUTPUT</span> = <span class="string">"$service.output$"</span></span><br><span class="line">    <span class="attr">NOTIFICATIONAUTHORNAME</span> = <span class="string">"$notification.author$"</span></span><br><span class="line">    <span class="attr">NOTIFICATIONCOMMENT</span> = <span class="string">"$notification.comment$"</span></span><br><span class="line">    <span class="attr">HOSTDISPLAYNAME</span> = <span class="string">"$host.display_name$"</span></span><br><span class="line">    <span class="attr">SERVICEDISPLAYNAME</span> = <span class="string">"$service.display_name$"</span></span><br><span class="line">    <span class="attr">USEREMAIL</span> = <span class="string">"$user.email$"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注册通知到主机和服务<br>/etc/icinga2/conf.d/notifications.conf<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">apply Notification <span class="string">"wechat-icingaadmin"</span> to Host &#123;</span><br><span class="line">  import <span class="string">"wechat-host-notification"</span></span><br><span class="line">  user_groups = host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span><span class="selector-class">.groups</span></span><br><span class="line">  assign where host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span></span><br><span class="line">  interval = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply Notification <span class="string">"wechat-icingaadmin"</span> to Service &#123;</span><br><span class="line">  import <span class="string">"wechat-service-notification"</span></span><br><span class="line">  user_groups = host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span><span class="selector-class">.groups</span></span><br><span class="line">  assign where host<span class="selector-class">.vars</span><span class="selector-class">.notification</span><span class="selector-class">.mail</span></span><br><span class="line">  interval = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>路径/etc/icinga2/scripts  </p>
<p><code># cat wechat-host-notification.sh</code>  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">template=\`cat &lt;&lt;TEMPLATE</span><br><span class="line"><span class="variable">$SHORTDATETIME</span>|<span class="variable">$HOSTALIAS</span>|<span class="variable">$HOSTADDRESS</span>|<span class="variable">$HOSTSTATE</span>|<span class="variable">$HOSTOUTPUT</span></span><br><span class="line">TEMPLATE</span><br><span class="line">\`</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/send_wechat.py <span class="variable">$USEREMAIL</span> <span class="string">"<span class="variable">$template</span>"</span></span><br></pre></td></tr></table></figure>
<p><code># cat wechat-service-notification.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">template=\`cat &lt;&lt;TEMPLATE</span><br><span class="line"><span class="variable">$SHORTDATETIME</span>|<span class="variable">$HOSTALIAS</span>|<span class="variable">$HOSTADDRESS</span>|<span class="variable">$SERVICEDESC</span>|<span class="variable">$SERVICESTATE</span>|<span class="variable">$SERVICEOUTPUT</span></span><br><span class="line">TEMPLATE</span><br><span class="line">\`</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/send_wechat.py <span class="variable">$USEREMAIL</span> <span class="string">"<span class="variable">$template</span>"</span></span><br></pre></td></tr></table></figure>
<p>检查配置文件<br>icinga2 daemon -C</p>
<p>重启icinga2</p>
<p>service icinga2 restart</p>
<p>相关资料：  <a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/migration" target="_blank" rel="external">http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/migration</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[OSX下合并MP4文件]]></title>
      <url>http://blog.wuliwala.net/2015/08/07/mp4box-concat-mp4/</url>
      <content type="html"><![CDATA[<p><code>brew install mp4box</code><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MP4Box -cat 1.mp4 -cat 2.mp4 -cat 3.mp4 output.mp4</span><br><span class="line">Appending file 1.mp4</span><br><span class="line">No suitable destination track found - creating new one (<span class="built_in">type</span> vide)</span><br><span class="line">No suitable destination track found - creating new one (<span class="built_in">type</span> soun)</span><br><span class="line">Appending file 2.mp4                             </span><br><span class="line">Appending file 3.mp4                             </span><br><span class="line">Saving to output.mp4: 0.500 secs Interleaving</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[gitlab服务搭建，配置ldap登陆]]></title>
      <url>http://blog.wuliwala.net/2015/08/06/gitlab-service-deploy/</url>
      <content type="html"><![CDATA[<p>准备数据目录<br><code>mkdir -p /srv/gitlab/config /srv/gitlab/logs /srv/gitlab/data</code></p>
<p>docker-compose.yml文件<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gitlabCE:</span><br><span class="line">  image: gitlab/gitlab-ce</span><br><span class="line">  dns: 172.17.42.1</span><br><span class="line">  ports:</span><br><span class="line">    - &quot;8443:443&quot;</span><br><span class="line">    - &quot;8008:80&quot;</span><br><span class="line">    - &quot;2222:22&quot;</span><br><span class="line">  volumes:</span><br><span class="line">    - /srv/gitlab/config:/etc/gitlab</span><br><span class="line">    - /srv/gitlab/logs:/var/log/gitlab</span><br><span class="line">    - /srv/gitlab/data:/var/opt/gitlab</span><br><span class="line">  environment:</span><br><span class="line">    - PATH=/sbin:/usr/sbin:/bin:/usr/bin</span><br></pre></td></tr></table></figure></p>
<p>配置ldap登陆<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gitlab_rails[&apos;ldap_enabled&apos;] = true</span><br><span class="line">gitlab_rails[&apos;ldap_servers&apos;] = YAML.load &lt;&lt;-&apos;EOS&apos; # remember to close this block with &apos;EOS&apos; below</span><br><span class="line">  main: # &apos;main&apos; is the GitLab &apos;provider ID&apos; of this LDAP server</span><br><span class="line">    label: &apos;LDAP&apos;</span><br><span class="line">    host: &apos;10.x.xx.xx&apos;</span><br><span class="line">    port: 389</span><br><span class="line">    uid: &apos;sAMAccountName&apos;</span><br><span class="line">    method: &apos;plain&apos; # &quot;tls&quot; or &quot;ssl&quot; or &quot;plain&quot;</span><br><span class="line">    bind_dn: &apos;cn=sysop,ou=zol,dc=office,dc=zol&apos;</span><br><span class="line">    password: &apos;password&apos;</span><br><span class="line">    active_directory: true</span><br><span class="line">    allow_username_or_email_login: false</span><br><span class="line">    block_auto_created_users: false</span><br><span class="line">    base: &apos;ou=zol,dc=office,dc=zol&apos;</span><br><span class="line">    user_filter: &apos;&apos;</span><br><span class="line">EOS</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS6免编译yum升级3.10内核]]></title>
      <url>http://blog.wuliwala.net/2015/08/04/centos6-update-kernel-to-3-10/</url>
      <content type="html"><![CDATA[<p>使用elrepo来更新<br>导入key<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br></pre></td></tr></table></figure></p>
<p>安装repo<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure></p>
<p>安装kernel<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install kernel<span class="_">-lt</span> kernel<span class="_">-lt</span>-firmware kernel<span class="_">-lt</span>-headers</span><br></pre></td></tr></table></figure></p>
<p>启用新kernel<br><code>vi /etc/grub.conf</code><br>修改<br><code>default=0</code><br>查看当前kernel版本<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># uname -a</span></span><br><span class="line">Linux localhost.localdomain 2.6.32-504.30.3.el6.x86_64 <span class="comment">#1 SMP Wed Jul 15 10:13:09 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure></p>
<p>重启系统<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># uname -a</span></span><br><span class="line">Linux localhost.localdomain 3.10.84-1.el6.elrepo.x86_64 <span class="comment">#1 SMP Sat Jul 11 11:33:48 EDT 2015 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[elk分析nginx访问日志]]></title>
      <url>http://blog.wuliwala.net/2015/07/25/elk/</url>
      <content type="html"><![CDATA[<p>使用rsyslog + elk分析nginx访问日志。<br>elk日志分析栈，即elasticsearch logstash kibana。<br>为了减少对现有系统的改造，故使用rsyslog来读取应用服务器的nginx access_log，使用udp的方式发送到elk日志分析服务器的logstash，logstash解析日志后写入elasticsearch，进行存储和索引，最后由kibana来查询elasticsearch中的数据进行分析。</p>
<p>nginx.conf<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">log_format</span>  main  <span class="string">'<span class="variable">$request_time</span> <span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" <span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" "<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br></pre></td></tr></table></figure></p>
<p>nginx日志<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0.083 111.112.113.119 - - [25/Jul/2015:17:39:12 +0800] &quot;POST /m/write?&amp;title=xxx&amp;img= HTTP/1.1&quot; 200 83 &quot;-&quot; &quot;Dalvik/1.6.0 (Linux; U; Android 4.4.4; MI 4LTE MIUI/V6.5.3.0.KXGCNCD)&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure></p>
<p>/etc/rsyslog.conf<br><figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">$ModLoad imuxsock</span><br><span class="line">$ModLoad imklog</span><br><span class="line">$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat</span><br><span class="line">$IncludeConfig /etc/rsyslog.d/*.conf</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none                /var/log/messages</span><br><span class="line">authpriv.*                                              /var/log/secure</span><br><span class="line">mail.*                                                  -/var/log/maillog</span><br><span class="line">cron.*                                                  /var/log/cron</span><br><span class="line">*.emerg                                                 *</span><br><span class="line">uucp,news.crit                                          /var/log/spooler</span><br><span class="line">local7.*                                                /var/log/boot.log</span><br><span class="line">$ModLoad imfile</span><br><span class="line">$InputFileName /var/log/nginx/access.log</span><br><span class="line">$InputFileTag nginx-access:</span><br><span class="line">$InputFileStateFile state-nginx-accesslog</span><br><span class="line">$InputRunFileMonitor</span><br><span class="line">$InputFilePollInterval <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> $programname == <span class="string">'nginx-access'</span> <span class="keyword">then</span> @@YOUR_ELK_IP:<span class="number">514</span></span><br><span class="line"><span class="keyword">if</span> $programname == <span class="string">'nginx-access'</span> <span class="keyword">then</span> ~</span><br></pre></td></tr></table></figure></p>
<p>最终logstash接收到的信息如下：<br>里面包含了一些rsyslog附加的信息。<br><figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">&lt;<span class="number">133</span>&gt;Jul <span class="number">25</span> <span class="number">10</span>:<span class="number">37</span>:<span class="number">45</span> APPSERVE_RNAME nginx-access: <span class="number">0</span>.<span class="number">455</span> <span class="number">111.112.113.119</span> - - <span class="string">[25/Jul/2015:10:37:43 +0800]</span> <span class="string">"<span class="keyword">POST</span> /m/write?&amp;title=xxx&amp;create=1 HTTP/1.1"</span> <span class="number">200</span> <span class="number">121</span> <span class="string">"-"</span> <span class="string">"Dalvik/v3.3.86_update2 (Linux; U; Android 4.4.4; m1 Build/KTU84P)"</span> <span class="string">"-"</span></span><br></pre></td></tr></table></figure></p>
<p>下面是最终的filter<br>logstash.conf<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    port =&gt; <span class="number">514</span></span><br><span class="line">    type =&gt; syslog</span><br><span class="line">  &#125;</span><br><span class="line">  udp &#123;</span><br><span class="line">    port =&gt; <span class="number">514</span></span><br><span class="line">    type =&gt; syslog</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  <span class="keyword">if</span> [type] == <span class="string">"syslog"</span> &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">      match =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;SYSLOGTIMESTAMP:syslog_timestamp&#125; %&#123;SYSLOGHOST:syslog_hostname&#125; %&#123;DATA:syslog_program&#125;(?:\[%&#123;POSINT:syslog_pid&#125;\])?: %&#123;NUMBER:request_time&#125; %&#123;IPORHOST:client_ip&#125; \- (%&#123;WORD:remote_user&#125;|-) \[%&#123;HTTPDATE:timestamp&#125;\] \"(?:%&#123;WORD:http_verb&#125; %&#123;NOTSPACE:http_request&#125;(?: HTTP/%&#123;NUMBER:http _version&#125;)?)\" %&#123;NUMBER:http_status_code&#125; (?:%&#123;NUMBER:bytes_read&#125;|-) %&#123;QS:referrer&#125; %&#123;QS:agent&#125; \"(%&#123;IP:x_forwarder_for&#125;|-)\""</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    kv &#123;</span><br><span class="line">      source =&gt; <span class="string">"http_request"</span></span><br><span class="line">      prefix =&gt; <span class="string">"arg_"</span></span><br><span class="line">      field_split =&gt; <span class="string">"&amp;?"</span></span><br><span class="line">      value_split =&gt; <span class="string">"="</span></span><br><span class="line">      exclude_keys =&gt; [ <span class="string">"title"</span>, <span class="string">"content"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">    urldecode &#123;</span><br><span class="line">      field =&gt; <span class="string">"http_request"</span></span><br><span class="line">    &#125;</span><br><span class="line">    mutate &#123;</span><br><span class="line">      remove_field =&gt; [ <span class="string">"message"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">    geoip &#123;</span><br><span class="line">      source =&gt; <span class="string">"client_ip"</span></span><br><span class="line">    &#125;</span><br><span class="line">    syslog_pri &#123; &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">      match =&gt; [ <span class="string">"timestamp"</span>, <span class="string">"d/MMM/y:HH:mm:ss Z"</span>, <span class="string">"MMM  d HH:mm:ss"</span>, <span class="string">"MMM dd HH:mm:ss"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123; </span><br><span class="line">    host =&gt; <span class="string">"elk-elasticsearch"</span></span><br><span class="line">    protocol =&gt; <span class="string">"http"</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[yum安装dell官方OpenIPMI失败问题]]></title>
      <url>http://blog.wuliwala.net/2015/07/24/yuman-zhuang-dellguan-fang-openipmishi-bai-wen-ti/</url>
      <content type="html"><![CDATA[<p>dell openmanage repo CentOS5<br>安装 OpenIPMI时报如下错误：<br><a href="http://mirrors.private.com/hardware/dell/5/x86_64/ipmitool/OpenIPMI-2.0.16-99.dell.4.99.1.el5.x86_64.rpm" target="_blank" rel="external">http://mirrors.private.com/hardware/dell/5/x86_64/ipmitool/OpenIPMI-2.0.16-99.dell.4.99.1.el5.x86_64.rpm</a>: [Errno -1] Package does not match intended download<br>Trying other mirror.<br>问题分析：<br>从mirror服务器的nginx访问日志中看，是200状态，表明yum成功下载了该rpm包<br>于是怀疑是repo数据库中此rpm包的值不对，于是用createrepo命令来创建</p>
<p>又遇到了Error performing checksum错误<br>原因为：<br>CentOS5中的yum不能计算sha256，于是改用 sha1算法来生成针对centos5版本的repo数据库</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="meta-keyword">/usr/</span>bin/createrepo -s sha1 --simple-md-filenames -d -o <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50 <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50</span><br><span class="line"><span class="meta-keyword">/usr/</span>bin/createrepo -s sha1 --simple-md-filenames -d -o <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50_64 <span class="meta-keyword">/mirrors/</span>hardware<span class="meta-keyword">/dell/</span>rh50_64</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ghost添加代码高亮highlight.js]]></title>
      <url>http://blog.wuliwala.net/2015/07/24/ghosttian-jia-dai-ma-gao-liang-highlight-js/</url>
      <content type="html"><![CDATA[<p>下载highlight代码，拷贝到当前使用主题的assets目录<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mv highlight ~/blog/content/themes/casper-zh/assets/hl</span><br><span class="line">vim ~/blog/content/themes/casper-zh/default.hbs</span><br></pre></td></tr></table></figure></p>
<p>修改模板，css添加到<code>&lt;head&gt;</code>标签内，js添加到<code>&lt;/body&gt;</code>前面。<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;asset "</span><span class="string">hl</span>/<span class="attr">styles</span>/<span class="attr">github-gist.css</span>"&#125;&#125;" /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;asset "</span><span class="string">hl</span>/<span class="attr">highlight.pack.js</span>"&#125;&#125;"&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">hljs.initHighlightingOnLoad();</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重启ghost<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo service supervisord restart</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[vmware ESXi 监控]]></title>
      <url>http://blog.wuliwala.net/2015/07/23/vmware-esxi-jian-kong/</url>
      <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vicfg-snmp --server 10.1.0.15 --username USER --password PASS --t 10.19.8.15@162/public</span><br><span class="line">vicfg-snmp --server 10.1.0.15  --username USER --password PASS --enable</span><br><span class="line">snmpwalk -v 1 -c public 10.1.0.15 1.3.6.1.2.1.25.3.3</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.1</span> = <span class="string">INTEGER:</span> <span class="number">5</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.2</span> = <span class="string">INTEGER:</span> <span class="number">4</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.3</span> = <span class="string">INTEGER:</span> <span class="number">5</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.4</span> = <span class="string">INTEGER:</span> <span class="number">4</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.5</span> = <span class="string">INTEGER:</span> <span class="number">4</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.6</span> = <span class="string">INTEGER:</span> <span class="number">5</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.7</span> = <span class="string">INTEGER:</span> <span class="number">4</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrProcessorLoad<span class="number">.8</span> = <span class="string">INTEGER:</span> <span class="number">5</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.10</span> = <span class="string">INTEGER:</span> <span class="number">1</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.11</span> = <span class="string">INTEGER:</span> <span class="number">2</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.12</span> = <span class="string">INTEGER:</span> <span class="number">3</span></span><br><span class="line">HOST-RESOURCES-<span class="string">MIB:</span>:hrNetworkIfIndex<span class="number">.13</span> = <span class="string">INTEGER:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[iptables NAT 动态切换 IP]]></title>
      <url>http://blog.wuliwala.net/2015/07/17/iptables-nat-dong-tai-qie-huan-ip/</url>
      <content type="html"><![CDATA[<p>iptables 动态切换出口IP<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 100); <span class="keyword">do</span> iptables -t nat -I POSTROUTING -m statistic --mode nth --packet 0 --every 5 -j SNAT --to-source 10.0.0.<span class="variable">$i</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[pip 报错from versions: 问题]]></title>
      <url>http://blog.wuliwala.net/2015/07/16/pip-bao-cuo-from-versions-wen-ti/</url>
      <content type="html"><![CDATA[<p>pip升级到6\7版本后，使用自搭建mirror的报错问题</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">pip_pypy <span class="keyword">install</span> Flask</span><br><span class="line">You <span class="keyword">are</span> <span class="keyword">using</span> pip <span class="keyword">version</span> <span class="number">7.0</span><span class="number">.1</span>, however <span class="keyword">version</span> <span class="number">7.1</span><span class="number">.0</span> <span class="keyword">is</span> available.</span><br><span class="line">You should <span class="keyword">consider</span> upgrading via the <span class="string">'pip install --upgrade pip'</span> command.</span><br><span class="line">Collecting Flask</span><br><span class="line">  The repository located <span class="keyword">at</span> mirrors.zol.com.cn <span class="keyword">is</span> <span class="keyword">not</span> a trusted <span class="keyword">or</span> secure host <span class="keyword">and</span> <span class="keyword">is</span> being ignored. <span class="keyword">If</span> this repository <span class="keyword">is</span> available via HTTPS it <span class="keyword">is</span> recommended <span class="keyword">to</span> <span class="keyword">use</span> HTTPS instead, otherwise you may silence this <span class="keyword">warning</span> <span class="keyword">and</span> <span class="keyword">allow</span> it anyways <span class="keyword">with</span> <span class="string">'--trusted-host mirrors.zol.com.cn'</span>.</span><br><span class="line">  Could <span class="keyword">not</span> find a <span class="keyword">version</span> that satisfies the requirement Flask (<span class="keyword">from</span> <span class="keyword">versions</span>: )</span><br><span class="line"><span class="keyword">No</span> matching distribution <span class="keyword">found</span> <span class="keyword">for</span> Flask</span><br></pre></td></tr></table></figure>
<p>主要是这句：<br>Could not find a version that satisfies the requirement Flask (from versions: )<br>No matching distribution found for Flask</p>
<p>困扰了好久，google也不到答案。 </p>
<p>其实这样使用就可以了：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">pip_pypy --trusted-host mirrors<span class="selector-class">.zol</span><span class="selector-class">.com</span><span class="selector-class">.cn</span> install Flask</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS6 ruby gems 安装]]></title>
      <url>http://blog.wuliwala.net/2015/07/14/centos6-ruby-gems-an-zhuang/</url>
      <content type="html"><![CDATA[<p>平时很少用到ruby，今天用到了，记录一下<br>ruby安装，并导入阿里云gems镜像</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">yum -y install ruby rubygems</span><br><span class="line">gem <span class="keyword">source</span> -r https:<span class="comment">//rubygems.org/</span></span><br><span class="line">gem <span class="keyword">source</span> -a http:<span class="comment">//mirrors.aliyun.com/rubygems/</span></span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS6 配置 vagrant + VirtualBox]]></title>
      <url>http://blog.wuliwala.net/2015/07/14/centos6-pei-zhi-vagrant-virtualbox/</url>
      <content type="html"><![CDATA[<p>安装vagrant1.7.2<br><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">wget http<span class="variable">s:</span>//<span class="keyword">dl</span>.bintray.<span class="keyword">com</span>/mitchellh/vagrant/vagrant_1.<span class="number">7.2</span>_x86_64.rpm</span><br><span class="line">rpm -ivh vagrant_1.<span class="number">7.2</span>_x86_64.rpm</span><br></pre></td></tr></table></figure></p>
<p>安装VirtualBox 4.2<br><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="meta"># curl http:<span class="comment">//download.virtualbox.org/virtualbox/rpm/el/virtualbox.repo &gt;/etc/yum.repos.d/virtualbox.repo</span></span></span><br><span class="line">yum -y install gcc make dkms libGL libXmu libXt SDL SDL-devel SDL-<span class="keyword">static</span> kernel-devel libpng libXcursor libXinerama fontconfig-devel freetype-devel VirtualBox<span class="number">-4.2</span></span><br></pre></td></tr></table></figure></p>
<p>安装VitrualBox中的重要提示信息<br><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">reating <span class="keyword">group</span> <span class="string">'vboxusers'</span>. VM users must be member <span class="keyword">of</span> that <span class="keyword">group</span>!</span><br></pre></td></tr></table></figure></p>
<p>启用dbus<br><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">chkconfig messagebus <span class="keyword">on</span></span><br></pre></td></tr></table></figure></p>
<p>如果执行VirtualBox报如下错误<br><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">No precompiled <span class="built_in">module</span> <span class="keyword">for</span> <span class="keyword">this</span> kernel found -- trying <span class="keyword">to</span> build one. Messages</span><br><span class="line">emitted during <span class="built_in">module</span> compilation will be logged <span class="keyword">to</span> /<span class="keyword">var</span>/log/vbox-install.log.</span><br></pre></td></tr></table></figure></p>
<p>查看日志可发现</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">Makefile:<span class="number">185</span>: *** <span class="built_in">Error</span>: unable to find the sources of your current Linux kernel. Specify KERN_DIR=&lt;directory&gt; <span class="keyword">and</span> <span class="keyword">run</span> <span class="built_in">Make</span> again.  <span class="keyword">Stop</span>.</span><br></pre></td></tr></table></figure>
<p>然后执行<br><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># KERN_DIR=<span class="regexp">/usr/</span>src<span class="regexp">/kernels/</span><span class="number">2.6</span>.<span class="number">32</span>-<span class="number">504.23</span>.<span class="number">4</span>.el6.x86_64 <span class="regexp">/etc/i</span>nit.d<span class="regexp">/vboxdrv setup</span></span><br></pre></td></tr></table></figure></p>
<p>运行过程中输出如下<br><figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">Stopping VirtualBox kernel modules <span class="string">[  OK  ]</span></span><br><span class="line">Uninstalling old VirtualBox DKMS kernel modules <span class="string">[  OK  ]</span></span><br><span class="line">Trying to register the VirtualBox kernel modules using DKMS <span class="string">[  OK  ]</span></span><br><span class="line">Starting VirtualBox kernel modules <span class="string">[  OK  ]</span></span><br></pre></td></tr></table></figure></p>
<p>然后重启系统<br><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">VBoxManage <span class="built_in">list</span> vms</span><br><span class="line">VBoxManage <span class="built_in">list</span> runningvms</span><br></pre></td></tr></table></figure></p>
<p>vagrant安装爬 墙 插件<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">https_proxy=<span class="string">https:</span><span class="comment">//yourporxy:3128 http_proxy=http://yourporxy:3128 vagrant plugin install vagrant-proxyconf</span></span><br></pre></td></tr></table></figure></p>
<p>vi Vagrantfile<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">config<span class="selector-class">.proxy</span><span class="selector-class">.http</span>     = <span class="string">"http://yourporxy:3128"</span></span><br><span class="line">config<span class="selector-class">.proxy</span><span class="selector-class">.https</span>    = <span class="string">"https://yourporxy:3128"</span></span><br><span class="line">config<span class="selector-class">.proxy</span><span class="selector-class">.no_proxy</span> = <span class="string">"localhost,127.0.0.1"</span></span><br></pre></td></tr></table></figure></p>
<p>vagrant的box文件可以通过迅雷加速下载到本地硬盘，然后通过命令导入，可节省大量时间<br><figure class="highlight processing"><table><tr><td class="code"><pre><span class="line">vagrant <span class="built_in">box</span> <span class="built_in">add</span> --name <span class="string">"centos-6.5-i386-vbox"</span> centos<span class="number">-65</span>-i386-vbox.<span class="built_in">box</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[OSv安装测试]]></title>
      <url>http://blog.wuliwala.net/2015/07/09/osvan-zhuang-ce-shi/</url>
      <content type="html"><![CDATA[<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">curl https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/cloudius-systems/capstan/master/scripts/download &gt;&gt;./</span> installcapstan</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># sh installcapstan </span></span><br><span class="line">Downloading Capstan binary: http:<span class="regexp">//</span>osv.capstan.s3.amazonaws.com/capstan/v0<span class="number">.1</span><span class="number">.8</span>/linux_amd64/capstan</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span> <span class="number">100.0</span>%</span><br></pre></td></tr></table></figure>
<p>执行命令<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# capstan </span><br><span class="line">NAME:</span><br><span class="line">   capstan - pack, ship, and run applications in light-weight VMs</span><br><span class="line"></span><br><span class="line">USAGE:</span><br><span class="line">   capstan [global options] command [command options] [arguments...]</span><br><span class="line"></span><br><span class="line">VERSION:</span><br><span class="line">   v0.1.8</span><br><span class="line"></span><br><span class="line">COMMANDS:</span><br><span class="line">   info		<span class="keyword">show</span> disk image information</span><br><span class="line">   <span class="keyword">import</span>	<span class="keyword">import</span> an image <span class="keyword">to</span> the <span class="keyword">local</span> repository</span><br><span class="line">   pull		pull an image <span class="keyword">from</span> a repository</span><br><span class="line">   rmi		<span class="keyword">delete</span> an image <span class="keyword">from</span> a repository</span><br><span class="line">   run		launch a VM. You may pass the image <span class="keyword">name</span> <span class="keyword">as</span> the <span class="keyword">first</span> argument.</span><br><span class="line">   <span class="keyword">build</span>	<span class="keyword">build</span> an image</span><br><span class="line">   images, i	<span class="keyword">list</span> images</span><br><span class="line">   <span class="keyword">search</span>	<span class="keyword">search</span> a remote images</span><br><span class="line">   instances, I	<span class="keyword">list</span> instances</span><br><span class="line">   <span class="keyword">stop</span>		<span class="keyword">stop</span> an <span class="keyword">instance</span></span><br><span class="line">   <span class="keyword">delete</span>	<span class="keyword">delete</span> an <span class="keyword">instance</span></span><br><span class="line">   <span class="keyword">help</span>, h	Shows a <span class="keyword">list</span> <span class="keyword">of</span> commands <span class="keyword">or</span> <span class="keyword">help</span> <span class="keyword">for</span> one command</span><br><span class="line">   </span><br><span class="line"><span class="keyword">GLOBAL</span> OPTIONS:</span><br><span class="line">   <span class="comment">--help, -h		show help</span></span><br><span class="line">   <span class="comment">--version, -v	print the version</span></span><br></pre></td></tr></table></figure></p>
<p>搜索官方镜像<br><figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="meta"># capstan search</span></span><br><span class="line"><span class="built_in">Name</span>                           Description                                        Version                   Created        </span><br><span class="line">cloudius/osv-base              OSv base <span class="built_in">image</span> <span class="keyword">for</span> developers                      v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">29</span>:<span class="number">46</span></span><br><span class="line">cloudius/osv-cassandra         Apache Cassandra/OSv                               v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">38</span>:<span class="number">48</span></span><br><span class="line">cloudius/osv-crash             OSv/CRaSH shell <span class="keyword">for</span> developers                     v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">35</span>:<span class="number">59</span></span><br><span class="line">cloudius/osv-iperf             iperf/OSv                                          v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">40</span>:<span class="number">46</span></span><br><span class="line">cloudius/osv-memcached-opt     OSv memcached server (optimized)                   v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">41</span>:<span class="number">14</span></span><br><span class="line">cloudius/osv-node              Node/OSv                                           v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">35</span>:<span class="number">30</span></span><br><span class="line">cloudius/osv-openjdk           OpenJDK <span class="number">7</span>/OSv base <span class="built_in">image</span> <span class="keyword">for</span> developers            v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">32</span>:<span class="number">52</span></span><br><span class="line">cloudius/osv-openjdk8          OpenJDK <span class="number">8</span>/OSv base <span class="built_in">image</span> <span class="keyword">for</span> developers            v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">33</span>:<span class="number">57</span></span><br><span class="line">cloudius/osv-redis-memonly     Redis (<span class="built_in">in</span>-memory only)                             v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">41</span>:<span class="number">45</span></span><br><span class="line">cloudius/osv-tomcat            Apache Tomcat/OSv                                  v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">39</span>:<span class="number">48</span></span><br><span class="line">cloudius/osv                   OSv <span class="keyword">with</span> shell <span class="keyword">for</span> users                           v0.<span class="number">22</span>                     <span class="number">2015</span>-<span class="number">07</span>-<span class="number">06</span>T09:<span class="number">36</span>:<span class="number">59</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Linux命令行获取HP iLo配置信息]]></title>
      <url>http://blog.wuliwala.net/2015/07/08/linux-hp-ilo-ming-ling-xing-gong-ju/</url>
      <content type="html"><![CDATA[<p>安装命令行工具</p>
<pre><code>#yum install hponcfg
</code></pre><p>测试一下</p>
<pre><code>#hponcfg -g
</code></pre><p>输出如下<br><figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">HP Lights-<span class="keyword">Out</span> Online Configuration utility</span><br><span class="line">Version <span class="number">4.1.</span><span class="number">0</span> Date <span class="number">1</span>/<span class="number">3</span>/<span class="number">2013</span> (c) Hewlett-Packard Company, <span class="number">2013</span></span><br><span class="line">Firmware Revision = <span class="number">1.81</span> Device <span class="keyword">type</span> = iLO <span class="number">2</span> Driver <span class="keyword">name</span> = hpilo</span><br><span class="line">Host Information:</span><br><span class="line">                        Server <span class="keyword">Name</span>: DL380G5PXXXX</span><br><span class="line">                        Server <span class="keyword">Number</span>: <span class="number">000000000</span></span><br></pre></td></tr></table></figure></p>
<p>编辑一个xml文件<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"># cat getinfo.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">RIBCL</span> <span class="attr">VERSION</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">LOGIN</span> <span class="attr">USER_LOGIN</span>=<span class="string">'yourusername'</span> <span class="attr">PASSWORD</span>=<span class="string">'yourpassword'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RIB_INFO</span> <span class="attr">MODE</span>=<span class="string">"read"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GET_NETWORK_SETTINGS</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">RIB_INFO</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">LOGIN</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RIBCL</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>执行命令</p>
<pre><code>#hponcfg -f getinfo.xml
</code></pre><p>输出如下<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">HP Lights-Out Online Configuration utility</span><br><span class="line">Version 4.1.0 Date 1/3/2013 (c) Hewlett-Packard Company, 2013</span><br><span class="line">Firmware Revision = 1.81 Device type = iLO 2 Driver name = hpilo</span><br><span class="line"><span class="tag">&lt;<span class="name">GET_NETWORK_SETTINGS</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ENABLE_NIC</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SHARED_NETWORK_PORT</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VLAN</span> <span class="attr">ENABLED</span>=<span class="string">"N"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">VLAN_ID</span> <span class="attr">VALUE</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SPEED_AUTOSELECT</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NIC_SPEED</span> <span class="attr">VALUE</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">FULL_DUPLEX</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DHCP_ENABLE</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DHCP_GATEWAY</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DHCP_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DHCP_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DHCP_STATIC_ROUTE</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DHCP_DOMAIN_NAME</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">REG_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">REG_DDNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"Y"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PING_GATEWAY</span> <span class="attr">VALUE</span>=<span class="string">"N"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MAC_ADDRESS</span> <span class="attr">VALUE</span>=<span class="string">"00:1e:0b:d9:a8:7a"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">IP_ADDRESS</span> <span class="attr">VALUE</span>=<span class="string">"10.15.xxx.xxx"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SUBNET_MASK</span> <span class="attr">VALUE</span>=<span class="string">"255.255.254.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GATEWAY_IP_ADDRESS</span> <span class="attr">VALUE</span>=<span class="string">"10.15.xxx.1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DNS_NAME</span> <span class="attr">VALUE</span>=<span class="string">"ILOCNGxxxxxxx"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DOMAIN_NAME</span> <span class="attr">VALUE</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PRIM_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SEC_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TER_DNS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PRIM_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SEC_WINS_SERVER</span> <span class="attr">VALUE</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">STATIC_ROUTE_1</span> <span class="attr">DEST</span>=<span class="string">"0.0.0.0"</span></span><br><span class="line">                    <span class="attr">GATEWAY</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">STATIC_ROUTE_2</span> <span class="attr">DEST</span>=<span class="string">"0.0.0.0"</span></span><br><span class="line">                    <span class="attr">GATEWAY</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">STATIC_ROUTE_3</span> <span class="attr">DEST</span>=<span class="string">"0.0.0.0"</span></span><br><span class="line">                    <span class="attr">GATEWAY</span>=<span class="string">"0.0.0.0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">GET_NETWORK_SETTINGS</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[DELL 部分型号 iPXE 不兼容问题]]></title>
      <url>http://blog.wuliwala.net/2015/07/03/dell-ipxe/</url>
      <content type="html"><![CDATA[<p>DELL R710 服务器iPXE启动报错问题，报错信息如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">1<span class="selector-class">.0</span><span class="selector-class">.0</span>(<span class="selector-tag">f557</span>)</span><br><span class="line"><span class="selector-tag">Link</span><span class="selector-pseudo">:up</span></span><br><span class="line"><span class="selector-tag">Configuring</span> (<span class="selector-tag">net0</span>)…… <span class="selector-tag">Error</span> 0<span class="selector-tag">x040ee119</span> </span><br><span class="line"><span class="selector-tag">No</span> <span class="selector-tag">more</span> <span class="selector-tag">network</span> <span class="selector-tag">devices</span></span><br></pre></td></tr></table></figure>
<p>在官网可以看到错误代码文档，以及可能的问题分析，还有直达源码的链接。<br><a href="http://ipxe.org/err/040ee1" target="_blank" rel="external">http://ipxe.org/err/040ee1</a></p>
<p>解决方案是升级 引导文件undionly.kpxe</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">yum -y install lzma xz-devel xz-libs lzip syslinux cdw</span><br><span class="line">git clone <span class="string">http:</span><span class="comment">//git.ipxe.org/ipxe.git</span></span><br><span class="line">cd ipxe<span class="regexp">/src/</span></span><br><span class="line">make</span><br><span class="line">cp bin<span class="regexp">/undionly.kpxe /</span>home<span class="regexp">/service/</span>PXE/</span><br></pre></td></tr></table></figure>
<p>把文件替换旧版本即可</p>
<p>重启服务器，网络引导成功</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用squid代理rsync]]></title>
      <url>http://blog.wuliwala.net/2015/06/23/squid/</url>
      <content type="html"><![CDATA[<p>由于新IDC和老IDC需要迁移部分数据，但新老两个IDC之间网络目前还没打通，但办公室网络两边都可以连通。<br>于是用squid搭个代理来同步数据。</p>
<p>office 10.21.2.2 squid proxy<br>老IDC  10.15.3.8 rsync src<br>新IDC  10.19.1.3 rsync dst</p>
<p>office的服务器10.21.2.2上搭建squid服务<br>yum install -y squid<br>vim /etc/squid/squid.conf<br>在配置文件最前面添加<br><figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="title">acl</span> idc_rule src <span class="number">10.19</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">22</span></span><br><span class="line"><span class="title">acl</span> <span class="type">SSL_port</span> <span class="keyword">port</span> 873 # for rsync  </span><br><span class="line"><span class="title">acl</span> <span class="type">Safe_port</span> <span class="keyword">port</span> 873 # for rsync  </span><br><span class="line"><span class="title">visible_hostname</span> localhost</span><br><span class="line"><span class="title">http_access</span> allow idc_rule</span><br></pre></td></tr></table></figure></p>
<p>service squid restart</p>
<p>在新idc的机器10.19.1.3上，运行下面命令<br>export RSYNC_PROXY=”10.21.2.2:3128”<br>rsync -avz –progress 10.15.3.8::iso/ ./</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[32位 XP server2003 连接vmware vCenter ESXi 5.5以上版本失败问题]]></title>
      <url>http://blog.wuliwala.net/2015/06/23/32wei-xp-server2003-lian-jie-vmware-vcenter-esxi-5-5yi-shang-ban-ben-shi-bai-wen-ti/</url>
      <content type="html"><![CDATA[<p>vSphere Client and vSphere PowerCLI may fail to connect to vCenter Server 5.5 due to a Handshake failure (2049143)</p>
<p>连到esxi 5.5 或 vCenter 5.5都要增加<cipherlist>ALL</cipherlist></p>
<p>F2 ，输入账号密码<br>进入Troubleshooting Options<br>EnableSSH</p>
<p>ssh 到 ESXi<br>cd /etc/vmware/rhttpproxy/<br>cp config.xml config_bak.xml<br>修改 config.xml ：vi config.xml<br>找到 <vmacore> 的 <ssl> 配置段<br>加上一行：<cipherlist>ALL</cipherlist></ssl></vmacore></p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="params">&lt;ssl&gt;</span></span><br><span class="line">          <span class="params">&lt;doVersionCheck&gt;</span> false <span class="params">&lt;/doVersionCheck&gt;</span></span><br><span class="line">          <span class="params">&lt;useCompression&gt;</span>true<span class="params">&lt;/useCompression&gt;</span></span><br><span class="line">          <span class="params">&lt;libraryPath&gt;</span><span class="meta-keyword">/lib/</span><span class="params">&lt;/libraryPath&gt;</span></span><br><span class="line">          <span class="params">&lt;cipherList&gt;</span>ALL<span class="params">&lt;/cipherList&gt;</span></span><br><span class="line"><span class="params">&lt;/ssl&gt;</span></span><br></pre></td></tr></table></figure>
<p>保存后重启服务：/etc/init.d/rhttpproxy restart</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CentOS 6.x git 1.7 clone gitlab 验证失败]]></title>
      <url>http://blog.wuliwala.net/2015/06/15/centos-6-x-git-1-7-clone-gitlab-yan-zheng-shi-bai/</url>
      <content type="html"><![CDATA[<p>最近要用测试机（CentOS6)测试项目代码，代码放在gitlab。<br>yum安装的git版本是1.7.1，在clone gitlab repo的时候，报如下错误。</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="string">error:</span> The requested URL returned <span class="string">error:</span> <span class="number">401</span> Unauthorized <span class="keyword">while</span> accessing <span class="string">https:</span><span class="comment">//gitlab.com/arkii/xxx.git/info/refs</span></span><br><span class="line"><span class="string">fatal:</span> HTTP request failed</span><br></pre></td></tr></table></figure>
<p>解决办法是升级git版本到2以上。<br>升级过程如下</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">wget https://github.com/git/git/archive/v2.4.3.tar.gz</span><br><span class="line">yum -y <span class="keyword">install</span> curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc xmlto docbook2x docbook2X</span><br><span class="line">tar -zxf v2<span class="number">.4</span><span class="number">.3</span>.tar.gz</span><br><span class="line">cd git<span class="number">-2.4</span><span class="number">.3</span></span><br><span class="line">make configure</span><br><span class="line">./configure <span class="comment">--prefix=/usr/local/git2.4.3</span></span><br><span class="line">make -j8 all doc info</span><br><span class="line">make <span class="keyword">install</span> <span class="keyword">install</span>-doc <span class="keyword">install</span>-html <span class="keyword">install</span>-info</span><br><span class="line"><span class="keyword">ln</span> -s /usr/<span class="keyword">local</span>/git2<span class="number">.4</span><span class="number">.3</span>/<span class="keyword">bin</span>/git /usr/<span class="keyword">bin</span>/</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[禁用chrome增强型书签管理器]]></title>
      <url>http://blog.wuliwala.net/2015/05/25/jin-yong-chromezeng-qiang-xing-shu-qian-guan-li-qi/</url>
      <content type="html"><![CDATA[<p>一直开着chrome自动更新，突然前段时间书签管理器变了，习惯之前的树形，书签都归类好了，突然来一简单粗暴的，还不习惯，每次添加都新书签都觉得好难用。</p>
<p>先关了吧，过一阵再研究。</p>
<p>打开 chrome://flags/#enhanced-bookmarks-experiment</p>
<p>设置为“Disabled”</p>
<p>重启chrome</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[docker-statsd-influxdb]]></title>
      <url>http://blog.wuliwala.net/2015/05/12/docker-statsd-influxdb/</url>
      <content type="html"><![CDATA[<p>本文介绍如何用docker封装一个支持graphite和influxdb作为后端数据存储的statsd image。</p>
<p>最近折腾监控系统<br>选用statsd作为数据代理，用于接收各种agent发来的读数，然后存到influxdb中。<br>statsd 目前在github上star有7500+。</p>
<p>注意:<br>使用statsd数据刷到influxdb中有10秒钟延迟，这是由于statsd的机制。</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/etsy/statsd.git</span><br></pre></td></tr></table></figure>
<p>Dockerfile<br><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat Dockerfile </span></span><br><span class="line"><span class="keyword">FROM</span>        arkii/node:slim</span><br><span class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</span><br><span class="line"><span class="keyword">COPY</span>        <span class="bash">./statsd /statsd</span><br><span class="line"></span><span class="keyword">ADD</span>         <span class="bash">config.js /statsd/config.js</span><br><span class="line"></span><span class="keyword">RUN</span>         <span class="bash"><span class="built_in">echo</span> <span class="string">'Asia/Shanghai'</span> &gt; /etc/timezone &amp;&amp; /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; <span class="built_in">cd</span> /statsd &amp;&amp; npm install statsd-influxdb-backend</span><br><span class="line"></span><span class="keyword">CMD</span>         <span class="bash">/statsd/bin/statsd <span class="string">"<span class="variable">$&#123;CONFIG_PATH:=/statsd/config.js&#125;</span>"</span></span><br><span class="line"></span><span class="keyword">EXPOSE</span>      <span class="number">8125</span>/udp <span class="number">8126</span>/tcp</span><br></pre></td></tr></table></figure></p>
<p>docker-compose/fig 配置文件<br><figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># cat fig.yml </span><br><span class="line">statsd:</span><br><span class="line">  image: arkii/statsd:influxdb</span><br><span class="line">  dns: 172.17.42.1</span><br><span class="line">  ports:</span><br><span class="line">    -<span class="ruby"> <span class="string">"8125:8125/udp"</span></span><br><span class="line"></span>    -<span class="ruby"> <span class="string">"8126:8126/tcp"</span></span><br><span class="line"></span>  environment:</span><br><span class="line">    -<span class="ruby"> PATH=<span class="regexp">/sbin:/usr</span><span class="regexp">/sbin:/bin</span><span class="symbol">:/usr/bin</span><span class="symbol">:/usr/local/bin</span></span><br><span class="line"></span>    -<span class="ruby"> INFLUXDB_HOST=<span class="number">10.21</span>.<span class="number">9.61</span></span><br><span class="line"></span>    -<span class="ruby"> STATSD_DEBUG=<span class="keyword">true</span></span></span><br></pre></td></tr></table></figure></p>
<p>启动脚本<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat service.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sysctl -w net.nf_conntrack_max=655360</span><br><span class="line">sysctl -w vm.max_map_count=262144</span><br><span class="line"><span class="built_in">ulimit</span> -n 65536</span><br><span class="line">/usr/bin/fig up <span class="_">-d</span> --allow-insecure-ssl</span><br></pre></td></tr></table></figure></p>
<p>statsd配置文件，支持启动时指定变量<br><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat config.js </span></span><br><span class="line">&#123;<span class="comment"></span><br><span class="line">//  graphitePort: 2003,</span><span class="comment"></span><br><span class="line">//  graphiteHost: "graphite.example.com",</span></span><br><span class="line">  port: <span class="number">8125</span>,<span class="comment"></span><br><span class="line">//  backends: [ "./backends/graphite", "statsd-influxdb-backend" ],</span></span><br><span class="line">  debug: <span class="built_in">process</span>.env.STATSD_DEBUG || <span class="literal">false</span>,</span><br><span class="line">  backends: [ <span class="string">"statsd-influxdb-backend"</span> ],</span><br><span class="line">  influxdb: &#123;</span><br><span class="line">    host: <span class="built_in">process</span>.env.INFLUXDB_HOST || <span class="string">'127.0.0.1'</span>,  <span class="comment"> // InfluxDB host. (default 127.0.0.1)</span></span><br><span class="line">    port: <span class="built_in">process</span>.env.INFLUXDB_PORT || <span class="number">8086</span>,         <span class="comment"> // InfluxDB port. (default 8086)</span></span><br><span class="line">    <span class="built_in">version</span>: <span class="number">0.8</span>,                                    <span class="comment"> // InfluxDB port. (default 0.8)</span></span><br><span class="line">    ssl: <span class="literal">false</span>,                                      <span class="comment"> // InfluxDB is hosted over SSL. (default false)</span></span><br><span class="line">    database: <span class="built_in">process</span>.env.INFLUXDB_DB || <span class="string">"statsd"</span>,   <span class="comment"> // InfluxDB database instance. (required)</span></span><br><span class="line">    username: <span class="built_in">process</span>.env.INFLUXDB_USER || <span class="string">"root"</span>,   <span class="comment"> // InfluxDB database username. (required)</span></span><br><span class="line">    password: <span class="built_in">process</span>.env.INFLUXDB_PASS || <span class="string">"root"</span>,   <span class="comment"> // InfluxDB database password. (required)</span></span><br><span class="line">    flush: &#123;</span><br><span class="line">      enable: <span class="literal">true</span>      <span class="comment"> // Enable regular flush strategy. (default true)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      enable: <span class="literal">false</span>,      <span class="comment"> // Enable the proxy strategy. (default false)</span></span><br><span class="line">      suffix: <span class="string">'raw'</span>,      <span class="comment"> // Metric name suffix. (default 'raw')</span></span><br><span class="line">      flushInterval: <span class="number">1000</span> <span class="comment"> // Flush interval for the internal buffer.</span></span><br><span class="line">                          <span class="comment"> // (default 1000)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    includeStatsdMetrics: <span class="literal">false</span>,<span class="comment"> // Send internal statsd metrics to InfluxDB. (default false)</span></span><br><span class="line">    includeInfluxdbMetrics: <span class="literal">false</span><span class="comment"> // Send internal backend metrics to InfluxDB. (default false)</span></span><br><span class="line">                                 <span class="comment"> // Requires includeStatsdMetrics to be enabled.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>启动容器<br><figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">./<span class="class"><span class="keyword">service</span>.<span class="title">sh</span></span></span><br></pre></td></tr></table></figure></p>
<p>查看容器日志和debug信息<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">fig</span> logs</span><br></pre></td></tr></table></figure></p>
<p>直接使用我的镜像<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">docker pull arkii/<span class="string">statsd:</span>influxdb</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/etsy/statsd" target="_blank" rel="external">statsd项目地址</a></p>
<p><a href="https://github.com/bernd/statsd-influxdb-backend" target="_blank" rel="external">statsd-influxdb-backend项目地址</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>http://blog.wuliwala.net/2015/01/23/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(data, key)</span>:</span></span><br><span class="line">    <span class="string">"""docstring for query"""</span></span><br><span class="line">    pattern = re.compile(key, re.IGNORECASE)</span><br><span class="line">    records = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> data.items():</span><br><span class="line">        match = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">if</span> pattern.match(k):</span><br><span class="line">            match = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> v.items():</span><br><span class="line">            <span class="keyword">if</span> isinstance(y, list):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> y:</span><br><span class="line">                    <span class="keyword">if</span> pattern.match(i):</span><br><span class="line">                        match = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> pattern.match(x):</span><br><span class="line">                    match = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="keyword">if</span> records.get(k):</span><br><span class="line">                records[k] = v</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                records.setdefault(k, v)</span><br><span class="line">    <span class="keyword">return</span> records</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用dnspod实现动态dns]]></title>
      <url>http://blog.wuliwala.net/2015/01/12/dnspod-ddns/</url>
      <content type="html"><![CDATA[<p>最近家里换了联通的30M带宽，刚好可以在家里电脑上搭个网站。</p>
<p>域名是托管在dnspod上。</p>
<p>用python写了个程序，获取公网IP，并调用dnspod的API，来更新dns记录。</p>
<p>DNSPod 貌似现在更改了 API 接口了，会自动读取请求主机的 IP 并且更新记录。</p>
<ul>
<li><p>注意事项：</p>
<ul>
<li>如果1小时之内，提交了超过5次没有任何变动的记录修改请求，该记录会被系统锁定1小时，不允许再次修改，所以在开发和测试的过程中，请自行处理IP变动，仅在本地IP发生变动的情况下才调用本接口。</li>
<li>如何理解没有任何变动的记录修改请求？比如原记录值已经是 1.1.1.1，新的请求还要求修改为 1.1.1.1。</li>
</ul>
</li>
</ul>
<p>替换上你的Email，密码，域名ID，记录ID等参数，就可以运行了。 会在后台一直运行，每隔30秒检查一遍IP，如果修改了就更新IP。</p>
<p>获得domain_id可以用curl</p>
<pre><code>curl -k https://dnsapi.cn/Domain.List -d &quot;login_email=xxx&amp;login_password=xxx&quot;
</code></pre><p>获得record_id类似</p>
<pre><code>curl -k https://dnsapi.cn/Record.List -d &quot;login_email=xxx&amp;login_password=xxx&amp;domain_id=xxx&quot;
</code></pre><p><a href="https://github.com/ARKII/dnspod-ddns" target="_blank" rel="external">下载</a></p>
<p><a href="https://www.dnspod.cn/docs/records.html#dns" target="_blank" rel="external">dnspod api文档</a></p>
<p><a href="https://gist.github.com/chuangbo/833369" target="_blank" rel="external">参考</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[在docker中使用cron]]></title>
      <url>http://blog.wuliwala.net/2015/01/12/run-crond-in-container/</url>
      <content type="html"><![CDATA[<h2 id="docker-crond解决方案"><a href="#docker-crond解决方案" class="headerlink" title="docker crond解决方案"></a>docker crond解决方案</h2><p>容器技术给我们带来极大便利的同时也带来一些必须要做的改变，比如以前在应用服务器中运行的cron定时任务就不能用原有的方式运行。<br>本文基于centos，介绍如何解决使用容器技术时的定时任务问题。</p>
<p>具体思路就是：<br>在你的应用环境image上面再commit一层crond<br>1.封装一个应用image<br>2.封装一个crond image，但是以应用image为base</p>
<p>假设已有的应用环境image为 arkii/lamp 是我的 php运行环境</p>
<p>mkdir build &amp;&amp; cd build<br>cat Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span>        arii/lamp</span><br><span class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</span><br><span class="line"><span class="keyword">RUN</span>         <span class="bash">yum -y install vixie-cron supervisor &amp;&amp; yum clean all &amp;&amp; rm <span class="_">-f</span> /var/<span class="built_in">log</span>/yum.log</span><br><span class="line"></span><span class="keyword">RUN</span>         <span class="bash">sed -ie <span class="string">'/pam_loginuid/d'</span> /etc/pam.d/crond</span><br><span class="line"></span><span class="keyword">ADD</span>         <span class="bash">supervisord.conf /etc/supervisord.conf</span><br><span class="line"></span><span class="keyword">CMD</span>         <span class="bash">[<span class="string">"/usr/bin/supervisord"</span>, <span class="string">"-c"</span>, <span class="string">"/etc/supervisord.conf"</span>]</span></span><br></pre></td></tr></table></figure>
<p>cat supervisord.conf</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[supervisord]</span></span><br><span class="line"><span class="attr">nodaemon</span>=<span class="literal">true</span></span><br><span class="line"><span class="section">[program:crond]</span></span><br><span class="line"><span class="attr">command</span>=/usr/sbin/crond -n</span><br><span class="line"><span class="attr">log_stdout</span>=<span class="literal">true</span>             </span><br><span class="line"><span class="attr">log_stderr</span>=<span class="literal">true</span>             </span><br><span class="line"><span class="attr">logfile</span>=/db/logs/crond.log  </span><br><span class="line"><span class="attr">logfile_maxbytes</span>=<span class="number">512</span>MB</span><br><span class="line"><span class="attr">logfile_backups</span>=<span class="number">10</span></span><br><span class="line"><span class="section"></span><br><span class="line">[program:crontab]</span></span><br><span class="line"><span class="attr">command</span>=/usr/bin/crontab /db/config/crontab</span><br></pre></td></tr></table></figure>
<p>从宿主机启动crond容器</p>
<p>宿主机中</p>
<p>日志目录/db/logs</p>
<p>crontab文件存放位置/db/app/config/crontab</p>
<p>在宿主机中修改/db/app/config/crontab 容器中inotify机制会自动更新crontab，不需重启容器。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">APPNAME=<span class="string">'crond-in-container'</span></span><br><span class="line">APPID=$(docker ps| grep <span class="variable">$&#123;APPNAME&#125;</span> | awk <span class="string">'&#123;print$1&#125;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$&#123;APPID&#125;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;APPNAME&#125;</span> not running ..."</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    docker stop <span class="variable">$&#123;APPID&#125;</span></span><br><span class="line">    docker rm <span class="variable">$&#123;APPID&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">docker run <span class="_">-d</span> --name=<span class="variable">$&#123;APPNAME&#125;</span> \</span><br><span class="line">-v /db/logs:/db/logs \</span><br><span class="line">-v /db/app/config/crontab:/db/config/crontab \</span><br><span class="line">arkii/crond</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
  
  
    
    <entry>
      <title><![CDATA[about]]></title>
      <url>http://blog.wuliwala.net/about/index.html</url>
      <content type="html"><![CDATA[<p>关于我<br>email sqy6#163.com<br>blog <a href="http://blog.wuliwala.net">http://blog.wuliwala.net</a><br>blog mirror <a href="http://arkii.github.io" target="_blank" rel="external">http://arkii.github.io</a><br>github <a href="https://github.com/arkii" target="_blank" rel="external">https://github.com/arkii</a><br>dockerhub <a href="https://hub.docker.com/u/arkii/" target="_blank" rel="external">https://hub.docker.com/u/arkii/</a>  </p>
<p>wechat<br><img src="/images/2015/07/1-pic_hd-1.jpg" alt="alt"></p>
]]></content>
    </entry>
    
  
</search>
