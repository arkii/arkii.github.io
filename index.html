<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tranquility Garden</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Focus on Python Cloud Container DevOps.">
<meta property="og:type" content="website">
<meta property="og:title" content="Tranquility Garden">
<meta property="og:url" content="http://blog.wuliwala.net/index.html">
<meta property="og:site_name" content="Tranquility Garden">
<meta property="og:description" content="Focus on Python Cloud Container DevOps.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tranquility Garden">
<meta name="twitter:description" content="Focus on Python Cloud Container DevOps.">
  
    <link rel="alternate" href="http://blog.wuliwala.net/atom.xml" title="Tranquility Garden" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
<!--  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-72217808-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tranquility Garden</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="http://blog.wuliwala.net">Home</a>
        
          <a class="main-nav-link" href="http://blog.wuliwala.net/archives">Archives</a>
        
          <a class="main-nav-link" href="http://blog.wuliwala.net/about">About</a>
        
          <a class="main-nav-link" href="https://github.com/arkii">GitHub</a>
        
          <a class="main-nav-link" href="https://hub.docker.com/u/arkii">DockerHub</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="http://blog.wuliwala.net/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.wuliwala.net"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-migrate-to-git-from-svn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/14/migrate-to-git-from-svn/" class="article-date">
  <time datetime="2016-03-14T11:01:00.000Z" itemprop="datePublished">2016-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/14/migrate-to-git-from-svn/">Migration From Subversion(svn) to Git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="migration-from-subversion-svn-to-git"><a href="#migration-from-subversion-svn-to-git" class="headerlink" title="migration from subversion(svn) to git"></a>migration from subversion(svn) to git</h2><p>git officiall documents<br><a href="https://git-scm.com/docs/git-svn" target="_blank" rel="external">https://git-scm.com/docs/git-svn</a><br><a href="https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git" target="_blank" rel="external">https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E4%B8%8E%E5%85%B6%E4%BB%96%E7%B3%BB%E7%BB%9F-%E4%BD%9C%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84-Git" target="_blank" rel="external">https://git-scm.com/book/zh/v2/Git-与其他系统-作为客户端的-Git</a>  </p>
<p>install the latest git  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum -y install subversion subversion-perl perl-TermReadKey curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc xmlto docbook2x docbook2X</span><br><span class="line"></span><br><span class="line">wget https://www.kernel.org/pub/software/scm/git/git-2.7.3.tar.gz</span><br><span class="line">tar xvf git-2.7.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> git-2.7.3</span><br><span class="line">make configure</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/git2.7.3</span><br><span class="line">make -j8 all doc info</span><br><span class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/git2.7.3/bin/git /usr/bin/</span><br><span class="line"></span><br><span class="line">vim ~/.subversion/servers</span><br><span class="line"><span class="comment"># let store-passwords = yes</span></span><br><span class="line"></span><br><span class="line">git svn <span class="built_in">clone</span> --username dev https://svn.yourdomain.com/yourrepo</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> yourrepo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首次 first time</span></span><br><span class="line">git branch <span class="_">-a</span> </span><br><span class="line">git show-ref</span><br><span class="line"><span class="comment"># push to gitlab server</span></span><br><span class="line">git remote add origin ssh://git@gitlab.yourdomain.com/svn/yourrepo.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 update</span></span><br><span class="line">git svn fetch &amp;&amp; git svn rebase</span><br><span class="line">git push</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2016/03/14/migrate-to-git-from-svn/" data-id="cilvxzsoq000vd9s64xjv5svd" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2016/03/14/migrate-to-git-from-svn/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-searchcode-server-community-deploy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/08/searchcode-server-community-deploy/" class="article-date">
  <time datetime="2016-03-08T07:01:00.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/productivity/">productivity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/searchcode-server-community-deploy/">Searchcode Server Community Deploy</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Searchcode-Server-Community-Deploy"><a href="#Searchcode-Server-Community-Deploy" class="headerlink" title="Searchcode Server Community Deploy"></a>Searchcode Server Community Deploy</h1><h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p><a href="https://searchcode.com" target="_blank" rel="external">https://searchcode.com</a></p>
<h2 id="query-syntax"><a href="#query-syntax" class="headerlink" title="query syntax"></a>query syntax</h2><p><a href="https://searchcode.com/#jumbo-examples" target="_blank" rel="external">https://searchcode.com/#jumbo-examples</a></p>
<h2 id="requirement"><a href="#requirement" class="headerlink" title="requirement"></a>requirement</h2><ul>
<li>Linux (in this example, I’m using CentOS6)  </li>
<li>JRE 8u65 <a href="http://www.oracle.com/technetwork/java/javase/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/archive-139210.html</a>  </li>
<li>searchcode-server-community 1.0.0 <a href="https://searchcode.com/static/searchcode-server-community.tar.gz" target="_blank" rel="external">https://searchcode.com/static/searchcode-server-community.tar.gz</a>  </li>
</ul>
<h2 id="installation"><a href="#installation" class="headerlink" title="installation"></a>installation</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># download jre package from java archive website</span></span><br><span class="line">rpm -ivh jre-8u65-linux-x64.rpm</span><br><span class="line">wget https://searchcode.com/static/searchcode-server-community.tar.gz</span><br><span class="line">tar xf searchcode-server-community.tar.gz</span><br><span class="line">searchcode-server-community/release</span><br><span class="line">java -jar searchcode-1.0.0.jar</span><br></pre></td></tr></table></figure>
<p><strong>visit <a href="http://yourserverip:8080/" target="_blank" rel="external">http://yourserverip:8080/</a></strong>  </p>
<h2 id="use-my-docker-image"><a href="#use-my-docker-image" class="headerlink" title="use my docker image"></a>use my docker image</h2><p>run image directly  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -p 8080:8080 <span class="_">-d</span> docker.io/arkii/searchcode-server</span><br></pre></td></tr></table></figure>
<p>or run image with docker-compose<br>docker-compose.yml<br><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">searchcode:</span></span><br><span class="line"><span class="attr">  image:</span> arkii/searchcode-server</span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/index:/srv/index</span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/repo:/srv/repo</span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.properties:/srv/searchcode.properties</span><br><span class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.sqlite:/srv/searchcode.sqlite</span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"8080:8080/tcp"</span></span><br></pre></td></tr></table></figure></p>
<p><strong>visit <a href="http://yourdockerserverip:8080/" target="_blank" rel="external">http://yourdockerserverip:8080/</a></strong>  </p>
<p>To administer your searchcode server instance you need to click on the Admin link in the top right.<br>Enter the default password <strong>Adm1n234</strong></p>
<h2 id="Dockerfiles"><a href="#Dockerfiles" class="headerlink" title="Dockerfiles"></a>Dockerfiles</h2><p><strong>build JRE 8u65 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span>        centos:<span class="number">6</span></span><br><span class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</span><br><span class="line"><span class="keyword">COPY</span>        <span class="bash">./jre-8u65-linux-x64.rpm /tmp/jre-8u65-linux-x64.rpm</span><br><span class="line"></span><span class="keyword">RUN</span>         <span class="bash">rpm -ivh /tmp/jre-8u65-linux-x64.rpm &amp;&amp; rm <span class="_">-f</span> /tmp/jre-8u65-linux-x64.rpm</span></span><br></pre></td></tr></table></figure>
<p><strong>build Searchcode Server Community 1.0.0 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span>        arkii/centos6-jre-<span class="number">8</span>u6<span class="number">5</span><br><span class="line"></span><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</span><br><span class="line"><span class="keyword">COPY</span>        <span class="bash">./searchcode-server-community/release /srv</span><br><span class="line"></span><span class="keyword">WORKDIR</span>     <span class="bash">/srv</span><br><span class="line"></span><span class="keyword">CMD</span>         <span class="bash">/usr/bin/java -jar searchcode-1.0.0.jar</span><br><span class="line"></span><span class="keyword">EXPOSE</span>      <span class="number">8080</span>/tcp</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2016/03/08/searchcode-server-community-deploy/" data-id="cilvxzsp00010d9s6q2pmc4fm" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2016/03/08/searchcode-server-community-deploy/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/devops/">devops</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-wall-e-web-deployment" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/01/wall-e-web-deployment/" class="article-date">
  <time datetime="2016-03-01T06:20:00.000Z" itemprop="datePublished">2016-03-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/productivity/">productivity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/01/wall-e-web-deployment/">Wall-E web deployment</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Wall-E-web-deployment"><a href="#Wall-E-web-deployment" class="headerlink" title="Wall-E web deployment"></a>Wall-E web deployment</h1><p>项目地址<br><a href="http://walle-web.io/" target="_blank" rel="external">http://walle-web.io/</a>  </p>
<p>安装文档<br><a href="http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html" target="_blank" rel="external">http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html</a>  </p>
<p>问题FAQ<br><a href="https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md" target="_blank" rel="external">https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md</a>  </p>
<p><a href="https://github.com/meolu/walle-web/archive/master.zip" target="_blank" rel="external">https://github.com/meolu/walle-web/archive/master.zip</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">rpm -Uvh http://mirror.webtatic.com/yum/el6/latest.rpm</span><br><span class="line">yum install -y php56w.x86_64 php56w-cli.x86_64 php56w-common.x86_64 php56w-gd.x86_64 php56w-ldap.x86_64 php56w-mbstring.x86_64 php56w-mcrypt.x86_64 php56w-mysql.x86_64 php56w-pdo.x86_64 php56w-xml.x86_64</span><br><span class="line">wget https://getcomposer.org/installer &amp;&amp; php installer &amp;&amp; mv composer.phar /usr/<span class="built_in">local</span>/bin/composer</span><br><span class="line"></span><br><span class="line">wget https://github.com/meolu/walle-web/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> walle-web-master</span><br><span class="line">composer install</span><br><span class="line"><span class="comment">#composer install --aprefer-dist --no-dev --optimize-autoloader -vvvv</span></span><br><span class="line"></span><br><span class="line">vi config/local.php</span><br><span class="line"></span><br><span class="line">./yii walle/setup</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> vendor</span><br><span class="line">ln <span class="_">-s</span> bower-asset/ bower</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;VirtualHost *:80&gt;</span><br><span class="line">ServerName walle.xxx.com</span><br><span class="line">DocumentRoot /var/www/html/web</span><br><span class="line">    &lt;Directory "/var/www/html/web"&gt;</span><br><span class="line">      Options  FollowSymLinks</span><br><span class="line">        AllowOverride ALL</span><br><span class="line">        Order allow,deny</span><br><span class="line">        Allow from all</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;'</span> &gt; /etc/httpd/conf.d/walle.conf</span><br></pre></td></tr></table></figure>
<p>default account<br>admin:admin</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2016/03/01/wall-e-web-deployment/" data-id="cilvxzsp90018d9s6tbgxln3q" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2016/03/01/wall-e-web-deployment/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/devops/">devops</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ionic-web-app-dev" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/15/ionic-web-app-dev/" class="article-date">
  <time datetime="2016-02-15T02:42:00.000Z" itemprop="datePublished">2016-02-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/dev/">dev</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/15/ionic-web-app-dev/">ionic hybrid app development</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ionic-hybrid-app-development"><a href="#ionic-hybrid-app-development" class="headerlink" title="ionic hybrid app development"></a>ionic hybrid app development</h1><h2 id="Video-Show"><a href="#Video-Show" class="headerlink" title="Video Show"></a>Video Show</h2><p><a href="/images/2016/02/15/ionic-dev-icinga-zol-480p.mov">video show</a>  </p>
<h2 id="Frontend"><a href="#Frontend" class="headerlink" title="Frontend"></a>Frontend</h2><h3 id="ionic"><a href="#ionic" class="headerlink" title="ionic"></a>ionic</h3><p><a href="http://ionicframework.com/getting-started/" target="_blank" rel="external">getting-started</a><br><a href="http://usecreator.com/" target="_blank" rel="external">usecreator</a><br><a href="https://creator.ionic.io/app/dashboard/help/videos" target="_blank" rel="external">videos for creator</a><br><a href="http://codepen.io/ionic/pens/public/" target="_blank" rel="external">Many examples on codepen</a><br><a href="http://www.runoob.com/ionic" target="_blank" rel="external">courses on w3school.cc</a>  </p>
<h4 id="install-ionic"><a href="#install-ionic" class="headerlink" title="install ionic"></a>install ionic</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install -g cordova ionic</span><br><span class="line">ionic start myApp blank</span><br><span class="line">ionic start myApp tabs</span><br><span class="line">ionic start myApp sidemenu</span><br></pre></td></tr></table></figure>
<h3 id="run-or-emulate-your-app"><a href="#run-or-emulate-your-app" class="headerlink" title="run or emulate your app"></a>run or emulate your app</h3><p><a href="http://ionicframework.com/docs/cli/run.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/run.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#安装cordova/ionic</span></span><br><span class="line">npm install -g cordova ionic</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加平台(ios相关操作请在mac机器下o(&gt;﹏&lt;)o)</span></span><br><span class="line">ionic platform add android/ios</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新项目中的ionic js类库</span></span><br><span class="line">ionic lib update</span><br><span class="line"></span><br><span class="line"><span class="comment">#展示ionic项目结果 (同时显示iOS和android上的样式)</span></span><br><span class="line">ionic serve --lab</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装/删除crosswalk</span></span><br><span class="line">ionic browser add/remove crosswalk</span><br></pre></td></tr></table></figure>
<h3 id="Icon-and-Splash-Screen-Image-Generation"><a href="#Icon-and-Splash-Screen-Image-Generation" class="headerlink" title="Icon and Splash Screen Image Generation"></a>Icon and Splash Screen Image Generation</h3><p>Guide below<br><a href="http://ionicframework.com/docs/cli/icon-splashscreen.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/icon-splashscreen.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cp ~/Downloads/logo11/free_logo_11.ai ./resources/icon.ai</span><br><span class="line">ionic resources --icon</span><br></pre></td></tr></table></figure>
<h3 id="splash-screen"><a href="#splash-screen" class="headerlink" title="splash screen"></a>splash screen</h3><p>2208 x 2208 splash.png  </p>
<p>search images on Google , set resolution to 2208 x 2208  </p>
<h2 id="Build-android-package"><a href="#Build-android-package" class="headerlink" title="Build android package"></a>Build android package</h2><p>Follow this guide<br><a href="http://ionicframework.com/docs/guide/publishing.html" target="_blank" rel="external">http://ionicframework.com/docs/guide/publishing.html</a>  </p>
<h3 id="安装android-sdk"><a href="#安装android-sdk" class="headerlink" title="安装android sdk"></a>安装android sdk</h3><p><a href="http://developer.android.com/sdk/installing/index.html" target="_blank" rel="external">http://developer.android.com/sdk/installing/index.html</a><br>Download Stand-alone SDK Tools  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget <span class="string">'http://dl.google.com/android/android-sdk_r24.4.1-macosx.zip'</span></span><br><span class="line">unzip android-sdk_r24.4.1-macosx.zip</span><br><span class="line">mv android-sdk-macosx /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export ANDROID_HOME="/usr/local/android-sdk-macosx"'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$PATH:$ANDROID_HOME/tools"'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'http.proxyPort=8123'</span> &gt;&gt; ~/.android/androidtool.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'http.proxyHost=127.0.0.1'</span> &gt;&gt; ~/.android/androidtool.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># android update sdk --no-ui</span></span><br><span class="line">android update sdk --no-https --no-ui --filter platform,system-image,tool,platform-tool</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT_FOLDER</span></span><br><span class="line"></span><br><span class="line">vim config.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">#we should remove debug console plugin before generating the release builds</span></span><br><span class="line"></span><br><span class="line">cordova plugin rm cordova-plugin-console</span><br><span class="line"></span><br><span class="line">cordova build --release android</span><br><span class="line"></span><br><span class="line">/bin/cp platforms/android/build/outputs/apk/android-release-unsigned.apk ./</span><br><span class="line"></span><br><span class="line"><span class="comment"># keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000</span></span><br><span class="line">keytool -genkey -v -keystore icinga-mobile-release-key.keystore -alias icinga_mobile -keyalg RSA -keysize 2048 -validity 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore android-release-unsigned.apk alias_name</span></span><br><span class="line">jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore icinga-mobile-release-key.keystore android-release-unsigned.apk icinga_mobile</span><br><span class="line"></span><br><span class="line"><span class="comment"># zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</span></span><br><span class="line">/usr/<span class="built_in">local</span>/android-sdk-macosx/build-tools/23.0.2/zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</span><br></pre></td></tr></table></figure>
<h2 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h2><p>style is much mess on Android  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .config(function($stateProvider, $urlRouterProvider) &#123;</span></span><br><span class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$stateProvider, $urlRouterProvider , $ionicConfigProvider</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.tabs.style(<span class="string">'standard'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.ios.tabs.position(<span class="string">'bottom'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.tabs.style(<span class="string">'standard'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.tabs.position(<span class="string">'standard'</span>);</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.navBar.alignTitle(<span class="string">'center'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.navBar.alignTitle(<span class="string">'left'</span>);</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-ios-arrow-thin-left'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-android-arrow-back'</span>);</span><br><span class="line"></span><br><span class="line">  $ionicConfigProvider.platform.ios.views.transition(<span class="string">'ios'</span>);</span><br><span class="line">  $ionicConfigProvider.platform.android.views.transition(<span class="string">'android'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ionic uses AngularUI Router which uses the concept of states</span></span><br><span class="line">  <span class="comment">// Learn more here: https://github.com/angular-ui/ui-router</span></span><br><span class="line">  <span class="comment">// Set up the various states which the app can be in.</span></span><br><span class="line">  <span class="comment">// Each state's controller can be found in controllers.js</span></span><br><span class="line">  $stateProvider</span><br></pre></td></tr></table></figure>
<h2 id="Useful-resources"><a href="#Useful-resources" class="headerlink" title="Useful resources"></a>Useful resources</h2><h3 id="vuejs"><a href="#vuejs" class="headerlink" title="vuejs"></a>vuejs</h3><p><a href="http://vuejs.org/" target="_blank" rel="external">vuejs</a><br><a href="https://github.com/vuejs/awesome-vue" target="_blank" rel="external">awesome-vue</a></p>
<h3 id="MaterializeCSS"><a href="#MaterializeCSS" class="headerlink" title="MaterializeCSS"></a>MaterializeCSS</h3><p><a href="http://materializecss.com/mobile.html" target="_blank" rel="external">Materialize</a>  </p>
<h2 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h2><p><a href="http://flask-restful.readthedocs.org/" target="_blank" rel="external">Flask-RESTful</a></p>
<h2 id="SDK-installation-output"><a href="#SDK-installation-output" class="headerlink" title="SDK installation output"></a>SDK installation output</h2><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">Running command: /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/hooks/after_prepare/010_add_platform_class.js /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend</span><br><span class="line">add to body <span class="keyword">class</span>: platform-android</span><br><span class="line"><span class="keyword">ERROR</span> building <span class="keyword">one</span> of the platforms: Please install Android target: <span class="string">"android-23"</span>.</span><br><span class="line"></span><br><span class="line">Hint: <span class="keyword">Open</span> the SDK manager <span class="keyword">by</span> running: /usr/<span class="keyword">local</span>/android-sdk-macosx/tools/android</span><br><span class="line">You will require:</span><br><span class="line">1. <span class="string">"SDK Platform"</span> <span class="keyword">for</span> android-23</span><br><span class="line">2. "Android SDK Platform-tools (latest)</span><br><span class="line">3. <span class="string">"Android SDK Build-tools"</span> (latest)</span><br><span class="line">You may not have the required environment or OS to build this project</span><br><span class="line"><span class="keyword">Error</span>: Please install Android target: <span class="string">"android-23"</span>.</span><br><span class="line"></span><br><span class="line">Hint: <span class="keyword">Open</span> the SDK manager <span class="keyword">by</span> running: /usr/<span class="keyword">local</span>/android-sdk-macosx/tools/android</span><br><span class="line">You will require:</span><br><span class="line">1. <span class="string">"SDK Platform"</span> <span class="keyword">for</span> android-23</span><br><span class="line">2. "Android SDK Platform-tools (latest)</span><br><span class="line">3. <span class="string">"Android SDK Build-tools"</span> (latest)</span><br></pre></td></tr></table></figure>
<h2 id="Android-build-process-output"><a href="#Android-build-process-output" class="headerlink" title="Android build process output"></a>Android build process output</h2><figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">Running command: /Users/arkii/Workspace/Projects/icinga<span class="attr">-dashboard</span><span class="attr">-mobile</span>/frontend/hooks/after_prepare/<span class="number">010</span>_add_platform_class.js /Users/arkii/Workspace/Projects/icinga<span class="attr">-dashboard</span><span class="attr">-mobile</span>/frontend</span><br><span class="line">add <span class="keyword">to</span> body class: platform<span class="attr">-android</span></span><br><span class="line">ANDROID_HOME=/usr/<span class="built_in">local</span>/android<span class="attr">-sdk</span><span class="attr">-macosx</span></span><br><span class="line">JAVA_HOME=/Library/Java/Home</span><br><span class="line">Downloading http:<span class="comment">//services.gradle.org/distributions/gradle-2.2.1-all.zip</span></span><br><span class="line"><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.</span><br><span class="line">:compileReleaseNdk UP<span class="attr">-TO</span><span class="attr">-DATE</span></span><br><span class="line">:compileReleaseSources</span><br><span class="line">:lintVitalRelease</span><br><span class="line">:transformClassesWithDexForRelease</span><br><span class="line">:mergeReleaseJniLibFolders</span><br><span class="line">:transformNative_libsWithMergeJniLibsForRelease</span><br><span class="line">:processReleaseJavaRes UP<span class="attr">-TO</span><span class="attr">-DATE</span></span><br><span class="line">:transformResourcesWithMergeJavaResForRelease</span><br><span class="line">:packageRelease</span><br><span class="line">:assembleRelease</span><br><span class="line">:cdvBuildRelease</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: <span class="number">5</span> mins <span class="number">21.356</span> secs</span><br><span class="line">Built the following apk(s): </span><br><span class="line">	/Users/arkii/Workspace/Projects/icinga<span class="attr">-dashboard</span><span class="attr">-mobile</span>/frontend/platforms/android/build/outputs/apk/android<span class="attr">-release</span><span class="attr">-unsigned</span>.apk</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2016/02/15/ionic-web-app-dev/" data-id="cilvxzsof000qd9s6g87en6gn" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2016/02/15/ionic-web-app-dev/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/app/">app</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ionic/">ionic</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bitbar-plugin-icinga-overview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/25/bitbar-plugin-icinga-overview/" class="article-date">
  <time datetime="2016-01-25T02:42:00.000Z" itemprop="datePublished">2016-01-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gadget/">gadget</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/25/bitbar-plugin-icinga-overview/">BitBar plugin icinga2 overview</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MacBitBar-Plugin-icinga2-api-overview-py"><a href="#MacBitBar-Plugin-icinga2-api-overview-py" class="headerlink" title="MacBitBar Plugin icinga2-api-overview.py"></a>MacBitBar Plugin icinga2-api-overview.py</h1><p>Plugin to show icinga2 tactical overview, developed by python, in order to use this plugin, you should enable icinga2-api first.  </p>
<h2 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h2><p><img src="/images/2016/01/25/icinga2-api-overview.png" alt="">  </p>
<h2 id="Install-MacBitBar"><a href="#Install-MacBitBar" class="headerlink" title="Install MacBitBar"></a>Install MacBitBar</h2><p>Download the latest package from site below<br><a href="https://github.com/matryer/bitbar/releases" target="_blank" rel="external">https://github.com/matryer/bitbar/releases</a><br>Or install it by brew cask<br><code>brew cask install bitbar</code></p>
<h2 id="Get-plugin"><a href="#Get-plugin" class="headerlink" title="Get plugin"></a>Get plugin</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py" target="_blank" rel="external">https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py</a>  </p>
<h2 id="Install-Plugin"><a href="#Install-Plugin" class="headerlink" title="Install Plugin"></a>Install Plugin</h2><p>Just download the plugin of your choice into your BitBar plugins directory and choose Refresh from one of the BitBar menu.  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod +x icinga2-api-overview.py</span><br><span class="line"><span class="built_in">cd</span> Plugins/Enabled</span><br><span class="line"><span class="comment"># Enable uptime plugin and change update interval to 30 seconds</span></span><br><span class="line">ln <span class="_">-s</span> ../Utility/icinga2-api-overview.py icinga.30s.py</span><br></pre></td></tr></table></figure>
<h2 id="Other-plugins-built-by-me"><a href="#Other-plugins-built-by-me" class="headerlink" title="Other plugins built by me"></a>Other plugins built by me</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/" target="_blank" rel="external">https://github.com/arkii/gadgets/Utility/BitBar/</a></p>
<h2 id="MacBitBar"><a href="#MacBitBar" class="headerlink" title="MacBitBar"></a>MacBitBar</h2><p><img src="/images/2016/01/25/bitbar-logo@2x.png" alt=""><br>The BitBar app lets you put the output from any script or program right in your Mac OS X menu bar. And it’s completely free. An impressive number of plugins have already been contributed by a wide range of developers just like you, and this site makes it easy to find them.  </p>
<p>Homepage:<br><a href="https://getbitbar.com" target="_blank" rel="external">https://getbitbar.com</a><br>Projects:<br><a href="https://github.com/matryer/bitbar" target="_blank" rel="external">BitBar</a><br><a href="https://github.com/matryer/bitbar-plugins" target="_blank" rel="external">BitBar-Plugins</a>  </p>
<h2 id="NagBar"><a href="#NagBar" class="headerlink" title="NagBar"></a>NagBar</h2><p><img src="/images/2016/01/25/nagbarapp.png" alt=""><br>NagBar is a freeware Nagios, Icinga and Thruk monitoring client which runs in the status bar and give updates about the monitored services. NagBar is a Mac OS X native application created using the Cocoa framework.  </p>
<p>Homepage:<br><a href="https://sites.google.com/site/nagbarapp/" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/</a><br>Screenshots:<br><a href="https://sites.google.com/site/nagbarapp/screenshots" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/screenshots</a>  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2016/01/25/bitbar-plugin-icinga-overview/" data-id="cilvxzsne0003d9s6w6t3hzy8" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2016/01/25/bitbar-plugin-icinga-overview/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/monitoring/">monitoring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sysops/">sysops</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-icinga2-influxdb-grafana-integration" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/09/icinga2-influxdb-grafana-integration/" class="article-date">
  <time datetime="2015-12-09T03:57:25.000Z" itemprop="datePublished">2015-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/09/icinga2-influxdb-grafana-integration/">icinga2 influxdb grafana integration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="icinga2-influxdb-grafana-integration"><a href="#icinga2-influxdb-grafana-integration" class="headerlink" title="icinga2 influxdb grafana integration"></a>icinga2 influxdb grafana integration</h1><p>Using influxdb as storage, icinga2 passing the performance data which returned by plugins, and grafana is used for data visulizing.  </p>
<h2 id="preparation"><a href="#preparation" class="headerlink" title="preparation"></a>preparation</h2><p><strong>plugins’ output is STRICTLY nagios standard output</strong></p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="meta"># OK - load average: 0.69, 0.97, 0.94|load1=0.690;16.000;30.000;0; load5=0.970;20.000;32.000;0; load15=0.940;24.000;34.000;0; </span></span><br><span class="line"></span><br><span class="line"><span class="meta"># hosts</span></span><br><span class="line">icinga2.server1.host.hostalive.perfdata.pl.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449566712</span></span><br><span class="line">icinga2.server1.host.hostalive.perfdata.rta.<span class="keyword">value</span> <span class="number">0.0041609999999999998</span> <span class="number">1449566712</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># services</span></span><br><span class="line">icinga2.server1.service.nrpe_load.perfdata.load1.<span class="keyword">value</span> <span class="number">0.01</span> <span class="number">1449567314</span></span><br><span class="line">icinga2.server1.service.nrpe_load.perfdata.load5.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></span><br><span class="line">icinga2.server1.service.nrpe_load.perfdata.load15.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></span><br></pre></td></tr></table></figure>
<h2 id="enable-icinga2-graphite-feature"><a href="#enable-icinga2-graphite-feature" class="headerlink" title="enable icinga2 graphite feature"></a>enable icinga2 graphite feature</h2><p><code># icinga2 feature enable perfdata</code><br><code># icinga2 feature enable graphite</code><br><code># vim /etc/icinga2/features-enabled/graphite.conf</code>  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * The GraphiteWriter type writes check result metrics and</span><br><span class="line"> * performance data to a graphite tcp socket.</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line">library <span class="string">"perfdata"</span></span><br><span class="line"></span><br><span class="line">object GraphiteWriter <span class="string">"graphite"</span> &#123;</span><br><span class="line">  <span class="comment">//host = "127.0.0.1"</span></span><br><span class="line">  <span class="comment">//port = 2003</span></span><br><span class="line">  host = <span class="string">"influxdb-server-with-graphite-plugin"</span></span><br><span class="line">  port = <span class="number">2004</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Optional. Metric prefix for host name. Defaults to "icinga2.$host.name$.host.$host.check_command$".</span></span><br><span class="line">host_name_template = <span class="string">"icinga2.$host.name$.host.$host.check_command$"</span></span><br><span class="line">service_name_template = <span class="string">"icinga2.$host.name$.service.$service.name$"</span></span><br><span class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.vars.nrpe_command$"</span></span><br><span class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.name$.$service.check_command$"</span></span><br><span class="line"><span class="comment">// Optional. Metric prefix for service name. Defaults to "icinga2.$host.name$.services.$service.name$.$service.check_command$".</span></span><br><span class="line"><span class="comment">// enable_send_thresholds = false // Optional. Send additional threshold metrics. Defaults to false.</span></span><br><span class="line"><span class="comment">// enable_send_metadata = false   // Optional. Send additional metadata metrics. Defaults to false.</span></span><br><span class="line"><span class="comment">// enable_legacy_mode = false</span></span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"><span class="meta">## <span class="meta-keyword">define</span> the internal link, guiding to grafana dashboard  </span></span><br><span class="line">`<span class="meta"># vim /etc/icinga2/conf.d/templates.conf`</span></span><br><span class="line"></span><br><span class="line">``` cpp</span><br><span class="line"><span class="keyword">template</span> Service <span class="string">"grafana-svc"</span> &#123;</span><br><span class="line">  <span class="comment">// http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=kddi-zol-dealer-web1&amp;var-CMD=nrpe_ss</span></span><br><span class="line">  notes_url = <span class="string">"http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=$HOSTNAME$&amp;var-CMD=$SERVICEDESC$"</span></span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"><span class="meta">## apply the template  </span></span><br><span class="line">`<span class="meta"># vim /etc/icinga2/conf.d/services.conf`</span></span><br><span class="line"></span><br><span class="line">``` cpp</span><br><span class="line">apply Service <span class="string">"nrpe_ss"</span> &#123;</span><br><span class="line">        import <span class="string">"generic-service"</span></span><br><span class="line">        import <span class="string">"grafana-svc"</span></span><br><span class="line">                check_command = <span class="string">"nrpe"</span></span><br><span class="line">                assign where <span class="string">"webserver"</span> in host.groups</span><br><span class="line">                vars.nrpe_timeout = <span class="number">240</span></span><br><span class="line">                vars.nrpe_command = <span class="string">"check_ss"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>icinga2 daemon -C &amp;&amp; service icinga2 reload</code>  </p>
<h2 id="Influxdb-graphite-plugin-configuration"><a href="#Influxdb-graphite-plugin-configuration" class="headerlink" title="Influxdb graphite plugin configuration"></a>Influxdb graphite plugin configuration</h2><p><code># vim /etc/influxdb/influxdb.conf</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">[[graphite]]</span><br><span class="line">  enabled = true</span><br><span class="line">  database = "icinga"</span><br><span class="line">  bind-address = ":2004"</span><br><span class="line">  protocol = "tcp"</span><br><span class="line">  consistency-level = "one"</span><br><span class="line">  ignore-unnamed = true</span><br><span class="line">  name-separator = "|"</span><br><span class="line">  # name-separator = "_"</span><br><span class="line">  templates = [</span><br><span class="line">     "icinga2.*.host.*.perfdata.*.*                   .measurement..cmd..metric.value",</span><br><span class="line">     "icinga2.*.service.*.perfdata.*.*                .measurement..cmd..metric.value",</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">[[graphite]]</span><br><span class="line">  enabled = true</span><br><span class="line">  database = "graphite"</span><br><span class="line">  bind-address = ":2003"</span><br><span class="line">  protocol = "tcp"</span><br><span class="line">  consistency-level = "one"</span><br><span class="line">  # name-separator = ";"</span><br><span class="line">  name-separator = "."</span><br><span class="line"></span><br><span class="line">  # These next lines control how batching works. You should have this enabled</span><br><span class="line">  # otherwise you could get dropped metrics or poor performance. Batching</span><br><span class="line">  # will buffer points in memory if you have many coming in.</span><br><span class="line"></span><br><span class="line">  # batch-size = 1000 # will flush if this many points get buffered</span><br><span class="line">  # batch-pending = 5 # number of batches that may be pending in memory</span><br><span class="line">  # batch-timeout = "1s" # will flush at least this often even if we haven't hit buffer limit</span><br><span class="line">  # udp-read-buffer = 0 # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.</span><br><span class="line"></span><br><span class="line">  ## "name-schema" configures tag names for parsing the metric name from graphite protocol;</span><br><span class="line">  ## separated by `name-separator`.</span><br><span class="line">  ## The "measurement" tag is special and the corresponding field will become</span><br><span class="line">  ## the name of the metric.</span><br><span class="line">  ## e.g. "type.host.measurement.device" will parse "server.localhost.cpu.cpu0" as</span><br><span class="line">  ## &#123;</span><br><span class="line">  ##     measurement: "cpu",</span><br><span class="line">  ##     tags: &#123;</span><br><span class="line">  ##         "type": "server",</span><br><span class="line">  ##         "host": "localhost,</span><br><span class="line">  ##         "device": "cpu0"</span><br><span class="line">  ##     &#125;</span><br><span class="line">  ## &#125;</span><br><span class="line">  # name-schema = "type.host.measurement.device"</span><br><span class="line"></span><br><span class="line">  ## If set to true, when the input metric name has more fields than `name-schema` specified,</span><br><span class="line">  ## the extra fields will be ignored.</span><br><span class="line">  ## Otherwise an error will be logged and the metric rejected.</span><br><span class="line">  # ignore-unnamed = true</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [collectd]</span><br><span class="line">###</span><br><span class="line">### Controls the listener for collectd data.</span><br><span class="line">###</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># grafana template variables</span><br><span class="line">$HOST</span><br><span class="line"><span class="keyword">SHOW</span> MEASUREMENTS</span><br><span class="line">$CMD</span><br><span class="line"><span class="keyword">SHOW</span> TAG <span class="keyword">VALUES</span> <span class="keyword">FROM</span> <span class="string">"$HOST"</span> <span class="keyword">WITH</span> <span class="keyword">KEY</span> = <span class="string">"cmd"</span></span><br><span class="line">$METRIC</span><br><span class="line"><span class="keyword">SHOW</span> TAG <span class="keyword">VALUES</span> <span class="keyword">FROM</span> <span class="string">"$HOST"</span> <span class="keyword">WITH</span> <span class="keyword">KEY</span> = <span class="string">"metric"</span> <span class="keyword">WHERE</span> cmd = <span class="string">'$CMD'</span></span><br><span class="line"><span class="string">``</span><span class="string">`  </span><br><span class="line">**grafana query below**  </span><br><span class="line">![grafana-query](/images/2015/12/1.png)</span><br><span class="line"></span><br><span class="line">## Get the share link from grafana dashboard  </span><br><span class="line"></span><br><span class="line">`</span><span class="string">``</span> html</span><br><span class="line">&lt;iframe src=<span class="string">"http://grafana.yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen&amp;var-HOST=server1&amp;var-CMD=nrpe_ss"</span> width=<span class="string">"450"</span> height=<span class="string">"200"</span> frameborder=<span class="string">"0"</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
<p><code>cd /etc/icingaweb2/enabledModules/pnp4nagios/</code></p>
<p>icingaweb2 modules API here<br><code>/usr/share/icingaweb2/modules/monitoring/library/Monitoring/Object/Service.php</code></p>
<p>add grafana integration into icingaweb2   </p>
<p><code>/usr/share/icingaweb2/modules/pnp4nagios/library/Pnp4nagios/Grapher.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grapher</span> <span class="keyword">extends</span> <span class="title">GrapherHook</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    .........OLD COLD BLOCK........</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> $baseUrl = <span class="string">'/pnp4nagios'</span>;</span><br><span class="line">    <span class="keyword">protected</span> $grafanaBaseUrl = <span class="string">'http://yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen'</span>;</span><br><span class="line">    </span><br><span class="line">    .........OLD COLD BLOCK........</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPreviewHtml</span><span class="params">(MonitoredObject $object)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">        .........OLD COLD BLOCK........</span><br><span class="line">        </span><br><span class="line">        $html .= <span class="string">"  &lt;/tr&gt;\n  &lt;tr&gt;\n"</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($viewKeys <span class="keyword">as</span> $view) &#123;</span><br><span class="line">            $html .= <span class="string">'    &lt;td style="border-left: 1px solid #555; padding-right: 3px"&gt;'</span></span><br><span class="line">                   . $this-&gt;getPreviewImg($host, $service, $view)</span><br><span class="line">                   . <span class="string">"&lt;/td&gt;\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Arkii 2015.12.14 added Grafana Integration</span></span><br><span class="line">        <span class="keyword">if</span> ($service != <span class="string">'_HOST_'</span> &amp;&amp; $object-&gt;service_notes_url) &#123;</span><br><span class="line">            $html .= <span class="string">"&lt;tr&gt;\n &lt;td&gt;\n"</span>;</span><br><span class="line">            $grafanaIframe = sprintf(</span><br><span class="line">                <span class="string">'&lt;iframe src="%s&amp;var-HOST=%s&amp;var-CMD=%s" width="480" height="150" frameborder="0"&gt;&lt;/iframe&gt;'</span>,</span><br><span class="line">                $this-&gt;grafanaBaseUrl,</span><br><span class="line">                $host,</span><br><span class="line">                $service);</span><br><span class="line">            $html .= $grafanaIframe;</span><br><span class="line">            $html .= <span class="string">"&lt;/td&gt;\n &lt;/tr&gt;\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// end of Grafana Integration</span></span><br><span class="line"></span><br><span class="line">        $html .= <span class="string">"&lt;/tr&gt;&lt;/table&gt;\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> $html;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="demos"><a href="#demos" class="headerlink" title="demos"></a>demos</h2><p><strong>work with pnp4nagios</strong><br><img src="/images/2015/12/5.png" alt=""><br><strong>click the notes_url</strong><br><img src="/images/2015/12/2.png" alt="icinga-"><br><strong>jumped to your grafana dashboard</strong><br><img src="/images/2015/12/3.png" alt="grafana-1"><br><strong>another metric</strong><br><img src="/images/2015/12/4.png" alt="grafana-2"></p>
<h2 id="many-useful-links"><a href="#many-useful-links" class="headerlink" title="many useful links"></a>many useful links</h2><p><a href="http://play.grafana.org/" target="_blank" rel="external">so many grafana examples here</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins#addons-graphing-influxdb" target="_blank" rel="external">enable influxdb writer</a><br><a href="http://www.infoq.com/articles/graphite-intro" target="_blank" rel="external">graphite-intro-en</a><br><a href="http://www.infoq.com/cn/articles/graphite-intro" target="_blank" rel="external">graphite-intro-cn</a><br><a href="https://github.com/influxdb/influxdb/tree/master/services/graphite" target="_blank" rel="external">InfluxDB hook up Graphite as an input source</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/monitoring-basics#runtime-macros" target="_blank" rel="external">icinga2-runtime-macros</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/object-types#objecttype-graphitewriter" target="_blank" rel="external">icinga2-objecttype-graphitewriter</a><br><strong>Intruduced Performance Data Pipe of icinga2 in GREAT DETAIL[非常详细的icinga2性能数据管道说明]:</strong><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/icinga2-features#performance-data" target="_blank" rel="external">icinga2-performance-data</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/12/09/icinga2-influxdb-grafana-integration/" data-id="cilvxzsod000od9s6a5w8a4of" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/12/09/icinga2-influxdb-grafana-integration/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-build-tinycorelinux-docker-image" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/07/how-to-build-tinycorelinux-docker-image/" class="article-date">
  <time datetime="2015-12-07T02:14:57.000Z" itemprop="datePublished">2015-12-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/07/how-to-build-tinycorelinux-docker-image/">how to build tinycorelinux docker image</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="how-to-build-tinycorelinux-docker-image"><a href="#how-to-build-tinycorelinux-docker-image" class="headerlink" title="how to build tinycorelinux docker image"></a>how to build tinycorelinux docker image</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http://tinycorelinux.net/6.x/x86_64/release/distribution_files/corepure64.gz</span><br><span class="line">mkdir chroot</span><br><span class="line">gunzip corepure64.gz</span><br><span class="line">cd chroot/</span><br><span class="line">cpio -i &lt; ../corepure64</span><br><span class="line">cd ..</span><br><span class="line">tar -C chroot -c . | docker import - tinycorelinux</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/12/07/how-to-build-tinycorelinux-docker-image/" data-id="cilvxzso1000jd9s6neaz7kw7" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/12/07/how-to-build-tinycorelinux-docker-image/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-configure-httpd-proxy-with-authentication" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/02/how-to-configure-httpd-proxy-with-authentication/" class="article-date">
  <time datetime="2015-12-01T23:20:31.000Z" itemprop="datePublished">2015-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/02/how-to-configure-httpd-proxy-with-authentication/">how to configure httpd proxy with authentication</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="how-to-configure-httpd-proxy-with-authentication"><a href="#how-to-configure-httpd-proxy-with-authentication" class="headerlink" title="how to configure httpd proxy with authentication"></a>how to configure httpd proxy with authentication</h1><p><code>vi gen.php</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo base64_encode(&quot;user:password&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p><code>php gen.php</code><br><code>dXNlcjpwYXNzd29yZA==</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RewriteEngine On</span><br><span class="line">RewriteRule ^/orin/(.*)$    http://target.lb.com/$1   [NC,L,P]</span><br><span class="line"></span><br><span class="line">&lt;LocationMatch &quot;^/orin/(.*)$&quot;&gt;</span><br><span class="line">    #AddDefaultCharset GBK</span><br><span class="line">    RequestHeader set Authorization &quot;dXNlcjpwYXNzd29yZA==&quot;</span><br><span class="line">    ProxyPass http://target.lb.com/$1</span><br><span class="line">&lt;/LocationMatch&gt;</span><br></pre></td></tr></table></figure>
<h2 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h2><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_headers.html" target="_blank" rel="external">mod_headers</a><br><a href="https://httpd.apache.org/docs/2.4/rewrite/flags.html#flag_p" target="_blank" rel="external">rewrite flags</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassreverse" target="_blank" rel="external">mod_proxy.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/12/02/how-to-configure-httpd-proxy-with-authentication/" data-id="cilvxzso6000ld9s6gz4x3j79" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/12/02/how-to-configure-httpd-proxy-with-authentication/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-configure-httpd-with-ldap-authentication" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/01/how-to-configure-httpd-with-ldap-authentication/" class="article-date">
  <time datetime="2015-12-01T00:07:06.000Z" itemprop="datePublished">2015-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/01/how-to-configure-httpd-with-ldap-authentication/">how to configure httpd with ldap authentication</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="how-to-configure-httpd-with-ldap-authentication"><a href="#how-to-configure-httpd-with-ldap-authentication" class="headerlink" title="how to configure httpd with ldap authentication"></a>how to configure httpd with ldap authentication</h1><h2 id="httpd-2-4-ldap"><a href="#httpd-2-4-ldap" class="headerlink" title="httpd 2.4 ldap"></a>httpd 2.4 ldap</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LoadModule authn_core_module modules/mod_authn_core.so</span><br><span class="line">LoadModule authz_host_module modules/mod_authz_host.so</span><br><span class="line">LoadModule authz_user_module modules/mod_authz_user.so</span><br><span class="line">LoadModule authz_core_module modules/mod_authz_core.so</span><br><span class="line">LoadModule access_compat_module modules/mod_access_compat.so</span><br><span class="line">LoadModule auth_basic_module modules/mod_auth_basic.so</span><br><span class="line">LoadModule ldap_module modules/mod_ldap.so</span><br><span class="line">LoadModule authnz_ldap_module modules/mod_authnz_ldap.so</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:*&gt;</span><br><span class="line">ProxyPass / http://elk-kibana:5601/</span><br><span class="line">ProxyPassReverse / http://elk-kibana:5601/</span><br><span class="line"></span><br><span class="line">&lt;Proxy *&gt;</span><br><span class="line">Require all granted</span><br><span class="line"></span><br><span class="line"># LDAPSharedCacheSize 500000</span><br><span class="line"># LDAPCacheEntries 1024</span><br><span class="line"># LDAPCacheTTL 600</span><br><span class="line"># LDAPOpCacheEntries 1024</span><br><span class="line"># LDAPOpCacheTTL 600</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName &quot;Login with LDAP&quot;</span><br><span class="line">AuthBasicProvider ldap</span><br><span class="line">AuthLDAPURL &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;</span><br><span class="line">AuthLDAPBindDN &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;</span><br><span class="line">AuthLDAPBindPassword &lt;PUT Operator&apos;s PASSWORD HERE&gt;</span><br><span class="line">require valid-user</span><br><span class="line">&lt;/Proxy&gt; </span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<h3 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h3><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_ldap.html" target="_blank" rel="external">mod_ldap</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_authnz_ldap.html" target="_blank" rel="external">mod_authnz_ldap</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/12/01/how-to-configure-httpd-with-ldap-authentication/" data-id="cilvxzso4000kd9s6i582osck" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/12/01/how-to-configure-httpd-with-ldap-authentication/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-configure-nginx-with-ldap-authentication" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/01/how-to-configure-nginx-with-ldap-authentication/" class="article-date">
  <time datetime="2015-11-30T23:42:43.000Z" itemprop="datePublished">2015-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/01/how-to-configure-nginx-with-ldap-authentication/">how to configure nginx with ldap authentication</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="how-to-configure-nginx-with-ldap-authentication"><a href="#how-to-configure-nginx-with-ldap-authentication" class="headerlink" title="how to configure nginx with ldap authentication"></a>how to configure nginx with ldap authentication</h1><h2 id="build-from-source"><a href="#build-from-source" class="headerlink" title="build from source"></a>build from source</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">version=&apos;1.8.0&apos;</span><br><span class="line"></span><br><span class="line">apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</span><br><span class="line"></span><br><span class="line">mkdir build &amp;&amp; cd build</span><br><span class="line">wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">wget http://nginx.org/download/nginx-$&#123;version&#125;.tar.gz</span><br><span class="line">tar xvf nginx-$&#123;version&#125;.tar.gz &amp;&amp; cd nginx-$&#123;version&#125;</span><br><span class="line"></span><br><span class="line">./configure \</span><br><span class="line">--prefix=/etc/nginx \</span><br><span class="line">--sbin-path=/usr/sbin/nginx \</span><br><span class="line">--conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">--error-log-path=/var/log/nginx/error.log \</span><br><span class="line">--http-log-path=/var/log/nginx/access.log \</span><br><span class="line">--pid-path=/var/run/nginx.pid \</span><br><span class="line">--lock-path=/var/run/nginx.lock \</span><br><span class="line">--http-client-body-temp-path=/var/cache/nginx/client_temp \</span><br><span class="line">--http-proxy-temp-path=/var/cache/nginx/proxy_temp \</span><br><span class="line">--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</span><br><span class="line">--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</span><br><span class="line">--http-scgi-temp-path=/var/cache/nginx/scgi_temp \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_addition_module \</span><br><span class="line">--with-http_sub_module \</span><br><span class="line">--with-http_dav_module \</span><br><span class="line">--with-http_flv_module \</span><br><span class="line">--with-http_mp4_module \</span><br><span class="line">--with-http_gunzip_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-http_random_index_module \</span><br><span class="line">--with-http_secure_link_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_auth_request_module \</span><br><span class="line">--with-mail \</span><br><span class="line">--with-mail_ssl_module \</span><br><span class="line">--with-file-aio \</span><br><span class="line">--with-http_spdy_module \</span><br><span class="line">--with-ipv6 \</span><br><span class="line">--add-module=../nginx-auth-ldap-master</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM debian:jessie</span><br><span class="line"># bugs here https://github.com/kvspb/nginx-auth-ldap/issues/88</span><br><span class="line"># nginx: [emerg] http_auth_ldap: parse_require in /etc/nginx/nginx.conf:45</span><br><span class="line"># nginx: [emerg] http_auth_ldap: Setting group in /etc/nginx/nginx.conf:45</span><br><span class="line">MAINTAINER Arkii &quot;sqy6@163.com&quot;</span><br><span class="line"></span><br><span class="line">RUN echo &apos;Asia/Shanghai&apos; &gt; /etc/timezone &amp;&amp; \</span><br><span class="line">    /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</span><br><span class="line">    groupadd -g 396 nginx &amp;&amp; \</span><br><span class="line">    useradd nginx -u 396 -g 396 -M -c &apos;Nginx web server&apos; -s /sbin/nologin -d /var/lib/nginx &amp;&amp; \</span><br><span class="line">    mkdir -p /var/log/nginx /var/lib/nginx /var/cache/nginx /usr/share/nginx &amp;&amp; \</span><br><span class="line">    chown -R nginx:nginx /var/log/nginx /var/lib/nginx /var/cache/nginx &amp;&amp; \</span><br><span class="line">    ln -sf /dev/stdout /var/log/nginx/access.log &amp;&amp; \</span><br><span class="line">    ln -sf /dev/stderr /var/log/nginx/error.log</span><br><span class="line"></span><br><span class="line">ENV NGINX_VERSION 1.8.0</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; \</span><br><span class="line">    apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</span><br><span class="line"></span><br><span class="line">RUN mkdir /tmp/build &amp;&amp; cd /tmp/build &amp;&amp; \</span><br><span class="line">    wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip &amp;&amp; \</span><br><span class="line">    unzip master.zip &amp;&amp; \</span><br><span class="line">    wget http://nginx.org/download/nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; \</span><br><span class="line">    tar xf nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; cd nginx-$&#123;NGINX_VERSION&#125; &amp;&amp; \</span><br><span class="line"></span><br><span class="line">    ./configure \</span><br><span class="line">    --prefix=/etc/nginx \</span><br><span class="line">    --sbin-path=/usr/sbin/nginx \</span><br><span class="line">    --conf-path=/etc/nginx/nginx.conf \</span><br><span class="line">    --error-log-path=/var/log/nginx/error.log \</span><br><span class="line">    --http-log-path=/var/log/nginx/access.log \</span><br><span class="line">    --pid-path=/var/run/nginx.pid \</span><br><span class="line">    --lock-path=/var/run/nginx.lock \</span><br><span class="line">    --http-client-body-temp-path=/var/cache/nginx/client_temp \</span><br><span class="line">    --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</span><br><span class="line">    --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</span><br><span class="line">    --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</span><br><span class="line">    --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</span><br><span class="line">    --user=nginx \</span><br><span class="line">    --group=nginx \</span><br><span class="line">    --with-http_ssl_module \</span><br><span class="line">    --with-http_realip_module \</span><br><span class="line">    --with-http_addition_module \</span><br><span class="line">    --with-http_sub_module \</span><br><span class="line">    --with-http_dav_module \</span><br><span class="line">    --with-http_flv_module \</span><br><span class="line">    --with-http_mp4_module \</span><br><span class="line">    --with-http_gunzip_module \</span><br><span class="line">    --with-http_gzip_static_module \</span><br><span class="line">    --with-http_random_index_module \</span><br><span class="line">    --with-http_secure_link_module \</span><br><span class="line">    --with-http_stub_status_module \</span><br><span class="line">    --with-http_auth_request_module \</span><br><span class="line">    --with-mail \</span><br><span class="line">    --with-mail_ssl_module \</span><br><span class="line">    --with-file-aio \</span><br><span class="line">    --with-http_spdy_module \</span><br><span class="line">    --with-ipv6 \</span><br><span class="line">    --add-module=../nginx-auth-ldap-master &amp;&amp; \</span><br><span class="line"></span><br><span class="line">    make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">RUN apt-get remove -y gcc wget make unzip &amp;&amp; \</span><br><span class="line">       rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">EXPOSE 80 443 8000 8080</span><br><span class="line">ENTRYPOINT [&quot;nginx&quot;]</span><br><span class="line">CMD [&quot;-g&quot;, &quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="configfile-example"><a href="#configfile-example" class="headerlink" title="configfile example"></a>configfile example</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"># user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"># error_log  logs/error.log;</span><br><span class="line"># error_log  logs/error.log  notice;</span><br><span class="line"># error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"># pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    auth_ldap_cache_enabled on;</span><br><span class="line">    auth_ldap_cache_expiration_time 10000;</span><br><span class="line">    auth_ldap_cache_size 1000;</span><br><span class="line">    ldap_server ad_1 &#123;</span><br><span class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</span><br><span class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</span><br><span class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</span><br><span class="line">      #connect_timeout 5s;</span><br><span class="line">      #bind_timeout 5s;</span><br><span class="line">      #request_timeout 5s;</span><br><span class="line">      group_attribute member;</span><br><span class="line">      group_attribute_is_dn on;</span><br><span class="line">      satisfy any;</span><br><span class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    ldap_server ad_2 &#123;</span><br><span class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</span><br><span class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</span><br><span class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</span><br><span class="line">      #connect_timeout 5s;</span><br><span class="line">      #bind_timeout 5s;</span><br><span class="line">      #request_timeout 5s;</span><br><span class="line">      group_attribute member;</span><br><span class="line">      group_attribute_is_dn on;</span><br><span class="line">      satisfy any;</span><br><span class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        auth_ldap &quot;Login with LDAP account&quot;;</span><br><span class="line">        auth_ldap_servers ad_1;</span><br><span class="line">        auth_ldap_servers ad_2;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="image-on-Docker-hub"><a href="#image-on-Docker-hub" class="headerlink" title="image on Docker hub"></a>image on Docker hub</h2><p><code>docker pull docker.io/arkii/nginx-ldap:1.8.0</code></p>
<p><a href="https://github.com/kvspb/nginx-auth-ldap" target="_blank" rel="external">github</a><br><a href="http://deezx.github.io/blog/2015/04/24/how-to-configure-nginx-with-ldap-authentication/" target="_blank" rel="external">blog</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/12/01/how-to-configure-nginx-with-ldap-authentication/" data-id="cilvxzsob000md9s6obmsm0v0" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/12/01/how-to-configure-nginx-with-ldap-authentication/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-when-a-man-loves-a-woman" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/27/when-a-man-loves-a-woman/" class="article-date">
  <time datetime="2015-11-27T06:41:01.000Z" itemprop="datePublished">2015-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/27/when-a-man-loves-a-woman/">When A Man Loves A Woman</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="When-A-Man-Loves-A-Woman"><a href="#When-A-Man-Loves-A-Woman" class="headerlink" title="When A Man Loves A Woman"></a>When A Man Loves A Woman</h1><p>作词 : Calvin Lewis/Andrew Wright<br>原唱 : Percy Sledge<br>翻唱 : Michael Bolton, 金润吉<br>当一个男人爱上一个女人<br>他的脑子就再也装不下任何东西<br>他宁愿出卖整个世界<br>就为了他寻得的挚爱<br>如果她很坏，他也看不到<br>她不会错<br>他甚至会背弃最好的朋友<br>如果朋友敢轻视她  </p>
<p>当一个男人爱上一个女人<br>会花光他的每一分<br>来维持他所需要的<br>他愿意放弃所有安逸<br>露宿街头 睡在雨中<br>如果她说就该做这些事  </p>
<p>当一个男人爱上一个女人<br>他会献出自己的所有<br>试图保住 这份宝贵的爱<br>宝贝请别忽视我  </p>
<p>当一个男人爱上一个女人<br>他的灵魂深处<br>她能使他痛苦如斯<br>如果她玩弄他如一个傻瓜<br>他也永远后知后觉<br>陷入爱河的人总是盲目  </p>
<p>是的当一个男人爱上一个女人<br>我完全了解他的心思  </p>
<p>当一个男人爱上一个女人  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/11/27/when-a-man-loves-a-woman/" data-id="cilvxzsp80017d9s63gj9emkx" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/11/27/when-a-man-loves-a-woman/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-gitlab-ci-and-runner" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/19/gitlab-ci-and-runner/" class="article-date">
  <time datetime="2015-11-19T00:52:33.000Z" itemprop="datePublished">2015-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/19/gitlab-ci-and-runner/">给gitlab添加gitlab-ci和gitlab-runner</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="给gitlab添加gitlab-ci和gitlab-runner"><a href="#给gitlab添加gitlab-ci和gitlab-runner" class="headerlink" title="给gitlab添加gitlab-ci和gitlab-runner"></a>给gitlab添加gitlab-ci和gitlab-runner</h1><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>使用的是<strong>gitlab v7.13.3</strong>。<br>run在docker中。<br>配置了ldap登录，和smtp邮件通知。<strong>失败时会发送邮件通知</strong><br>最近测试gitlab-ci服务。  </p>
<h3 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置:"></a>服务配置:</h3><p>直接在配置文件gitlab.rb底部打开相关配置，即可使用。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">############################################</span><br><span class="line"># Url on which GitLab CI will be reachable #</span><br><span class="line">############################################</span><br><span class="line">## see https://gitlab.com/gitlab-org/omnibus-gitlab/tree/629def0a7a26e7c2326566f0758d4a27857b52a3/doc/gitlab-ci/README.md</span><br><span class="line"></span><br><span class="line">ci_external_url &apos;http://ci.gitlab.yourdomain.com&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#################################</span><br><span class="line"># application.yml configuration #</span><br><span class="line">#################################</span><br><span class="line"># 这个app_id在gitlab中创建application后获得</span><br><span class="line">gitlab_ci[&apos;gitlab_server&apos;] = &#123; &quot;url&quot; =&gt; &apos;http://gitlab.yourdomain.com&apos;, &quot;app_id&quot; =&gt; &apos;xxxxxxxxxxxx&apos;, &quot;app_se</span><br><span class="line">cret&quot; =&gt; &apos;yyyyyyyyyyyyyyy&apos; &#125;</span><br><span class="line"></span><br><span class="line">gitlab_ci[&apos;gitlab_ci_email_from&apos;] = &apos;gitlab@yourdomain.com&apos;</span><br><span class="line">gitlab_ci[&apos;gitlab_ci_support_email&apos;] = &apos;sysop@yourdomain.com&apos;</span><br><span class="line">gitlab_ci[&apos;gitlab_ci_all_broken_builds&apos;] = true</span><br><span class="line">gitlab_ci[&apos;gitlab_ci_add_pusher&apos;] = true</span><br><span class="line">gitlab_ci[&apos;builds_directory&apos;] = &apos;/var/opt/gitlab/gitlab-ci/builds&apos;</span><br><span class="line"></span><br><span class="line">gitlab_ci[&apos;gravatar_enabled&apos;] = false</span><br><span class="line"># gitlab_ci[&apos;gravatar_plain_url&apos;] = &quot;http://www.gravatar.com/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=mm&quot;</span><br><span class="line"># gitlab_ci[&apos;gravatar_ssl_url&apos;] =  &quot;https://secure.gravatar.com/avatar/%&#123;hash&#125;?s=%&#123;size&#125;&amp;d=mm&quot;</span><br><span class="line"></span><br><span class="line">## For setting up backups</span><br><span class="line">## see https://gitlab.com/gitlab-org/omnibus-gitlab/blob/629def0a7a26e7c2326566f0758d4a27857b52a3/README.md#backups</span><br><span class="line"></span><br><span class="line">gitlab_ci[&apos;backup_path&apos;] = &quot;/var/opt/gitlab/ci-backups&quot;</span><br><span class="line"># gitlab_ci[&apos;backup_keep_time&apos;] = 604800</span><br><span class="line"># gitlab_ci[&apos;backup_upload_connection&apos;] = &#123;</span><br><span class="line">#   &apos;provider&apos; =&gt; &apos;AWS&apos;,</span><br><span class="line">#   &apos;region&apos; =&gt; &apos;eu-west-1&apos;,</span><br><span class="line">#   &apos;aws_access_key_id&apos; =&gt; &apos;AKIAKIAKI&apos;,</span><br><span class="line">#   &apos;aws_secret_access_key&apos; =&gt; &apos;secret123&apos;</span><br><span class="line"># &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="配置gitlab-runner"><a href="#配置gitlab-runner" class="headerlink" title="配置gitlab-runner"></a>配置gitlab-runner</h4><p>PS:新版本gitlab-runner从ruby改为go语言实现，名字为gitlab-ci-multi-runner，软链接为gitlab-runner<br>官方文档:<a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/docker.md" target="_blank" rel="external">Run gitlab-runner in a container</a><br>启动gitlab-runner服务<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -d --name gitlab-runner --restart always \</span><br><span class="line">  -v /srv/gitlab-runner/config:/etc/gitlab-runner \</span><br><span class="line">  gitlab/gitlab-runner:latest</span><br></pre></td></tr></table></figure></p>
<p>也可以用官方的另一个实现：<br><figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">gitlab/gitlab-runner    latest              <span class="number">3</span>e<span class="number">8077e209f5</span>        <span class="number">13</span> hours ago        <span class="number">304</span>.<span class="number">3</span> MB</span><br><span class="line">gitlab/gitlab-runner    alpine              <span class="number">7</span>c431ac8f30f        <span class="number">13</span> hours ago        <span class="number">25</span>.<span class="number">98</span> MB</span><br></pre></td></tr></table></figure></p>
<p><strong>注册runner</strong><br><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">docker exec -it gitlab-runner gitlab-runner register</span><br><span class="line"></span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> coordinator URL (<span class="keyword">e</span>.<span class="keyword">g</span>. https:<span class="comment">//gitlab.com/ci):</span></span><br><span class="line">http:<span class="comment">//ci.gitlab.yourdomain.com/</span></span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> <span class="keyword">token</span> <span class="keyword">for</span> this runner:</span><br><span class="line"># 这个<span class="keyword">token</span>在gitlab-<span class="keyword">ci</span>中Runners选项卡获得</span><br><span class="line">e0ab42c98fff06b3dd4f3d4c776bc4</span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> description <span class="keyword">for</span> this runner:</span><br><span class="line">[3366d1121148]: <span class="keyword">test</span>-<span class="keyword">ci</span></span><br><span class="line">Please enter the gitlab-<span class="keyword">ci</span> tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">delpoy</span><br><span class="line">INFO[0086] e0ab42c9 Registering runner... succeeded                    </span><br><span class="line">Please enter the executor: ssh, <span class="keyword">shell</span>, parallels, docker, docker-ssh:</span><br><span class="line">[]: <span class="keyword">shell</span></span><br><span class="line">INFO[0097] Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it's running already the config should be automatically reloaded!</span><br></pre></td></tr></table></figure></p>
<p><strong>注册成功后，查看生成的配置文件</strong><br><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat  /srv/gitlab-runner/config/config.toml </span></span><br><span class="line"><span class="attr">concurrent</span> = <span class="number">1</span></span><br><span class="line">[[runners]]</span><br><span class="line">  <span class="attr">url</span> = <span class="string">"http://ci.gitlab.yourdomain.com/"</span></span><br><span class="line">  <span class="attr">token</span> = <span class="string">"c87c7ad883af316b7d173c1094c6fe"</span></span><br><span class="line">  <span class="attr">name</span> = <span class="string">"test-ci"</span></span><br><span class="line">  <span class="attr">executor</span> = <span class="string">"shell"</span></span><br><span class="line">  [runners.ssh]</span><br><span class="line">  [runners.docker]</span><br><span class="line">    <span class="attr">image</span> = <span class="string">""</span></span><br><span class="line">    <span class="attr">privileged</span> = <span class="literal">false</span></span><br><span class="line">  [runners.parallels]</span><br><span class="line">    <span class="attr">base_name</span> = <span class="string">""</span></span><br></pre></td></tr></table></figure></p>
<p><strong>debug:</strong><br><code>docker logs -f gitlab-runner</code><br><code>docker exec -it gitlab-runner gitlab-runner --help</code></p>
<h4 id="使用gitlab-ci"><a href="#使用gitlab-ci" class="headerlink" title="使用gitlab-ci"></a>使用gitlab-ci</h4><p>打开<a href="http://ci.gitlab.yourdomain.com" target="_blank" rel="external">http://ci.gitlab.yourdomain.com</a> ，会跳转到<a href="http://gitlab.yourdomain.com去做验证，然后跳回。" target="_blank" rel="external">http://gitlab.yourdomain.com去做验证，然后跳回。</a><br>选择一个需要CI的项目，点击”Add project to CI”。</p>
<p>#####.gitlab-ci.yml配置:<br>在项目中添加.gitlab-ci.yml文件，然后push到gitlab<br><code>git add . ; git commit -m &#39;test&#39; ; git push</code><br><strong>注意：有坑！如果按照官方最新文档的话，会构建失败，因为句法有变化，可用下面这个链接在线验证配置文件。</strong><br><a href="http://ci.gitlab.yourdomain.com/lint" target="_blank" rel="external">在线编辑器</a></p>
<p>下面是一个栗子</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">staging:</span><br><span class="line">  type: deploy</span><br><span class="line">  script:</span><br><span class="line">  - echo &apos;deploy to test env&apos; &gt;&gt; /tmp/test-ci.log</span><br><span class="line">  - echo &quot;CI:$CI CI_SERVER:$CI_SERVER CI_SERVER_NAME:$CI_SERVER_NAME GITLAB_CI:$GITLAB_CI CI_SERVER_VERSION:$CI_SERVER_VERSION CI_SERVER_REVISION:$CI_SERVER_REVISION CI_BUILD_REF:$CI_BUILD_REF CI_BUILD_BEFORE_SHA:$CI_BUILD_BEFORE_SHA  CI_BUILD_REF_NAME:$CI_BUILD_REF_NAME CI_BUILD_ID:$CI_BUILD_ID CI_BUILD_REPO:$CI_BUILD_REPO CI_PROJECT_DIR:$CI_PROJECT_DIR&quot; &gt;&gt;/tmp/test-ci.log</span><br><span class="line">#  only:</span><br><span class="line">#  - master</span><br><span class="line"></span><br><span class="line">production:</span><br><span class="line">  type: deploy</span><br><span class="line">  script:</span><br><span class="line">  - echo &apos;deploy to production env&apos;  &gt;&gt; /tmp/test-ci.log</span><br><span class="line">  - echo &quot;CI:$CI CI_SERVER:$CI_SERVER CI_SERVER_NAME:$CI_SERVER_NAME GITLAB_CI:$GITLAB_CI CI_SERVER_VERSION:$CI_SERVER_VERSION CI_SERVER_REVISION:$CI_SERVER_REVISION CI_BUILD_REF:$CI_BUILD_REF CI_BUILD_BEFORE_SHA:$CI_BUILD_BEFORE_SHA  CI_BUILD_REF_NAME:$CI_BUILD_REF_NAME CI_BUILD_ID:$CI_BUILD_ID CI_BUILD_REPO:$CI_BUILD_REPO CI_PROJECT_DIR:$CI_PROJECT_DIR&quot; &gt;&gt;/tmp/test-ci.log</span><br><span class="line">  only:</span><br><span class="line">  - tags</span><br><span class="line">  # except:</span><br><span class="line">  #   - stable</span><br><span class="line">  #   - /^deploy-.*$/</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta"># cat /tmp/test-ci.log</span></span><br><span class="line">deploy to test env</span><br><span class="line">CI:<span class="literal">true</span> <span class="built_in">CI_SERVER</span>:yes <span class="built_in">CI_SERVER_NAME</span>:GitLab CI GITLAB_CI:<span class="literal">true</span> <span class="built_in">CI_SERVER_VERSION</span>: <span class="built_in">CI_SERVER_REVISION</span>: <span class="built_in">CI_BUILD_REF</span>:<span class="number">66</span>b8d99e51ff39e98629068bb5e9ef302288e899 <span class="built_in">CI_BUILD_BEFORE_SHA</span>:b7c8b5d458375902426bb0777da3c0ddf553f308  <span class="built_in">CI_BUILD_REF_NAME</span>:my-dev <span class="built_in">CI_BUILD_ID</span>:<span class="number">9</span> <span class="built_in">CI_BUILD_REPO</span>:http:<span class="comment">//gitlab-ci-token:e0ab42c98fff06b3dd4f3d4c776bc4@gitlab.yourdomain.com/arkii/test-ci.git CI_PROJECT_DIR:builds/53b58d35/0/arkii/test-ci</span></span><br><span class="line">deploy to production env</span><br><span class="line">CI:<span class="literal">true</span> <span class="built_in">CI_SERVER</span>:yes <span class="built_in">CI_SERVER_NAME</span>:GitLab CI GITLAB_CI:<span class="literal">true</span> <span class="built_in">CI_SERVER_VERSION</span>: <span class="built_in">CI_SERVER_REVISION</span>: <span class="built_in">CI_BUILD_REF</span>:<span class="number">66</span>b8d99e51ff39e98629068bb5e9ef302288e899 <span class="built_in">CI_BUILD_BEFORE_SHA</span>:b7c8b5d458375902426bb0777da3c0ddf553f308  <span class="built_in">CI_BUILD_REF_NAME</span>:my-dev <span class="built_in">CI_BUILD_ID</span>:<span class="number">10</span> <span class="built_in">CI_BUILD_REPO</span>:http:<span class="comment">//gitlab-ci-token:e0ab42c98fff06b3dd4f3d4c776bc4@gitlab.yourdomain.com/arkii/test-ci.git CI_PROJECT_DIR:builds/0c3c27e4/0/arkii/test-ci</span></span><br></pre></td></tr></table></figure>
<p>#####看到这些变量的输出，大家有思路该怎么玩了吗？</p>
<p>官方文档<a href="https://gitlab.com/gitlab-org/gitlab-ci/blob/7-13-stable/doc/builds_configuration/README.md" target="_blank" rel="external">Configuration of your builds with .gitlab-ci.yml</a><br>特别重要的说明<a href="https://gitlab.com/gitlab-org/gitlab-ci/blob/7-13-stable/doc/examples/README.md" target="_blank" rel="external">官方说明</a><br><strong>How your build script is run</strong></p>
<p>The runner runs the line below before it runs the commands in your build script:<br><code>cd /gitlab-ci-runner/tmp/builds &amp;&amp; git clone git@gitlab_server_fqdn:group/project.git project-1 &amp;&amp; cd project-1 &amp;&amp; git checkout master</code><br><strong>Build script example</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bundle install</span><br><span class="line">bundle <span class="built_in">exec</span> rake db:create RAILS_ENV=<span class="built_in">test</span></span><br><span class="line">bundle <span class="built_in">exec</span> rake db:migrate RAILS_ENV=<span class="built_in">test</span></span><br><span class="line">script/run_all_tests</span><br></pre></td></tr></table></figure>
<p><strong>Environmental variables</strong></p>
<p>The runner sets the following environmental variables:<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">CI=<span class="literal">true</span></span><br><span class="line"><span class="built_in">CI_SERVER</span>=<span class="literal">true</span></span><br><span class="line"><span class="built_in">CI_SERVER_NAME</span>=GitLab CI</span><br><span class="line">GITLAB_CI=<span class="literal">true</span></span><br><span class="line"><span class="built_in">CI_SERVER_VERSION</span></span><br><span class="line"><span class="built_in">CI_SERVER_REVISION</span></span><br><span class="line"><span class="built_in">CI_BUILD_REF</span></span><br><span class="line"><span class="built_in">CI_BUILD_BEFORE_SHA</span></span><br><span class="line"><span class="built_in">CI_BUILD_REF_NAME</span> (branch)</span><br><span class="line"><span class="built_in">CI_BUILD_ID</span></span><br><span class="line"><span class="built_in">CI_BUILD_REPO</span></span><br><span class="line"><span class="built_in">CI_PROJECT_DIR</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/11/19/gitlab-ci-and-runner/" data-id="cilvxzsnz000gd9s65292jtzb" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/11/19/gitlab-ci-and-runner/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-aliyun-disk-growth-online" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/19/aliyun-disk-growth-online/" class="article-date">
  <time datetime="2015-11-18T18:49:29.000Z" itemprop="datePublished">2015-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/19/aliyun-disk-growth-online/">aliyunEC云主机磁盘安全扩容</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>云主机磁盘（块设备），实际是虚拟文件，当磁盘空间不够时，可以在云服务提供商后台增加磁盘容量，下面是用户需要做的操作。  </p>
<ul>
<li>系统版本：CentOS6</li>
<li>数据盘文件系统：xfs</li>
<li>数据盘挂载点：/mount_point</li>
<li>数据盘设备名：/dev/xvdb</li>
<li>当前容量: <code>df -lh</code><br><code>/dev/xvdb1       27G   23G  4.0G  85% /mount_point</code></li>
<li>扩容后容量：</li>
</ul>
<h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ul>
<li>停止服务 <code>service nginx stop</code></li>
<li>查看是否有其他程序正在打开分区<code>lsof /mount_point</code></li>
<li>umount分区 <code>umount /mount_point</code></li>
<li><p>查看磁盘信息，可看到这块盘已经是100GB大小，但是系统还不能使用。</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line"># fdisl -l /dev/xvdb</span><br><span class="line">Disk /dev/xvdb: <span class="number">107</span>.<span class="number">4</span> GB, <span class="number">107374182400</span> bytes, <span class="number">209715200</span>     sectors</span><br><span class="line">Device       Start      End         Blocks     Id  System</span><br><span class="line">/dev/xvdb1   <span class="number">7999488</span>    <span class="number">62914559</span>    <span class="number">27457536</span>   <span class="number">83</span>  Linux</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改分区表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># fdisk /dev/xvdb</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m for <span class="keyword">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: <span class="number">107.4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes</span>, <span class="number">209715200</span> sectors</span><br><span class="line">Units = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disk label <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device Boot      <span class="keyword">Start</span>         <span class="keyword">End</span>      Blocks   <span class="keyword">Id</span>  <span class="keyword">System</span></span><br><span class="line">/dev/xvdb1         <span class="number">7999488</span>    <span class="number">62914559</span>    <span class="number">27457536</span>   <span class="number">83</span>  Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): d</span><br><span class="line">Selected <span class="keyword">partition</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">Partition</span> <span class="number">1</span> <span class="keyword">is</span> deleted</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: <span class="number">107.4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes</span>, <span class="number">209715200</span> sectors</span><br><span class="line">Units = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disk label <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device Boot      <span class="keyword">Start</span>         <span class="keyword">End</span>      Blocks   <span class="keyword">Id</span>  <span class="keyword">System</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): n</span><br><span class="line"><span class="keyword">Partition</span> <span class="keyword">type</span>:</span><br><span class="line">   p   primary (<span class="number">0</span> primary, <span class="number">0</span> <span class="keyword">extended</span>, <span class="number">4</span> free)</span><br><span class="line">   e   <span class="keyword">extended</span></span><br><span class="line"><span class="keyword">Select</span> (<span class="keyword">default</span> p): p</span><br><span class="line"><span class="keyword">Partition</span> <span class="built_in">number</span> (<span class="number">1</span><span class="number">-4</span>, <span class="keyword">default</span> <span class="number">1</span>): </span><br><span class="line"><span class="keyword">First</span> sector (<span class="number">2048</span><span class="number">-209715199</span>, <span class="keyword">default</span> <span class="number">2048</span>): <span class="number">7999488</span></span><br><span class="line"><span class="keyword">Last</span> sector, +sectors <span class="keyword">or</span> +<span class="keyword">size</span>&#123;K,M,G&#125; (<span class="number">7999488</span><span class="number">-209715199</span>, <span class="keyword">default</span> <span class="number">209715199</span>): </span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">default</span> <span class="keyword">value</span> <span class="number">209715199</span></span><br><span class="line"><span class="keyword">Partition</span> <span class="number">1</span> <span class="keyword">of</span> <span class="keyword">type</span> Linux <span class="keyword">and</span> <span class="keyword">of</span> <span class="keyword">size</span> <span class="number">96.2</span> GiB <span class="keyword">is</span> <span class="keyword">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdb: <span class="number">107.4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes</span>, <span class="number">209715200</span> sectors</span><br><span class="line">Units = sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disk label <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device Boot      <span class="keyword">Start</span>         <span class="keyword">End</span>      Blocks   <span class="keyword">Id</span>  <span class="keyword">System</span></span><br><span class="line">/dev/xvdb1         <span class="number">7999488</span>   <span class="number">209715199</span>   <span class="number">100857856</span>   <span class="number">83</span>  Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): wq</span><br><span class="line">The <span class="keyword">partition</span> <span class="keyword">table</span> has been altered!</span><br><span class="line"></span><br><span class="line"><span class="keyword">Calling</span> ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> <span class="keyword">partition</span> <span class="keyword">table</span>.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看修改结果</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"># fdisk -l /dev/xvdb</span><br><span class="line"><span class="symbol">Disk</span> /dev/xvdb: <span class="number">107</span>.<span class="number">4</span> GB, <span class="number">107374182400</span> <span class="keyword">bytes, </span><span class="number">209715200</span> sectors</span><br><span class="line"><span class="symbol">Units</span> = sectors of <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Sector</span> size (logical/physical): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span>I/O size (minimum/optimal): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Disk</span> label type: dos</span><br><span class="line"><span class="symbol">Disk</span> identifier: <span class="number">0x000dc675</span></span><br><span class="line"></span><br><span class="line">    Device <span class="keyword">Boot </span>     Start         <span class="meta">End</span>      <span class="keyword">Blocks </span>  Id  System</span><br><span class="line">/dev/xvdb1         <span class="number">7999488</span>   <span class="number">209715199</span>   <span class="number">100857856</span>   <span class="number">83</span>  Linux</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用xfs_growfs命令对xfs文件系统进行扩容</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="comment"># xfs_growfs /dev/xvdb1 </span></span><br><span class="line"><span class="attr">meta-data=/dev/xvdb1</span>             <span class="attr">isize=256</span>    <span class="attr">agcount=4,</span> <span class="attr">agsize=1716096</span> <span class="attr">blks</span></span><br><span class="line">         =                       <span class="attr">sectsz=512</span>   <span class="attr">attr=2,</span> <span class="attr">projid32bit=0</span></span><br><span class="line">         =                       <span class="attr">crc=0</span></span><br><span class="line"><span class="attr">data</span>     =                       <span class="attr">bsize=4096</span>   <span class="attr">blocks=6864384,</span> <span class="attr">imaxpct=25</span></span><br><span class="line">         =                       <span class="attr">sunit=0</span>      <span class="attr">swidth=0</span> blks</span><br><span class="line"><span class="attr">naming</span>   =version <span class="number">2</span>              <span class="attr">bsize=4096</span>   <span class="attr">ascii-ci=0</span> <span class="attr">ftype=0</span></span><br><span class="line"><span class="attr">log</span>      =internal               <span class="attr">bsize=4096</span>   <span class="attr">blocks=3351,</span> <span class="attr">version=2</span></span><br><span class="line">         =                       <span class="attr">sectsz=512</span>   <span class="attr">sunit=0</span> blks, <span class="attr">lazy-count=1</span></span><br><span class="line"><span class="attr">realtime</span> =none                   <span class="attr">extsz=4096</span>   <span class="attr">blocks=0,</span> <span class="attr">rtextents=0</span></span><br><span class="line">data blocks changed from <span class="number">6864384</span> to <span class="number">25214464</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>挂载分区<code># mount -a</code></p>
</li>
<li>查看目前可用空间<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># df -lh</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted <span class="keyword">on</span></span><br><span class="line">/dev/xvdb1       <span class="number">97</span>G   <span class="number">23</span>G   <span class="number">74</span>G  <span class="number">24</span>% /mount_point</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="http://bbs.aliyun.com/read/239398.html" target="_blank" rel="external">aliyun磁盘原地扩容官方说明</a></p>
<p><a href="http://help.aliyun.com/document_detail/ecs/operation-guide/disk-operation/resize.html" target="_blank" rel="external">aliyun磁盘原地扩容官方操作说明</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/11/19/aliyun-disk-growth-online/" data-id="cilvxzsn80001d9s6zyjsvbrw" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/11/19/aliyun-disk-growth-online/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-icinga2-escalation-notification" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/22/icinga2-escalation-notification/" class="article-date">
  <time datetime="2015-09-21T22:52:12.000Z" itemprop="datePublished">2015-09-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/22/icinga2-escalation-notification/">icinga2/nagios 分级通知</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>icinga是nagios的派生版，但又增加了很多改进，icinga2版本配置文件变化较大。<br>下面是设置分级别通知策略的配置方法。<br>分级通知主要用于 业务负责人员未收到通知的情况通知全体联系人。   </p>
<p>下面的配置解析：<br>出现问题后立刻通知web组管理员，如果15分钟后问题没有得到处理，接下来的30分钟以每5分钟一次的频率再次通知web组管理员；45分钟后问题仍存在，通知所有管理员。</p>
<p><code>vim /etc/icinga2/conf.d/notifications.conf</code>  </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">// <span class="keyword">start</span> <span class="keyword">of</span> escalation notification <span class="keyword">level</span></span><br><span class="line"><span class="keyword">apply</span> Notification <span class="string">"wechat-2nd-level-web"</span> <span class="keyword">to</span> Service &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="string">"wechat-service-notification-template"</span></span><br><span class="line"></span><br><span class="line">  user_groups = [ <span class="string">"admins-web"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="built_in">interval</span> = <span class="number">5</span>m</span><br><span class="line">  times = &#123;</span><br><span class="line">    <span class="keyword">begin</span> = <span class="number">15</span>m</span><br><span class="line">    <span class="keyword">end</span> = <span class="number">45</span>m</span><br><span class="line">  &#125;</span><br><span class="line">  assign <span class="keyword">where</span> service.<span class="keyword">name</span> == <span class="string">"ping4"</span></span><br><span class="line">  assign <span class="keyword">where</span> <span class="keyword">match</span>(<span class="string">"nrpe_disk_read_write"</span>, service.<span class="keyword">name</span>)</span><br><span class="line">&#125;           </span><br><span class="line"><span class="keyword">apply</span> Notification <span class="string">"wechat-1st-level-web"</span> <span class="keyword">to</span> Service &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="string">"wechat-service-notification-template"</span></span><br><span class="line">           </span><br><span class="line">  user_groups = [ <span class="string">"icingaadmins"</span> ]</span><br><span class="line">              </span><br><span class="line">  <span class="built_in">interval</span> = <span class="number">15</span>m</span><br><span class="line">  times = &#123; </span><br><span class="line">    <span class="keyword">begin</span> = <span class="number">45</span>m</span><br><span class="line">    <span class="keyword">end</span> = <span class="number">2</span>h</span><br><span class="line">  &#125; </span><br><span class="line">  assign <span class="keyword">where</span> service.<span class="keyword">name</span> == <span class="string">"ping4"</span></span><br><span class="line">  assign <span class="keyword">where</span> <span class="keyword">match</span>(<span class="string">"nrpe_disk_read_write"</span>, service.<span class="keyword">name</span>)</span><br><span class="line">&#125;   </span><br><span class="line">// <span class="keyword">end</span> <span class="keyword">of</span> escalation notification <span class="keyword">level</span></span><br></pre></td></tr></table></figure>
<h3 id="官方的文档如下"><a href="#官方的文档如下" class="headerlink" title="官方的文档如下"></a>官方的文档如下</h3><p>Similar example for advanced notification apply rule filters: If the service attribute notes contains the has gold support 24x7 string AND one of the two condition passes: Either the customer host custom attribute is set to customer-xy OR the host custom attribute always_notify is set to true.</p>
<p>The notification is ignored for services whose host name ends with *internal OR the priority custom attribute is less than 2.</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">template Notification <span class="string">"cust-xy-notification"</span> &#123;</span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"noc-xy"</span>, <span class="string">"mgmt-xy"</span> ]</span><br><span class="line">  <span class="attr">command</span> = <span class="string">"mail-service-notification"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply Notification <span class="string">"notify-cust-xy-mysql"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"cust-xy-notification"</span></span><br><span class="line"></span><br><span class="line">  assign where match(<span class="string">"*has gold support 24x7*"</span>, service.notes) &amp;&amp; (host.vars.<span class="attr">customer</span> == <span class="string">"customer-xy"</span> || host.vars.<span class="attr">always_notify</span> == <span class="literal">true</span>)</span><br><span class="line">  ignore where match(<span class="string">"*internal"</span>, host.name) || (service.vars.priority &lt; <span class="number">2</span> &amp;&amp; host.vars.<span class="attr">is_clustered</span> == <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If the problem does not get resolved nor acknowledged preventing further notifications the escalation-sms-1st-level user will be escalated 1h after the initial problem was notified, but only for one hour (2h as end key for the times dictionary).  </p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">apply Notification <span class="string">"mail"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = <span class="string">"mail-notification"</span></span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"icingaadmin"</span> ]</span><br><span class="line"></span><br><span class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply Notification <span class="string">"escalation-sms-2nd-level"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = <span class="string">"sms-notification"</span></span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"icinga-oncall-2nd-level"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="attr">times</span> = &#123;</span><br><span class="line">    <span class="attr">begin</span> = <span class="number">30</span>m</span><br><span class="line">    <span class="attr">end</span> = <span class="number">1</span>h</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply Notification <span class="string">"escalation-sms-1st-level"</span> to Service &#123;</span><br><span class="line">  <span class="built_in">import</span> <span class="string">"generic-notification"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command</span> = <span class="string">"sms-notification"</span></span><br><span class="line">  <span class="attr">users</span> = [ <span class="string">"icinga-oncall-1st-level"</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="attr">times</span> = &#123;</span><br><span class="line">    <span class="attr">begin</span> = <span class="number">1</span>h</span><br><span class="line">    <span class="attr">end</span> = <span class="number">2</span>h</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  assign where service.<span class="attr">name</span> == <span class="string">"ping4"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/object-types#objecttype-notification" target="_blank" rel="external">官方关于notification定义的文档</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/monitoring-basics#notification-delay" target="_blank" rel="external">官方关于notification配置技巧文档</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/09/22/icinga2-escalation-notification/" data-id="cilvxzsoc000nd9s6ersib81x" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/09/22/icinga2-escalation-notification/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ssh-key-auth-require-password" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/15/ssh-key-auth-require-password/" class="article-date">
  <time datetime="2015-09-14T23:59:34.000Z" itemprop="datePublished">2015-09-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/15/ssh-key-auth-require-password/">ssh注入秘钥要求密码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>已经通过kickstart安装过程中注入ssh秘钥的系统，启动后ssh连接的时候仍然要求输入密码。<br>但是再执行一遍ssh-copy-id后，ssh就又能免密码连接。<br>最后确认是selinux问题。<br>解决办法是执行<code>/sbin/restorecon -r /root/.ssh</code><br>安装系统时关闭SELinux，可以在kickstart中增加一行<code>selinux --disabled</code>。<br>已经完整完系统的，可以<code>sed -i -e &#39;/SELINUX/s/enforcing/disabled/&#39; /etc/selinux/config</code> 重启系统来关闭SELinux。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/09/15/ssh-key-auth-require-password/" data-id="cilvxzsp60015d9s6rih2pgyi" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/09/15/ssh-key-auth-require-password/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-pnp4nagioszi-dong-diao-zheng-shu-zhi" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/08/pnp4nagioszi-dong-diao-zheng-shu-zhi/" class="article-date">
  <time datetime="2015-09-07T23:27:51.000Z" itemprop="datePublished">2015-09-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/08/pnp4nagioszi-dong-diao-zheng-shu-zhi/">pnp4nagios数值缩短问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>其实就是指定rrdtool的一个参数 –units-exponent 0<br><code>vim /usr/local/pnp4nagios/share/templates/get_cdn_bw_usage.php</code><br><figure class="highlight cos"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"># Plugin: get_cdn_bw_usage</span><br><span class="line"># Output: Last <span class="number">5</span>mins <span class="number">10140.73218</span>Mbp/<span class="keyword">s</span> | data=<span class="number">11040.73218</span>Mbps<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">$opt</span>[<span class="number">1</span>] = <span class="string">" --units-exponent 0 --vertical-label \"</span><span class="built_in">$UNIT</span>[<span class="number">1</span>]\<span class="string">" --title \"</span><span class="built_in">$servicedesc</span>\<span class="string">" "</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>]  = <span class="string">"DEF:var1=$RRDFILE[1]:$DS[1]:AVERAGE "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"AREA:var1#0066FF:\"</span>bandwidth\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:LAST:\"</span>%.<span class="number">5</span>lf <span class="built_in">%s</span><span class="built_in">$UNIT</span>[<span class="number">1</span>] last\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:AVERAGE:\"</span>%.<span class="number">5</span>lf <span class="built_in">%s</span><span class="built_in">$UNIT</span>[<span class="number">1</span>] avg\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line"><span class="built_in">$def</span>[<span class="number">1</span>] .= <span class="string">"GPRINT:var1:MAX:\"</span>%.<span class="number">5</span>lf <span class="built_in">%s</span><span class="built_in">$UNIT</span>[<span class="number">1</span>] max\\n\<span class="string">" "</span> <span class="comment">;</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.wuliwala.net/2015/09/08/pnp4nagioszi-dong-diao-zheng-shu-zhi/" data-id="cilvxzsoy000yd9s614b2shsf" class="article-share-link">Share</a>
      
        <a href="http://blog.wuliwala.net/2015/09/08/pnp4nagioszi-dong-diao-zheng-shu-zhi/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/03/14/migrate-to-git-from-svn/">Migration From Subversion(svn) to Git</a>
          </li>
        
          <li>
            <a href="/2016/03/08/searchcode-server-community-deploy/">Searchcode Server Community Deploy</a>
          </li>
        
          <li>
            <a href="/2016/03/01/wall-e-web-deployment/">Wall-E web deployment</a>
          </li>
        
          <li>
            <a href="/2016/02/15/ionic-web-app-dev/">ionic hybrid app development</a>
          </li>
        
          <li>
            <a href="/2016/01/25/bitbar-plugin-icinga-overview/">BitBar plugin icinga2 overview</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/app/" style="font-size: 10px;">app</a> <a href="/tags/dev/" style="font-size: 20px;">dev</a> <a href="/tags/devops/" style="font-size: 15px;">devops</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/ionic/" style="font-size: 10px;">ionic</a> <a href="/tags/monitoring/" style="font-size: 10px;">monitoring</a> <a href="/tags/sysops/" style="font-size: 10px;">sysops</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/app/">app</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/">dev</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/">devops</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ionic/">ionic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monitoring/">monitoring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sysops/">sysops</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 arkii<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="http://blog.wuliwala.net" class="mobile-nav-link">Home</a>
  
    <a href="http://blog.wuliwala.net/archives" class="mobile-nav-link">Archives</a>
  
    <a href="http://blog.wuliwala.net/about" class="mobile-nav-link">About</a>
  
    <a href="https://github.com/arkii" class="mobile-nav-link">GitHub</a>
  
    <a href="https://hub.docker.com/u/arkii" class="mobile-nav-link">DockerHub</a>
  
</nav>
    
<script>
  var disqus_shortname = 'blog-arkii';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>