<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tranquility Garden</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.wuliwala.net/"/>
  <updated>2017-08-30T08:25:30.000Z</updated>
  <id>http://blog.wuliwala.net/</id>
  
  <author>
    <name>arkii</name>
    <email>sqy6#163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Powerful wrk</title>
    <link href="http://blog.wuliwala.net/2017/08/30/powerful_wrk/"/>
    <id>http://blog.wuliwala.net/2017/08/30/powerful_wrk/</id>
    <published>2017-08-30T00:24:43.000Z</published>
    <updated>2017-08-30T08:25:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Powerful-wrk"><a href="#Powerful-wrk" class="headerlink" title="Powerful wrk"></a>Powerful wrk</h1><h3 id="Related"><a href="#Related" class="headerlink" title="Related"></a>Related</h3><p><a href="https://github.com/wg/wrk" target="_blank" rel="external">https://github.com/wg/wrk</a><br><a href="https://github.com/wg/wrk/blob/master/SCRIPTING" target="_blank" rel="external">SCRIPTING</a><br><a href="https://github.com/wg/wrk/blob/master/scripts" target="_blank" rel="external">scripts</a><br><a href="https://github.com/timotta/wrk-scripts/blob/master/multiplepaths.lua" target="_blank" rel="external">multiplepaths.lua</a></p>
<h2 id="random-arg-while-benchmarking"><a href="#random-arg-while-benchmarking" class="headerlink" title="random arg while benchmarking"></a>random arg while benchmarking</h2><p>For this example, I want benchmark this url, user is a number.</p>
<p><code>http://eureka.arkii.com/polls/14/progress/?user=\d+</code></p>
<p><strong>Lua script test.lua</strong></p>
<figure class="highlight lua"><table><tr><td class="code"><pre><div class="line"><span class="comment">-- print(wrk.scheme)</span></div><div class="line"><span class="comment">-- print(wrk.host)</span></div><div class="line"><span class="comment">-- print(wrk.port)</span></div><div class="line"><span class="comment">-- print(wrk.path)</span></div><div class="line"><span class="comment">-- print(wrk.body)</span></div><div class="line"></div><div class="line"><span class="built_in">math</span>.randomseed(<span class="built_in">os</span>.time())</div><div class="line"><span class="built_in">math</span>.random(); <span class="built_in">math</span>.random(); <span class="built_in">math</span>.random()</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span><span class="params">()</span></span></div><div class="line">    <span class="keyword">local</span> n = <span class="built_in">math</span>.random(<span class="number">999999</span>)</div><div class="line">    <span class="keyword">local</span> path = wrk.path</div><div class="line">    <span class="keyword">local</span> url = path..n</div><div class="line">    <span class="keyword">return</span> wrk.format(<span class="keyword">nil</span>, url)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment"># wrk -d 300 -c 3000 -t 16 --timeout 5 -s test.lua 'http://eureka.arkii.com/polls/14/progress/?user='             </span></div><div class="line">Running 5m <span class="built_in">test</span> @ http://eureka.arkii.com/polls/14/progress/?user=</div><div class="line">  16 threads and 3000 connections</div><div class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</div><div class="line">    Latency     1.86s     1.19s    5.00s    75.43%</div><div class="line">    Req/Sec    46.27     23.79     1.46k    75.01%</div><div class="line">  220502 requests <span class="keyword">in</span> 5.00m, 1.84GB <span class="built_in">read</span></div><div class="line">  Socket errors: connect 0, <span class="built_in">read</span> 3657, write 0, timeout 63411</div><div class="line">  Non-2xx or 3xx responses: 2196</div><div class="line">Requests/sec:    734.77</div><div class="line">Transfer/sec:      6.29MB</div></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment"># wrk -d 300 -c 3000 -t 16 --timeout 5 -s test.lua 'http://eureka.arkii.com/polls/14/progress/?user='</span></div><div class="line">Running 5m <span class="built_in">test</span> @ http://eureka.arkii.com/polls/14/progress/?user=</div><div class="line">  16 threads and 3000 connections</div><div class="line">  Thread Stats   Avg      Stdev     Max   +/- Stdev</div><div class="line">    Latency     1.86s     1.21s    5.00s    73.99%</div><div class="line">    Req/Sec    46.40     23.55     0.90k    66.45%</div><div class="line">  220857 requests <span class="keyword">in</span> 5.00m, 1.84GB <span class="built_in">read</span></div><div class="line">  Socket errors: connect 0, <span class="built_in">read</span> 0, write 0, timeout 64029</div><div class="line">  Non-2xx or 3xx responses: 2566</div><div class="line">Requests/sec:    735.95</div><div class="line">Transfer/sec:      6.29MB</div></pre></td></tr></table></figure>
<p><strong>Application logs on server side</strong></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=106856 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=770189 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=901519 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=645483 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=370875 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=431874 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=250223 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=598406 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=464561 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=585691 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=275949 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=963801 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=188118 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=674099 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=600031 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=744967 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=743827 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=504839 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=869017 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=197191 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=943787 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=895053 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=383663 HTTP/1.1"</span> <span class="number">200</span> -</div><div class="line"><span class="number">127.0.0.1</span> - - <span class="string">[30/Aug/2017 11:21:20]</span> <span class="string">"<span class="keyword">GET</span> /polls/14/progress/?user=967306 HTTP/1.1"</span> <span class="number">200</span> -</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Powerful-wrk&quot;&gt;&lt;a href=&quot;#Powerful-wrk&quot; class=&quot;headerlink&quot; title=&quot;Powerful wrk&quot;&gt;&lt;/a&gt;Powerful wrk&lt;/h1&gt;&lt;h3 id=&quot;Related&quot;&gt;&lt;a href=&quot;#Relate
    
    </summary>
    
      <category term="tools" scheme="http://blog.wuliwala.net/categories/tools/"/>
    
    
      <category term="benchmark" scheme="http://blog.wuliwala.net/tags/benchmark/"/>
    
      <category term="wrk" scheme="http://blog.wuliwala.net/tags/wrk/"/>
    
  </entry>
  
  <entry>
    <title>logstash CPU high</title>
    <link href="http://blog.wuliwala.net/2017/03/16/logstash-cpu-percent-100/"/>
    <id>http://blog.wuliwala.net/2017/03/16/logstash-cpu-percent-100/</id>
    <published>2017-03-16T02:23:43.000Z</published>
    <updated>2017-03-16T08:28:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Logstash-CPU-使用率高"><a href="#Logstash-CPU-使用率高" class="headerlink" title="Logstash CPU 使用率高"></a>Logstash CPU 使用率高</h1><p>好久没更新blog了。<br>最近搭ELK，遇到logstash的几个坑。<br>特别特别坑，忍无可忍，赶紧记录下来。</p>
<p>CPU使用100%的情况：<br>/etc/init.d/logstash中有一行nice=19<br>在系统中使用top命令会看到CPU每个核心使用率100%。按1键会看到，并不是%us高，而是100%ni。</p>
<p><code>Timeout executing grok &#39;%{NGINXMAIN}&#39; against field &#39;message&#39; with value &#39;Value too large to output (587 bytes)! First 255 chars are:</code></p>
<p><code>Timeout executing grok &#39;%{NGINXMAIN}&#39; against field &#39;message&#39; with value &#39;</code>  </p>
<p>这两个错误绝对不是超时，而是正则表达式没匹配。</p>
<p>当我把问题解决完之后，才发现，CPU使用率高的最终原因是传来的日志格式不能匹配，所以grok就会找默认的n多正则，一直到超时(貌似默认30秒)，这个时间内CPU就会特别繁忙。</p>
<p>总结:</p>
<ol>
<li>当你无法确认所接受到的数据都能在你的自定义正则匹配时，建议删除grok插件自带的正则模板</li>
<li>写正则表达式时，多思考，要兼容意外情况。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Logstash-CPU-使用率高&quot;&gt;&lt;a href=&quot;#Logstash-CPU-使用率高&quot; class=&quot;headerlink&quot; title=&quot;Logstash CPU 使用率高&quot;&gt;&lt;/a&gt;Logstash CPU 使用率高&lt;/h1&gt;&lt;p&gt;好久没更新blog了
    
    </summary>
    
      <category term="sysop" scheme="http://blog.wuliwala.net/categories/sysop/"/>
    
    
      <category term="elk" scheme="http://blog.wuliwala.net/tags/elk/"/>
    
  </entry>
  
  <entry>
    <title>DC/OS Deployment</title>
    <link href="http://blog.wuliwala.net/2016/04/21/dcos_installation/"/>
    <id>http://blog.wuliwala.net/2016/04/21/dcos_installation/</id>
    <published>2016-04-21T10:42:00.000Z</published>
    <updated>2016-12-08T08:10:20.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p><strong>Every system operator always dreaming an infrastructure management tool like <a href="https://dcos.io" target="_blank" rel="external">DCOS</a>, makes job easier and more spare time.</strong><br>As you know, mesosphere.com released it as <a href="https://mesosphere.com/blog/2016/04/19/open-source-dcos/" target="_blank" rel="external">Open Source project</a> on 2016/04/19.<br>So I tried it the first time.<br>This post reords my steps followed the official <a href="https://dcos.io/get-started" target="_blank" rel="external">guide</a>.<br>In this example, all my node is running CentOS7(with <code>yum -y update</code>), I used 6 nodes(1 deploy, 1 master, 4 compute), and if you want master node High-Availability, 8 nodes(1 deploy, 3 master, 4 compute) is recommended.<br>After deployment, the deploy node can be destroyed, so it can be a temporary vm.</p>
<h3 id="System-Requirements"><a href="#System-Requirements" class="headerlink" title="System Requirements"></a>System Requirements</h3><p>Please read <a href="https://dcos.io/docs/1.7/administration/installing/custom/system-requirements/" target="_blank" rel="external">system-requirements</a> carefully.<br>First time, I encountered an issue. It’s a shell script in the progress of deployment, to change the storage-driver to overlayfs.<br>I don’t know why if run with this <code>-H fd://</code>, docker daemon can not get started.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo mkdir -p /etc/systemd/system/docker.service.d &amp;&amp; sudo tee /etc/systemd/system/docker.service.d/override.conf &lt;&lt;- EOF</div><div class="line">[Service]</div><div class="line">ExecStart=</div><div class="line">ExecStart=/usr/bin/docker daemon --storage-driver=overlay -H fd://</div><div class="line">EOF</div></pre></td></tr></table></figure>
<ul>
<li>CentOS Linux release 7.2.1511 (Core)   </li>
<li>Linux 3.10.0-327.13.1.el7.x86_64  </li>
<li>docker 1.9.xx</li>
</ul>
<p>So I upgraded docker to v1.11.0</p>
<h3 id="Deployment-Progress"><a href="#Deployment-Progress" class="headerlink" title="Deployment Progress"></a>Deployment Progress</h3><h4 id="change-storage-driver-from-devicemapper-to-overlayfs"><a href="#change-storage-driver-from-devicemapper-to-overlayfs" class="headerlink" title="change storage-driver from devicemapper to overlayfs"></a>change storage-driver from devicemapper to overlayfs</h4><p><a href="https://docs.docker.com/engine/userguide/storagedriver/overlayfs-driver/" target="_blank" rel="external">docker official docs of storage driver</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">service docker stop</div><div class="line"></div><div class="line"><span class="comment"># remove  '-H fd://'</span></div><div class="line">sed -ie <span class="string">"/DOCKER_STORAGE_OPTIONS/s/=.*/='--storage-driver=overlay'/"</span> /etc/sysconfig/docker-storage</div><div class="line"></div><div class="line">service docker start</div><div class="line"></div><div class="line"><span class="comment"># check if storage-driver is overlay</span></div><div class="line">docker info</div></pre></td></tr></table></figure>
<h4 id="Download-amp-Start-the-DC-OS-installer"><a href="#Download-amp-Start-the-DC-OS-installer" class="headerlink" title="Download &amp; Start the DC/OS installer"></a>Download &amp; Start the DC/OS installer</h4><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">curl -O https://downloads.dcos.io/dcos/EarlyAccess/dcos_generate_config.sh</div><div class="line">bash dcos_generate_config.sh --web -v</div></pre></td></tr></table></figure>
<p>Launch the DC/OS web installer in your browser at: <code>http://&lt;bootstrap-node-public-ip&gt;:9000</code>.</p>
<p><strong>Follow this <a href="https://dcos.io/docs/1.7/administration/installing/custom/gui/" target="_blank" rel="external">GUI DC/OS Installation Guide</a>.</strong></p>
<h4 id="Uninstall-DC-OS"><a href="#Uninstall-DC-OS" class="headerlink" title="Uninstall DC/OS"></a>Uninstall DC/OS</h4><figure class="highlight mipsasm"><table><tr><td class="code"><pre><div class="line"><span class="keyword">bash </span>dcos_generate_config.<span class="keyword">sh </span>--uninstall</div></pre></td></tr></table></figure>
<h4 id="Authentication-opt-out"><a href="#Authentication-opt-out" class="headerlink" title="Authentication opt-out"></a>Authentication opt-out</h4><p><a href="https://dcos.io/docs/1.7/overview/security/#authentication-opt-out" target="_blank" rel="external">authentication-opt-out</a><br>If you are performing a custom advanced installation, you may opt out of Auth0-based authentication by adding the following directive to <code>genconf/config.yaml</code> (note that the quotes are currently required):</p>
<p><code>oauth_enabled: &#39;false&#39;</code></p>
<p>On AWS, when creating a stack, at the Specify Details step, you may choose to set the OAuthEnabled option to false to disable authentication for the DC/OS installation.</p>
<p>The same option is not currently available when installing DC/OS through the Azure Marketplace, but will be added in a future release along with other options to customize authentication.</p>
<h3 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h3><p><a href="http://elrepo.org/tiki/tiki-index.php" target="_blank" rel="external">ELrepo</a><br><a href="https://github.com/dcos/dcos" target="_blank" rel="external">dcos on github</a><br><a href="https://dcos.io/docs/1.7/administration/installing/custom/advanced/#configure-your-cluster" target="_blank" rel="external">configure-your-cluster</a></p>
<h3 id="All-right-it’s-show-time"><a href="#All-right-it’s-show-time" class="headerlink" title="All right, it’s show time"></a>All right, it’s show time</h3><p><img src="/images/2016/04/21/1.png" alt=""><br><img src="/images/2016/04/21/2.png" alt=""><br><img src="/images/2016/04/21/3.png" alt=""><br><img src="/images/2016/04/21/4.png" alt=""><br><img src="/images/2016/04/21/5.png" alt=""><br><img src="/images/2016/04/21/6.png" alt=""><br><img src="/images/2016/04/21/7.png" alt=""><br><img src="/images/2016/04/21/8.png" alt=""><br><img src="/images/2016/04/21/9.png" alt=""><br><img src="/images/2016/04/21/10.png" alt=""><br><img src="/images/2016/04/21/11.png" alt=""><br><img src="/images/2016/04/21/12.png" alt=""><br><img src="/images/2016/04/21/13.png" alt=""><br><img src="/images/2016/04/21/14.png" alt=""><br><img src="/images/2016/04/21/15.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Every system operator 
    
    </summary>
    
      <category term="cloud" scheme="http://blog.wuliwala.net/categories/cloud/"/>
    
    
      <category term="dcos" scheme="http://blog.wuliwala.net/tags/dcos/"/>
    
      <category term="docker" scheme="http://blog.wuliwala.net/tags/docker/"/>
    
      <category term="mesos" scheme="http://blog.wuliwala.net/tags/mesos/"/>
    
  </entry>
  
  <entry>
    <title>Using NxLog to send Windows Event Logs to Logstash</title>
    <link href="http://blog.wuliwala.net/2016/04/21/using_nxlog_to_send_windows_event_logs_to_logstash/"/>
    <id>http://blog.wuliwala.net/2016/04/21/using_nxlog_to_send_windows_event_logs_to_logstash/</id>
    <published>2016-04-21T04:42:00.000Z</published>
    <updated>2016-04-21T09:42:28.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Using-NxLog-to-send-Windows-Event-Logs-to-Logstash"><a href="#Using-NxLog-to-send-Windows-Event-Logs-to-Logstash" class="headerlink" title="Using NxLog to send Windows Event Logs to Logstash"></a>Using NxLog to send Windows Event Logs to Logstash</h2><h3 id="configure-logstash"><a href="#configure-logstash" class="headerlink" title="configure logstash"></a>configure logstash</h3><figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">input &#123;</div><div class="line">  tcp &#123;</div><div class="line">    codec =&gt; json_lines &#123; charset =&gt; <span class="string">"UTF-8"</span> &#125;</div><div class="line">    <span class="comment"># codec =&gt; json_lines &#123; charset =&gt; CP1252 &#125;</span></div><div class="line">    port =&gt; <span class="number">5000</span></div><div class="line">    tags =&gt; [ <span class="string">"tcpjson"</span> ]</div><div class="line">    type =&gt; <span class="string">"nxlog"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">filter &#123;</div><div class="line">  <span class="keyword">if</span> [type] == <span class="string">"nxlog"</span> &#123;</div><div class="line">    json &#123;</div><div class="line">      source =&gt; <span class="string">"message"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> [SourceModuleName] == <span class="string">"eventlog"</span> &#123;</div><div class="line">      mutate &#123;</div><div class="line">        replace =&gt; [ <span class="string">"message"</span>, <span class="string">"%&#123;Message&#125;"</span> ]</div><div class="line">      &#125;</div><div class="line">      mutate &#123;</div><div class="line">        remove_field =&gt; [ <span class="string">"Message"</span> ]</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    date &#123;</div><div class="line">      locale =&gt; <span class="string">"en"</span></div><div class="line">      <span class="comment"># timezone =&gt; "Etc/GMT"</span></div><div class="line">      timezone =&gt; <span class="string">"Asia/Shanghai"</span></div><div class="line">      match =&gt; [ <span class="string">"EventTime"</span>, <span class="string">"YYYY-MM-dd HH:mm:ss"</span> ]</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">  elasticsearch &#123;</div><div class="line">    hosts =&gt; [<span class="string">"YOUR_ELASTICSEARCH_SERVER"</span>]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="install-nxlog-ce"><a href="#install-nxlog-ce" class="headerlink" title="install nxlog-ce"></a>install nxlog-ce</h3><p><a href="http://nxlog.org/products/nxlog-community-edition/download" target="_blank" rel="external">download here</a>  </p>
<h3 id="modify-nxlog-conf"><a href="#modify-nxlog-conf" class="headerlink" title="modify nxlog.conf"></a>modify nxlog.conf</h3><figure class="highlight"><table><tr><td class="code"><pre><div class="line">## This is a sample configuration file. See the nxlog reference manual about the</div><div class="line">## configuration options. It should be installed locally and is also available</div><div class="line">## online at http://nxlog.org/docs/</div><div class="line"></div><div class="line">## Please set the ROOT to the folder your nxlog was installed into,</div><div class="line">## otherwise it will not start.</div><div class="line"></div><div class="line">#define ROOT C:\Program Files\nxlog</div><div class="line">define ROOT C:\Program Files (x86)\nxlog</div><div class="line"></div><div class="line">Moduledir %ROOT%\modules</div><div class="line">CacheDir %ROOT%\data</div><div class="line">Pidfile %ROOT%\data\nxlog.pid</div><div class="line">SpoolDir %ROOT%\data</div><div class="line">LogFile %ROOT%\data\nxlog.log</div><div class="line"></div><div class="line">&lt;Extension json&gt;</div><div class="line">    Module	xm_json</div><div class="line">&lt;/Extension&gt;</div><div class="line"></div><div class="line">&lt;Input eventlog&gt;</div><div class="line">    Module      im_msvistalog</div><div class="line">#    SavePos	TRUE</div><div class="line">    Query       &lt;QueryList&gt;\</div><div class="line">                    &lt;Query Id="0"&gt;\</div><div class="line">                        &lt;Select Path="Application"&gt;*&lt;/Select&gt;\</div><div class="line">                        &lt;Select Path="System"&gt;*&lt;/Select&gt;\</div><div class="line">                        &lt;Select Path="Security"&gt;*&lt;/Select&gt;\</div><div class="line">                    &lt;/Query&gt;\</div><div class="line">                &lt;/QueryList&gt;</div><div class="line">    Exec	to_json();</div><div class="line">&lt;/Input&gt;</div><div class="line"></div><div class="line">&lt;Output out&gt;</div><div class="line">    Module      om_tcp</div><div class="line">    Host        YOUR_LOGSTASH_SERVER</div><div class="line">    Port        5000</div><div class="line">&lt;/Output&gt;</div><div class="line"></div><div class="line">&lt;Route 1&gt;</div><div class="line">    Path        eventlog =&gt; out</div><div class="line">&lt;/Route&gt;</div></pre></td></tr></table></figure>
<h3 id="verify-configuration-file-syntax-and-start-service"><a href="#verify-configuration-file-syntax-and-start-service" class="headerlink" title="verify configuration file syntax and start service"></a>verify configuration file syntax and start service</h3><p><code>&quot;C:\Program Files (x86)\nxlog\nxlog.exe&quot; -v &amp;&amp; net start nxlog</code></p>
<h3 id="make-some-noise-on-your-windows-node"><a href="#make-some-noise-on-your-windows-node" class="headerlink" title="make some noise on your windows node"></a>make some noise on your windows node</h3><h4 id="then-you-will-see-it-in-elasticsearch"><a href="#then-you-will-see-it-in-elasticsearch" class="headerlink" title="then you will see it in elasticsearch"></a>then you will see it in elasticsearch</h4><h3 id="docs"><a href="#docs" class="headerlink" title="docs"></a>docs</h3><p><a href="http://nxlog.org/docs/nxlog-ce/nxlog-reference-manual.html" target="_blank" rel="external">nxlog-reference-manual</a><br><a href="http://nxlog.org/docs/elasticsearch-kibana/using-nxlog-with-elasticsearch-and-kibana.html" target="_blank" rel="external">using-nxlog-with-elasticsearch-and-kibana</a><br><a href="http://nxlog.org/docs/sysmon/audit-logging-on-windows-with-sysmon-and-nxlog.html" target="_blank" rel="external">audit-logging-on-windows-with-sysmon-and-nxlog</a><br><a href="https://www.elastic.co/guide/en/logstash/2.2/event-dependent-configuration.html" target="_blank" rel="external">logstash-event-dependent-configuration</a><br><a href="https://sematext.com/blog/2016/02/01/sending-windows-event-logs-to-logsene-using-nxlog-and-logstash/" target="_blank" rel="external">sending-windows-event-logs-to-logsene-using-nxlog-and-logstash</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Using-NxLog-to-send-Windows-Event-Logs-to-Logstash&quot;&gt;&lt;a href=&quot;#Using-NxLog-to-send-Windows-Event-Logs-to-Logstash&quot; class=&quot;headerlink&quot;
    
    </summary>
    
      <category term="monitoring" scheme="http://blog.wuliwala.net/categories/monitoring/"/>
    
    
      <category term="elk" scheme="http://blog.wuliwala.net/tags/elk/"/>
    
      <category term="logstash" scheme="http://blog.wuliwala.net/tags/logstash/"/>
    
      <category term="windows" scheme="http://blog.wuliwala.net/tags/windows/"/>
    
      <category term="nxlog" scheme="http://blog.wuliwala.net/tags/nxlog/"/>
    
  </entry>
  
  <entry>
    <title>Upgrade influxdb from v0.9 to v0.12</title>
    <link href="http://blog.wuliwala.net/2016/04/12/upgrade_influxdb_from_v0.9_to_v0.10/"/>
    <id>http://blog.wuliwala.net/2016/04/12/upgrade_influxdb_from_v0.9_to_v0.10/</id>
    <published>2016-04-12T06:42:00.000Z</published>
    <updated>2016-04-20T06:51:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Upgrade-influxdb-from-v0-9-to-v0-10"><a href="#Upgrade-influxdb-from-v0-9-to-v0-10" class="headerlink" title="Upgrade influxdb from v0.9 to v0.10"></a>Upgrade influxdb from v0.9 to v0.10</h2><h4 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h4><table>
<thead>
<tr>
<th>Comparison</th>
<th>0.9</th>
<th>0.10</th>
</tr>
</thead>
<tbody>
<tr>
<td>engine</td>
<td>b1\</td>
<td>bz1</td>
<td>tsm1</td>
</tr>
</tbody>
</table>
<h3 id="upgrade-from-v0-9-to-v0-10"><a href="#upgrade-from-v0-9-to-v0-10" class="headerlink" title="upgrade from v0.9 to v0.10"></a>upgrade from v0.9 to v0.10</h3><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">$ influx_tsm -h</div><div class="line">:&lt;&lt;DOC</div><div class="line">Usage: influx_tsm [options] &lt;data-path&gt; </div><div class="line"></div><div class="line">Convert a database from b1 or bz1 format to tsm1 format.</div><div class="line"></div><div class="line">This tool will backup the directories before conversion (<span class="keyword">if</span> not disabled).</div><div class="line">The backed-up files must be removed manually, generally after starting up the</div><div class="line">node again to make sure all of data has been converted correctly.</div><div class="line"></div><div class="line">To restore a backup:</div><div class="line">  Shut down the node, remove the converted directory, and</div><div class="line">  copy the backed-up directory to the original location.</div><div class="line"></div><div class="line">Options:</div><div class="line">  -backup=<span class="string">""</span>: The location to backup up the current databases. Must not be within the data directory.</div><div class="line">  -dbs=<span class="string">""</span>: Comma-delimited list of databases to convert. Default is to convert all databases.</div><div class="line">  -debug=<span class="string">""</span>: If <span class="built_in">set</span>, http debugging endpoints will be enabled on the given address</div><div class="line">  -interval=5s: How often status updates are printed.</div><div class="line">  -nobackup=<span class="literal">false</span>: Disable database backups. Not recommended.</div><div class="line">  -parallel=<span class="literal">false</span>: Perform parallel conversion. (up to GOMAXPROCS shards at once)</div><div class="line">  -profile=<span class="string">""</span>: CPU Profile location</div><div class="line">  -sz=2147483648: Maximum size of individual TSM files.</div><div class="line">  -y=<span class="literal">false</span>: Don<span class="string">'t ask, just convert</span></div><div class="line">DOC</div><div class="line"></div><div class="line">$ ls /var/lib/influxdb</div><div class="line">data  hh  meta  wal</div><div class="line"></div><div class="line">$ mkdir /tmp/influxdb_backup</div><div class="line"></div><div class="line">$ influx_tsm -backup /tmp/influxdb_backup /var/lib/influxdb/data</div><div class="line"></div><div class="line"># If you wish to minimize the time conversion takes, enable parallel mode with -parallel:</div><div class="line">$ influx_tsm -parallel=true -backup /tmp/influxdb_backup /var/lib/influxdb/data</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">:&lt;&lt;OUTPUT</div><div class="line">2016/04/19 00:18:44.362167 Still Working: Completed Shards: 27/28 Points read/written: 4192583424/4192583424</div><div class="line">2016/04/19 00:18:49.362387 Still Working: Completed Shards: 27/28 Points read/written: 4192625739/4192625739</div><div class="line">2016/04/19 00:18:54.362674 Still Working: Completed Shards: 27/28 Points read/written: 4192700371/4192700371</div><div class="line">2016/04/19 00:18:59.362906 Still Working: Completed Shards: 27/28 Points read/written: 4192806162/4192806162</div><div class="line">2016/04/19 00:19:04.363121 Still Working: Completed Shards: 27/28 Points read/written: 4192911040/4192911040</div><div class="line">2016/04/19 00:19:09.363313 Still Working: Completed Shards: 27/28 Points read/written: 4192911040/4192911040</div><div class="line">2016/04/19 00:19:13.912142 Conversion of /data/data/icinga/default/136 successful (8h6m31.481348028s)</div><div class="line"></div><div class="line">Summary statistics</div><div class="line">========================================</div><div class="line">Databases converted:                 2</div><div class="line">Shards converted:                    28</div><div class="line">TSM files created:                   28</div><div class="line">Points read:                         4192911040</div><div class="line">Points written:                      4192911040</div><div class="line">NaN filtered:                        0</div><div class="line">Inf filtered:                        0</div><div class="line">Points without fields filtered:      0</div><div class="line">Disk usage pre-conversion (bytes):   118480699392</div><div class="line">Disk usage post-conversion (bytes):  17643390726</div><div class="line">Reduction factor:                    85%</div><div class="line">Bytes per TSM point:                 4.21</div><div class="line">Total conversion time:               13h56m43.515786407s</div><div class="line">OUTPUT</div></pre></td></tr></table></figure>
<h3 id="official-upgrading-guides"><a href="#official-upgrading-guides" class="headerlink" title="official upgrading guides"></a>official upgrading guides</h3><p><a href="https://docs.influxdata.com/influxdb/v0.10/administration/upgrading/" target="_blank" rel="external">v0.10/administration/upgrading/</a><br><a href="https://docs.influxdata.com/influxdb/v0.11/administration/upgrading/" target="_blank" rel="external">v0.11/administration/upgrading/</a><br><a href="https://docs.influxdata.com/influxdb/v0.12/administration/upgrading/" target="_blank" rel="external">v0.12/administration/upgrading/</a><br><a href="http://www.slideshare.net/SeanBeckett4/influxdb-upgrade-to-010-considerations" target="_blank" rel="external">SeanBeckett4 influxdb-upgrade-to-010-considerations</a></p>
<h4 id="Example-Migration-2"><a href="#Example-Migration-2" class="headerlink" title="Example Migration #2"></a>Example Migration #2</h4><p>Conditions: </p>
<ul>
<li>Downtime is unacceptable  </li>
<li>Converting from 0.9  </li>
<li>Not clustered  </li>
</ul>
<ol>
<li>Install 0.10.1 on top of 0.9 and restart</li>
<li>Copy “cold” B1/BZ1 shards to /tmp</li>
<li>Run <code>./influx_tsm to convert cold shards influx_tsm -backup /tmp/influxdb_backup /tmp/data</code></li>
<li>Remove cold B1/BZ1 shards and replace with converted TSM shards</li>
<li>Wait until current “hot” shards become “cold”, repeat steps 2-4 on newly cold shards</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Upgrade-influxdb-from-v0-9-to-v0-10&quot;&gt;&lt;a href=&quot;#Upgrade-influxdb-from-v0-9-to-v0-10&quot; class=&quot;headerlink&quot; title=&quot;Upgrade influxdb from 
    
    </summary>
    
    
      <category term="monitoring" scheme="http://blog.wuliwala.net/tags/monitoring/"/>
    
      <category term="influxdb" scheme="http://blog.wuliwala.net/tags/influxdb/"/>
    
      <category term="graphing" scheme="http://blog.wuliwala.net/tags/graphing/"/>
    
  </entry>
  
  <entry>
    <title>SuperMicro Auto Deploy</title>
    <link href="http://blog.wuliwala.net/2016/04/07/supermicro_auto_deploy/"/>
    <id>http://blog.wuliwala.net/2016/04/07/supermicro_auto_deploy/</id>
    <published>2016-04-07T10:42:00.000Z</published>
    <updated>2016-04-11T03:42:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SuperMicro-Auto-Deploy"><a href="#SuperMicro-Auto-Deploy" class="headerlink" title="SuperMicro Auto Deploy"></a>SuperMicro Auto Deploy</h2><h3 id="SMCIPMITool-Usage"><a href="#SMCIPMITool-Usage" class="headerlink" title="SMCIPMITool Usage"></a>SMCIPMITool Usage</h3><h4 id="Query-FRU-info"><a href="#Query-FRU-info" class="headerlink" title="Query FRU info"></a>Query FRU info</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi fru</div><div class="line">:&lt;&lt;EOF</div><div class="line">Getting FRU ...</div><div class="line">Chassis Type (CT)              = Other (01h)</div><div class="line">Chassis Part Number (CP)       = CSE-217HQ-XXXX</div><div class="line">Chassis Serial Number (CS)     = C2170FE0XXXX</div><div class="line">Board mfg. Date/Time (BDT)     = 1996/01/01 00:00:00 (00 00 00)</div><div class="line">Board Manufacturer Name (BM)   = Supermicro</div><div class="line">Board Product Name (BPN)       = </div><div class="line">Board Serial Number (BS)       = VM15CSXXXX</div><div class="line">Board Part Number (BP)         = X10DRT-H</div><div class="line">Board FRU File ID              = </div><div class="line">Product Manufacturer Name (PM) = Supermicro</div><div class="line">Product Name (PN)              = </div><div class="line">Product PartModel Number (PPM) = SYS-2028TR-H72R</div><div class="line">Product Version (PV)           = </div><div class="line">Product Serial Number (PS)     = S173440XXXXXXX</div><div class="line">Product Asset Tag (PAT)        = </div><div class="line">Product FRU File ID            = </div><div class="line">EOF</div></pre></td></tr></table></figure>
<h4 id="Set-Next-Boot-from-PXE"><a href="#Set-Next-Boot-from-PXE" class="headerlink" title="Set Next Boot from PXE"></a>Set Next Boot from PXE</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">:&lt;&lt;EOF</div><div class="line">For bootoption index :</div><div class="line">1: PXE              2:  Hard-drive</div><div class="line">3: CD/DVD           4:  Bios</div><div class="line">5: USB KEY          6:  USB HDD</div><div class="line">7: USB Floppy       8:  USB CD/DVD</div><div class="line">9: UEFI Hard-drive  10: UEFI CD/DVD</div><div class="line">11: UEFI USB KEY    12: UEFI USB HDD</div><div class="line">13: UEFI USB CD/DVD    </div><div class="line">EOF</div><div class="line"></div><div class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi power bootoption 1 </div><div class="line">SMCIPMITool 10.0.0.100 ADMIN ADMIN ipmi power reset</div><div class="line"></div><div class="line">:&lt;&lt;EOF</div><div class="line">3.39.2 wsiso mount</div><div class="line">Use this <span class="built_in">command</span> to mount an ISO file.</div><div class="line">Usage:wsiso mount &lt;IP&gt; &lt;path&gt; [username] [password]</div><div class="line">      IP: IP or domain name of share host</div><div class="line">      path: path to iso file</div><div class="line">      username: username of share host (optional)</div><div class="line">      password: password of share host (optional)</div><div class="line">      Ex 1: mount linux.iso</div><div class="line">       wsiso mount 192.168.1.100 /iso/linux.iso</div><div class="line">      Ex 2: mount linux.iso with username and password</div><div class="line">       wsiso mount 192.168.1.100 /iso/linux.iso admin admin</div><div class="line">      * Use one ISO file at a time. Make sure umount existing ISO before mount new ISO</div><div class="line">    file</div><div class="line">      * This <span class="built_in">command</span> is available <span class="keyword">for</span> X9 and X10 platform with SFT-OOB-LIC node</div><div class="line">    product key</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h3 id="RAID-Configuration"><a href="#RAID-Configuration" class="headerlink" title="RAID Configuration"></a>RAID Configuration</h3><p><code>&lt;Ctrl&gt; - &lt;Y&gt;</code><br><strong>LSI Preboot CLI</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment"># pager 20 lines per page</span></div><div class="line">PDList a0 page20</div><div class="line"><span class="comment"># create one raid0 ld with one disk</span></div><div class="line">C<span class="built_in">fg</span>LdAdd r0 [252:0] a0<span class="comment"># create one raid1 ld with two disks</span>C<span class="built_in">fg</span>LdAdd r1 [252:0,252:1] a0C<span class="built_in">fg</span>Foreign Clear a0</div></pre></td></tr></table></figure>
<p><strong>Full Screen Cast Below</strong></p>
<figure class="highlight vim"><table><tr><td class="code"><pre><div class="line">Battery Statu<span class="variable">s:</span> Not present                                                                         </div><div class="line">                                                                                                    </div><div class="line">PCI SLOT ID LUN VENDOR    PRODUCT                   REVISION       CAPACITY                         </div><div class="line">-------- -- --- ------    -------                   --------       --------                         </div><div class="line"><span class="number">3</span>               LSI       Supermicro SMC2208        <span class="number">3.240</span>.<span class="number">05</span>-<span class="number">2282</span>  <span class="number">1024</span>MB                           </div><div class="line"><span class="number">3</span>        <span class="number">7</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">3</span>        <span class="number">8</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">0</span> Virtual Drive(s) found <span class="keyword">on</span> the host adapter.                                                       </div><div class="line">                                                                                                    </div><div class="line"><span class="number">0</span> Virtual Drive(s) handled by BIOS                                                                  </div><div class="line">Press <span class="symbol">&lt;Ctrl&gt;</span><span class="symbol">&lt;H&gt;</span> <span class="keyword">for</span> WebBIOS <span class="built_in">or</span> press <span class="symbol">&lt;Ctrl&gt;</span><span class="symbol">&lt;Y&gt;</span> <span class="keyword">for</span> Preboot CLI                                      </div><div class="line">                                                                                                    </div><div class="line">MegaPCLI SAS RAID Management Tool.                                                                  </div><div class="line">Copyright(<span class="keyword">c</span>) LSI Corporation, <span class="number">2008</span>.                                                                 </div><div class="line">Use -h -<span class="keyword">a</span><span class="symbol">&lt;n&gt;</span> <span class="keyword">for</span> controller specific <span class="keyword">help</span>, where n <span class="keyword">is</span> the controller <span class="built_in">index</span>                          </div><div class="line">Use -v -<span class="keyword">a</span><span class="symbol">&lt;n&gt;</span> <span class="keyword">for</span> controller specific <span class="keyword">version</span>, where n <span class="keyword">is</span> the controller <span class="built_in">index</span>                       </div><div class="line">Use q <span class="keyword">to</span> <span class="keyword">exit</span> from $ prompt                                                                         </div><div class="line">                                                                                                    </div><div class="line">Controller(s) Found                                                                                 </div><div class="line">HA-<span class="number">0</span> (Bus <span class="number">3</span> DevFn <span class="number">0</span>)                                                                                </div><div class="line">$                                                                                                   </div><div class="line">                                                                                                    </div><div class="line">$cfgforeign clear a0                                                                                </div><div class="line">                                                                                                    </div><div class="line">                                                                                                    </div><div class="line">Foreign configuration <span class="number">0</span> <span class="keyword">is</span> cleared <span class="keyword">on</span> controller <span class="number">0</span>.                                                 </div><div class="line">Foreign configuration <span class="number">1</span> <span class="keyword">is</span> cleared <span class="keyword">on</span> controller <span class="number">0</span>.                                                 </div><div class="line">Exit Code = <span class="number">0</span>x0                                                                                     </div><div class="line">$cfgldadd r1 [<span class="number">252</span>:<span class="number">0</span>,<span class="number">252</span>:<span class="number">1</span>] a0                                                                       </div><div class="line">                                                                                                    </div><div class="line">                                                                                                    </div><div class="line">Adapter <span class="number">0</span>: Created VD <span class="number">0</span>                                                                             </div><div class="line">                                                                                                    </div><div class="line">Adapter <span class="number">0</span>: Configured the Adapter!!                                                                 </div><div class="line">Exit Code = <span class="number">0</span>x0                                                                                     </div><div class="line">$q                                                                                                  </div><div class="line">Press <span class="symbol">&lt;CTL&gt;</span><span class="symbol">&lt;ALT&gt;</span><span class="symbol">&lt;DEL&gt;</span> <span class="keyword">to</span> reboot.</div></pre></td></tr></table></figure>
<p><strong>After Rebooting POST message will show</strong></p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><div class="line"><span class="symbol">LSI</span> MegaRAID SAS-MFI <span class="keyword">BIOS </span>                                                                          </div><div class="line"><span class="symbol">Version</span> <span class="number">5</span>.<span class="number">38</span>.<span class="number">00</span> (<span class="keyword">Build </span>October <span class="number">11</span>, <span class="number">2012</span>)                                                            </div><div class="line"><span class="symbol">Copyright</span>(c) <span class="number">2012</span> LSI Corporation                                                                   </div><div class="line"><span class="symbol">HA</span> -<span class="number">0</span> (<span class="keyword">Bus </span><span class="number">3</span> Dev <span class="number">0</span>) Supermicro <span class="keyword">SMC2208 </span>                                                             </div><div class="line"><span class="symbol">FW</span> package: <span class="number">23</span>.<span class="number">12</span>.<span class="number">0</span>.<span class="number">0011</span>                                                                            </div><div class="line">                                                                                                    </div><div class="line"><span class="keyword">Battery </span>Status: Not present                                                                         </div><div class="line">                                                                                                    </div><div class="line"><span class="symbol">PCI</span> SLOT ID LUN VENDOR    PRODUCT                   <span class="keyword">REVISION </span>      CAPACITY                         </div><div class="line">-------- -- --- ------    -------                   --------       --------                         </div><div class="line"><span class="number">3</span>               LSI       Supermicro <span class="keyword">SMC2208 </span>       <span class="number">3</span>.<span class="number">240</span>.<span class="number">05</span>-<span class="number">2282</span>  <span class="number">1024</span>MB                           </div><div class="line"><span class="number">3</span>        <span class="number">7</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">3</span>        <span class="number">8</span>  <span class="number">0</span>   SEAGATE   ST9146853SS               YS09           <span class="number">140014</span>MB                         </div><div class="line"><span class="number">3</span>           <span class="number">0</span>   LSI       Virtual Drive             RAID1          <span class="number">139236</span>MB                         </div><div class="line"><span class="number">1</span> Virtual Drive(s) found on the host adapter.                                                       </div><div class="line">                                                                                                    </div><div class="line"><span class="number">1</span> Virtual Drive(s) handled <span class="keyword">by </span><span class="keyword">BIOS </span>                                                                 </div><div class="line"><span class="symbol">Press</span> &lt;Ctrl&gt;&lt;H&gt; for WebBIOS or press &lt;Ctrl&gt;&lt;Y&gt; for Preboot CLI</div></pre></td></tr></table></figure>
<h3 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h3><p>错误信息为:<br><code>PXE-E7B: Missing MTFTP server IP address</code>  </p>
<p>Cisco设备是PortFast<br>Huawei设备里是<br>临时关掉生成树<br><code>stp disable</code><br>或者标记为边界端口<br><code>stp edged-port enable</code></p>
<h3 id="other-resources"><a href="#other-resources" class="headerlink" title="other resources"></a>other resources</h3><h4 id="boot-ipxe"><a href="#boot-ipxe" class="headerlink" title="boot.ipxe"></a>boot.ipxe</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">http://10.0.0.9/cgi-bin/pxe.py?mac=<span class="variable">$&#123;netX/mac&#125;</span>&amp;manufacturer=<span class="variable">$&#123;manufacturer&#125;</span>&amp;product=<span class="variable">$&#123;product&#125;</span>&amp;serial=<span class="variable">$&#123;serial&#125;</span>&amp;bserial=<span class="variable">$&#123;smbios/board-serial:string&#125;</span></div></pre></td></tr></table></figure>
<h4 id="WS-Management"><a href="#WS-Management" class="headerlink" title="WS-Management"></a>WS-Management</h4><p><code>wsman identify -h 10.0.0.100 -P 5985 -u ADMIN -p ADMIN</code></p>
<h4 id="flashrom"><a href="#flashrom" class="headerlink" title="flashrom"></a>flashrom</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment"># flashrom-0.9.9 install</span></div><div class="line">yum install -y zlib-devel libpciaccess-devel pciutils-devel libusb1-devel             </div><div class="line">make DESTDIR=/usr install</div></pre></td></tr></table></figure>
<h4 id="Intel-BootUtil"><a href="#Intel-BootUtil" class="headerlink" title="Intel BootUtil"></a>Intel BootUtil</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">yum install -y make gcc perl kernel-devel</div><div class="line">./install </div><div class="line"></div><div class="line">./bootutil64e <span class="_">-e</span></div><div class="line"></div><div class="line">:&lt;&lt;EOF</div><div class="line">Intel(R) Ethernet Flash Firmware Utility</div><div class="line">BootUtil version 1.5.94.2</div><div class="line">Copyright (C) 2003-2015 Intel Corporation</div><div class="line"></div><div class="line">NIC= 1 MACAddress=0CC47AB4C12E</div><div class="line">NIC= 2 MACAddress=0CC47AB4C12F</div><div class="line"></div><div class="line">Port Network Address Location Series  WOL Flash Firmware                Version</div><div class="line">==== =============== ======== ======= === ============================= =======</div><div class="line">  1   0CC47AB4C12E     1:00.0 Gigabit YES FLASH Not Present</div><div class="line">  2   0CC47AB4C12F     1:00.1 Gigabit NO  FLASH Not Present</div><div class="line">EOF</div><div class="line"></div><div class="line">./bootutil64e -nic 1 -saveimage -file 0CC47AB4C12E.rom</div><div class="line"></div><div class="line">./bootutil64e -nic 1 -saveimage -file 80861521.rom</div></pre></td></tr></table></figure>
<h4 id="SerialNumber"><a href="#SerialNumber" class="headerlink" title="SerialNumber"></a>SerialNumber</h4><p><code>dmidecode -s baseboard-serial-number</code> instead of <code>dmidecode -s system-serial-number</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;SuperMicro-Auto-Deploy&quot;&gt;&lt;a href=&quot;#SuperMicro-Auto-Deploy&quot; class=&quot;headerlink&quot; title=&quot;SuperMicro Auto Deploy&quot;&gt;&lt;/a&gt;SuperMicro Auto Depl
    
    </summary>
    
      <category term="Automatic" scheme="http://blog.wuliwala.net/categories/Automatic/"/>
    
    
      <category term="sysops" scheme="http://blog.wuliwala.net/tags/sysops/"/>
    
      <category term="ipmi" scheme="http://blog.wuliwala.net/tags/ipmi/"/>
    
      <category term="pxe" scheme="http://blog.wuliwala.net/tags/pxe/"/>
    
      <category term="dhcp" scheme="http://blog.wuliwala.net/tags/dhcp/"/>
    
  </entry>
  
  <entry>
    <title>can not add lun device in vsphere client</title>
    <link href="http://blog.wuliwala.net/2016/03/29/can_not_add_lun_device_in_vsphere_client/"/>
    <id>http://blog.wuliwala.net/2016/03/29/can_not_add_lun_device_in_vsphere_client/</id>
    <published>2016-03-29T08:42:00.000Z</published>
    <updated>2016-12-08T07:58:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Can-not-add-lun-device-in-vsphere-client"><a href="#Can-not-add-lun-device-in-vsphere-client" class="headerlink" title="Can not add lun device in vsphere client"></a>Can not add lun device in vsphere client</h2><blockquote>
<p>Call “HostStorageSystem.ComputeDiskPartitionInfo” for object “storageSystem” on ESXi “10.19.40.8” failed.</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">~ <span class="comment"># esxcfg-scsidevs -l</span></div><div class="line">naa.600508b1001037383941424344450400</div><div class="line">   Device Type: Direct-Access </div><div class="line">   Size: 69973 MB</div><div class="line">   Display Name: HP Serial Attached SCSI Disk (naa.600508b1001037383941424344450400)</div><div class="line">   Multipath Plugin: NMP</div><div class="line">   Console Device: /vmfs/devices/disks/naa.600508b1001037383941424344450400</div><div class="line">   Devfs Path: /vmfs/devices/disks/naa.600508b1001037383941424344450400</div><div class="line">   Vendor: HP        Model: LOGICAL VOLUME    Revis: 1.62 </div><div class="line">   SCSI Level: 5  Is Pseudo: <span class="literal">false</span> Status: degraded  </div><div class="line">   Is RDM Capable: <span class="literal">true</span>  Is Removable: <span class="literal">false</span> </div><div class="line">   Is Local: <span class="literal">false</span> Is SSD: <span class="literal">false</span> </div><div class="line">   Other Names: </div><div class="line">      vml.0200000000600508b10010373839414243444504004c4f47494341</div><div class="line">   VAAI Status: unknown</div><div class="line">naa.600508b1001037383941424344450700</div><div class="line">   Device Type: Direct-Access </div><div class="line">   Size: 139979 MB</div><div class="line">   Display Name: HP Serial Attached SCSI Disk (naa.600508b1001037383941424344450700)</div><div class="line">   Multipath Plugin: NMP</div><div class="line">   Console Device: /vmfs/devices/disks/naa.600508b1001037383941424344450700</div><div class="line">   Devfs Path: /vmfs/devices/disks/naa.600508b1001037383941424344450700</div><div class="line">   Vendor: HP        Model: LOGICAL VOLUME    Revis: 1.62 </div><div class="line">   SCSI Level: 5  Is Pseudo: <span class="literal">false</span> Status: degraded  </div><div class="line">   Is RDM Capable: <span class="literal">true</span>  Is Removable: <span class="literal">false</span> </div><div class="line">   Is Local: <span class="literal">false</span> Is SSD: <span class="literal">false</span> </div><div class="line">   Other Names: </div><div class="line">      vml.0200010000600508b10010373839414243444507004c4f47494341</div><div class="line">   VAAI Status: unknown</div><div class="line"></div><div class="line"></div><div class="line">~ <span class="comment"># partedUtil getptbl /dev/disks/naa.600508b1001037383941424344450700</span></div><div class="line">msdos</div><div class="line">17844 255 63 286677120</div><div class="line">1 32 286677119 131 0</div><div class="line">~ <span class="comment"># partedUtil get /dev/disks/naa.600508b1001037383941424344450700</span></div><div class="line">17844 255 63 286677120</div><div class="line">1 32 286677119 131 0</div><div class="line"></div><div class="line">~ <span class="comment"># partedUtil delete /dev/disks/naa.600508b1001037383941424344450700 1</span></div><div class="line">~ <span class="comment"># partedUtil getptbl /dev/disks/naa.600508b1001037383941424344450700</span></div><div class="line">msdos</div><div class="line">17844 255 63 286677120</div></pre></td></tr></table></figure>
<p><a href="https://communities.vmware.com/message/2294919#2294919" target="_blank" rel="external">QA id 2294919 in vmware’s community</a><br><a href="http://www.cnblogs.com/kk1230/p/3363737.html" target="_blank" rel="external">post on kk.1230’s blog</a><br><a href="https://communities.vmware.com/thread/458670" target="_blank" rel="external">QA id 458670 in vmware’s community</a>  </p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Can-not-add-lun-device-in-vsphere-client&quot;&gt;&lt;a href=&quot;#Can-not-add-lun-device-in-vsphere-client&quot; class=&quot;headerlink&quot; title=&quot;Can not add 
    
    </summary>
    
    
      <category term="virtualization" scheme="http://blog.wuliwala.net/tags/virtualization/"/>
    
  </entry>
  
  <entry>
    <title>Learning ElasticSearch</title>
    <link href="http://blog.wuliwala.net/2016/03/29/learning-elasticsearch/"/>
    <id>http://blog.wuliwala.net/2016/03/29/learning-elasticsearch/</id>
    <published>2016-03-29T02:42:00.000Z</published>
    <updated>2016-04-01T03:30:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Learning-ElasticSearch"><a href="#Learning-ElasticSearch" class="headerlink" title="Learning ElasticSearch"></a>Learning ElasticSearch</h2><p>最近在学习ElasticSearch，从底层的Lucene开始了解<br>特别推荐这两本书，非常非常感谢社区的贡献，有机会还是支持出版的纸质书籍<br>这篇文章等于是对这两本书阅读后做了摘要，方便零基础的用户快速上手ElasticSearch<br><a href="https://github.com/looly/elasticsearch-definitive-guide-cn" target="_blank" rel="external">Elasticsearch 权威指南（中文版）</a><br><a href="https://www.gitbook.com/book/chenryn/kibana-guide-cn/details" target="_blank" rel="external">ELKstack 中文指南（ElasticSearch章节）</a>  </p>
<h3 id="ES-vs-SQL"><a href="#ES-vs-SQL" class="headerlink" title="ES vs SQL"></a>ES vs SQL</h3><table>
<thead>
<tr>
<th>Relational DB</th>
<th>Elasticsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>Databases</td>
<td>Indices</td>
</tr>
<tr>
<td>Tables</td>
<td>Types</td>
</tr>
<tr>
<td>Rows</td>
<td>Documents</td>
</tr>
<tr>
<td>Columns</td>
<td>Fields</td>
</tr>
</tbody>
</table>
<p>Elasticsearch集群可以包含多个索引(indices)（数据库），每一个索引可以包含多个类型(types)（表），每一个类型包含多个文档(documents)（行），然后每个文档包含多个字段(Fields)（列）。  </p>
<h3 id="“索引”含义的区分"><a href="#“索引”含义的区分" class="headerlink" title="“索引”含义的区分"></a>“索引”含义的区分</h3><p>你可能已经注意到索引(index)这个词在Elasticsearch中有着不同的含义，所以有必要在此做一下区分:  </p>
<ul>
<li>索引（名词） 如上文所述，一个索引(index)就像是传统关系数据库中的数据库，它是相关文档存储的地方，index的复数是indices 或indexes。  </li>
<li>索引（动词） 「索引一个文档」表示把一个文档存储到索引（名词）里，以便它可以被检索或者查询。这很像SQL中的INSERT关键字，差别是，如果文档已经存在，新的文档将覆盖旧的文档。  </li>
<li>倒排索引 传统数据库为特定列增加一个索引，例如B-Tree索引来加速检索。Elasticsearch和Lucene使用一种叫做倒排索引(inverted index)的数据结构来达到相同目的。   </li>
</ul>
<h3 id="Excerise"><a href="#Excerise" class="headerlink" title="Excerise"></a>Excerise</h3><ol>
<li><p>Ping &amp; Server info</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http http://127.0.0.1:9200/</div><div class="line">&#123;</div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "name": "Goliath", </div><div class="line">    "status": 200, </div><div class="line">    "tagline": "You Know, for Search", </div><div class="line">    "version": &#123;</div><div class="line">        "build_hash": "c88f77ffc81301dfa9dfd81ca2232f09588bd512", </div><div class="line">        "build_snapshot": false, </div><div class="line">        "build_timestamp": "2015-02-19T13:05:36Z", </div><div class="line">        "lucene_version": "4.10.3", </div><div class="line">        "number": "1.4.4"</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>All rows</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http 'http://localhost:9200/_count'                   </div><div class="line">&#123;</div><div class="line">    "_shards": &#123;</div><div class="line">        "failed": 0, </div><div class="line">        "successful": 436, </div><div class="line">        "total": 436</div><div class="line">    &#125;, </div><div class="line">    "count": 35672472</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>All indices</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><div class="line">http 'localhost:9200/_cat/indices?v'</div><div class="line">health status index                pri rep docs.count docs.deleted store.size pri.store.size </div><div class="line">yellow open   .kibana               <span class="number"> 1 </span> <span class="number"> 1 </span>       <span class="number"> 10 </span>          <span class="number"> 2 </span>    27.5kb         27.5kb </div><div class="line">yellow open   logstash-2016.01.18   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 289193 </span>          <span class="number"> 0 </span>   170.8mb        170.8mb </div><div class="line">yellow open   logstash-2016.03.22   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 597585 </span>          <span class="number"> 0 </span>   141.1mb        141.1mb </div><div class="line">yellow open   logstash-2016.03.17   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 582696 </span>          <span class="number"> 0 </span>   138.5mb        138.5mb </div><div class="line">yellow open   logstash-2016.02.25   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 304186 </span>          <span class="number"> 0 </span>   103.2mb        103.2mb </div><div class="line">yellow open   logstash-2016.02.24   <span class="number"> 5 </span> <span class="number"> 1 </span>   <span class="number"> 298755 </span>          <span class="number"> 0 </span>   102.5mb        102.5mb</div></pre></td></tr></table></figure>
</li>
<li><p>Cluster health</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http '127.0.0.1:9200/_cluster/health?pretty'</div><div class="line">&#123;</div><div class="line">    "active_primary_shards": 436, </div><div class="line">    "active_shards": 436, </div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "initializing_shards": 0, </div><div class="line">    "number_of_data_nodes": 1, </div><div class="line">    "number_of_nodes": 1, </div><div class="line">    "relocating_shards": 0, </div><div class="line">    "status": "yellow", </div><div class="line">    "timed_out": false, </div><div class="line">    "unassigned_shards": 436</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Nodes list</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><div class="line">http '<span class="number">127.0.0.1</span>:<span class="number">9200</span>/_cat/nodes'</div><div class="line"><span class="number">366d</span>cee<span class="number">51992 172.17</span>.<span class="number">5.127 78 80</span> <span class="number">1</span>.<span class="number">21</span> d * Goliath</div></pre></td></tr></table></figure>
</li>
<li><p>Task list</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><div class="line">http 'http://<span class="number">127.0.0.1:9200</span>/_cluster/pending_tasks'</div><div class="line">&#123;</div><div class="line">    <span class="string">"tasks"</span>: <span class="string">[]</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Node health<br><strong>jvm</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http '127.0.0.1:9200/_nodes/stats/jvm'</div><div class="line">&#123;</div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "nodes": &#123;</div><div class="line">        "vwKzZrSrTDidFr-jtZdRjg": &#123;</div><div class="line">            "host": "366dcee51992", </div><div class="line">            "ip": [</div><div class="line">                "inet[/172.17.5.127:9300]", </div><div class="line">                "NONE"</div><div class="line">            ], </div><div class="line">            "jvm": &#123;</div><div class="line">                "buffer_pools": &#123;</div><div class="line">                    "direct": &#123;</div><div class="line">                        "count": 1610, </div><div class="line">                        "total_capacity_in_bytes": 39064123, </div><div class="line">                        "used_in_bytes": 39064123</div><div class="line">                    &#125;, </div><div class="line">                    "mapped": &#123;</div><div class="line">                        "count": 2656, </div><div class="line">                        "total_capacity_in_bytes": 6260870265, </div><div class="line">                        "used_in_bytes": 6260870265</div><div class="line">                    &#125;</div><div class="line">                &#125;, </div><div class="line">                "gc": &#123;</div><div class="line">                    "collectors": &#123;</div><div class="line">                        "old": &#123;</div><div class="line">                            "collection_count": 20469, </div><div class="line">                            "collection_time_in_millis": 1804674</div><div class="line">                        &#125;, </div><div class="line">                        "young": &#123;</div><div class="line">                            "collection_count": 396171, </div><div class="line">                            "collection_time_in_millis": 4463746</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;, </div><div class="line">                "mem": &#123;</div><div class="line">                    "heap_committed_in_bytes": 1037959168, </div><div class="line">                    "heap_max_in_bytes": 1037959168, </div><div class="line">                    "heap_used_in_bytes": 849427344, </div><div class="line">                    "heap_used_percent": 81, </div><div class="line">                    "non_heap_committed_in_bytes": 85303296, </div><div class="line">                    "non_heap_used_in_bytes": 56807912, </div><div class="line">                    "pools": &#123;</div><div class="line">                        "old": &#123;</div><div class="line">                            "max_in_bytes": 715849728, </div><div class="line">                            "peak_max_in_bytes": 715849728, </div><div class="line">                            "peak_used_in_bytes": 672561680, </div><div class="line">                            "used_in_bytes": 602039528</div><div class="line">                        &#125;, </div><div class="line">                        "survivor": &#123;</div><div class="line">                            "max_in_bytes": 35782656, </div><div class="line">                            "peak_max_in_bytes": 35782656, </div><div class="line">                            "peak_used_in_bytes": 35782656, </div><div class="line">                            "used_in_bytes": 6359176</div><div class="line">                        &#125;, </div><div class="line">                        "young": &#123;</div><div class="line">                            "max_in_bytes": 286326784, </div><div class="line">                            "peak_max_in_bytes": 286326784, </div><div class="line">                            "peak_used_in_bytes": 286326784, </div><div class="line">                            "used_in_bytes": 241028640</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;, </div><div class="line">                "threads": &#123;</div><div class="line">                    "count": 130, </div><div class="line">                    "peak_count": 135</div><div class="line">                &#125;, </div><div class="line">                "timestamp": 1459242935482, </div><div class="line">                "uptime_in_millis": 2528035636</div><div class="line">            &#125;, </div><div class="line">            "name": "Goliath", </div><div class="line">            "timestamp": 1459242935482, </div><div class="line">            "transport_address": "inet[/172.17.5.127:9300]"</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>os</strong></p>
 <figure class="highlight"><table><tr><td class="code"><pre><div class="line">http '127.0.0.1:9200/_nodes/stats/os'</div><div class="line">&#123;</div><div class="line">    "cluster_name": "elasticsearch", </div><div class="line">    "nodes": &#123;</div><div class="line">        "vwKzZrSrTDidFr-jtZdRjg": &#123;</div><div class="line">            "host": "366dcee51992", </div><div class="line">            "ip": [</div><div class="line">                "inet[/172.17.5.127:9300]", </div><div class="line">                "NONE"</div><div class="line">            ], </div><div class="line">            "name": "Goliath", </div><div class="line">            "os": &#123;</div><div class="line">                "cpu": &#123;</div><div class="line">                    "idle": 75, </div><div class="line">                    "stolen": 0, </div><div class="line">                    "sys": 2, </div><div class="line">                    "usage": 17, </div><div class="line">                    "user": 15</div><div class="line">                &#125;, </div><div class="line">                "load_average": [</div><div class="line">                    3.23, </div><div class="line">                    2.33, </div><div class="line">                    2.27</div><div class="line">                ], </div><div class="line">                "mem": &#123;</div><div class="line">                    "actual_free_in_bytes": 5407027200, </div><div class="line">                    "actual_used_in_bytes": 28110413824, </div><div class="line">                    "free_in_bytes": 2586775552, </div><div class="line">                    "free_percent": 16, </div><div class="line">                    "used_in_bytes": 30930665472, </div><div class="line">                    "used_percent": 83</div><div class="line">                &#125;, </div><div class="line">                "swap": &#123;</div><div class="line">                    "free_in_bytes": 7885094912, </div><div class="line">                    "used_in_bytes": 8892116992</div><div class="line">                &#125;, </div><div class="line">                "timestamp": 1459245065474, </div><div class="line">                "uptime_in_millis": 21615006</div><div class="line">            &#125;, </div><div class="line">            "timestamp": 1459245065474, </div><div class="line">            "transport_address": "inet[/172.17.5.127:9300]"</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p>Index info</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">http http://127.0.0.1:9200/logstash-2016.03.29/</div><div class="line">&#123;</div><div class="line">    "logstash-2016.03.29": &#123;</div><div class="line">        "aliases": &#123;&#125;, </div><div class="line">        "mappings": &#123;</div><div class="line">            "_default_": &#123;</div><div class="line">                "_all": &#123;</div><div class="line">                    "enabled": true</div><div class="line">                &#125;, </div><div class="line">                "dynamic_templates": [</div><div class="line">                    &#123;</div><div class="line">                        "string_fields": &#123;</div><div class="line">                            "mapping": &#123;</div><div class="line">                                "fields": &#123;</div><div class="line">                                    "raw": &#123;</div><div class="line">                                        "ignore_above": 256, </div><div class="line">                                        "index": "not_analyzed", </div><div class="line">                                        "type": "string"</div><div class="line">                                    &#125;</div><div class="line">                                &#125;, </div><div class="line">                                "index": "analyzed", </div><div class="line">                                "omit_norms": true, </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;, </div><div class="line">                            "match": "*", </div><div class="line">                            "match_mapping_type": "string"</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                ], </div><div class="line">                "properties": &#123;</div><div class="line">                    "@version": &#123;</div><div class="line">                        "index": "not_analyzed", </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "geoip": &#123;</div><div class="line">                        "dynamic": "true", </div><div class="line">                        "properties": &#123;</div><div class="line">                            "location": &#123;</div><div class="line">                                "type": "geo_point"</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;, </div><div class="line">            "syslog": &#123;</div><div class="line">                "_all": &#123;</div><div class="line">                    "enabled": true</div><div class="line">                &#125;, </div><div class="line">                "dynamic_templates": [</div><div class="line">                    &#123;</div><div class="line">                        "string_fields": &#123;</div><div class="line">                            "mapping": &#123;</div><div class="line">                                "fields": &#123;</div><div class="line">                                    "raw": &#123;</div><div class="line">                                        "ignore_above": 256, </div><div class="line">                                        "index": "not_analyzed", </div><div class="line">                                        "type": "string"</div><div class="line">                                    &#125;</div><div class="line">                                &#125;, </div><div class="line">                                "index": "analyzed", </div><div class="line">                                "omit_norms": true, </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;, </div><div class="line">                            "match": "*", </div><div class="line">                            "match_mapping_type": "string"</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                ], </div><div class="line">                "properties": &#123;</div><div class="line">                    "@timestamp": &#123;</div><div class="line">                        "format": "dateOptionalTime", </div><div class="line">                        "type": "date"</div><div class="line">                    &#125;, </div><div class="line">                    "@version": &#123;</div><div class="line">                        "index": "not_analyzed", </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "brief": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "count": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "geoip": &#123;</div><div class="line">                        "dynamic": "true", </div><div class="line">                        "properties": &#123;</div><div class="line">                            "location": &#123;</div><div class="line">                                "type": "geo_point"</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;, </div><div class="line">                    "host": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "hostname": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "info": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "log_type": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "module": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "msg": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "oid": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "serverity": &#123;</div><div class="line">                        "type": "long"</div><div class="line">                    &#125;, </div><div class="line">                    "severity": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "status": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog5424_pri": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_facility": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_facility_code": &#123;</div><div class="line">                        "type": "long"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_message": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_program": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_severity": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "syslog_severity_code": &#123;</div><div class="line">                        "type": "long"</div><div class="line">                    &#125;, </div><div class="line">                    "tags": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "timestamp": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;, </div><div class="line">                    "type": &#123;</div><div class="line">                        "fields": &#123;</div><div class="line">                            "raw": &#123;</div><div class="line">                                "ignore_above": 256, </div><div class="line">                                "index": "not_analyzed", </div><div class="line">                                "type": "string"</div><div class="line">                            &#125;</div><div class="line">                        &#125;, </div><div class="line">                        "norms": &#123;</div><div class="line">                            "enabled": false</div><div class="line">                        &#125;, </div><div class="line">                        "type": "string"</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;, </div><div class="line">        "settings": &#123;</div><div class="line">            "index": &#123;</div><div class="line">                "creation_date": "1459189864276", </div><div class="line">                "number_of_replicas": "1", </div><div class="line">                "number_of_shards": "5", </div><div class="line">                "refresh_interval": "5s", </div><div class="line">                "uuid": "qUZ_ZY3_RPOdhrdJ5mi32A", </div><div class="line">                "version": &#123;</div><div class="line">                    "created": "1040499"</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;, </div><div class="line">        "warmers": &#123;&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="cat-接口的命令行使用"><a href="#cat-接口的命令行使用" class="headerlink" title="cat 接口的命令行使用"></a>cat 接口的命令行使用</h3><p>之前介绍的各种接口数据，其响应数据都是 JSON 格式，更适用于程序处理。对于我们日常运维，在 Linux 命令行终端环境来说，简单的分行和分列表格才是更方便的样式。为此，Elasticsearch 提供了 cat 接口。</p>
<p>cat 接口可以读取各种监控数据，可用接口列表如下：</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><div class="line">/<span class="variable">_cat</span>/allocation</div><div class="line">/<span class="variable">_cat</span>/shards</div><div class="line">/<span class="variable">_cat</span>/shards/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/master</div><div class="line">/<span class="variable">_cat</span>/nodes</div><div class="line">/<span class="variable">_cat</span>/indices</div><div class="line">/<span class="variable">_cat</span>/indices/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/segments</div><div class="line">/<span class="variable">_cat</span>/segments/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/<span class="built_in">count</span></div><div class="line">/<span class="variable">_cat</span>/<span class="built_in">count</span>/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/recovery</div><div class="line">/<span class="variable">_cat</span>/recovery/&#123;index&#125;</div><div class="line">/<span class="variable">_cat</span>/health</div><div class="line">/<span class="variable">_cat</span>/pending_tasks</div><div class="line">/<span class="variable">_cat</span>/aliases</div><div class="line">/<span class="variable">_cat</span>/aliases/&#123;alias&#125;</div><div class="line">/<span class="variable">_cat</span>/thread_pool</div><div class="line">/<span class="variable">_cat</span>/plugins</div><div class="line">/<span class="variable">_cat</span>/fielddata</div><div class="line">/<span class="variable">_cat</span>/fielddata/&#123;fields&#125;</div></pre></td></tr></table></figure>
<h3 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h3><p>增删改查是数据库的基础操作方法。ES 虽然不是数据库，但是很多场合下，都被人们当做一个文档型 NoSQL 数据库在使用，原因自然是因为在接口和分布式架构层面的相似性。虽然在 ELKstack 场景下，数据的写入和查询，分别由 Logstash 和 Kibana 代劳，作为测试、调研和排错时的基本功，还是需要了解一下 ES 的增删改查用法的。</p>
<h3 id="数据写入"><a href="#数据写入" class="headerlink" title="数据写入"></a>数据写入</h3><p>ES 的一大特点，就是全 RESTful 接口处理 JSON 请求。所以，数据写入非常简单：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST http://127.0.0.1:9200/logstash-2015.06.21/testlog -d '&#123;</div><div class="line">    "date" : "1434966686000",</div><div class="line">    "user" : "chenlin7",</div><div class="line">    "mesg" : "first message into Elasticsearch"</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>命令返回响应结果为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"created"</span>:<span class="literal">true</span>&#125;</div></pre></td></tr></table></figure>
<h3 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h3><p>“可以看到，在数据写入的时候，会返回该数据的 _id。这就是后续用来获取数据的关键：</p>
<p><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK</code><br>命令返回响应结果为：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"found"</span>:<span class="literal">true</span>,<span class="attr">"_source"</span>:&#123;</div><div class="line">    <span class="attr">"date"</span> : <span class="string">"1434966686000"</span>,</div><div class="line">    <span class="attr">"user"</span> : <span class="string">"chenlin7"</span>,</div><div class="line">    <span class="attr">"mesg"</span> : <span class="string">"first message into Elasticsearch"</span></div><div class="line">&#125;&#125;</div></pre></td></tr></table></figure>
<p>这个 _source 里的内容，正是之前写入的数据。</p>
<p>如果觉得这个返回看起来有点太过麻烦，可以使用<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_source</code><br>来指明只获取源数据部分。</p>
<p>更进一步的，如果你只想看数据中的一部分字段内容，可以使用<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK?fields=user,mesg</code><br>来指明获取字段，结果如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_version"</span>:<span class="number">1</span>,<span class="attr">"found"</span>:<span class="literal">true</span>,<span class="attr">"fields"</span>:&#123;<span class="attr">"user"</span>:[<span class="string">"chenlin7"</span>],<span class="attr">"mesg"</span>:[<span class="string">"first message into Elasticsearch"</span>]&#125;&#125;</div></pre></td></tr></table></figure>
<h3 id="数据删除"><a href="#数据删除" class="headerlink" title="数据删除"></a>数据删除</h3><p>要删除数据，修改发送的 HTTP 请求方法为 DELETE 即可：<br><code>curl -XDELETE http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK</code><br>删除不单针对单条数据，还可以删除整个 type，乃至整个索引。甚至可以用通配符。<br><code>curl -XDELETE http://127.0.0.1:9200/logstash-2015.06.0*</code></p>
<h3 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h3><p>已经写过的数据，同样还是可以修改的。有两种办法，一种是全量提交，即指明 _id 再发送一次写入请求。</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK -d '&#123;</div><div class="line">    "date" : "1434966686000",</div><div class="line">    "user" : "chenlin7",</div><div class="line">    "mesg" " "first message into Elasticsearch but version 2"</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>另一种是局部更新，使用 /_update 接口：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_update' -d '&#123;</div><div class="line">    "doc" : &#123;</div><div class="line">        "user" : "someone"</div><div class="line">    &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.21/testlog/AU4ew3h2nBE6n0qcyVJK/_update' -d '&#123;</div><div class="line">    "script" : "ctx._source.user = \"someone\""</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<h3 id="搜索请求"><a href="#搜索请求" class="headerlink" title="搜索请求"></a>搜索请求</h3><p>上节介绍的，都是针对单条数据的操作。在 ES 环境中，更多的是搜索和聚合请求。在之前章节中，我们也介绍过数据获取和数据搜索的一点区别：==刚写入的数据，可以通过 translog 立刻获取；但是却要等到 refresh 成为一个 segment 后，才能被搜索到。==本节就介绍一下 ES 的搜索语法。</p>
<h3 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h3><p>ES 对搜索请求，有简易语法和完整语法两种方式。简易语法作为以后在 Kibana 上最常用的方式，一定是需要学会的。而在命令行里，我们可以通过最简单的方式来做到。还是上节输入的数据：<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/_search?q=first</code><br>可以看到返回结果：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;<span class="attr">"took"</span>:<span class="number">240</span>,<span class="attr">"timed_out"</span>:<span class="literal">false</span>,<span class="attr">"_shards"</span>:&#123;<span class="attr">"total"</span>:<span class="number">27</span>,<span class="attr">"successful"</span>:<span class="number">27</span>,<span class="attr">"failed"</span>:<span class="number">0</span>&#125;,<span class="attr">"hits"</span>:&#123;<span class="attr">"total"</span>:<span class="number">1</span>,<span class="attr">"max_score"</span>:<span class="number">0.11506981</span>,<span class="attr">"hits"</span>:[&#123;<span class="attr">"_index"</span>:<span class="string">"logstash-2015.06.21"</span>,<span class="attr">"_type"</span>:<span class="string">"testlog"</span>,<span class="attr">"_id"</span>:<span class="string">"AU4ew3h2nBE6n0qcyVJK"</span>,<span class="attr">"_score"</span>:<span class="number">0.11506981</span>,<span class="attr">"_source"</span>:&#123;</div><div class="line">    <span class="attr">"date"</span> : <span class="string">"1434966686000"</span>,</div><div class="line">    <span class="attr">"user"</span> : <span class="string">"chenlin7"</span>,</div><div class="line">    <span class="attr">"mesg"</span> : <span class="string">"first message into Elasticsearch"</span></div><div class="line">&#125;&#125;]&#125;&#125;</div></pre></td></tr></table></figure>
<p>还可以用下面语句搜索，结果是一样的。<br><code>curl -XGET http://127.0.0.1:9200/logstash-2015.06.21/testlog/_search?q=user:&quot;chenlin7</code></p>
<p>Excerpt From: 饶琛琳. “ELKstack 中文指南.” iBooks. </p>
<h3 id="querystring-语法"><a href="#querystring-语法" class="headerlink" title="querystring 语法"></a>querystring 语法</h3><p><code>curl -XGET http://127.0.0.1:9200/logstash-2016.03.29/_search?q=first</code></p>
<p>上例中，<code>?q=</code>后面写的，就是 querystring 语法。鉴于这部分内容会在 Kibana 上经常使用，这里详细解析一下语法：  </p>
<ul>
<li><strong>全文检索</strong>：直接写搜索的单词，如上例中的 <code>first</code>；</li>
<li><strong>单字段的全文检索</strong>：在搜索单词之前加上字段名和冒号，比如如果知道单词 first 肯定出现在 mesg 字段，可以写作 <code>mesg:first</code>；</li>
<li><strong>单字段的精确检索</strong>：在搜索单词前后加双引号，比如 <code>user:&quot;chenlin7&quot;</code>；<br>多个检索条件的组合：可以使用 NOT, AND 和 OR 来组合检索，注意必须是大写。比如 <code>user:(&quot;chenlin7&quot; OR &quot;chenlin&quot;) AND NOT mesg:first</code>；</li>
<li><strong>字段是否存在</strong>：<code>_exists_:user</code> 表示要求 user 字段存在，<code>_missing_:user</code> 表示要求 user 字段不存在；</li>
<li><strong>通配符</strong>：用 ? 表示单字母，<em> 表示任意个字母。比如 `fir?t mess</em>`；</li>
<li><strong>正则</strong>：需要比通配符更复杂一点的表达式，可以使用正则。比如 <code>mesg:/mes{2}ages?/</code>。注意 ES 中正则性能很差，而且支持的功能也不是特别强大，尽量不要使用。ES 支持的正则语法见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="external">query-dsl-regexp-query.html</a></li>
<li><strong>近似搜索</strong>：用 ~ 表示搜索单词可能有一两个字母写的不对，请 ES 按照相似度返回结果。比如 <code>frist~</code>；</li>
<li><strong>范围搜索</strong>：对数值和时间，ES 都可以使用范围搜索，比如：<code>rtt:&gt;300</code>，<code>date:[&quot;now-6h&quot; TO &quot;now&quot;}</code> 等。其中，<code>[]</code> 表示端点数值包含在范围内，<code>{}</code> 表示端点数值不包含在范围内；</li>
</ul>
<h3 id="完整语法"><a href="#完整语法" class="headerlink" title="完整语法"></a>完整语法</h3><p>ES 支持各种类型的检索请求，除了可以用 querystring 语法表达的以外，还有很多其他类型，具体列表和示例可参见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-queries.html" target="_blank" rel="external">query-dsl-regexp-query.html</a>。</p>
<p>作为最简单和常用的示例，这里展示一下 term query 的写法，相当于 querystring 语法中的 <code>user:&quot;chenlin7&quot;</code>：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">curl -XGET http://127.0.0.1:9200/_search -d '</div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "term": &#123;</div><div class="line">      "user": "chenlin7" </div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<h3 id="聚合请求"><a href="#聚合请求" class="headerlink" title="聚合请求"></a>聚合请求</h3><p>在检索范围确定之后，ES 还支持对结果集做聚合查询，返回更直接的聚合统计结果。在 ES 1.0 版本之前，这个接口叫 Facet，1.0 版本之后，这个接口改为 Aggregation。</p>
<p>Kibana 分别在 v3 中使用 Facet，v4 中使用 Aggregation。不过总的来说，Aggregation 是 Facet 接口的强化升级版本，我们直接了解 Aggregation 即可。本书后续章节也会介绍如何在 Kibana 的 v3 版本中使用 aggregation 接口做二次开发。</p>
<p>Aggregation 分为 bucket 和 metric 两种，分别用作词元划分和数值计算。而其中的 bucket aggregation，还支持在自身结果集的基础上，叠加新的 aggregation。这就是 aggregation 比 facet 最领先的地方。比如实现一个时序百分比统计，在 facet 接口就无法直接完成，而在 aggregation 接口就很简单了：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line"># curl -XPOST 'http://127.0.0.1:9200/logstash-2015.06.22/_search?size=0&amp;pretty' -d'&#123;</div><div class="line">    "aggs" : &#123;</div><div class="line">        "percentile_over_time" : &#123;</div><div class="line">            "date_histogram" : &#123;</div><div class="line">                "field"    : "@timestamp",</div><div class="line">                "interval" : "1h"</div><div class="line">            &#125;,</div><div class="line">            "aggs" : &#123;</div><div class="line">                "percentile_one_time" : &#123;</div><div class="line">                    "percentiles" : &#123;</div><div class="line">                        "field" : "requesttime"</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure>
<p>得到结果如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"took"</span> : <span class="number">151595</span>,</div><div class="line">  <span class="attr">"timed_out"</span> : <span class="literal">false</span>,</div><div class="line">  <span class="attr">"_shards"</span> : &#123;</div><div class="line">    <span class="attr">"total"</span> : <span class="number">81</span>,</div><div class="line">    <span class="attr">"successful"</span> : <span class="number">81</span>,</div><div class="line">    <span class="attr">"failed"</span> : <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"hits"</span> : &#123;</div><div class="line">    <span class="attr">"total"</span> : <span class="number">3307142043</span>,</div><div class="line">    <span class="attr">"max_score"</span> : <span class="number">1.0</span>,</div><div class="line">    <span class="attr">"hits"</span> : [ ]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"aggregations"</span> : &#123;</div><div class="line">    <span class="attr">"percentile_over_time"</span> : &#123;</div><div class="line">      <span class="attr">"buckets"</span> : [ &#123;</div><div class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"22/Jun/2015:22:00:00 +0000"</span>,</div><div class="line">        <span class="attr">"key"</span> : <span class="number">1435010400000</span>,</div><div class="line">        <span class="attr">"doc_count"</span> : <span class="number">459273981</span>,</div><div class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</div><div class="line">          <span class="attr">"values"</span> : &#123;</div><div class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</div><div class="line">            <span class="attr">"5.0"</span> : <span class="number">0.006</span>,</div><div class="line">            <span class="attr">"25.0"</span> : <span class="number">0.023</span>,</div><div class="line">            <span class="attr">"50.0"</span> : <span class="number">0.035</span>,</div><div class="line">            <span class="attr">"75.0"</span> : <span class="number">0.08774675719725569</span>,</div><div class="line">            <span class="attr">"95.0"</span> : <span class="number">0.25732934416125663</span>,</div><div class="line">            <span class="attr">"99.0"</span> : <span class="number">0.7508899754871812</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"23/Jun/2015:00:00:00 +0000"</span>,</div><div class="line">        <span class="attr">"key"</span> : <span class="number">1435017600000</span>,</div><div class="line">        <span class="attr">"doc_count"</span> : <span class="number">768620219</span>,</div><div class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</div><div class="line">          <span class="attr">"values"</span> : &#123;</div><div class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</div><div class="line">            <span class="attr">"5.0"</span> : <span class="number">0.007000000000000001</span>,</div><div class="line">            <span class="attr">"25.0"</span> : <span class="number">0.025</span>,</div><div class="line">            <span class="attr">"50.0"</span> : <span class="number">0.03987809503972864</span>,</div><div class="line">            <span class="attr">"75.0"</span> : <span class="number">0.10297843567746187</span>,</div><div class="line">            <span class="attr">"95.0"</span> : <span class="number">0.30047269327062875</span>,</div><div class="line">            <span class="attr">"99.0"</span> : <span class="number">1.015495933753329</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="attr">"key_as_string"</span> : <span class="string">"23/Jun/2015:02:00:00 +0000"</span>,</div><div class="line">        <span class="attr">"key"</span> : <span class="number">1435024800000</span>,</div><div class="line">        <span class="attr">"doc_count"</span> : <span class="number">849467060</span>,</div><div class="line">        <span class="attr">"percentile_one_time"</span> : &#123;</div><div class="line">          <span class="attr">"values"</span> : &#123;</div><div class="line">            <span class="attr">"1.0"</span> : <span class="number">0.004</span>,</div><div class="line">            <span class="attr">"5.0"</span> : <span class="number">0.008</span>,</div><div class="line">            <span class="attr">"25.0"</span> : <span class="number">0.027000000000000003</span>,</div><div class="line">            <span class="attr">"50.0"</span> : <span class="number">0.0439999899006102</span>,</div><div class="line">            <span class="attr">"75.0"</span> : <span class="number">0.1160416197625958</span>,</div><div class="line">            <span class="attr">"95.0"</span> : <span class="number">0.3383140614483838</span>,</div><div class="line">            <span class="attr">"99.0"</span> : <span class="number">1.0275839684542212</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125; ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ES 目前能支持的聚合请求列表，参见：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_blank" rel="external">search-aggregations.html</a></p>
<h3 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h3><p>对不了解 JVM 的 GC 的读者，这里先介绍一下 GC(垃圾收集)以及 GC 对 Elasticsearch 的影响。</p>
<p>Java is a garbage-collected language, which means that the programmer does not manually manage memory allocation and deallocation. The programmer simply writes code, and the Java Virtual Machine (JVM) manages the process of allocating memory as needed, and then later cleaning up that memory when no longer needed. Java 是一个自动垃圾收集的编程语言，启动 JVM 虚拟机的时候，会分配到固定大小的内存块，这个块叫做 heap(堆)。JVM 会把 heap 分成两个组：</p>
<ul>
<li>Young 新实例化的对象所分配的空间。这个空间一般来说只有 100MB 到 500MB 大小。Young 空间又分为两个 survivor(幸存)空间。当 Young 空间满，就会发生一次 young gc，还存活的对象，就被移入幸存空间里，已失效的对象则被移除。</li>
<li>Old 老对象存储的空间。这些对象应该是长期存活而且在较长一段时间内不会变化的内容。“这个空间会大很多，在 ES 来说，一节点上可能就有 30GB 内存是这个空间。前面提到的 young gc 中，如果某个对象连续多次幸存下来，就会被移进 Old 空间内。而等到 Old 空间满，就会发生一次 old gc，把失效对象移除。<br>听起来很美好的样子，但是这些都是有代价的！在 GC 发生的时候，JVM 需要暂停程序运行，以便自己追踪对象图收集全部失效对象。在这期间，其他一切都不会继续运行。请求没有响应，ping 没有应答，分片不会分配……</li>
</ul>
<p>当然，young gc 一般来说执行极快，没太大影响。但是 old 空间那么大，稍慢一点的 gc 就意味着程序几秒乃至十几秒的不可用，这太危险了。</p>
<p>JVM 本身对 gc 算法一直在努力优化，Elasticsearch 也尽量复用内部对象，复用网络缓冲，然后还提供像 Doc Values 这样的特性。但不管怎么说，gc 性能总是我们需要密切关注的数据，因为它是集群稳定性最大的影响因子。</p>
<p>如果你的 ES 集群监控里发现经常有很耗时的 GC，说明集群负载很重，内存不足。严重情况下，这些 GC 导致节点无法正确响应集群之间的 ping ，可能就直接从集群里退出了。然后数据分片也随之在集群中重新迁移，引发更大的网络和磁盘 IO，正常的写入和搜索也会受到影响。</p>
<h3 id="查询慢"><a href="#查询慢" class="headerlink" title="查询慢"></a>查询慢</h3><p>更常见的可能，是集群存储长期数据导致索引映射数据确实大到了 master 节点内存不足以快速处理的地步。</p>
<p>这时候，根据实际情况，可以有以下几种选择：</p>
<p>索引就是特别多：给 master 加内存。<br>索引里字段太多：改用 nested object 方式节省字段数量。<br>索引多到内存就是不够了：把一部分数据拆出来另一个集群。</p>
<h3 id="Web-Console"><a href="#Web-Console" class="headerlink" title="Web Console"></a>Web Console</h3><p><a href="https://github.com/lmenezes/elasticsearch-kopf" target="_blank" rel="external">elasticsearch-kopf</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Learning-ElasticSearch&quot;&gt;&lt;a href=&quot;#Learning-ElasticSearch&quot; class=&quot;headerlink&quot; title=&quot;Learning ElasticSearch&quot;&gt;&lt;/a&gt;Learning ElasticSear
    
    </summary>
    
      <category term="search" scheme="http://blog.wuliwala.net/categories/search/"/>
    
    
      <category term="elk" scheme="http://blog.wuliwala.net/tags/elk/"/>
    
      <category term="dev" scheme="http://blog.wuliwala.net/tags/dev/"/>
    
      <category term="nosql" scheme="http://blog.wuliwala.net/tags/nosql/"/>
    
      <category term="search" scheme="http://blog.wuliwala.net/tags/search/"/>
    
  </entry>
  
  <entry>
    <title>segmentfault「我是工具控」分享</title>
    <link href="http://blog.wuliwala.net/2016/03/19/segmentfault-tools-sharing/"/>
    <id>http://blog.wuliwala.net/2016/03/19/segmentfault-tools-sharing/</id>
    <published>2016-03-19T09:42:00.000Z</published>
    <updated>2016-05-01T14:29:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="segmentfault-我是工具控-分享"><a href="#segmentfault-我是工具控-分享" class="headerlink" title="segmentfault[我是工具控]分享"></a>segmentfault[我是工具控]分享</h2><p> <strong>运维团队中的开发，4年运维工作经验，去年转开发。主要开发语言python，偶尔写shell、javascript.</strong></p>
<p>我的工具箱可能跟别人不太一样<br>大家装机必备的就不提了<br><a href="http://blog.wuliwala.net">我的博客</a> 欢迎交流</p>
<h3 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h3><ul>
<li><strong>ag</strong> 搜索代码炒鸡快！</li>
<li><strong>httpie</strong> 人类用的http测试工具</li>
<li><strong>jq</strong> 格式化json用的，跟<code>python -m json.tool</code>相比，是彩色的</li>
<li><strong>cowsay</strong> <strong>lolcat</strong> 好玩的，不解释</li>
</ul>
<h3 id="生活-效率"><a href="#生活-效率" class="headerlink" title="生活/效率"></a>生活/效率</h3><ul>
<li><strong>Keynote</strong> 特别喜欢苹果的这款产品，简洁易用，码农也能做出很好的幻灯片。曾用它做演讲稿，从产品、前端那里赢得几次分享、项目评比冠军。</li>
<li><strong>MacDown</strong> 以前用Mou，后来发现MacDown，代码着色要比Mou好很多，配合<strong>Hexo</strong>，也能用来写博客。</li>
<li><strong>eWallet</strong> 管理密码的，从windows就开始用，Mac平台也有。</li>
<li><strong>MindNode</strong> 看图，不解释<img src="/images/2016/03/19/mindnode.png" alt="mindnode"></li>
</ul>
<h3 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h3><ul>
<li><strong>MacVim</strong>今年开始学习，平时一般用它，写写shell脚本、python小程序；</li>
<li><strong>Atom</strong>项目用它，写前端不要太爽。</li>
<li><em><strong>TextMate</strong></em> 刚从windows换到Mac的时候非常怀念极轻量的<strong>Editplus</strong>，用了一阵，也还不错，今年主要学习vim，所以不用了。</li>
<li>我不用 <strong>oh~my~zsh</strong> 我用<strong>bash-it</strong> ，因为做了4年运维，对bash较熟，用过oh~my~zsh，感觉各种行为好怪异，简直无法愉快玩耍。<br>自己改的bash主题<img src="/images/2016/03/19/bash-it.png" alt="bash-it"></li>
</ul>
<p>有同学想要这个主题的话，可以访问<a href="https://github.com/arkii/gadgets/tree/master/Terminal" target="_blank" rel="external">我的github</a>。  </p>
<p>vim 插件，一天可是说不完的。。。</p>
<figure class="highlight sml"><table><tr><td class="code"><pre><div class="line"><span class="type">Plugin</span> <span class="symbol">'VundleVim</span>/<span class="type">Vundle</span>.vim'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'Valloric</span>/<span class="type">YouCompleteMe'</span></div><div class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/nerdtree'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/nerdcommenter'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'scrooloose</span>/syntastic'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-airline/vim-airline'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-airline/vim-airline-themes'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'vim</span>-scripts/indentpython.vim'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'nvie</span>/vim-flake8'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'Xuyuanp</span>/nerdtree-git-plugin'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'xolox</span>/vim-misc'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'xolox</span>/vim-session'</div><div class="line"><span class="type">Plugin</span> <span class="symbol">'Chiel92</span>/vim-autoformat'</div></pre></td></tr></table></figure>
<p>Atom插件</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><div class="line">atom-beautify</div><div class="line">atom-<span class="keyword">sync</span></div><div class="line">color-picker</div><div class="line"><span class="keyword">file</span>-icons</div><div class="line">git-control</div><div class="line">git-status</div><div class="line">linter</div><div class="line">linter-jshint</div><div class="line">linter-pep8</div><div class="line">linter-<span class="keyword">python</span>-pep8</div><div class="line">minimap</div><div class="line"><span class="keyword">python</span>-tools</div><div class="line">tree-<span class="keyword">view</span>-git-status</div><div class="line"><span class="keyword">vim</span>-<span class="keyword">mode</span></div></pre></td></tr></table></figure>
<h3 id="工位无码图"><a href="#工位无码图" class="headerlink" title="工位无码图"></a>工位无码图</h3><p><img src="/images/2016/03/19/seat.jpeg" alt="工位无码图"></p>
<blockquote>
<p>本文参与了 SegmentFault<a href="https://segmentfault.com/a/1190000004537274" target="_blank" rel="external">「我是工具控」</a>分享，如果你也手持利器，那就一起来分享吧。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;segmentfault-我是工具控-分享&quot;&gt;&lt;a href=&quot;#segmentfault-我是工具控-分享&quot; class=&quot;headerlink&quot; title=&quot;segmentfault[我是工具控]分享&quot;&gt;&lt;/a&gt;segmentfault[我是工具控]分享&lt;/
    
    </summary>
    
    
      <category term="dev" scheme="http://blog.wuliwala.net/tags/dev/"/>
    
      <category term="tools" scheme="http://blog.wuliwala.net/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>Migration From Subversion(svn) to Git</title>
    <link href="http://blog.wuliwala.net/2016/03/14/migrate-to-git-from-svn/"/>
    <id>http://blog.wuliwala.net/2016/03/14/migrate-to-git-from-svn/</id>
    <published>2016-03-14T11:01:00.000Z</published>
    <updated>2016-03-14T11:13:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="migration-from-subversion-svn-to-git"><a href="#migration-from-subversion-svn-to-git" class="headerlink" title="migration from subversion(svn) to git"></a>migration from subversion(svn) to git</h2><p>git officiall documents<br><a href="https://git-scm.com/docs/git-svn" target="_blank" rel="external">https://git-scm.com/docs/git-svn</a><br><a href="https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git" target="_blank" rel="external">https://git-scm.com/book/en/v2/Git-and-Other-Systems-Migrating-to-Git</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E4%B8%8E%E5%85%B6%E4%BB%96%E7%B3%BB%E7%BB%9F-%E4%BD%9C%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84-Git" target="_blank" rel="external">https://git-scm.com/book/zh/v2/Git-与其他系统-作为客户端的-Git</a>  </p>
<p>install the latest git  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">yum -y install subversion subversion-perl perl-TermReadKey curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc xmlto docbook2x docbook2X</div><div class="line"></div><div class="line">wget https://www.kernel.org/pub/software/scm/git/git-2.7.3.tar.gz</div><div class="line">tar xvf git-2.7.3.tar.gz </div><div class="line"><span class="built_in">cd</span> git-2.7.3</div><div class="line">make configure</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/git2.7.3</div><div class="line">make -j8 all doc info</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/git2.7.3/bin/git /usr/bin/</div><div class="line"></div><div class="line">vim ~/.subversion/servers</div><div class="line"><span class="comment"># let store-passwords = yes</span></div><div class="line"></div><div class="line">git svn <span class="built_in">clone</span> --username dev https://svn.yourdomain.com/yourrepo</div><div class="line"></div><div class="line"><span class="built_in">cd</span> yourrepo</div><div class="line"></div><div class="line"><span class="comment"># 首次 first time</span></div><div class="line">git branch <span class="_">-a</span> </div><div class="line">git show-ref</div><div class="line"><span class="comment"># push to gitlab server</span></div><div class="line">git remote add origin ssh://git@gitlab.yourdomain.com/svn/yourrepo.git</div><div class="line">git push -u origin master</div><div class="line"></div><div class="line"><span class="comment"># 更新 update</span></div><div class="line">git svn fetch &amp;&amp; git svn rebase</div><div class="line">git push</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;migration-from-subversion-svn-to-git&quot;&gt;&lt;a href=&quot;#migration-from-subversion-svn-to-git&quot; class=&quot;headerlink&quot; title=&quot;migration from subve
    
    </summary>
    
    
      <category term="dev" scheme="http://blog.wuliwala.net/tags/dev/"/>
    
      <category term="git" scheme="http://blog.wuliwala.net/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Searchcode Server Community Deploy</title>
    <link href="http://blog.wuliwala.net/2016/03/08/searchcode-server-community-deploy/"/>
    <id>http://blog.wuliwala.net/2016/03/08/searchcode-server-community-deploy/</id>
    <published>2016-03-08T07:01:00.000Z</published>
    <updated>2016-04-13T08:49:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Searchcode-Server-Community-Deploy"><a href="#Searchcode-Server-Community-Deploy" class="headerlink" title="Searchcode Server Community Deploy"></a>Searchcode Server Community Deploy</h1><h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p><a href="https://searchcode.com" target="_blank" rel="external">https://searchcode.com</a></p>
<h2 id="query-syntax"><a href="#query-syntax" class="headerlink" title="query syntax"></a>query syntax</h2><p><a href="https://searchcode.com/#jumbo-examples" target="_blank" rel="external">https://searchcode.com/#jumbo-examples</a></p>
<h2 id="requirement"><a href="#requirement" class="headerlink" title="requirement"></a>requirement</h2><ul>
<li>Linux (in this example, I’m using CentOS6)  </li>
<li>JRE 8u65 <a href="http://www.oracle.com/technetwork/java/javase/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/archive-139210.html</a>  </li>
<li>searchcode-server-community 1.0.0 <a href="https://searchcode.com/static/searchcode-server-community.tar.gz" target="_blank" rel="external">https://searchcode.com/static/searchcode-server-community.tar.gz</a>  </li>
</ul>
<h2 id="installation"><a href="#installation" class="headerlink" title="installation"></a>installation</h2><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment"># download jre package from java archive website</span></div><div class="line">rpm -ivh jre-8u65-linux-x64.rpm</div><div class="line">wget https://searchcode.com/static/searchcode-server-community.tar.gz</div><div class="line">tar xf searchcode-server-community.tar.gz</div><div class="line">searchcode-server-community/release</div><div class="line">java -jar searchcode-1.0.0.jar</div></pre></td></tr></table></figure>
<p><strong>visit <a href="http://yourserverip:8080/" target="_blank" rel="external">http://yourserverip:8080/</a></strong>  </p>
<h2 id="use-my-docker-image"><a href="#use-my-docker-image" class="headerlink" title="use my docker image"></a>use my docker image</h2><h3 id="fresh-image-auto-build-and-keep-fresh-depend-on-author’s-api"><a href="#fresh-image-auto-build-and-keep-fresh-depend-on-author’s-api" class="headerlink" title="fresh image auto-build and keep fresh, depend on author’s api"></a>fresh image auto-build and keep fresh, depend on author’s api</h3><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">docker run -p 8080:8080 <span class="_">-d</span> docker.io/arkii/searchcode-server-community</div></pre></td></tr></table></figure>
<p>run image directly  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">docker run -p 8080:8080 <span class="_">-d</span> docker.io/arkii/searchcode-server</div></pre></td></tr></table></figure>
<p>or run image with docker-compose<br>docker-compose.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><div class="line"><span class="attr">searchcode:</span></div><div class="line"><span class="attr">  image:</span> arkii/searchcode-server</div><div class="line"><span class="attr">  volumes:</span></div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/index:/srv/index</div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/repo:/srv/repo</div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.properties:/srv/searchcode.properties</div><div class="line"><span class="bullet">    -</span> /db/searchcode/git/searchcode.sqlite:/srv/searchcode.sqlite</div><div class="line"><span class="attr">  ports:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">"8080:8080/tcp"</span></div></pre></td></tr></table></figure>
<p><strong>visit <a href="http://yourdockerserverip:8080/" target="_blank" rel="external">http://yourdockerserverip:8080/</a></strong>  </p>
<p>To administer your searchcode server instance you need to click on the Admin link in the top right.<br>Enter the default password <strong>Adm1n234</strong></p>
<h2 id="Dockerfiles"><a href="#Dockerfiles" class="headerlink" title="Dockerfiles"></a>Dockerfiles</h2><p><strong>build JRE 8u65 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><div class="line"><span class="keyword">FROM</span>        centos:<span class="number">6</span></div><div class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</div><div class="line"><span class="keyword">COPY</span><span class="bash">        ./jre-8u65-linux-x64.rpm /tmp/jre-8u65-linux-x64.rpm</span></div><div class="line"><span class="keyword">RUN</span><span class="bash">         rpm -ivh /tmp/jre-8u65-linux-x64.rpm &amp;&amp; rm <span class="_">-f</span> /tmp/jre-8u65-linux-x64.rpm</span></div></pre></td></tr></table></figure>
<p><strong>build Searchcode Server Community 1.0.0 image</strong></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><div class="line"><span class="keyword">FROM</span>        arkii/centos6-jre-<span class="number">8</span>u65</div><div class="line"><span class="keyword">MAINTAINER</span>  Arkii sqy6@<span class="number">163</span>.com</div><div class="line"><span class="keyword">COPY</span><span class="bash">        ./searchcode-server-community/release /srv</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash">     /srv</span></div><div class="line"><span class="keyword">CMD</span><span class="bash">         /usr/bin/java -jar searchcode-1.0.0.jar</span></div><div class="line"><span class="keyword">EXPOSE</span>      <span class="number">8080</span>/tcp</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Searchcode-Server-Community-Deploy&quot;&gt;&lt;a href=&quot;#Searchcode-Server-Community-Deploy&quot; class=&quot;headerlink&quot; title=&quot;Searchcode Server Commun
    
    </summary>
    
      <category term="productivity" scheme="http://blog.wuliwala.net/categories/productivity/"/>
    
    
      <category term="dev" scheme="http://blog.wuliwala.net/tags/dev/"/>
    
      <category term="devops" scheme="http://blog.wuliwala.net/tags/devops/"/>
    
  </entry>
  
  <entry>
    <title>Wall-E web deployment</title>
    <link href="http://blog.wuliwala.net/2016/03/01/wall-e-web-deployment/"/>
    <id>http://blog.wuliwala.net/2016/03/01/wall-e-web-deployment/</id>
    <published>2016-03-01T06:20:00.000Z</published>
    <updated>2016-03-08T09:07:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Wall-E-web-deployment"><a href="#Wall-E-web-deployment" class="headerlink" title="Wall-E web deployment"></a>Wall-E web deployment</h1><p>项目地址<br><a href="http://walle-web.io/" target="_blank" rel="external">http://walle-web.io/</a>  </p>
<p>安装文档<br><a href="http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html" target="_blank" rel="external">http://doc.huamanshu.com/%E7%93%A6%E5%8A%9B/2.%E5%AE%89%E8%A3%85/%E5%AE%89%E8%A3%85.html</a>  </p>
<p>问题FAQ<br><a href="https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md" target="_blank" rel="external">https://github.com/meolu/walle-web/blob/master/docs%2Ffaq.md</a>  </p>
<p><a href="https://github.com/meolu/walle-web/archive/master.zip" target="_blank" rel="external">https://github.com/meolu/walle-web/archive/master.zip</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">rpm -Uvh http://mirror.webtatic.com/yum/el6/latest.rpm</div><div class="line">yum install -y php56w.x86_64 php56w-cli.x86_64 php56w-common.x86_64 php56w-gd.x86_64 php56w-ldap.x86_64 php56w-mbstring.x86_64 php56w-mcrypt.x86_64 php56w-mysql.x86_64 php56w-pdo.x86_64 php56w-xml.x86_64</div><div class="line">wget https://getcomposer.org/installer &amp;&amp; php installer &amp;&amp; mv composer.phar /usr/<span class="built_in">local</span>/bin/composer</div><div class="line"></div><div class="line">wget https://github.com/meolu/walle-web/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line"></div><div class="line"><span class="built_in">cd</span> walle-web-master</div><div class="line">composer install</div><div class="line"><span class="comment">#composer install --aprefer-dist --no-dev --optimize-autoloader -vvvv</span></div><div class="line"></div><div class="line">vi config/local.php</div><div class="line"></div><div class="line">./yii walle/setup</div><div class="line"></div><div class="line"><span class="built_in">cd</span> vendor</div><div class="line">ln <span class="_">-s</span> bower-asset/ bower</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'&lt;VirtualHost *:80&gt;</span></div><div class="line">ServerName walle.xxx.com</div><div class="line">DocumentRoot /var/www/html/web</div><div class="line">    &lt;Directory "/var/www/html/web"&gt;</div><div class="line">      Options  FollowSymLinks</div><div class="line">        AllowOverride ALL</div><div class="line">        Order allow,deny</div><div class="line">        Allow from all</div><div class="line">    &lt;/Directory&gt;</div><div class="line">&lt;/VirtualHost&gt;' &gt; /etc/httpd/conf.d/walle.conf</div></pre></td></tr></table></figure>
<p>default account<br>admin:admin</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Wall-E-web-deployment&quot;&gt;&lt;a href=&quot;#Wall-E-web-deployment&quot; class=&quot;headerlink&quot; title=&quot;Wall-E web deployment&quot;&gt;&lt;/a&gt;Wall-E web deployment&lt;/
    
    </summary>
    
      <category term="productivity" scheme="http://blog.wuliwala.net/categories/productivity/"/>
    
    
      <category term="dev" scheme="http://blog.wuliwala.net/tags/dev/"/>
    
      <category term="devops" scheme="http://blog.wuliwala.net/tags/devops/"/>
    
  </entry>
  
  <entry>
    <title>ionic hybrid app development</title>
    <link href="http://blog.wuliwala.net/2016/02/15/ionic-web-app-dev/"/>
    <id>http://blog.wuliwala.net/2016/02/15/ionic-web-app-dev/</id>
    <published>2016-02-15T02:42:00.000Z</published>
    <updated>2016-03-23T06:55:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ionic-hybrid-app-development"><a href="#ionic-hybrid-app-development" class="headerlink" title="ionic hybrid app development"></a>ionic hybrid app development</h1><h2 id="Video-Show"><a href="#Video-Show" class="headerlink" title="Video Show"></a>Video Show</h2><p><a href="/images/2016/02/15/ionic-dev-icinga-zol-480p.mp4">video show</a>  </p>
<h2 id="Frontend"><a href="#Frontend" class="headerlink" title="Frontend"></a>Frontend</h2><h3 id="ionic"><a href="#ionic" class="headerlink" title="ionic"></a>ionic</h3><p><a href="http://ionicframework.com/getting-started/" target="_blank" rel="external">getting-started</a><br><a href="http://usecreator.com/" target="_blank" rel="external">usecreator</a><br><a href="https://creator.ionic.io/app/dashboard/help/videos" target="_blank" rel="external">videos for creator</a><br><a href="http://codepen.io/ionic/pens/public/" target="_blank" rel="external">Many examples on codepen</a><br><a href="http://www.runoob.com/ionic" target="_blank" rel="external">courses on w3school.cc</a>  </p>
<h4 id="install-ionic"><a href="#install-ionic" class="headerlink" title="install ionic"></a>install ionic</h4><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">npm install -g cordova ionic</div><div class="line">ionic start myApp blank</div><div class="line">ionic start myApp tabs</div><div class="line">ionic start myApp sidemenu</div></pre></td></tr></table></figure>
<h3 id="run-or-emulate-your-app"><a href="#run-or-emulate-your-app" class="headerlink" title="run or emulate your app"></a>run or emulate your app</h3><p><a href="http://ionicframework.com/docs/cli/run.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/run.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="comment">#安装cordova/ionic</span></div><div class="line">npm install -g cordova ionic</div><div class="line"></div><div class="line"><span class="comment">#添加平台(ios相关操作请在mac机器下o(&gt;﹏&lt;)o)</span></div><div class="line">ionic platform add android/ios</div><div class="line"></div><div class="line"><span class="comment">#更新项目中的ionic js类库</span></div><div class="line">ionic lib update</div><div class="line"></div><div class="line"><span class="comment">#展示ionic项目结果 (同时显示iOS和android上的样式)</span></div><div class="line">ionic serve --lab</div><div class="line"></div><div class="line"><span class="comment">#安装/删除crosswalk</span></div><div class="line">ionic browser add/remove crosswalk</div></pre></td></tr></table></figure>
<h3 id="Icon-and-Splash-Screen-Image-Generation"><a href="#Icon-and-Splash-Screen-Image-Generation" class="headerlink" title="Icon and Splash Screen Image Generation"></a>Icon and Splash Screen Image Generation</h3><p>Guide below<br><a href="http://ionicframework.com/docs/cli/icon-splashscreen.html" target="_blank" rel="external">http://ionicframework.com/docs/cli/icon-splashscreen.html</a>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">cp ~/Downloads/logo11/free_logo_11.ai ./resources/icon.ai</div><div class="line">ionic resources --icon</div></pre></td></tr></table></figure>
<h3 id="splash-screen"><a href="#splash-screen" class="headerlink" title="splash screen"></a>splash screen</h3><p>2208 x 2208 splash.png  </p>
<p>search images on Google , set resolution to 2208 x 2208  </p>
<h2 id="Build-android-package"><a href="#Build-android-package" class="headerlink" title="Build android package"></a>Build android package</h2><p>Follow this guide<br><a href="http://ionicframework.com/docs/guide/publishing.html" target="_blank" rel="external">http://ionicframework.com/docs/guide/publishing.html</a>  </p>
<h3 id="安装android-sdk"><a href="#安装android-sdk" class="headerlink" title="安装android sdk"></a>安装android sdk</h3><p><a href="http://developer.android.com/sdk/installing/index.html" target="_blank" rel="external">http://developer.android.com/sdk/installing/index.html</a><br>Download Stand-alone SDK Tools  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">wget <span class="string">'http://dl.google.com/android/android-sdk_r24.4.1-macosx.zip'</span></div><div class="line">unzip android-sdk_r24.4.1-macosx.zip</div><div class="line">mv android-sdk-macosx /usr/<span class="built_in">local</span>/</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'export ANDROID_HOME="/usr/local/android-sdk-macosx"'</span> &gt;&gt; ~/.bash_profile</div><div class="line"><span class="built_in">echo</span> <span class="string">'export PATH="$PATH:$ANDROID_HOME/tools"'</span> &gt;&gt; ~/.bash_profile</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">'http.proxyPort=8123'</span> &gt;&gt; ~/.android/androidtool.cfg</div><div class="line"><span class="built_in">echo</span> <span class="string">'http.proxyHost=127.0.0.1'</span> &gt;&gt; ~/.android/androidtool.cfg</div><div class="line"></div><div class="line"><span class="comment"># android update sdk --no-ui</span></div><div class="line">android update sdk --no-https --no-ui --filter platform,system-image,tool,platform-tool</div><div class="line"></div><div class="line"><span class="built_in">cd</span> <span class="variable">$PROJECT_FOLDER</span></div><div class="line"></div><div class="line">vim config.xml</div><div class="line"></div><div class="line"><span class="comment">#we should remove debug console plugin before generating the release builds</span></div><div class="line"></div><div class="line">cordova plugin rm cordova-plugin-console</div><div class="line"></div><div class="line">cordova build --release android</div><div class="line"></div><div class="line">/bin/cp platforms/android/build/outputs/apk/android-release-unsigned.apk ./</div><div class="line"></div><div class="line"><span class="comment"># keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000</span></div><div class="line">keytool -genkey -v -keystore icinga-mobile-release-key.keystore -alias icinga_mobile -keyalg RSA -keysize 2048 -validity 10000</div><div class="line"></div><div class="line"><span class="comment"># jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore android-release-unsigned.apk alias_name</span></div><div class="line">jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore icinga-mobile-release-key.keystore android-release-unsigned.apk icinga_mobile</div><div class="line"></div><div class="line"><span class="comment"># zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</span></div><div class="line">/usr/<span class="built_in">local</span>/android-sdk-macosx/build-tools/23.0.2/zipalign -v 4 android-release-unsigned.apk icinga-dash.apk</div></pre></td></tr></table></figure>
<h2 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h2><p>style is much mess on Android  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// .config(function($stateProvider, $urlRouterProvider) &#123;</span></div><div class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$stateProvider, $urlRouterProvider , $ionicConfigProvider</span>) </span>&#123;</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.tabs.style(<span class="string">'standard'</span>);</div><div class="line">  $ionicConfigProvider.platform.ios.tabs.position(<span class="string">'bottom'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.tabs.style(<span class="string">'standard'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.tabs.position(<span class="string">'standard'</span>);</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.navBar.alignTitle(<span class="string">'center'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.navBar.alignTitle(<span class="string">'left'</span>);</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-ios-arrow-thin-left'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.backButton.previousTitleText(<span class="string">''</span>).icon(<span class="string">'ion-android-arrow-back'</span>);</div><div class="line"></div><div class="line">  $ionicConfigProvider.platform.ios.views.transition(<span class="string">'ios'</span>);</div><div class="line">  $ionicConfigProvider.platform.android.views.transition(<span class="string">'android'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Ionic uses AngularUI Router which uses the concept of states</span></div><div class="line">  <span class="comment">// Learn more here: https://github.com/angular-ui/ui-router</span></div><div class="line">  <span class="comment">// Set up the various states which the app can be in.</span></div><div class="line">  <span class="comment">// Each state's controller can be found in controllers.js</span></div><div class="line">  $stateProvider</div></pre></td></tr></table></figure>
<h2 id="Useful-resources"><a href="#Useful-resources" class="headerlink" title="Useful resources"></a>Useful resources</h2><h3 id="vuejs"><a href="#vuejs" class="headerlink" title="vuejs"></a>vuejs</h3><p><a href="http://vuejs.org/" target="_blank" rel="external">vuejs</a><br><a href="https://github.com/vuejs/awesome-vue" target="_blank" rel="external">awesome-vue</a></p>
<h3 id="MaterializeCSS"><a href="#MaterializeCSS" class="headerlink" title="MaterializeCSS"></a>MaterializeCSS</h3><p><a href="http://materializecss.com/mobile.html" target="_blank" rel="external">Materialize</a>  </p>
<h2 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h2><p><a href="http://flask-restful.readthedocs.org/" target="_blank" rel="external">Flask-RESTful</a></p>
<h2 id="SDK-installation-output"><a href="#SDK-installation-output" class="headerlink" title="SDK installation output"></a>SDK installation output</h2><figure class="highlight subunit"><table><tr><td class="code"><pre><div class="line">Running command: /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/hooks/after_prepare/010_add_platform_class.js /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend</div><div class="line">add to body class: platform-android</div><div class="line"><span class="keyword">ERROR </span>building one of the platforms: Please install Android target: "android<span class="string">-23</span>".</div><div class="line"></div><div class="line">Hint: Open the SDK manager by running: /usr/local/android-sdk-macosx/tools/android</div><div class="line">You will require:</div><div class="line">1. "SDK Platform" for android<span class="string">-23</span></div><div class="line">2. "Android SDK Platform-tools (latest)</div><div class="line">3. "Android SDK Build-tools" (latest)</div><div class="line">You may not have the required environment or OS to build this project</div><div class="line"><span class="keyword">Error: </span>Please install Android target: "android<span class="string">-23</span>".</div><div class="line"></div><div class="line">Hint: Open the SDK manager by running: /usr/local/android-sdk-macosx/tools/android</div><div class="line">You will require:</div><div class="line">1. "SDK Platform" for android<span class="string">-23</span></div><div class="line">2. "Android SDK Platform-tools (latest)</div><div class="line">3. "Android SDK Build-tools" (latest)</div></pre></td></tr></table></figure>
<h2 id="Android-build-process-output"><a href="#Android-build-process-output" class="headerlink" title="Android build process output"></a>Android build process output</h2><figure class="highlight clean"><table><tr><td class="code"><pre><div class="line">Running command: /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/hooks/after_prepare/<span class="number">010</span>_add_platform_class.js /Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend</div><div class="line">add to body <span class="keyword">class</span>: platform-android</div><div class="line">ANDROID_HOME=/usr/local/android-sdk-macosx</div><div class="line">JAVA_HOME=/Library/Java/Home</div><div class="line">Downloading http:<span class="comment">//services.gradle.org/distributions/gradle-2.2.1-all.zip</span></div><div class="line">.........................................................................</div><div class="line">:compileReleaseNdk UP-TO-DATE</div><div class="line">:compileReleaseSources</div><div class="line">:lintVitalRelease</div><div class="line">:transformClassesWithDexForRelease</div><div class="line">:mergeReleaseJniLibFolders</div><div class="line">:transformNative_libsWithMergeJniLibsForRelease</div><div class="line">:processReleaseJavaRes UP-TO-DATE</div><div class="line">:transformResourcesWithMergeJavaResForRelease</div><div class="line">:packageRelease</div><div class="line">:assembleRelease</div><div class="line">:cdvBuildRelease</div><div class="line"></div><div class="line">BUILD SUCCESSFUL</div><div class="line"></div><div class="line">Total time: <span class="number">5</span> mins <span class="number">21.356</span> secs</div><div class="line">Built the following apk(s): </div><div class="line">	/Users/arkii/Workspace/Projects/icinga-dashboard-mobile/frontend/platforms/android/build/outputs/apk/android-release-unsigned.apk</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ionic-hybrid-app-development&quot;&gt;&lt;a href=&quot;#ionic-hybrid-app-development&quot; class=&quot;headerlink&quot; title=&quot;ionic hybrid app development&quot;&gt;&lt;/a&gt;io
    
    </summary>
    
      <category term="dev" scheme="http://blog.wuliwala.net/categories/dev/"/>
    
    
      <category term="ionic" scheme="http://blog.wuliwala.net/tags/ionic/"/>
    
      <category term="app" scheme="http://blog.wuliwala.net/tags/app/"/>
    
  </entry>
  
  <entry>
    <title>BitBar plugin icinga2 overview</title>
    <link href="http://blog.wuliwala.net/2016/01/25/bitbar-plugin-icinga-overview/"/>
    <id>http://blog.wuliwala.net/2016/01/25/bitbar-plugin-icinga-overview/</id>
    <published>2016-01-25T02:42:00.000Z</published>
    <updated>2016-04-01T01:50:18.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MacBitBar-Plugin-icinga2-api-overview-py"><a href="#MacBitBar-Plugin-icinga2-api-overview-py" class="headerlink" title="MacBitBar Plugin icinga2-api-overview.py"></a>MacBitBar Plugin icinga2-api-overview.py</h1><p>Plugin to show icinga2 tactical overview, developed by python, in order to use this plugin, you should enable icinga2-api first.  </p>
<h2 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h2><p><a href="/images/2016/01/25/macbitbar-icinga-overview-480p.mp4">screencast here</a><br><img src="/images/2016/01/25/icinga2-api-overview.png" alt="">  </p>
<h2 id="Install-MacBitBar"><a href="#Install-MacBitBar" class="headerlink" title="Install MacBitBar"></a>Install MacBitBar</h2><p>Download the latest package from site below<br><a href="https://github.com/matryer/bitbar/releases" target="_blank" rel="external">https://github.com/matryer/bitbar/releases</a><br>Or install it by brew cask<br><code>brew cask install bitbar</code></p>
<h2 id="Get-plugin"><a href="#Get-plugin" class="headerlink" title="Get plugin"></a>Get plugin</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py" target="_blank" rel="external">https://github.com/arkii/gadgets/blob/master/Utility/BitBar/icinga2-api-overview.py</a>  </p>
<h2 id="Install-Plugin"><a href="#Install-Plugin" class="headerlink" title="Install Plugin"></a>Install Plugin</h2><p>Just download the plugin of your choice into your BitBar plugins directory and choose Refresh from one of the BitBar menu.  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">chmod +x icinga2-api-overview.py</div><div class="line"><span class="built_in">cd</span> Plugins/Enabled</div><div class="line"><span class="comment"># Enable uptime plugin and change update interval to 30 seconds</span></div><div class="line">ln <span class="_">-s</span> ../Utility/icinga2-api-overview.py icinga.30s.py</div></pre></td></tr></table></figure>
<h2 id="Other-plugins-built-by-me"><a href="#Other-plugins-built-by-me" class="headerlink" title="Other plugins built by me"></a>Other plugins built by me</h2><p><a href="https://github.com/arkii/gadgets/blob/master/Utility/BitBar/" target="_blank" rel="external">https://github.com/arkii/gadgets/Utility/BitBar/</a></p>
<h2 id="MacBitBar"><a href="#MacBitBar" class="headerlink" title="MacBitBar"></a>MacBitBar</h2><p><img src="/images/2016/01/25/bitbar-logo@2x.png" alt=""><br>The BitBar app lets you put the output from any script or program right in your Mac OS X menu bar. And it’s completely free. An impressive number of plugins have already been contributed by a wide range of developers just like you, and this site makes it easy to find them.  </p>
<p>Homepage:<br><a href="https://getbitbar.com" target="_blank" rel="external">https://getbitbar.com</a><br>Projects:<br><a href="https://github.com/matryer/bitbar" target="_blank" rel="external">BitBar</a><br><a href="https://github.com/matryer/bitbar-plugins" target="_blank" rel="external">BitBar-Plugins</a>  </p>
<h2 id="NagBar"><a href="#NagBar" class="headerlink" title="NagBar"></a>NagBar</h2><p><img src="/images/2016/01/25/nagbarapp.png" alt=""><br>NagBar is a freeware Nagios, Icinga and Thruk monitoring client which runs in the status bar and give updates about the monitored services. NagBar is a Mac OS X native application created using the Cocoa framework.  </p>
<p>Homepage:<br><a href="https://sites.google.com/site/nagbarapp/" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/</a><br>Screenshots:<br><a href="https://sites.google.com/site/nagbarapp/screenshots" target="_blank" rel="external">https://sites.google.com/site/nagbarapp/screenshots</a>  </p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;MacBitBar-Plugin-icinga2-api-overview-py&quot;&gt;&lt;a href=&quot;#MacBitBar-Plugin-icinga2-api-overview-py&quot; class=&quot;headerlink&quot; title=&quot;MacBitBar Pl
    
    </summary>
    
      <category term="gadget" scheme="http://blog.wuliwala.net/categories/gadget/"/>
    
    
      <category term="monitoring" scheme="http://blog.wuliwala.net/tags/monitoring/"/>
    
      <category term="sysops" scheme="http://blog.wuliwala.net/tags/sysops/"/>
    
  </entry>
  
  <entry>
    <title>icinga2 influxdb grafana integration</title>
    <link href="http://blog.wuliwala.net/2015/12/09/icinga2-influxdb-grafana-integration/"/>
    <id>http://blog.wuliwala.net/2015/12/09/icinga2-influxdb-grafana-integration/</id>
    <published>2015-12-09T03:57:25.000Z</published>
    <updated>2016-07-21T03:26:41.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="icinga2-influxdb-grafana-integration"><a href="#icinga2-influxdb-grafana-integration" class="headerlink" title="icinga2 influxdb grafana integration"></a>icinga2 influxdb grafana integration</h1><p>Using influxdb as storage, icinga2 passing the performance data which returned by plugins, and grafana is used for data visulizing.  </p>
<h2 id="preparation"><a href="#preparation" class="headerlink" title="preparation"></a>preparation</h2><p><strong>plugins’ output is STRICTLY nagios standard output</strong></p>
<figure class="highlight cs"><table><tr><td class="code"><pre><div class="line"><span class="meta"># OK - load average: 0.69, 0.97, 0.94|load1=0.690;16.000;30.000;0; load5=0.970;20.000;32.000;0; load15=0.940;24.000;34.000;0; </span></div><div class="line"></div><div class="line"><span class="meta"># hosts</span></div><div class="line">icinga2.server1.host.hostalive.perfdata.pl.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449566712</span></div><div class="line">icinga2.server1.host.hostalive.perfdata.rta.<span class="keyword">value</span> <span class="number">0.0041609999999999998</span> <span class="number">1449566712</span></div><div class="line"></div><div class="line"><span class="meta"># services</span></div><div class="line">icinga2.server1.service.nrpe_load.perfdata.load1.<span class="keyword">value</span> <span class="number">0.01</span> <span class="number">1449567314</span></div><div class="line">icinga2.server1.service.nrpe_load.perfdata.load5.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></div><div class="line">icinga2.server1.service.nrpe_load.perfdata.load15.<span class="keyword">value</span> <span class="number">0</span> <span class="number">1449567314</span></div></pre></td></tr></table></figure>
<h2 id="enable-icinga2-graphite-feature"><a href="#enable-icinga2-graphite-feature" class="headerlink" title="enable icinga2 graphite feature"></a>enable icinga2 graphite feature</h2><p><code># icinga2 feature enable perfdata</code><br><code># icinga2 feature enable graphite</code><br><code># vim /etc/icinga2/features-enabled/graphite.conf</code>  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * The GraphiteWriter type writes check result metrics and</div><div class="line"> * performance data to a graphite tcp socket.</div><div class="line"> */</div><div class="line"></div><div class="line">library <span class="string">"perfdata"</span></div><div class="line"></div><div class="line">object GraphiteWriter <span class="string">"graphite"</span> &#123;</div><div class="line">  <span class="comment">//host = "127.0.0.1"</span></div><div class="line">  <span class="comment">//port = 2003</span></div><div class="line">  host = <span class="string">"influxdb-server-with-graphite-plugin"</span></div><div class="line">  port = <span class="number">2004</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Optional. Metric prefix for host name. Defaults to "icinga2.$host.name$.host.$host.check_command$".</span></div><div class="line">host_name_template = <span class="string">"icinga2.$host.name$.host.$host.check_command$"</span></div><div class="line">service_name_template = <span class="string">"icinga2.$host.name$.service.$service.name$"</span></div><div class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.vars.nrpe_command$"</span></div><div class="line"><span class="comment">// service_name_template = "icinga2.$host.name$.service.$service.name$.$service.check_command$"</span></div><div class="line"><span class="comment">// Optional. Metric prefix for service name. Defaults to "icinga2.$host.name$.services.$service.name$.$service.check_command$".</span></div><div class="line"><span class="comment">// enable_send_thresholds = false // Optional. Send additional threshold metrics. Defaults to false.</span></div><div class="line"><span class="comment">// enable_send_metadata = false   // Optional. Send additional metadata metrics. Defaults to false.</span></div><div class="line"><span class="comment">// enable_legacy_mode = false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="define-the-internal-link-guiding-to-grafana-dashboard"><a href="#define-the-internal-link-guiding-to-grafana-dashboard" class="headerlink" title="define the internal link, guiding to grafana dashboard"></a>define the internal link, guiding to grafana dashboard</h2><p><code># vim /etc/icinga2/conf.d/templates.conf</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="keyword">template</span> Service <span class="string">"grafana-svc"</span> &#123;</div><div class="line">  <span class="comment">// http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=kddi-zol-dealer-web1&amp;var-CMD=nrpe_ss</span></div><div class="line">  notes_url = <span class="string">"http://grafana.yourdomain.com/dashboard/db/icinga?var-HOST=$HOSTNAME$&amp;var-CMD=$SERVICEDESC$"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="apply-the-template"><a href="#apply-the-template" class="headerlink" title="apply the template"></a>apply the template</h2><p><code># vim /etc/icinga2/conf.d/services.conf</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line">apply Service <span class="string">"nrpe_ss"</span> &#123;</div><div class="line">        <span class="keyword">import</span> <span class="string">"generic-service"</span></div><div class="line">        <span class="keyword">import</span> <span class="string">"grafana-svc"</span></div><div class="line">                check_command = <span class="string">"nrpe"</span></div><div class="line">                assign where <span class="string">"webserver"</span> in host.groups</div><div class="line">                vars.nrpe_timeout = <span class="number">240</span></div><div class="line">                vars.nrpe_command = <span class="string">"check_ss"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>icinga2 daemon -C &amp;&amp; service icinga2 reload</code>  </p>
<h2 id="Influxdb-graphite-plugin-configuration"><a href="#Influxdb-graphite-plugin-configuration" class="headerlink" title="Influxdb graphite plugin configuration"></a>Influxdb graphite plugin configuration</h2><p><code># vim /etc/influxdb/influxdb.conf</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">[[graphite]]</div><div class="line">  enabled = true</div><div class="line">  database = "icinga"</div><div class="line">  bind-address = ":2004"</div><div class="line">  protocol = "tcp"</div><div class="line">  consistency-level = "one"</div><div class="line">  ignore-unnamed = true</div><div class="line">  name-separator = "|"</div><div class="line">  # name-separator = "_"</div><div class="line">  templates = [</div><div class="line">     "icinga2.*.host.*.perfdata.*.*                   .measurement..cmd..metric.value",</div><div class="line">     "icinga2.*.service.*.perfdata.*.*                .measurement..cmd..metric.value",</div><div class="line">  ]</div><div class="line"></div><div class="line">[[graphite]]</div><div class="line">  enabled = true</div><div class="line">  database = "graphite"</div><div class="line">  bind-address = ":2003"</div><div class="line">  protocol = "tcp"</div><div class="line">  consistency-level = "one"</div><div class="line">  # name-separator = ";"</div><div class="line">  name-separator = "."</div><div class="line"></div><div class="line">  # These next lines control how batching works. You should have this enabled</div><div class="line">  # otherwise you could get dropped metrics or poor performance. Batching</div><div class="line">  # will buffer points in memory if you have many coming in.</div><div class="line"></div><div class="line">  # batch-size = 1000 # will flush if this many points get buffered</div><div class="line">  # batch-pending = 5 # number of batches that may be pending in memory</div><div class="line">  # batch-timeout = "1s" # will flush at least this often even if we haven't hit buffer limit</div><div class="line">  # udp-read-buffer = 0 # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.</div><div class="line"></div><div class="line">  ## "name-schema" configures tag names for parsing the metric name from graphite protocol;</div><div class="line">  ## separated by `name-separator`.</div><div class="line">  ## The "measurement" tag is special and the corresponding field will become</div><div class="line">  ## the name of the metric.</div><div class="line">  ## e.g. "type.host.measurement.device" will parse "server.localhost.cpu.cpu0" as</div><div class="line">  ## &#123;</div><div class="line">  ##     measurement: "cpu",</div><div class="line">  ##     tags: &#123;</div><div class="line">  ##         "type": "server",</div><div class="line">  ##         "host": "localhost,</div><div class="line">  ##         "device": "cpu0"</div><div class="line">  ##     &#125;</div><div class="line">  ## &#125;</div><div class="line">  # name-schema = "type.host.measurement.device"</div><div class="line"></div><div class="line">  ## If set to true, when the input metric name has more fields than `name-schema` specified,</div><div class="line">  ## the extra fields will be ignored.</div><div class="line">  ## Otherwise an error will be logged and the metric rejected.</div><div class="line">  # ignore-unnamed = true</div><div class="line"></div><div class="line">###</div><div class="line">### [collectd]</div><div class="line">###</div><div class="line">### Controls the listener for collectd data.</div><div class="line">###</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line"># grafana template variables</div><div class="line">$HOST</div><div class="line">SHOW MEASUREMENTS</div><div class="line">$CMD</div><div class="line">SHOW TAG VALUES FROM "$HOST" WITH KEY = "cmd"</div><div class="line">$METRIC</div><div class="line">SHOW TAG VALUES FROM "$HOST" WITH KEY = "metric" WHERE cmd = '$CMD'</div></pre></td></tr></table></figure>
<p><strong>grafana query below</strong><br><img src="/images/2015/12/1.png" alt="grafana-query"></p>
<h2 id="Get-the-share-link-from-grafana-dashboard"><a href="#Get-the-share-link-from-grafana-dashboard" class="headerlink" title="Get the share link from grafana dashboard"></a>Get the share link from grafana dashboard</h2><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://grafana.yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen&amp;var-HOST=server1&amp;var-CMD=nrpe_ss"</span> <span class="attr">width</span>=<span class="string">"450"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>cd /etc/icingaweb2/enabledModules/pnp4nagios/</code></p>
<p>icingaweb2 modules API here<br><code>/usr/share/icingaweb2/modules/monitoring/library/Monitoring/Object/Service.php</code></p>
<p>add grafana integration into icingaweb2   </p>
<p><code>/usr/share/icingaweb2/modules/pnp4nagios/library/Pnp4nagios/Grapher.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grapher</span> <span class="keyword">extends</span> <span class="title">GrapherHook</span></span></div><div class="line">&#123;</div><div class="line">    .........OLD COLD BLOCK........</div><div class="line">    </div><div class="line">    <span class="keyword">protected</span> $baseUrl = <span class="string">'/pnp4nagios'</span>;</div><div class="line">    <span class="keyword">protected</span> $grafanaBaseUrl = <span class="string">'http://yourdomain.com/dashboard-solo/db/icinga?panelId=1&amp;fullscreen'</span>;</div><div class="line">    </div><div class="line">    .........OLD COLD BLOCK........</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPreviewHtml</span><span class="params">(MonitoredObject $object)</span></span></div><div class="line">    &#123;</div><div class="line">    </div><div class="line">        .........OLD COLD BLOCK........</div><div class="line">        </div><div class="line">        $html .= <span class="string">"  &lt;/tr&gt;\n  &lt;tr&gt;\n"</span>;</div><div class="line">        <span class="keyword">foreach</span> ($viewKeys <span class="keyword">as</span> $view) &#123;</div><div class="line">            $html .= <span class="string">'    &lt;td style="border-left: 1px solid #555; padding-right: 3px"&gt;'</span></div><div class="line">                   . <span class="keyword">$this</span>-&gt;getPreviewImg($host, $service, $view)</div><div class="line">                   . <span class="string">"&lt;/td&gt;\n"</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Arkii 2015.12.14 added Grafana Integration</span></div><div class="line">        <span class="keyword">if</span> ($service != <span class="string">'_HOST_'</span> &amp;&amp; $object-&gt;service_notes_url) &#123;</div><div class="line">            $html .= <span class="string">"&lt;tr&gt;\n &lt;td&gt;\n"</span>;</div><div class="line">            $grafanaIframe = sprintf(</div><div class="line">                <span class="string">'&lt;iframe src="%s&amp;var-HOST=%s&amp;var-CMD=%s" width="480" height="150" frameborder="0"&gt;&lt;/iframe&gt;'</span>,</div><div class="line">                <span class="keyword">$this</span>-&gt;grafanaBaseUrl,</div><div class="line">                $host,</div><div class="line">                $service);</div><div class="line">            $html .= $grafanaIframe;</div><div class="line">            $html .= <span class="string">"&lt;/td&gt;\n &lt;/tr&gt;\n"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// end of Grafana Integration</span></div><div class="line"></div><div class="line">        $html .= <span class="string">"&lt;/tr&gt;&lt;/table&gt;\n"</span>;</div><div class="line">        <span class="keyword">return</span> $html;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="demos"><a href="#demos" class="headerlink" title="demos"></a>demos</h2><p><strong>work aside pnp4nagios</strong><br><img src="/images/2015/12/5.png" alt=""><br><strong>click the notes_url</strong><br><img src="/images/2015/12/2.png" alt="icinga-"><br><strong>jumped to your grafana dashboard</strong><br><img src="/images/2015/12/3.png" alt="grafana-1"><br><strong>another metric</strong><br><img src="/images/2015/12/4.png" alt="grafana-2"></p>
<h2 id="many-useful-links"><a href="#many-useful-links" class="headerlink" title="many useful links"></a>many useful links</h2><p><a href="http://play.grafana.org/" target="_blank" rel="external">so many grafana examples here</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/addons-plugins#addons-graphing-influxdb" target="_blank" rel="external">enable influxdb writer</a><br><a href="http://www.infoq.com/articles/graphite-intro" target="_blank" rel="external">graphite-intro-en</a><br><a href="http://www.infoq.com/cn/articles/graphite-intro" target="_blank" rel="external">graphite-intro-cn</a><br><a href="https://github.com/influxdb/influxdb/tree/master/services/graphite" target="_blank" rel="external">InfluxDB hook up Graphite as an input source</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/monitoring-basics#runtime-macros" target="_blank" rel="external">icinga2-runtime-macros</a><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/object-types#objecttype-graphitewriter" target="_blank" rel="external">icinga2-objecttype-graphitewriter</a><br><strong>Intruduced Performance Data Pipe of icinga2 in GREAT DETAIL[非常详细的icinga2性能数据管道说明]:</strong><br><a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/icinga2-features#performance-data" target="_blank" rel="external">icinga2-performance-data</a></p>
<h2 id="updated-2016-07-21"><a href="#updated-2016-07-21" class="headerlink" title="updated 2016.07.21"></a>updated 2016.07.21</h2><p><strong>how to create grafana template variables</strong><br>For this tutorial I’m using Grafana 2.0, I suggest you study on these two dashboards in playground @ grafana. </p>
<p>You can also edit graphs and look at the template settings.</p>
<p><a href="http://play.grafana.org/dashboard/db/monitorama-templating" target="_blank" rel="external">http://play.grafana.org/dashboard/db/monitorama-templating</a>  </p>
<p><a href="http://play.grafana.org/dashboard/db/templating-value-groups" target="_blank" rel="external">http://play.grafana.org/dashboard/db/monitorama-templating</a>  </p>
<p><img src="/images/2015/12/template1.png" alt="template-1">  </p>
<p><img src="/images/2015/12/template2.png" alt="template-2">  </p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;icinga2-influxdb-grafana-integration&quot;&gt;&lt;a href=&quot;#icinga2-influxdb-grafana-integration&quot; class=&quot;headerlink&quot; title=&quot;icinga2 influxdb gra
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>how to build tinycorelinux docker image</title>
    <link href="http://blog.wuliwala.net/2015/12/07/how-to-build-tinycorelinux-docker-image/"/>
    <id>http://blog.wuliwala.net/2015/12/07/how-to-build-tinycorelinux-docker-image/</id>
    <published>2015-12-07T02:14:57.000Z</published>
    <updated>2016-01-25T11:18:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="how-to-build-tinycorelinux-docker-image"><a href="#how-to-build-tinycorelinux-docker-image" class="headerlink" title="how to build tinycorelinux docker image"></a>how to build tinycorelinux docker image</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">wget http://tinycorelinux.net/6.x/x86_64/release/distribution_files/corepure64.gz</div><div class="line">mkdir chroot</div><div class="line">gunzip corepure64.gz</div><div class="line">cd chroot/</div><div class="line">cpio -i &lt; ../corepure64</div><div class="line">cd ..</div><div class="line">tar -C chroot -c . | docker import - tinycorelinux</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;how-to-build-tinycorelinux-docker-image&quot;&gt;&lt;a href=&quot;#how-to-build-tinycorelinux-docker-image&quot; class=&quot;headerlink&quot; title=&quot;how to build t
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>how to configure httpd proxy with authentication</title>
    <link href="http://blog.wuliwala.net/2015/12/02/how-to-configure-httpd-proxy-with-authentication/"/>
    <id>http://blog.wuliwala.net/2015/12/02/how-to-configure-httpd-proxy-with-authentication/</id>
    <published>2015-12-01T23:20:31.000Z</published>
    <updated>2016-01-25T11:18:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="how-to-configure-httpd-proxy-with-authentication"><a href="#how-to-configure-httpd-proxy-with-authentication" class="headerlink" title="how to configure httpd proxy with authentication"></a>how to configure httpd proxy with authentication</h1><p><code>vi gen.php</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;?php</div><div class="line">echo base64_encode(&quot;user:password&quot;);</div><div class="line">?&gt;</div></pre></td></tr></table></figure></p>
<p><code>php gen.php</code><br><code>dXNlcjpwYXNzd29yZA==</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">RewriteEngine On</div><div class="line">RewriteRule ^/orin/(.*)$    http://target.lb.com/$1   [NC,L,P]</div><div class="line"></div><div class="line">&lt;LocationMatch &quot;^/orin/(.*)$&quot;&gt;</div><div class="line">    #AddDefaultCharset GBK</div><div class="line">    RequestHeader set Authorization &quot;dXNlcjpwYXNzd29yZA==&quot;</div><div class="line">    ProxyPass http://target.lb.com/$1</div><div class="line">&lt;/LocationMatch&gt;</div></pre></td></tr></table></figure>
<h2 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h2><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_headers.html" target="_blank" rel="external">mod_headers</a><br><a href="https://httpd.apache.org/docs/2.4/rewrite/flags.html#flag_p" target="_blank" rel="external">rewrite flags</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassreverse" target="_blank" rel="external">mod_proxy.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;how-to-configure-httpd-proxy-with-authentication&quot;&gt;&lt;a href=&quot;#how-to-configure-httpd-proxy-with-authentication&quot; class=&quot;headerlink&quot; tit
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>how to configure httpd with ldap authentication</title>
    <link href="http://blog.wuliwala.net/2015/12/01/how-to-configure-httpd-with-ldap-authentication/"/>
    <id>http://blog.wuliwala.net/2015/12/01/how-to-configure-httpd-with-ldap-authentication/</id>
    <published>2015-12-01T00:07:06.000Z</published>
    <updated>2016-01-25T11:18:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="how-to-configure-httpd-with-ldap-authentication"><a href="#how-to-configure-httpd-with-ldap-authentication" class="headerlink" title="how to configure httpd with ldap authentication"></a>how to configure httpd with ldap authentication</h1><h2 id="httpd-2-4-ldap"><a href="#httpd-2-4-ldap" class="headerlink" title="httpd 2.4 ldap"></a>httpd 2.4 ldap</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">LoadModule authn_core_module modules/mod_authn_core.so</div><div class="line">LoadModule authz_host_module modules/mod_authz_host.so</div><div class="line">LoadModule authz_user_module modules/mod_authz_user.so</div><div class="line">LoadModule authz_core_module modules/mod_authz_core.so</div><div class="line">LoadModule access_compat_module modules/mod_access_compat.so</div><div class="line">LoadModule auth_basic_module modules/mod_auth_basic.so</div><div class="line">LoadModule ldap_module modules/mod_ldap.so</div><div class="line">LoadModule authnz_ldap_module modules/mod_authnz_ldap.so</div><div class="line"></div><div class="line">&lt;VirtualHost *:*&gt;</div><div class="line">ProxyPass / http://elk-kibana:5601/</div><div class="line">ProxyPassReverse / http://elk-kibana:5601/</div><div class="line"></div><div class="line">&lt;Proxy *&gt;</div><div class="line">Require all granted</div><div class="line"></div><div class="line"># LDAPSharedCacheSize 500000</div><div class="line"># LDAPCacheEntries 1024</div><div class="line"># LDAPCacheTTL 600</div><div class="line"># LDAPOpCacheEntries 1024</div><div class="line"># LDAPOpCacheTTL 600</div><div class="line">AuthType Basic</div><div class="line">AuthName &quot;Login with LDAP&quot;</div><div class="line">AuthBasicProvider ldap</div><div class="line">AuthLDAPURL &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;</div><div class="line">AuthLDAPBindDN &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;</div><div class="line">AuthLDAPBindPassword &lt;PUT Operator&apos;s PASSWORD HERE&gt;</div><div class="line">require valid-user</div><div class="line">&lt;/Proxy&gt; </div><div class="line"></div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
<h3 id="via-httpd-apache-org"><a href="#via-httpd-apache-org" class="headerlink" title="via:httpd.apache.org"></a>via:httpd.apache.org</h3><p><a href="https://httpd.apache.org/docs/2.4/mod/mod_ldap.html" target="_blank" rel="external">mod_ldap</a><br><a href="https://httpd.apache.org/docs/2.4/mod/mod_authnz_ldap.html" target="_blank" rel="external">mod_authnz_ldap</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;how-to-configure-httpd-with-ldap-authentication&quot;&gt;&lt;a href=&quot;#how-to-configure-httpd-with-ldap-authentication&quot; class=&quot;headerlink&quot; title
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>how to configure nginx with ldap authentication</title>
    <link href="http://blog.wuliwala.net/2015/12/01/how-to-configure-nginx-with-ldap-authentication/"/>
    <id>http://blog.wuliwala.net/2015/12/01/how-to-configure-nginx-with-ldap-authentication/</id>
    <published>2015-11-30T23:42:43.000Z</published>
    <updated>2016-01-25T11:18:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="how-to-configure-nginx-with-ldap-authentication"><a href="#how-to-configure-nginx-with-ldap-authentication" class="headerlink" title="how to configure nginx with ldap authentication"></a>how to configure nginx with ldap authentication</h1><h2 id="build-from-source"><a href="#build-from-source" class="headerlink" title="build from source"></a>build from source</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">version=&apos;1.8.0&apos;</div><div class="line"></div><div class="line">apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</div><div class="line"></div><div class="line">mkdir build &amp;&amp; cd build</div><div class="line">wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line">wget http://nginx.org/download/nginx-$&#123;version&#125;.tar.gz</div><div class="line">tar xvf nginx-$&#123;version&#125;.tar.gz &amp;&amp; cd nginx-$&#123;version&#125;</div><div class="line"></div><div class="line">./configure \</div><div class="line">--prefix=/etc/nginx \</div><div class="line">--sbin-path=/usr/sbin/nginx \</div><div class="line">--conf-path=/etc/nginx/nginx.conf \</div><div class="line">--error-log-path=/var/log/nginx/error.log \</div><div class="line">--http-log-path=/var/log/nginx/access.log \</div><div class="line">--pid-path=/var/run/nginx.pid \</div><div class="line">--lock-path=/var/run/nginx.lock \</div><div class="line">--http-client-body-temp-path=/var/cache/nginx/client_temp \</div><div class="line">--http-proxy-temp-path=/var/cache/nginx/proxy_temp \</div><div class="line">--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</div><div class="line">--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</div><div class="line">--http-scgi-temp-path=/var/cache/nginx/scgi_temp \</div><div class="line">--user=nginx \</div><div class="line">--group=nginx \</div><div class="line">--with-http_ssl_module \</div><div class="line">--with-http_realip_module \</div><div class="line">--with-http_addition_module \</div><div class="line">--with-http_sub_module \</div><div class="line">--with-http_dav_module \</div><div class="line">--with-http_flv_module \</div><div class="line">--with-http_mp4_module \</div><div class="line">--with-http_gunzip_module \</div><div class="line">--with-http_gzip_static_module \</div><div class="line">--with-http_random_index_module \</div><div class="line">--with-http_secure_link_module \</div><div class="line">--with-http_stub_status_module \</div><div class="line">--with-http_auth_request_module \</div><div class="line">--with-mail \</div><div class="line">--with-mail_ssl_module \</div><div class="line">--with-file-aio \</div><div class="line">--with-http_spdy_module \</div><div class="line">--with-ipv6 \</div><div class="line">--add-module=../nginx-auth-ldap-master</div><div class="line"></div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">FROM debian:jessie</div><div class="line"># bugs here https://github.com/kvspb/nginx-auth-ldap/issues/88</div><div class="line"># nginx: [emerg] http_auth_ldap: parse_require in /etc/nginx/nginx.conf:45</div><div class="line"># nginx: [emerg] http_auth_ldap: Setting group in /etc/nginx/nginx.conf:45</div><div class="line">MAINTAINER Arkii &quot;sqy6@163.com&quot;</div><div class="line"></div><div class="line">RUN echo &apos;Asia/Shanghai&apos; &gt; /etc/timezone &amp;&amp; \</div><div class="line">    /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</div><div class="line">    groupadd -g 396 nginx &amp;&amp; \</div><div class="line">    useradd nginx -u 396 -g 396 -M -c &apos;Nginx web server&apos; -s /sbin/nologin -d /var/lib/nginx &amp;&amp; \</div><div class="line">    mkdir -p /var/log/nginx /var/lib/nginx /var/cache/nginx /usr/share/nginx &amp;&amp; \</div><div class="line">    chown -R nginx:nginx /var/log/nginx /var/lib/nginx /var/cache/nginx &amp;&amp; \</div><div class="line">    ln -sf /dev/stdout /var/log/nginx/access.log &amp;&amp; \</div><div class="line">    ln -sf /dev/stderr /var/log/nginx/error.log</div><div class="line"></div><div class="line">ENV NGINX_VERSION 1.8.0</div><div class="line"></div><div class="line">RUN apt-get update &amp;&amp; \</div><div class="line">    apt-get install -y wget unzip make gcc libzip-dev libssl-dev libpcre3-dev libldap2-dev</div><div class="line"></div><div class="line">RUN mkdir /tmp/build &amp;&amp; cd /tmp/build &amp;&amp; \</div><div class="line">    wget https://github.com/kvspb/nginx-auth-ldap/archive/master.zip &amp;&amp; \</div><div class="line">    unzip master.zip &amp;&amp; \</div><div class="line">    wget http://nginx.org/download/nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; \</div><div class="line">    tar xf nginx-$&#123;NGINX_VERSION&#125;.tar.gz &amp;&amp; cd nginx-$&#123;NGINX_VERSION&#125; &amp;&amp; \</div><div class="line"></div><div class="line">    ./configure \</div><div class="line">    --prefix=/etc/nginx \</div><div class="line">    --sbin-path=/usr/sbin/nginx \</div><div class="line">    --conf-path=/etc/nginx/nginx.conf \</div><div class="line">    --error-log-path=/var/log/nginx/error.log \</div><div class="line">    --http-log-path=/var/log/nginx/access.log \</div><div class="line">    --pid-path=/var/run/nginx.pid \</div><div class="line">    --lock-path=/var/run/nginx.lock \</div><div class="line">    --http-client-body-temp-path=/var/cache/nginx/client_temp \</div><div class="line">    --http-proxy-temp-path=/var/cache/nginx/proxy_temp \</div><div class="line">    --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \</div><div class="line">    --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \</div><div class="line">    --http-scgi-temp-path=/var/cache/nginx/scgi_temp \</div><div class="line">    --user=nginx \</div><div class="line">    --group=nginx \</div><div class="line">    --with-http_ssl_module \</div><div class="line">    --with-http_realip_module \</div><div class="line">    --with-http_addition_module \</div><div class="line">    --with-http_sub_module \</div><div class="line">    --with-http_dav_module \</div><div class="line">    --with-http_flv_module \</div><div class="line">    --with-http_mp4_module \</div><div class="line">    --with-http_gunzip_module \</div><div class="line">    --with-http_gzip_static_module \</div><div class="line">    --with-http_random_index_module \</div><div class="line">    --with-http_secure_link_module \</div><div class="line">    --with-http_stub_status_module \</div><div class="line">    --with-http_auth_request_module \</div><div class="line">    --with-mail \</div><div class="line">    --with-mail_ssl_module \</div><div class="line">    --with-file-aio \</div><div class="line">    --with-http_spdy_module \</div><div class="line">    --with-ipv6 \</div><div class="line">    --add-module=../nginx-auth-ldap-master &amp;&amp; \</div><div class="line"></div><div class="line">    make &amp;&amp; make install</div><div class="line"></div><div class="line">RUN apt-get remove -y gcc wget make unzip &amp;&amp; \</div><div class="line">       rm -rf /var/lib/apt/lists/*</div><div class="line"></div><div class="line">EXPOSE 80 443 8000 8080</div><div class="line">ENTRYPOINT [&quot;nginx&quot;]</div><div class="line">CMD [&quot;-g&quot;, &quot;daemon off;&quot;]</div></pre></td></tr></table></figure>
<h2 id="configfile-example"><a href="#configfile-example" class="headerlink" title="configfile example"></a>configfile example</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line"># user  nobody;</div><div class="line">worker_processes  1;</div><div class="line"></div><div class="line"># error_log  logs/error.log;</div><div class="line"># error_log  logs/error.log  notice;</div><div class="line"># error_log  logs/error.log  info;</div><div class="line"></div><div class="line"># pid        logs/nginx.pid;</div><div class="line"></div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line"></div><div class="line">    #access_log  logs/access.log  main;</div><div class="line"></div><div class="line">    sendfile        on;</div><div class="line">    #tcp_nopush     on;</div><div class="line"></div><div class="line">    #keepalive_timeout  0;</div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line">    #gzip  on;</div><div class="line"></div><div class="line">    auth_ldap_cache_enabled on;</div><div class="line">    auth_ldap_cache_expiration_time 10000;</div><div class="line">    auth_ldap_cache_size 1000;</div><div class="line">    ldap_server ad_1 &#123;</div><div class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</div><div class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</div><div class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</div><div class="line">      #connect_timeout 5s;</div><div class="line">      #bind_timeout 5s;</div><div class="line">      #request_timeout 5s;</div><div class="line">      group_attribute member;</div><div class="line">      group_attribute_is_dn on;</div><div class="line">      satisfy any;</div><div class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</div><div class="line">    &#125;</div><div class="line">    ldap_server ad_2 &#123;</div><div class="line">      url &quot;ldap://&lt;YOUR LDAP SERVER&gt;:3268/OU=Offices,DC=company,DC=com?sAMAccountName?sub?(objectClass=person)&quot;;</div><div class="line">      binddn &quot;CN=Operator,OU=Service Accounts,DC=company,DC=com&quot;;</div><div class="line">      binddn_passwd &lt;PUT Operator&apos;s PASSWORD HERE&gt;;</div><div class="line">      #connect_timeout 5s;</div><div class="line">      #bind_timeout 5s;</div><div class="line">      #request_timeout 5s;</div><div class="line">      group_attribute member;</div><div class="line">      group_attribute_is_dn on;</div><div class="line">      satisfy any;</div><div class="line">      require group &quot;CN=Admins,OU=My Security Groups,DC=company,DC=com&quot;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  localhost;</div><div class="line"></div><div class="line">        auth_ldap &quot;Login with LDAP account&quot;;</div><div class="line">        auth_ldap_servers ad_1;</div><div class="line">        auth_ldap_servers ad_2;</div><div class="line"></div><div class="line">        #charset koi8-r;</div><div class="line"></div><div class="line">        #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        #error_page  404              /404.html;</div><div class="line"></div><div class="line">        # redirect server error pages to the static page /50x.html</div><div class="line">        #</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="image-on-Docker-hub"><a href="#image-on-Docker-hub" class="headerlink" title="image on Docker hub"></a>image on Docker hub</h2><p><code>docker pull docker.io/arkii/nginx-ldap:1.8.0</code></p>
<p><a href="https://github.com/kvspb/nginx-auth-ldap" target="_blank" rel="external">github</a><br><a href="http://deezx.github.io/blog/2015/04/24/how-to-configure-nginx-with-ldap-authentication/" target="_blank" rel="external">blog</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;how-to-configure-nginx-with-ldap-authentication&quot;&gt;&lt;a href=&quot;#how-to-configure-nginx-with-ldap-authentication&quot; class=&quot;headerlink&quot; title
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>When A Man Loves A Woman</title>
    <link href="http://blog.wuliwala.net/2015/11/27/when-a-man-loves-a-woman/"/>
    <id>http://blog.wuliwala.net/2015/11/27/when-a-man-loves-a-woman/</id>
    <published>2015-11-27T06:41:01.000Z</published>
    <updated>2016-01-25T11:18:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="When-A-Man-Loves-A-Woman"><a href="#When-A-Man-Loves-A-Woman" class="headerlink" title="When A Man Loves A Woman"></a>When A Man Loves A Woman</h1><p>作词 : Calvin Lewis/Andrew Wright<br>原唱 : Percy Sledge<br>翻唱 : Michael Bolton, 金润吉<br>当一个男人爱上一个女人<br>他的脑子就再也装不下任何东西<br>他宁愿出卖整个世界<br>就为了他寻得的挚爱<br>如果她很坏，他也看不到<br>她不会错<br>他甚至会背弃最好的朋友<br>如果朋友敢轻视她  </p>
<p>当一个男人爱上一个女人<br>会花光他的每一分<br>来维持他所需要的<br>他愿意放弃所有安逸<br>露宿街头 睡在雨中<br>如果她说就该做这些事  </p>
<p>当一个男人爱上一个女人<br>他会献出自己的所有<br>试图保住 这份宝贵的爱<br>宝贝请别忽视我  </p>
<p>当一个男人爱上一个女人<br>他的灵魂深处<br>她能使他痛苦如斯<br>如果她玩弄他如一个傻瓜<br>他也永远后知后觉<br>陷入爱河的人总是盲目  </p>
<p>是的当一个男人爱上一个女人<br>我完全了解他的心思  </p>
<p>当一个男人爱上一个女人  </p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;When-A-Man-Loves-A-Woman&quot;&gt;&lt;a href=&quot;#When-A-Man-Loves-A-Woman&quot; class=&quot;headerlink&quot; title=&quot;When A Man Loves A Woman&quot;&gt;&lt;/a&gt;When A Man Lov
    
    </summary>
    
    
  </entry>
  
</feed>
